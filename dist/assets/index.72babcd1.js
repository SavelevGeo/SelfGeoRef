(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const Zp={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection"};class qp extends Error{constructor(e){const t=Zp[e];super(t),this.code=e,this.name="AssertionError",this.message=t}}const ig=qp;class Jp{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Ei=Jp,Zs={PROPERTYCHANGE:"propertychange"};class Qp{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}const Fa=Qp;function eb(r,e,t){let i,n;t=t||wn;let s=0,o=r.length,a=!1;for(;s<o;)i=s+(o-s>>1),n=+t(r[i],e),n<0?s=i+1:(o=i,a=!n);return a?s:~s}function wn(r,e){return r>e?1:r<e?-1:0}function Pa(r,e,t){const i=r.length;if(r[0]<=e)return 0;if(e<=r[i-1])return i-1;{let n;if(t>0){for(n=1;n<i;++n)if(r[n]<e)return n-1}else if(t<0){for(n=1;n<i;++n)if(r[n]<=e)return n}else for(n=1;n<i;++n){if(r[n]==e)return n;if(r[n]<e)return typeof t=="function"?t(e,r[n-1],r[n])>0?n-1:n:r[n-1]-e<e-r[n]?n-1:n}return i-1}}function tb(r,e,t){for(;e<t;){const i=r[e];r[e]=r[t],r[t]=i,++e,--t}}function en(r,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let n=0;n<i;n++)r[r.length]=t[n]}function xn(r,e){const t=r.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(r[i]!==e[i])return!1;return!0}function ib(r,e,t){const i=e||wn;return r.every(function(n,s){if(s===0)return!0;const o=i(r[s-1],n);return!(o>0||t&&o===0)})}function rs(){return!0}function gs(){return!1}function os(){}function nb(r){let e=!1,t,i,n;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==n||!xn(s,i))&&(e=!0,n=this,i=s,t=r.apply(this,arguments)),t}}function sb(r){function e(){let t;try{t=r()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function ar(r){for(const e in r)delete r[e]}function Ur(r){let e;for(e in r)return!1;return!e}class rb extends Fa{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),n=i[e]||(i[e]=[]);n.includes(t)||n.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const s=t?new Ei(e):e;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let u=0,f=n.length;u<f;++u)if("handleEvent"in n[u]?l=n[u].handleEvent(s):l=n[u].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[i]===0){let u=a[i];for(delete a[i];u--;)this.removeEventListener(i,os);delete o[i]}return l}disposeInternal(){this.listeners_&&ar(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){const i=this.listeners_&&this.listeners_[e];if(i){const n=i.indexOf(t);n!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[n]=os,++this.pendingRemovals_[e]):(i.splice(n,1),i.length===0&&delete this.listeners_[e]))}}}const lr=rb,Te={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function ze(r,e,t,i,n){if(i&&i!==r&&(t=t.bind(i)),n){const o=t;t=function(){r.removeEventListener(e,t),o.apply(this,arguments)}}const s={target:r,type:e,listener:t};return r.addEventListener(e,t),s}function ha(r,e,t,i){return ze(r,e,t,i,!0)}function lt(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),ar(r))}class hr extends lr{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Te.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=ze(this,e[s],t);return n}else return ze(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const n=e.length;i=new Array(n);for(let s=0;s<n;++s)i[s]=ha(this,e[s],t)}else i=ha(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)ng(i);else if(Array.isArray(e))for(let n=0,s=e.length;n<s;++n)this.removeEventListener(e[n],t);else this.removeEventListener(e,t)}}hr.prototype.on;hr.prototype.once;hr.prototype.un;function ng(r){if(Array.isArray(r))for(let e=0,t=r.length;e<t;++e)lt(r[e]);else lt(r)}const ob=Object.freeze(Object.defineProperty({__proto__:null,unByKey:ng,default:hr},Symbol.toStringTag,{value:"Module"}));function Ze(){throw new Error("Unimplemented abstract method.")}let ab=0;function Ie(r){return r.ol_uid||(r.ol_uid=String(++ab))}class Hd extends Ei{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class lb extends hr{constructor(e){super(),this.on,this.once,this.un,Ie(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new Hd(i,e,t)),i=Zs.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new Hd(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const n=this.values_||(this.values_={});if(i)n[e]=t;else{const s=n[e];n[e]=t,s!==t&&this.notify(e,s)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){!e.values_||Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],Ur(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}const Hi=lb,Ft={ADD:"add",REMOVE:"remove"},Ud={LENGTH:"length"};class Bo extends Ei{constructor(e,t,i){super(e),this.element=t,this.index=i}}class hb extends Hi{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let i=0,n=this.array_.length;i<n;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,n=t.length;i<n;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(Ud.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Bo(Ft.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,n=t.length;i<n;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Bo(Ft.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const n=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Bo(Ft.REMOVE,n,e)),this.dispatchEvent(new Bo(Ft.ADD,t,e))}updateLength_(){this.set(Ud.LENGTH,this.array_.length)}assertUnique_(e,t){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===e&&i!==t)throw new ig(58)}}const mi=hb,oi={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};function Xe(r,e){if(!r)throw new ig(e)}class yh extends Hi{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new yh(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(lt(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=ze(e,Te.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?cb(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function cb(r){if(typeof r=="function")return r;{let e;return Array.isArray(r)?e=r:(Xe(typeof r.getZIndex=="function",41),e=[r]),function(){return e}}}const Is=yh;class vh{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null}clone(){const e=this.getColor();return new vh({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){this.color_=e}}const qs=vh,Cn=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",ub=Cn.includes("firefox"),db=Cn.includes("safari")&&!Cn.includes("chrom"),fb=db&&(Cn.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Cn)),gb=Cn.includes("webkit")&&!Cn.includes("edge"),mb=Cn.includes("macintosh"),sg=typeof devicePixelRatio<"u"?devicePixelRatio:1,Eh=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,pb=typeof Image<"u"&&Image.prototype.decode,rg=function(){let r=!1;try{const e=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return r}(),wh=new Array(6);function ai(){return[1,0,0,1,0,0]}function sa(r){return io(r,1,0,0,1,0,0)}function Ch(r,e){const t=r[0],i=r[1],n=r[2],s=r[3],o=r[4],a=r[5],l=e[0],u=e[1],f=e[2],m=e[3],_=e[4],C=e[5];return r[0]=t*l+n*u,r[1]=i*l+s*u,r[2]=t*f+n*m,r[3]=i*f+s*m,r[4]=t*_+n*C+o,r[5]=i*_+s*C+a,r}function io(r,e,t,i,n,s,o){return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r[4]=s,r[5]=o,r}function bb(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r}function St(r,e){const t=e[0],i=e[1];return e[0]=r[0]*t+r[2]*i+r[4],e[1]=r[1]*t+r[3]*i+r[5],e}function og(r,e){const t=Math.cos(e),i=Math.sin(e);return Ch(r,io(wh,t,i,-i,t,0,0))}function Kl(r,e,t){return Ch(r,io(wh,e,0,0,t,0,0))}function _b(r,e,t){return io(r,e,0,0,t,0,0)}function yb(r,e,t){return Ch(r,io(wh,1,0,0,1,e,t))}function vi(r,e,t,i,n,s,o,a){const l=Math.sin(s),u=Math.cos(s);return r[0]=i*u,r[1]=n*l,r[2]=-i*l,r[3]=n*u,r[4]=o*i*u-a*i*l+e,r[5]=o*n*l+a*n*u+t,r}function Oa(r,e){const t=vb(e);Xe(t!==0,32);const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5];return r[0]=o/t,r[1]=-n/t,r[2]=-s/t,r[3]=i/t,r[4]=(s*l-o*a)/t,r[5]=-(i*l-n*a)/t,r}function vb(r){return r[0]*r[3]-r[1]*r[2]}let Vd;function xh(r){const e="matrix("+r.join(", ")+")";if(Eh)return e;const t=Vd||(Vd=document.createElement("div"));return t.style.transform=e,t.style.transform}const Mt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Bt(r){const e=pi();for(let t=0,i=r.length;t<i;++t)Or(e,r[t]);return e}function no(r,e,t){return t?(t[0]=r[0]-e,t[1]=r[1]-e,t[2]=r[2]+e,t[3]=r[3]+e,t):[r[0]-e,r[1]-e,r[2]+e,r[3]+e]}function ag(r,e){return e?(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e):r.slice()}function ms(r,e,t){let i,n;return e<r[0]?i=r[0]-e:r[2]<e?i=e-r[2]:i=0,t<r[1]?n=r[1]-t:r[3]<t?n=t-r[3]:n=0,i*i+n*n}function as(r,e){return Th(r,e[0],e[1])}function Zn(r,e){return r[0]<=e[0]&&e[2]<=r[2]&&r[1]<=e[1]&&e[3]<=r[3]}function Th(r,e,t){return r[0]<=e&&e<=r[2]&&r[1]<=t&&t<=r[3]}function $l(r,e){const t=r[0],i=r[1],n=r[2],s=r[3],o=e[0],a=e[1];let l=Mt.UNKNOWN;return o<t?l=l|Mt.LEFT:o>n&&(l=l|Mt.RIGHT),a<i?l=l|Mt.BELOW:a>s&&(l=l|Mt.ABOVE),l===Mt.UNKNOWN&&(l=Mt.INTERSECTING),l}function pi(){return[1/0,1/0,-1/0,-1/0]}function zi(r,e,t,i,n){return n?(n[0]=r,n[1]=e,n[2]=t,n[3]=i,n):[r,e,t,i]}function so(r){return zi(1/0,1/0,-1/0,-1/0,r)}function ra(r,e){const t=r[0],i=r[1];return zi(t,i,t,i,e)}function lg(r,e,t,i,n){const s=so(n);return cg(s,r,e,t,i)}function Js(r,e){return r[0]==e[0]&&r[2]==e[2]&&r[1]==e[1]&&r[3]==e[3]}function hg(r,e){return e[0]<r[0]&&(r[0]=e[0]),e[2]>r[2]&&(r[2]=e[2]),e[1]<r[1]&&(r[1]=e[1]),e[3]>r[3]&&(r[3]=e[3]),r}function Or(r,e){e[0]<r[0]&&(r[0]=e[0]),e[0]>r[2]&&(r[2]=e[0]),e[1]<r[1]&&(r[1]=e[1]),e[1]>r[3]&&(r[3]=e[1])}function cg(r,e,t,i,n){for(;t<i;t+=n)Eb(r,e[t],e[t+1]);return r}function Eb(r,e,t){r[0]=Math.min(r[0],e),r[1]=Math.min(r[1],t),r[2]=Math.max(r[2],e),r[3]=Math.max(r[3],t)}function Rh(r,e){let t;return t=e(ka(r)),t||(t=e(Na(r)),t)||(t=e(Ga(r)),t)||(t=e(ps(r)),t)?t:!1}function Zl(r){let e=0;return ro(r)||(e=ot(r)*jt(r)),e}function ka(r){return[r[0],r[1]]}function Na(r){return[r[2],r[1]]}function rn(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function wb(r,e){let t;return e==="bottom-left"?t=ka(r):e==="bottom-right"?t=Na(r):e==="top-left"?t=ps(r):e==="top-right"?t=Ga(r):Xe(!1,13),t}function ql(r,e,t,i,n){const[s,o,a,l,u,f,m,_]=Jl(r,e,t,i);return zi(Math.min(s,a,u,m),Math.min(o,l,f,_),Math.max(s,a,u,m),Math.max(o,l,f,_),n)}function Jl(r,e,t,i){const n=e*i[0]/2,s=e*i[1]/2,o=Math.cos(t),a=Math.sin(t),l=n*o,u=n*a,f=s*o,m=s*a,_=r[0],C=r[1];return[_-l+m,C-u-f,_-l-m,C-u+f,_+l-m,C+u+f,_+l+m,C+u-f,_-l+m,C-u-f]}function jt(r){return r[3]-r[1]}function Li(r,e,t){const i=t||pi();return Nt(r,e)?(r[0]>e[0]?i[0]=r[0]:i[0]=e[0],r[1]>e[1]?i[1]=r[1]:i[1]=e[1],r[2]<e[2]?i[2]=r[2]:i[2]=e[2],r[3]<e[3]?i[3]=r[3]:i[3]=e[3]):so(i),i}function ps(r){return[r[0],r[3]]}function Ga(r){return[r[2],r[3]]}function ot(r){return r[2]-r[0]}function Nt(r,e){return r[0]<=e[2]&&r[2]>=e[0]&&r[1]<=e[3]&&r[3]>=e[1]}function ro(r){return r[2]<r[0]||r[3]<r[1]}function Cb(r,e){return e?(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e):r}function xb(r,e,t){let i=!1;const n=$l(r,e),s=$l(r,t);if(n===Mt.INTERSECTING||s===Mt.INTERSECTING)i=!0;else{const o=r[0],a=r[1],l=r[2],u=r[3],f=e[0],m=e[1],_=t[0],C=t[1],R=(C-m)/(_-f);let L,A;!!(s&Mt.ABOVE)&&!(n&Mt.ABOVE)&&(L=_-(C-u)/R,i=L>=o&&L<=l),!i&&!!(s&Mt.RIGHT)&&!(n&Mt.RIGHT)&&(A=C-(_-l)*R,i=A>=a&&A<=u),!i&&!!(s&Mt.BELOW)&&!(n&Mt.BELOW)&&(L=_-(C-a)/R,i=L>=o&&L<=l),!i&&!!(s&Mt.LEFT)&&!(n&Mt.LEFT)&&(A=C-(_-o)*R,i=A>=a&&A<=u)}return i}function ug(r,e){const t=e.getExtent(),i=rn(r);if(e.canWrapX()&&(i[0]<t[0]||i[0]>=t[2])){const n=ot(t),o=Math.floor((i[0]-t[0])/n)*n;r[0]-=o,r[2]-=o}return r}function Tb(r,e){if(e.canWrapX()){const t=e.getExtent();if(!isFinite(r[0])||!isFinite(r[2]))return[[t[0],r[1],t[2],r[3]]];ug(r,e);const i=ot(t);if(ot(r)>i)return[[t[0],r[1],t[2],r[3]]];if(r[0]<t[0])return[[r[0]+i,r[1],t[2],r[3]],[t[0],r[1],r[2],r[3]]];if(r[2]>t[2])return[[r[0],r[1],t[2],r[3]],[t[0],r[1],r[2]-i,r[3]]]}return[r]}const Rb={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function Wd(r){return Rb[r]}const Vr={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Sb{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Vr[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const ca=Sb,oo=6378137,Gs=Math.PI*oo,Lb=[-Gs,-Gs,Gs,Gs],Db=[-180,-85,180,85],jo=oo*Math.log(Math.tan(Math.PI/2));class Rs extends ca{constructor(e){super({code:e,units:"m",extent:Lb,global:!0,worldExtent:Db,getPointResolution:function(t,i){return t/Math.cosh(i[1]/oo)}})}}const Xd=[new Rs("EPSG:3857"),new Rs("EPSG:102100"),new Rs("EPSG:102113"),new Rs("EPSG:900913"),new Rs("http://www.opengis.net/def/crs/EPSG/0/3857"),new Rs("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Ab(r,e,t){const i=r.length;t=t>1?t:2,e===void 0&&(t>2?e=r.slice():e=new Array(i));for(let n=0;n<i;n+=t){e[n]=Gs*r[n]/180;let s=oo*Math.log(Math.tan(Math.PI*(+r[n+1]+90)/360));s>jo?s=jo:s<-jo&&(s=-jo),e[n+1]=s}return e}function Mb(r,e,t){const i=r.length;t=t>1?t:2,e===void 0&&(t>2?e=r.slice():e=new Array(i));for(let n=0;n<i;n+=t)e[n]=180*r[n]/Gs,e[n+1]=360*Math.atan(Math.exp(r[n+1]/oo))/Math.PI-90;return e}const Ib=6378137,Yd=[-180,-90,180,90],Fb=Math.PI*Ib/180;class Wn extends ca{constructor(e,t){super({code:e,units:"degrees",extent:Yd,axisOrientation:t,global:!0,metersPerUnit:Fb,worldExtent:Yd})}}const Kd=[new Wn("CRS:84"),new Wn("EPSG:4326","neu"),new Wn("urn:ogc:def:crs:OGC:1.3:CRS84"),new Wn("urn:ogc:def:crs:OGC:2:84"),new Wn("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Wn("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Wn("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ql={};function Pb(r){return Ql[r]||Ql[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Ob(r,e){Ql[r]=e}let Us={};function ua(r,e,t){const i=r.getCode(),n=e.getCode();i in Us||(Us[i]={}),Us[i][n]=t}function kb(r,e){let t;return r in Us&&e in Us[r]&&(t=Us[r][e]),t}function wt(r,e,t){return Math.min(Math.max(r,e),t)}function Nb(r,e,t,i,n,s){const o=n-t,a=s-i;if(o!==0||a!==0){const l=((r-t)*o+(e-i)*a)/(o*o+a*a);l>1?(t=n,i=s):l>0&&(t+=o*l,i+=a*l)}return tn(r,e,t,i)}function tn(r,e,t,i){const n=t-r,s=i-e;return n*n+s*s}function Gb(r){const e=r.length;for(let i=0;i<e;i++){let n=i,s=Math.abs(r[i][i]);for(let a=i+1;a<e;a++){const l=Math.abs(r[a][i]);l>s&&(s=l,n=a)}if(s===0)return null;const o=r[n];r[n]=r[i],r[i]=o;for(let a=i+1;a<e;a++){const l=-r[a][i]/r[i][i];for(let u=i;u<e+1;u++)i==u?r[a][u]=0:r[a][u]+=l*r[i][u]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=r[i][e]/r[i][i];for(let n=i-1;n>=0;n--)r[n][e]-=r[n][i]*t[i]}return t}function oa(r){return r*Math.PI/180}function ts(r,e){const t=r%e;return t*e<0?t+e:t}function Zi(r,e,t){return r+t*(e-r)}function Sh(r,e){const t=Math.pow(10,e);return Math.round(r*t)/t}function Ho(r,e){return Math.floor(Sh(r,e))}function Uo(r,e){return Math.ceil(Sh(r,e))}function zb(r,e){return r[0]+=+e[0],r[1]+=+e[1],r}function Bb(r,e){const t=e.getRadius(),i=e.getCenter(),n=i[0],s=i[1],o=r[0],a=r[1];let l=o-n;const u=a-s;l===0&&u===0&&(l=1);const f=Math.sqrt(l*l+u*u),m=n+t*l/f,_=s+t*u/f;return[m,_]}function Lh(r,e){const t=r[0],i=r[1],n=e[0],s=e[1],o=n[0],a=n[1],l=s[0],u=s[1],f=l-o,m=u-a,_=f===0&&m===0?0:(f*(t-o)+m*(i-a))/(f*f+m*m||0);let C,R;return _<=0?(C=o,R=a):_>=1?(C=l,R=u):(C=o+_*f,R=a+_*m),[C,R]}function Ri(r,e){let t=!0;for(let i=r.length-1;i>=0;--i)if(r[i]!=e[i]){t=!1;break}return t}function Dh(r,e){const t=Math.cos(e),i=Math.sin(e),n=r[0]*t-r[1]*i,s=r[1]*t+r[0]*i;return r[0]=n,r[1]=s,r}function jb(r,e){return r[0]*=e,r[1]*=e,r}function nn(r,e){const t=r[0]-e[0],i=r[1]-e[1];return t*t+i*i}function da(r,e){return Math.sqrt(nn(r,e))}function Hb(r,e){return nn(r,Lh(r,e))}function dg(r,e){if(e.canWrapX()){const t=ot(e.getExtent()),i=Ub(r,e,t);i&&(r[0]-=i*t)}return r}function Ub(r,e,t){const i=e.getExtent();let n=0;return e.canWrapX()&&(r[0]<i[0]||r[0]>i[2])&&(t=t||ot(i),n=Math.floor((r[0]-i[0])/t)),n}const Vb=63710088e-1;function $d(r,e,t){t=t||Vb;const i=oa(r[1]),n=oa(e[1]),s=(n-i)/2,o=oa(e[0]-r[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(n);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}let eh=!0;function Wb(r){eh=!(r===void 0?!0:r)}function Ah(r,e,t){if(e!==void 0){for(let i=0,n=r.length;i<n;++i)e[i]=r[i];e=e}else e=r.slice();return e}function fg(r,e,t){if(e!==void 0&&r!==e){for(let i=0,n=r.length;i<n;++i)e[i]=r[i];r=e}return r}function Xb(r){Ob(r.getCode(),r),ua(r,r,Ah)}function Yb(r){r.forEach(Xb)}function li(r){return typeof r=="string"?Pb(r):r||null}function Zd(r,e,t,i){r=li(r);let n;const s=r.getPointResolutionFunc();if(s){if(n=s(e,t),i&&i!==r.getUnits()){const o=r.getMetersPerUnit();o&&(n=n*o/Vr[i])}}else{const o=r.getUnits();if(o=="degrees"&&!i||i=="degrees")n=e;else{const a=Ih(r,li("EPSG:4326"));if(a===fg&&o!=="degrees")n=e*r.getMetersPerUnit();else{let u=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];u=a(u,u,2);const f=$d(u.slice(0,2),u.slice(2,4)),m=$d(u.slice(4,6),u.slice(6,8));n=(f+m)/2}const l=i?Vr[i]:r.getMetersPerUnit();l!==void 0&&(n/=l)}}return n}function qd(r){Yb(r),r.forEach(function(e){r.forEach(function(t){e!==t&&ua(e,t,Ah)})})}function Kb(r,e,t,i){r.forEach(function(n){e.forEach(function(s){ua(n,s,t),ua(s,n,i)})})}function Mh(r,e){return r?typeof r=="string"?li(r):r:li(e)}function pn(r,e){if(r===e)return!0;const t=r.getUnits()===e.getUnits();return(r.getCode()===e.getCode()||Ih(r,e)===Ah)&&t}function Ih(r,e){const t=r.getCode(),i=e.getCode();let n=kb(t,i);return n||(n=fg),n}function fa(r,e){const t=li(r),i=li(e);return Ih(t,i)}function $b(r,e,t){return fa(e,t)(r,void 0,r.length)}function ls(r,e){return r}function ft(r,e){return eh&&!Ri(r,[0,0])&&r[0]>=-180&&r[0]<=180&&r[1]>=-90&&r[1]<=90&&(eh=!1,console.warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),r}function za(r,e){return r}function yi(r,e){return r}function Zb(){qd(Xd),qd(Kd),Kb(Kd,Xd,Ab,Mb)}Zb();function is(r,e,t,i,n,s){s=s||[];let o=0;for(let a=e;a<t;a+=i){const l=r[a],u=r[a+1];s[o++]=n[0]*l+n[2]*u+n[4],s[o++]=n[1]*l+n[3]*u+n[5]}return s&&s.length!=o&&(s.length=o),s}function Fh(r,e,t,i,n,s,o){o=o||[];const a=Math.cos(n),l=Math.sin(n),u=s[0],f=s[1];let m=0;for(let _=e;_<t;_+=i){const C=r[_]-u,R=r[_+1]-f;o[m++]=u+C*a-R*l,o[m++]=f+C*l+R*a;for(let L=_+2;L<_+i;++L)o[m++]=r[L]}return o&&o.length!=m&&(o.length=m),o}function qb(r,e,t,i,n,s,o,a){a=a||[];const l=o[0],u=o[1];let f=0;for(let m=e;m<t;m+=i){const _=r[m]-l,C=r[m+1]-u;a[f++]=l+n*_,a[f++]=u+s*C;for(let R=m+2;R<m+i;++R)a[f++]=r[R]}return a&&a.length!=f&&(a.length=f),a}function gg(r,e,t,i,n,s,o){o=o||[];let a=0;for(let l=e;l<t;l+=i){o[a++]=r[l]+n,o[a++]=r[l+1]+s;for(let u=l+2;u<l+i;++u)o[a++]=r[u]}return o&&o.length!=a&&(o.length=a),o}const Jd=ai();class Jb extends Hi{constructor(){super(),this.extent_=pi(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=nb(function(e,t,i){if(!i)return this.getSimplifiedGeometry(t);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return Ze()}closestPointXY(e,t,i,n){return Ze()}containsXY(e,t){const i=this.getClosestPoint([e,t]);return i[0]===e&&i[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return Ze()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&so(t),this.extentRevision_=this.getRevision()}return Cb(this.extent_,e)}rotate(e,t){Ze()}scale(e,t,i){Ze()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return Ze()}getType(){return Ze()}applyTransform(e){Ze()}intersectsExtent(e){return Ze()}translate(e,t){Ze()}transform(e,t){const i=li(e),n=i.getUnits()=="tile-pixels"?function(s,o,a){const l=i.getExtent(),u=i.getWorldExtent(),f=jt(u)/jt(l);return vi(Jd,u[0],u[3],f,-f,0,0,0),is(s,0,s.length,a,Jd,o),fa(i,t)(s,o,a)}:fa(i,t);return this.applyTransform(n),this}}const mg=Jb;class Tn extends mg{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(e){return lg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return Ze()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=ga(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){Ze()}setLayout(e,t,i){let n;if(e)n=ga(e);else{for(let s=0;s<i;++s)if(t.length===0){this.layout="XY",this.stride=2;return}else t=t[0];n=t.length,e=Qb(n)}this.layout=e,this.stride=n}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const n=this.getStride();Fh(i,0,i.length,n,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=rn(this.getExtent()));const n=this.getFlatCoordinates();if(n){const s=this.getStride();qb(n,0,n.length,s,e,t,i,n),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const n=this.getStride();gg(i,0,i.length,n,e,t,i),this.changed()}}}function Qb(r){let e;return r==2?e="XY":r==3?e="XYZ":r==4&&(e="XYZM"),e}function ga(r){let e;return r=="XY"?e=2:r=="XYZ"||r=="XYM"?e=3:r=="XYZM"&&(e=4),e}function e_(r,e,t){const i=r.getFlatCoordinates();if(i){const n=r.getStride();return is(i,0,i.length,n,e,t)}else return null}function Qd(r,e,t,i,n,s,o){const a=r[e],l=r[e+1],u=r[t]-a,f=r[t+1]-l;let m;if(u===0&&f===0)m=e;else{const _=((n-a)*u+(s-l)*f)/(u*u+f*f);if(_>1)m=t;else if(_>0){for(let C=0;C<i;++C)o[C]=Zi(r[e+C],r[t+C],_);o.length=i;return}else m=e}for(let _=0;_<i;++_)o[_]=r[m+_];o.length=i}function Ph(r,e,t,i,n){let s=r[e],o=r[e+1];for(e+=i;e<t;e+=i){const a=r[e],l=r[e+1],u=tn(s,o,a,l);u>n&&(n=u),s=a,o=l}return n}function Oh(r,e,t,i,n){for(let s=0,o=t.length;s<o;++s){const a=t[s];n=Ph(r,e,a,i,n),e=a}return n}function t_(r,e,t,i,n){for(let s=0,o=t.length;s<o;++s){const a=t[s];n=Oh(r,e,a,i,n),e=a[a.length-1]}return n}function kh(r,e,t,i,n,s,o,a,l,u,f){if(e==t)return u;let m,_;if(n===0)if(_=tn(o,a,r[e],r[e+1]),_<u){for(m=0;m<i;++m)l[m]=r[e+m];return l.length=i,_}else return u;f=f||[NaN,NaN];let C=e+i;for(;C<t;)if(Qd(r,C-i,C,i,o,a,f),_=tn(o,a,f[0],f[1]),_<u){for(u=_,m=0;m<i;++m)l[m]=f[m];l.length=i,C+=i}else C+=i*Math.max((Math.sqrt(_)-Math.sqrt(u))/n|0,1);if(s&&(Qd(r,t-i,e,i,o,a,f),_=tn(o,a,f[0],f[1]),_<u)){for(u=_,m=0;m<i;++m)l[m]=f[m];l.length=i}return u}function Nh(r,e,t,i,n,s,o,a,l,u,f){f=f||[NaN,NaN];for(let m=0,_=t.length;m<_;++m){const C=t[m];u=kh(r,e,C,i,n,s,o,a,l,u,f),e=C}return u}function i_(r,e,t,i,n,s,o,a,l,u,f){f=f||[NaN,NaN];for(let m=0,_=t.length;m<_;++m){const C=t[m];u=Nh(r,e,C,i,n,s,o,a,l,u,f),e=C[C.length-1]}return u}function pg(r,e,t,i){for(let n=0,s=t.length;n<s;++n)r[e++]=t[n];return e}function Ba(r,e,t,i){for(let n=0,s=t.length;n<s;++n){const o=t[n];for(let a=0;a<i;++a)r[e++]=o[a]}return e}function Gh(r,e,t,i,n){n=n||[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=Ba(r,e,t[o],i);n[s++]=l,e=l}return n.length=s,n}function n_(r,e,t,i,n){n=n||[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=Gh(r,e,t[o],i,n[s]);l.length===0&&(l[0]=e),n[s++]=l,e=l[l.length-1]}return n.length=s,n}function zh(r,e,t,i,n,s,o){const a=(t-e)/i;if(a<3){for(;e<t;e+=i)s[o++]=r[e],s[o++]=r[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const u=[e,t-i];let f=0;for(;u.length>0;){const m=u.pop(),_=u.pop();let C=0;const R=r[_],L=r[_+1],A=r[m],S=r[m+1];for(let P=_+i;P<m;P+=i){const k=r[P],H=r[P+1],K=Nb(k,H,R,L,A,S);K>C&&(f=P,C=K)}C>n&&(l[(f-e)/i]=1,_+i<f&&u.push(_,f),f+i<m&&u.push(f,m))}for(let m=0;m<a;++m)l[m]&&(s[o++]=r[e+m*i],s[o++]=r[e+m*i+1]);return o}function s_(r,e,t,i,n,s,o,a){for(let l=0,u=t.length;l<u;++l){const f=t[l];o=zh(r,e,f,i,n,s,o),a.push(o),e=f}return o}function Kn(r,e){return e*Math.round(r/e)}function r_(r,e,t,i,n,s,o){if(e==t)return o;let a=Kn(r[e],n),l=Kn(r[e+1],n);e+=i,s[o++]=a,s[o++]=l;let u,f;do if(u=Kn(r[e],n),f=Kn(r[e+1],n),e+=i,e==t)return s[o++]=u,s[o++]=f,o;while(u==a&&f==l);for(;e<t;){const m=Kn(r[e],n),_=Kn(r[e+1],n);if(e+=i,m==u&&_==f)continue;const C=u-a,R=f-l,L=m-a,A=_-l;if(C*A==R*L&&(C<0&&L<C||C==L||C>0&&L>C)&&(R<0&&A<R||R==A||R>0&&A>R)){u=m,f=_;continue}s[o++]=u,s[o++]=f,a=u,l=f,u=m,f=_}return s[o++]=u,s[o++]=f,o}function bg(r,e,t,i,n,s,o,a){for(let l=0,u=t.length;l<u;++l){const f=t[l];o=r_(r,e,f,i,n,s,o),a.push(o),e=f}return o}function o_(r,e,t,i,n,s,o,a){for(let l=0,u=t.length;l<u;++l){const f=t[l],m=[];o=bg(r,e,f,i,n,s,o,m),a.push(m),e=f[f.length-1]}return o}function _g(r,e,t,i,n){let s;for(e+=i;e<t;e+=i)if(s=n(r.slice(e-i,e),r.slice(e,e+i)),s)return s;return!1}function bn(r,e,t,i,n){n=n!==void 0?n:[];let s=0;for(let o=e;o<t;o+=i)n[s++]=r.slice(o,o+i);return n.length=s,n}function Wr(r,e,t,i,n){n=n!==void 0?n:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];n[s++]=bn(r,e,l,i,n[s]),e=l}return n.length=s,n}function th(r,e,t,i,n){n=n!==void 0?n:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];n[s++]=l.length===1&&l[0]===e?[]:Wr(r,e,l,i,n[s]),e=l[l.length-1]}return n.length=s,n}function yg(r,e,t,i,n,s,o){let a,l;const u=(t-e)/i;if(u===1)a=e;else if(u===2)a=e,l=n;else if(u!==0){let f=r[e],m=r[e+1],_=0;const C=[0];for(let A=e+i;A<t;A+=i){const S=r[A],P=r[A+1];_+=Math.sqrt((S-f)*(S-f)+(P-m)*(P-m)),C.push(_),f=S,m=P}const R=n*_,L=eb(C,R);L<0?(l=(R-C[-L-2])/(C[-L-1]-C[-L-2]),a=e+(-L-2)*i):a=e+L*i}o=o>1?o:2,s=s||new Array(o);for(let f=0;f<o;++f)s[f]=a===void 0?NaN:l===void 0?r[a+f]:Zi(r[a+f],r[a+i+f],l);return s}function ih(r,e,t,i,n,s){if(t==e)return null;let o;if(n<r[e+i-1])return s?(o=r.slice(e,e+i),o[i-1]=n,o):null;if(r[t-1]<n)return s?(o=r.slice(t-i,t),o[i-1]=n,o):null;if(n==r[e+i-1])return r.slice(e,e+i);let a=e/i,l=t/i;for(;a<l;){const _=a+l>>1;n<r[(_+1)*i-1]?l=_:a=_+1}const u=r[a*i-1];if(n==u)return r.slice((a-1)*i,(a-1)*i+i);const f=r[(a+1)*i-1],m=(n-u)/(f-u);o=[];for(let _=0;_<i-1;++_)o.push(Zi(r[(a-1)*i+_],r[a*i+_],m));return o.push(n),o}function a_(r,e,t,i,n,s,o){if(o)return ih(r,e,t[t.length-1],i,n,s);let a;if(n<r[i-1])return s?(a=r.slice(0,i),a[i-1]=n,a):null;if(r[r.length-1]<n)return s?(a=r.slice(r.length-i),a[i-1]=n,a):null;for(let l=0,u=t.length;l<u;++l){const f=t[l];if(e!=f){if(n<r[e+i-1])return null;if(n<=r[f-1])return ih(r,e,f,i,n,!1);e=f}}return null}function l_(r,e,t,i,n){return!Rh(n,function(o){return!qn(r,e,t,i,o[0],o[1])})}function qn(r,e,t,i,n,s){let o=0,a=r[t-i],l=r[t-i+1];for(;e<t;e+=i){const u=r[e],f=r[e+1];l<=s?f>s&&(u-a)*(s-l)-(n-a)*(f-l)>0&&o++:f<=s&&(u-a)*(s-l)-(n-a)*(f-l)<0&&o--,a=u,l=f}return o!==0}function Bh(r,e,t,i,n,s){if(t.length===0||!qn(r,e,t[0],i,n,s))return!1;for(let o=1,a=t.length;o<a;++o)if(qn(r,t[o-1],t[o],i,n,s))return!1;return!0}function h_(r,e,t,i,n,s){if(t.length===0)return!1;for(let o=0,a=t.length;o<a;++o){const l=t[o];if(Bh(r,e,l,i,n,s))return!0;e=l[l.length-1]}return!1}function ja(r,e,t,i,n){const s=cg(pi(),r,e,t,i);return Nt(n,s)?Zn(n,s)||s[0]>=n[0]&&s[2]<=n[2]||s[1]>=n[1]&&s[3]<=n[3]?!0:_g(r,e,t,i,function(o,a){return xb(n,o,a)}):!1}function c_(r,e,t,i,n){for(let s=0,o=t.length;s<o;++s){if(ja(r,e,t[s],i,n))return!0;e=t[s]}return!1}function vg(r,e,t,i,n){return!!(ja(r,e,t,i,n)||qn(r,e,t,i,n[0],n[1])||qn(r,e,t,i,n[0],n[3])||qn(r,e,t,i,n[2],n[1])||qn(r,e,t,i,n[2],n[3]))}function Eg(r,e,t,i,n){if(!vg(r,e,t[0],i,n))return!1;if(t.length===1)return!0;for(let s=1,o=t.length;s<o;++s)if(l_(r,t[s-1],t[s],i,n)&&!ja(r,t[s-1],t[s],i,n))return!1;return!0}function u_(r,e,t,i,n){for(let s=0,o=t.length;s<o;++s){const a=t[s];if(Eg(r,e,a,i,n))return!0;e=a[a.length-1]}return!1}function wg(r,e,t,i){let n=r[e],s=r[e+1],o=0;for(let a=e+i;a<t;a+=i){const l=r[a],u=r[a+1];o+=Math.sqrt((l-n)*(l-n)+(u-s)*(u-s)),n=l,s=u}return o}class ma extends Tn{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){this.flatCoordinates?en(this.flatCoordinates,e):this.flatCoordinates=e.slice(),this.changed()}clone(){const e=new ma(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<ms(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ph(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),kh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,n))}forEachSegment(e){return _g(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,ih(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return bn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return yg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return wg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=zh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new ma(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return ja(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ba(this.flatCoordinates,0,e,this.stride),this.changed()}}const Vs=ma;class jh extends Tn{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new jh(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){const s=this.flatCoordinates,o=tn(e,t,s[0],s[1]);if(o<n){const a=this.stride;for(let l=0;l<a;++l)i[l]=s[l];return i.length=a,o}else return n}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(e){return ra(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return Th(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=pg(this.flatCoordinates,0,e,this.stride),this.changed()}}const ns=jh;class Hh{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Hh({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}const Ws=Hh,Ne={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function ef(r){return r[0]>0&&r[1]>0}function d_(r,e,t){return t===void 0&&(t=[0,0]),t[0]=r[0]*e+.5|0,t[1]=r[1]*e+.5|0,t}function Pt(r,e){return Array.isArray(r)?r:(e===void 0?e=[r,r]:(e[0]=r,e[1]=r),e)}class Uh{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=Pt(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Uh({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Ze()}getImage(e){return Ze()}getHitDetectionImage(){return Ze()}getPixelRatio(e){return 1}getImageState(){return Ze()}getImageSize(){return Ze()}getOrigin(){return Ze()}getSize(){return Ze()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Pt(e)}listenImageChange(e){Ze()}load(){Ze()}unlistenImageChange(e){Ze()}}const Cg=Uh,xg=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Tg=/^([a-z]*)$|^hsla?\(.*\)$/i;function Rg(r){return typeof r=="string"?r:Dg(r)}function Sg(r){const e=document.createElement("div");if(e.style.color=r,e.style.color!==""){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}else return""}const Lg=function(){const e={};let t=0;return function(i){let n;if(e.hasOwnProperty(i))n=e[i];else{if(t>=1024){let s=0;for(const o in e)(s++&3)===0&&(delete e[o],--t)}n=f_(i),e[i]=n,++t}return n}}();function Xr(r){return Array.isArray(r)?r:Lg(r)}function f_(r){let e,t,i,n,s;if(Tg.exec(r)&&(r=Sg(r)),xg.exec(r)){const o=r.length-1;let a;o<=4?a=1:a=2;const l=o===4||o===8;e=parseInt(r.substr(1+0*a,a),16),t=parseInt(r.substr(1+1*a,a),16),i=parseInt(r.substr(1+2*a,a),16),l?n=parseInt(r.substr(1+3*a,a),16):n=255,a==1&&(e=(e<<4)+e,t=(t<<4)+t,i=(i<<4)+i,l&&(n=(n<<4)+n)),s=[e,t,i,n/255]}else r.startsWith("rgba(")?(s=r.slice(5,-1).split(",").map(Number),tf(s)):r.startsWith("rgb(")?(s=r.slice(4,-1).split(",").map(Number),s.push(1),tf(s)):Xe(!1,14);return s}function tf(r){return r[0]=wt(r[0]+.5|0,0,255),r[1]=wt(r[1]+.5|0,0,255),r[2]=wt(r[2]+.5|0,0,255),r[3]=wt(r[3],0,1),r}function Dg(r){let e=r[0];e!=(e|0)&&(e=e+.5|0);let t=r[1];t!=(t|0)&&(t=t+.5|0);let i=r[2];i!=(i|0)&&(i=i+.5|0);const n=r[3]===void 0?1:Math.round(r[3]*100)/100;return"rgba("+e+","+t+","+i+","+n+")"}function g_(r){return Tg.test(r)&&(r=Sg(r)),xg.test(r)||r.startsWith("rgba(")||r.startsWith("rgb(")}function Ni(r){return Array.isArray(r)?Dg(r):r}function hi(r,e,t,i){let n;return t&&t.length?n=t.shift():Eh?n=new OffscreenCanvas(r||300,e||300):n=document.createElement("canvas"),r&&(n.width=r),e&&(n.height=e),n.getContext("2d",i)}function Ag(r){const e=r.canvas;e.width=1,e.height=1,r.clearRect(0,0,1,1)}function nf(r,e){const t=e.parentNode;t&&t.replaceChild(r,e)}function nh(r){return r&&r.parentNode?r.parentNode.removeChild(r):null}function m_(r){for(;r.lastChild;)r.removeChild(r.lastChild)}function p_(r,e){const t=r.childNodes;for(let i=0;;++i){const n=t[i],s=e[i];if(!n&&!s)break;if(n!==s){if(!n){r.appendChild(s);continue}if(!s){r.removeChild(n),--i;continue}r.insertBefore(s,n)}}}const Vo="ol-hidden",Ha="ol-unselectable",Vh="ol-control",sf="ol-collapsed",b_=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),rf=["style","variant","weight","size","lineHeight","family"],Mg=function(r){const e=r.match(b_);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,n=rf.length;i<n;++i){const s=e[i+1];s!==void 0&&(t[rf[i]]=s)}return t.families=t.family.split(/,\s?/),t},Ig="10px sans-serif",sn="#000",pa="round",Yr=[],Kr=0,Qs="round",$r=10,Zr="#000",qr="center",ba="middle",Jn=[0,0,0,0],Jr=1,Yi=new Hi;let Fs=null,sh;const rh={},__=function(){const e="32px ",t=["monospace","serif"],i=t.length,n="wmytzilWMYTZIL@#/&?$%10\uF013";let s,o;function a(u,f,m){let _=!0;for(let C=0;C<i;++C){const R=t[C];if(o=_a(u+" "+f+" "+e+R,n),m!=R){const L=_a(u+" "+f+" "+e+m+","+R,n);_=_&&L!=o}}return!!_}function l(){let u=!0;const f=Yi.getKeys();for(let m=0,_=f.length;m<_;++m){const C=f[m];Yi.get(C)<100&&(a.apply(this,C.split(`
`))?(ar(rh),Fs=null,sh=void 0,Yi.set(C,100)):(Yi.set(C,Yi.get(C)+1,!0),u=!1))}u&&(clearInterval(s),s=void 0)}return function(u){const f=Mg(u);if(!f)return;const m=f.families;for(let _=0,C=m.length;_<C;++_){const R=m[_],L=f.style+`
`+f.weight+`
`+R;Yi.get(L)===void 0&&(Yi.set(L,100,!0),a(f.style,f.weight,R)||(Yi.set(L,0,!0),s===void 0&&(s=setInterval(l,32))))}}}(),y_=function(){let r;return function(e){let t=rh[e];if(t==null){if(Eh){const i=Mg(e),n=Fg(e,"\u017Dg");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else r||(r=document.createElement("div"),r.innerHTML="M",r.style.minHeight="0",r.style.maxHeight="none",r.style.height="auto",r.style.padding="0",r.style.border="none",r.style.position="absolute",r.style.display="block",r.style.left="-99999px"),r.style.font=e,document.body.appendChild(r),t=r.offsetHeight,document.body.removeChild(r);rh[e]=t}return t}}();function Fg(r,e){return Fs||(Fs=hi(1,1)),r!=sh&&(Fs.font=r,sh=Fs.font),Fs.measureText(e)}function _a(r,e){return Fg(r,e).width}function of(r,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((n,s)=>Math.max(n,_a(r,s)),0);return t[e]=i,i}function v_(r,e){const t=[],i=[],n=[];let s=0,o=0,a=0,l=0;for(let u=0,f=e.length;u<=f;u+=2){const m=e[u];if(m===`
`||u===f){s=Math.max(s,o),n.push(o),o=0,a+=l;continue}const _=e[u+1]||r.font,C=_a(_,m);t.push(C),o+=C;const R=y_(_);i.push(R),l=Math.max(l,R)}return{width:s,height:a,widths:t,heights:i,lineWidths:n}}function E_(r,e,t,i,n,s,o,a,l,u,f){r.save(),t!==1&&(r.globalAlpha*=t),e&&r.setTransform.apply(r,e),i.contextInstructions?(r.translate(l,u),r.scale(f[0],f[1]),w_(i,r)):f[0]<0||f[1]<0?(r.translate(l,u),r.scale(f[0],f[1]),r.drawImage(i,n,s,o,a,0,0,o,a)):r.drawImage(i,n,s,o,a,l,u,o*f[0],a*f[1]),r.restore()}function w_(r,e){const t=r.contextInstructions;for(let i=0,n=t.length;i<n;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class Wh extends Cg{constructor(e){const t=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:1,rotateWithView:t,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius!==void 0?e.radius:e.radius1,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const e=this.getScale(),t=new Wh({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_;if(!e)return null;const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(e){let t=this.canvas_[e];if(!t){const i=this.renderOptions_,n=hi(i.size*e,i.size*e);this.draw_(i,n,e),t=n.canvas,this.canvas_[e]=t}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return Ne.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let n=this.radius_,s=this.radius2_===void 0?n:this.radius2_;if(n<s){const ie=n;n=s,s=ie}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),u=Math.sqrt(s*s-l*l),f=n-u,m=Math.sqrt(l*l+f*f),_=m/l;if(e==="miter"&&_<=i)return _*t;const C=t/2/_,R=t/2*(f/m),A=Math.sqrt((n+C)*(n+C)+R*R)-n;if(this.radius2_===void 0||e==="bevel")return A*2;const S=n*Math.sin(a),P=Math.sqrt(n*n-S*S),k=s-P,K=Math.sqrt(S*S+k*k)/S;if(K<=i){const ie=K*t/2-s-n;return 2*Math.max(A,ie)}return A*2}createRenderOptions(){let e=Qs,t=0,i=null,n=0,s,o=0;this.stroke_&&(s=this.stroke_.getColor(),s===null&&(s=Zr),s=Ni(s),o=this.stroke_.getWidth(),o===void 0&&(o=Jr),i=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset(),e=this.stroke_.getLineJoin(),e===void 0&&(e=Qs),t=this.stroke_.getMiterLimit(),t===void 0&&(t=$r));const a=this.calculateLineJoinSize_(e,o,t),l=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*l+a);return{strokeStyle:s,strokeWidth:o,size:u,lineDash:i,lineDashOffset:n,lineJoin:e,miterLimit:t}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.canvas_={},this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let n=this.fill_.getColor();n===null&&(n=sn),t.fillStyle=Ni(n),t.fill()}this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){if(this.fill_){let t=this.fill_.getColor(),i=0;if(typeof t=="string"&&(t=Xr(t)),t===null?i=1:Array.isArray(t)&&(i=t.length===4?t[3]:1),i===0){const n=hi(e.size,e.size);this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(e,n)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(e){let t=this.points_;const i=this.radius_;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const n=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=s+a*o,u=a%2===0?i:n;e.lineTo(u*Math.cos(l),u*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=sn,t.fill(),this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}}const Pg=Wh;class Xh extends Pg{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new Xh({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius_=e,this.render()}}const Ua=Xh;class _n{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=af,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new _n({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=af,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function C_(r){let e;if(typeof r=="function")e=r;else{let t;Array.isArray(r)?t=r:(Xe(typeof r.getZIndex=="function",41),t=[r]),e=function(){return t}}return e}let pl=null;function x_(r,e){if(!pl){const t=new qs({color:"rgba(255,255,255,0.4)"}),i=new Ws({color:"#3399CC",width:1.25});pl=[new _n({image:new Ua({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return pl}function Og(){const r={},e=[255,255,255,1],t=[0,153,255,1],i=3;return r.Polygon=[new _n({fill:new qs({color:[255,255,255,.5]})})],r.MultiPolygon=r.Polygon,r.LineString=[new _n({stroke:new Ws({color:e,width:i+2})}),new _n({stroke:new Ws({color:t,width:i})})],r.MultiLineString=r.LineString,r.Circle=r.Polygon.concat(r.LineString),r.Point=[new _n({image:new Ua({radius:i*2,fill:new qs({color:t}),stroke:new Ws({color:e,width:i/2})}),zIndex:1/0})],r.MultiPoint=r.Point,r.GeometryCollection=r.Polygon.concat(r.LineString,r.Point),r}function af(r){return r.getGeometry()}const ya=_n,T_="#333";class Yh{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=Pt(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new qs({color:T_}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding}clone(){const e=this.getScale();return new Yh({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Pt(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}const R_=Yh,st={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class S_ extends Hi{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[st.OPACITY]=e.opacity!==void 0?e.opacity:1,Xe(typeof t[st.OPACITY]=="number",64),t[st.VISIBLE]=e.visible!==void 0?e.visible:!0,t[st.Z_INDEX]=e.zIndex,t[st.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[st.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[st.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[st.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=wt(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return Ze()}getLayerStatesArray(e){return Ze()}getExtent(){return this.get(st.EXTENT)}getMaxResolution(){return this.get(st.MAX_RESOLUTION)}getMinResolution(){return this.get(st.MIN_RESOLUTION)}getMinZoom(){return this.get(st.MIN_ZOOM)}getMaxZoom(){return this.get(st.MAX_ZOOM)}getOpacity(){return this.get(st.OPACITY)}getSourceState(){return Ze()}getVisible(){return this.get(st.VISIBLE)}getZIndex(){return this.get(st.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(st.EXTENT,e)}setMaxResolution(e){this.set(st.MAX_RESOLUTION,e)}setMinResolution(e){this.set(st.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(st.MAX_ZOOM,e)}setMinZoom(e){this.set(st.MIN_ZOOM,e)}setOpacity(e){Xe(typeof e=="number",64),this.set(st.OPACITY,e)}setVisible(e){this.set(st.VISIBLE,e)}setZIndex(e){this.set(st.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const kg=S_;class L_ extends kg{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(st.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(st.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed()}handleSourcePropertyChange_(){this.sourceChangeKey_&&(lt(this.sourceChangeKey_),this.sourceChangeKey_=null);const e=this.getSource();e&&(this.sourceChangeKey_=ze(e,Te.CHANGE,this.handleSourceChange_,this)),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):new Promise(t=>t([]))}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}render(e,t){const i=this.getRenderer();if(i.prepareFrame(e))return this.rendered=!0,i.renderFrame(e,t)}unrender(){this.rendered=!1}setMapInternal(e){e||this.unrender(),this.set(st.MAP,e)}getMapInternal(){return this.get(st.MAP)}setMap(e){this.mapPrecomposeKey_&&(lt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(lt(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=ze(e,oi.PRECOMPOSE,function(t){const n=t.frameState.layerStatesArray,s=this.getLayerState(!1);Xe(!n.some(function(o){return o.layer===s.layer}),67),n.push(s)},this),this.mapRenderKey_=ze(this,Te.CHANGE,e.render,e),this.changed())}setSource(e){this.set(st.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Kh(r,e){if(!r.visible)return!1;const t=e.resolution;if(t<r.minResolution||t>=r.maxResolution)return!1;const i=e.zoom;return i>r.minZoom&&i<=r.maxZoom}const ao=L_;function D_(r,e,t,i,n){Ng(r,e,t||0,i||r.length-1,n||A_)}function Ng(r,e,t,i,n){for(;i>t;){if(i-t>600){var s=i-t+1,o=e-t+1,a=Math.log(s),l=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1),f=Math.max(t,Math.floor(e-o*l/s+u)),m=Math.min(i,Math.floor(e+(s-o)*l/s+u));Ng(r,e,f,m,n)}var _=r[e],C=t,R=i;for(Lr(r,t,e),n(r[i],_)>0&&Lr(r,t,i);C<R;){for(Lr(r,C,R),C++,R--;n(r[C],_)<0;)C++;for(;n(r[R],_)>0;)R--}n(r[t],_)===0?Lr(r,t,R):(R++,Lr(r,R,i)),R<=e&&(t=R+1),e<=R&&(i=R-1)}}function Lr(r,e,t){var i=r[e];r[e]=r[t],r[t]=i}function A_(r,e){return r<e?-1:r>e?1:0}class Gg{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!Xo(e,t))return i;const n=this.toBBox,s=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?n(a):a;Xo(e,l)&&(t.leaf?i.push(a):_l(e,l)?this._all(a,i):s.push(a))}t=s.pop()}return i}collides(e){let t=this.data;if(!Xo(e,t))return!1;const i=[];for(;t;){for(let n=0;n<t.children.length;n++){const s=t.children[n],o=t.leaf?this.toBBox(s):s;if(Xo(e,o)){if(t.leaf||_l(e,o))return!0;i.push(s)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Ps([]),this}remove(e,t){if(!e)return this;let i=this.data;const n=this.toBBox(e),s=[],o=[];let a,l,u;for(;i||s.length;){if(i||(i=s.pop(),l=s[s.length-1],a=o.pop(),u=!0),i.leaf){const f=M_(e,i.children,t);if(f!==-1)return i.children.splice(f,1),s.push(i),this._condense(s),this}!u&&!i.leaf&&_l(i,n)?(s.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],u=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,n){const s=i-t+1;let o=this._maxEntries,a;if(s<=o)return a=Ps(e.slice(t,i+1)),Ss(a,this.toBBox),a;n||(n=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,n-1))),a=Ps([]),a.leaf=!1,a.height=n;const l=Math.ceil(s/o),u=l*Math.ceil(Math.sqrt(o));lf(e,t,i,u,this.compareMinX);for(let f=t;f<=i;f+=u){const m=Math.min(f+u-1,i);lf(e,f,m,l,this.compareMinY);for(let _=f;_<=m;_+=l){const C=Math.min(_+l-1,m);a.children.push(this._build(e,_,C,n-1))}}return Ss(a,this.toBBox),a}_chooseSubtree(e,t,i,n){for(;n.push(t),!(t.leaf||n.length-1===i);){let s=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const u=t.children[l],f=bl(u),m=P_(e,u)-f;m<o?(o=m,s=f<s?f:s,a=u):m===o&&f<s&&(s=f,a=u)}t=a||t.children[0]}return t}_insert(e,t,i){const n=i?e:this.toBBox(e),s=[],o=this._chooseSubtree(n,this.data,t,s);for(o.children.push(e),Ir(o,n);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(n,s,t)}_split(e,t){const i=e[t],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);const o=this._chooseSplitIndex(i,s,n),a=Ps(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,Ss(i,this.toBBox),Ss(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this.data=Ps([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Ss(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let n,s=1/0,o=1/0;for(let a=t;a<=i-t;a++){const l=Mr(e,0,a,this.toBBox),u=Mr(e,a,i,this.toBBox),f=O_(l,u),m=bl(l)+bl(u);f<s?(s=f,n=a,o=m<o?m:o):f===s&&m<o&&(o=m,n=a)}return n||i-t}_chooseSplitAxis(e,t,i){const n=e.leaf?this.compareMinX:I_,s=e.leaf?this.compareMinY:F_,o=this._allDistMargin(e,t,i,n),a=this._allDistMargin(e,t,i,s);o<a&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const s=this.toBBox,o=Mr(e,0,t,s),a=Mr(e,i-t,i,s);let l=Wo(o)+Wo(a);for(let u=t;u<i-t;u++){const f=e.children[u];Ir(o,e.leaf?s(f):f),l+=Wo(o)}for(let u=i-t-1;u>=t;u--){const f=e.children[u];Ir(a,e.leaf?s(f):f),l+=Wo(a)}return l}_adjustParentBBoxes(e,t,i){for(let n=i;n>=0;n--)Ir(t[n],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():Ss(e[t],this.toBBox)}}function M_(r,e,t){if(!t)return e.indexOf(r);for(let i=0;i<e.length;i++)if(t(r,e[i]))return i;return-1}function Ss(r,e){Mr(r,0,r.children.length,e,r)}function Mr(r,e,t,i,n){n||(n=Ps(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s=e;s<t;s++){const o=r.children[s];Ir(n,r.leaf?i(o):o)}return n}function Ir(r,e){return r.minX=Math.min(r.minX,e.minX),r.minY=Math.min(r.minY,e.minY),r.maxX=Math.max(r.maxX,e.maxX),r.maxY=Math.max(r.maxY,e.maxY),r}function I_(r,e){return r.minX-e.minX}function F_(r,e){return r.minY-e.minY}function bl(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function Wo(r){return r.maxX-r.minX+(r.maxY-r.minY)}function P_(r,e){return(Math.max(e.maxX,r.maxX)-Math.min(e.minX,r.minX))*(Math.max(e.maxY,r.maxY)-Math.min(e.minY,r.minY))}function O_(r,e){const t=Math.max(r.minX,e.minX),i=Math.max(r.minY,e.minY),n=Math.min(r.maxX,e.maxX),s=Math.min(r.maxY,e.maxY);return Math.max(0,n-t)*Math.max(0,s-i)}function _l(r,e){return r.minX<=e.minX&&r.minY<=e.minY&&e.maxX<=r.maxX&&e.maxY<=r.maxY}function Xo(r,e){return e.minX<=r.maxX&&e.minY<=r.maxY&&e.maxX>=r.minX&&e.maxY>=r.minY}function Ps(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function lf(r,e,t,i,n){const s=[e,t];for(;s.length;){if(t=s.pop(),e=s.pop(),t-e<=i)continue;const o=e+Math.ceil((t-e)/i/2)*i;D_(r,o,e,t,n),s.push(e,o,o,t)}}class k_{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];(e++&3)===0&&!i.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,i){const n=hf(e,t,i);return n in this.cache_?this.cache_[n]:null}set(e,t,i,n){const s=hf(e,t,i);this.cache_[s]=n,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function hf(r,e,t){const i=t?Rg(t):"null";return e+":"+r+":"+i}const va=new k_;class N_ extends lr{constructor(e,t,i,n){super(),this.extent=e,this.pixelRatio_=i,this.resolution=t,this.state=n}changed(){this.dispatchEvent(Te.CHANGE)}getExtent(){return this.extent}getImage(){return Ze()}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){Ze()}}const zg=N_;class G_ extends zg{constructor(e,t,i,n,s,o){super(e,t,i,Ne.IDLE),this.src_=n,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.state=Ne.IDLE,this.imageLoadFunction_=o}getImage(){return this.image_}handleImageError_(){this.state=Ne.ERROR,this.unlistenImage_(),this.changed()}handleImageLoad_(){this.resolution===void 0&&(this.resolution=jt(this.extent)/this.image_.height),this.state=Ne.LOADED,this.unlistenImage_(),this.changed()}load(){(this.state==Ne.IDLE||this.state==Ne.ERROR)&&(this.state=Ne.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=$h(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}setImage(e){this.image_=e,this.resolution=jt(this.extent)/this.image_.height}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function $h(r,e,t){const i=r;let n=!0,s=!1,o=!1;const a=[ha(i,Te.LOAD,function(){o=!0,s||e()})];return i.src&&pb?(s=!0,i.decode().then(function(){n&&e()}).catch(function(l){n&&(o?e():t())})):a.push(ha(i,Te.ERROR,t)),function(){n=!1,a.forEach(lt)}}const z_=G_;let Dr=null;class B_ extends lr{constructor(e,t,i,n,s,o){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=n,this.canvas_={},this.color_=o,this.unlisten_=null,this.imageState_=s,this.size_=i,this.src_=t,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===Ne.LOADED){Dr||(Dr=hi(1,1)),Dr.drawImage(this.image_,0,0);try{Dr.getImageData(0,0,1,1),this.tainted_=!1}catch{Dr=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Te.CHANGE)}handleImageError_(){this.imageState_=Ne.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Ne.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=hi(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===Ne.IDLE){this.image_||this.initializeImage_(),this.imageState_=Ne.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=$h(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==Ne.LOADED)return;const t=this.image_,i=document.createElement("canvas");i.width=Math.ceil(t.width*e),i.height=Math.ceil(t.height*e);const n=i.getContext("2d");n.scale(e,e),n.drawImage(t,0,0),n.globalCompositeOperation="multiply",n.fillStyle=Rg(this.color_),n.fillRect(0,0,i.width/e,i.height/e),n.globalCompositeOperation="destination-in",n.drawImage(t,0,0),this.canvas_[e]=i}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function j_(r,e,t,i,n,s){let o=va.get(e,i,s);return o||(o=new B_(r,e,t,i,n,s),va.set(e,i,s,o)),o}class Zh extends Cg{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,n=e.scale!==void 0?e.scale:1,s=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:n,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:s,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;this.imgSize_=e.imgSize;let a=e.src;Xe(!(a!==void 0&&o),4),Xe(!o||o&&this.imgSize_,5),(a===void 0||a.length===0)&&o&&(a=o.src||Ie(o)),Xe(a!==void 0&&a.length>0,6);const l=e.src!==void 0?Ne.IDLE:Ne.LOADED;this.color_=e.color!==void 0?Xr(e.color):null,this.iconImage_=j_(o,a,this.imgSize_!==void 0?this.imgSize_:null,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null}clone(){const e=this.getScale();return new Zh({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(e)?e.slice():e,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const n=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!n)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=n[0]),this.anchorYUnits_=="fraction"&&(e[1]*=n[1])}if(this.anchorOrigin_!="top-left"){if(!n)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+n[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+n[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}listenImageChange(e){this.iconImage_.addEventListener(Te.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(Te.CHANGE,e)}}const Bg=Zh;function cf(r){return new ya({fill:Qr(r,""),stroke:eo(r,""),text:H_(r),image:U_(r)})}function Qr(r,e){const t=r[e+"fill-color"];if(!!t)return new qs({color:t})}function eo(r,e){const t=r[e+"stroke-width"],i=r[e+"stroke-color"];if(!(!t&&!i))return new Ws({width:t,color:i,lineCap:r[e+"stroke-line-cap"],lineJoin:r[e+"stroke-line-join"],lineDash:r[e+"stroke-line-dash"],lineDashOffset:r[e+"stroke-line-dash-offset"],miterLimit:r[e+"stroke-miter-limit"]})}function H_(r){const e=r["text-value"];return e?new R_({text:e,font:r["text-font"],maxAngle:r["text-max-angle"],offsetX:r["text-offset-x"],offsetY:r["text-offset-y"],overflow:r["text-overflow"],placement:r["text-placement"],scale:r["text-scale"],rotateWithView:r["text-rotate-with-view"],rotation:r["text-rotation"],textAlign:r["text-align"],justify:r["text-justify"],textBaseline:r["text-baseline"],padding:r["text-padding"],fill:Qr(r,"text-"),backgroundFill:Qr(r,"text-background-"),stroke:eo(r,"text-"),backgroundStroke:eo(r,"text-background-")}):void 0}function U_(r){const e=r["icon-src"],t=r["icon-img"];if(e||t)return new Bg({src:e,img:t,imgSize:r["icon-img-size"],anchor:r["icon-anchor"],anchorOrigin:r["icon-anchor-origin"],anchorXUnits:r["icon-anchor-x-units"],anchorYUnits:r["icon-anchor-y-units"],color:r["icon-color"],crossOrigin:r["icon-cross-origin"],offset:r["icon-offset"],displacement:r["icon-displacement"],opacity:r["icon-opacity"],scale:r["icon-scale"],rotation:r["icon-rotation"],rotateWithView:r["icon-rotate-with-view"],size:r["icon-size"],declutterMode:r["icon-declutter-mode"]});const i=r["shape-points"];if(i){const s="shape-";return new Pg({points:i,fill:Qr(r,s),stroke:eo(r,s),radius:r["shape-radius"],radius1:r["shape-radius1"],radius2:r["shape-radius2"],angle:r["shape-angle"],displacement:r["shape-displacement"],rotation:r["shape-rotation"],rotateWithView:r["shape-rotate-with-view"],scale:r["shape-scale"],declutterMode:r["shape-declutter-mode"]})}const n=r["circle-radius"];if(n){const s="circle-";return new Ua({radius:n,fill:Qr(r,s),stroke:eo(r,s),displacement:r["circle-displacement"],scale:r["circle-scale"],rotation:r["circle-rotation"],rotateWithView:r["circle-rotate-with-view"],declutterMode:r["circle-declutter-mode"]})}}const uf={RENDER_ORDER:"renderOrder"};class V_ extends ao{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter!==void 0?e.declutter:!1,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(uf.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e){e.declutterTree||(e.declutterTree=new Gg(9)),this.getRenderer().renderDeclutter(e)}setRenderOrder(e){this.set(uf.RENDER_ORDER,e)}setStyle(e){let t;if(e===void 0)t=x_;else if(e===null)t=null;else if(typeof e=="function")t=e;else if(e instanceof ya)t=e;else if(Array.isArray(e)){const i=e.length,n=new Array(i);for(let s=0;s<i;++s){const o=e[s];o instanceof ya?n[s]=o:n[s]=cf(o)}t=n}else t=cf(e);this.style_=t,this.styleFunction_=e===null?void 0:C_(this.style_),this.changed()}}const W_=V_,lo={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Yo=[lo.FILL],yn=[lo.STROKE],Qn=[lo.BEGIN_PATH],df=[lo.CLOSE_PATH],Ae=lo;class X_{drawCustom(e,t,i,n){}drawGeometry(e){}setStyle(e){}drawCircle(e,t){}drawFeature(e,t){}drawGeometryCollection(e,t){}drawLineString(e,t){}drawMultiLineString(e,t){}drawMultiPoint(e,t){}drawMultiPolygon(e,t){}drawPoint(e,t){}drawPolygon(e,t){}drawText(e,t){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const jg=X_;class Y_ extends jg{constructor(e,t,i,n){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,l=e.length;a<l;a+=t)n[0]=e[a],n[1]=e[a+1],as(i,n)&&(s[o++]=n[0],s[o++]=n[1]);return o}appendFlatLineCoordinates(e,t,i,n,s,o){const a=this.coordinates;let l=a.length;const u=this.getBufferedMaxExtent();o&&(t+=n);let f=e[t],m=e[t+1];const _=this.tmpCoordinate_;let C=!0,R,L,A;for(R=t+n;R<i;R+=n)_[0]=e[R],_[1]=e[R+1],A=$l(u,_),A!==L?(C&&(a[l++]=f,a[l++]=m,C=!1),a[l++]=_[0],a[l++]=_[1]):A===Mt.INTERSECTING?(a[l++]=_[0],a[l++]=_[1],C=!1):C=!0,f=_[0],m=_[1],L=A;return(s&&C||R===t+n)&&(a[l++]=f,a[l++]=m),l}drawCustomCoordinates_(e,t,i,n,s){for(let o=0,a=i.length;o<a;++o){const l=i[o],u=this.appendFlatLineCoordinates(e,t,l,n,!1,!1);s.push(u),t=l}return t}drawCustom(e,t,i,n){this.beginGeometry(e,t);const s=e.getType(),o=e.getStride(),a=this.coordinates.length;let l,u,f,m,_;switch(s){case"MultiPolygon":l=e.getOrientedFlatCoordinates(),m=[];const C=e.getEndss();_=0;for(let R=0,L=C.length;R<L;++R){const A=[];_=this.drawCustomCoordinates_(l,_,C[R],o,A),m.push(A)}this.instructions.push([Ae.CUSTOM,a,m,e,i,th]),this.hitDetectionInstructions.push([Ae.CUSTOM,a,m,e,n||i,th]);break;case"Polygon":case"MultiLineString":f=[],l=s=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),_=this.drawCustomCoordinates_(l,0,e.getEnds(),o,f),this.instructions.push([Ae.CUSTOM,a,f,e,i,Wr]),this.hitDetectionInstructions.push([Ae.CUSTOM,a,f,e,n||i,Wr]);break;case"LineString":case"Circle":l=e.getFlatCoordinates(),u=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([Ae.CUSTOM,a,u,e,i,bn]),this.hitDetectionInstructions.push([Ae.CUSTOM,a,u,e,n||i,bn]);break;case"MultiPoint":l=e.getFlatCoordinates(),u=this.appendFlatPointCoordinates(l,o),u>a&&(this.instructions.push([Ae.CUSTOM,a,u,e,i,bn]),this.hitDetectionInstructions.push([Ae.CUSTOM,a,u,e,n||i,bn]));break;case"Point":l=e.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),u=this.coordinates.length,this.instructions.push([Ae.CUSTOM,a,u,e,i]),this.hitDetectionInstructions.push([Ae.CUSTOM,a,u,e,n||i]);break}this.endGeometry(t)}beginGeometry(e,t){this.beginGeometryInstruction1_=[Ae.BEGIN_GEOMETRY,t,0,e],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Ae.BEGIN_GEOMETRY,t,0,e],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let n,s,o=-1;for(t=0;t<i;++t)n=e[t],s=n[0],s==Ae.END_GEOMETRY?o=t:s==Ae.BEGIN_GEOMETRY&&(n[2]=t,tb(this.hitDetectionInstructions,o,t),o=-1)}setFillStrokeStyle(e,t){const i=this.state;if(e){const n=e.getColor();i.fillStyle=Ni(n||sn)}else i.fillStyle=void 0;if(t){const n=t.getColor();i.strokeStyle=Ni(n||Zr);const s=t.getLineCap();i.lineCap=s!==void 0?s:pa;const o=t.getLineDash();i.lineDash=o?o.slice():Yr;const a=t.getLineDashOffset();i.lineDashOffset=a||Kr;const l=t.getLineJoin();i.lineJoin=l!==void 0?l:Qs;const u=t.getWidth();i.lineWidth=u!==void 0?u:Jr;const f=t.getMiterLimit();i.miterLimit=f!==void 0?f:$r,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(e){const t=e.fillStyle,i=[Ae.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(!0),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[Ae.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,n=e.lineCap,s=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,u=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=n||s!=e.currentLineDash&&!xn(e.currentLineDash,s)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=u)&&(i!==void 0&&t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=n,e.currentLineDash=s,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=u)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[Ae.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=ag(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;no(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const ho=Y_;class K_ extends ho{constructor(e,t,i,n){super(e,t,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const i=e.getFlatCoordinates(),n=e.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([Ae.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Ae.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t){if(!this.image_)return;this.beginGeometry(e,t);const i=e.getFlatCoordinates(),n=e.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([Ae.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Ae.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),n=e.getSize(),s=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=e.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=n[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const $_=K_;class Z_ extends ho{constructor(e,t,i,n){super(e,t,i,n)}drawFlatCoordinates_(e,t,i,n){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,i,n,!1,!1),a=[Ae.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(e,t){const i=this.state,n=i.strokeStyle,s=i.lineWidth;if(n===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Ae.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,Yr,Kr],Qn);const o=e.getFlatCoordinates(),a=e.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(yn),this.endGeometry(t)}drawMultiLineString(e,t){const i=this.state,n=i.strokeStyle,s=i.lineWidth;if(n===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Ae.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],Qn);const o=e.getEnds(),a=e.getFlatCoordinates(),l=e.getStride();let u=0;for(let f=0,m=o.length;f<m;++f)u=this.drawFlatCoordinates_(a,u,o[f],l);this.hitDetectionInstructions.push(yn),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(yn),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(yn),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Qn)}}const q_=Z_;class J_ extends ho{constructor(e,t,i,n){super(e,t,i,n)}drawFlatCoordinatess_(e,t,i,n){const s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=i.length;this.instructions.push(Qn),this.hitDetectionInstructions.push(Qn);for(let u=0;u<l;++u){const f=i[u],m=this.coordinates.length,_=this.appendFlatLineCoordinates(e,t,f,n,!0,!a),C=[Ae.MOVE_TO_LINE_TO,m,_];this.instructions.push(C),this.hitDetectionInstructions.push(C),a&&(this.instructions.push(df),this.hitDetectionInstructions.push(df)),t=f}return o&&(this.instructions.push(Yo),this.hitDetectionInstructions.push(Yo)),a&&(this.instructions.push(yn),this.hitDetectionInstructions.push(yn)),t}drawCircle(e,t){const i=this.state,n=i.fillStyle,s=i.strokeStyle;if(n===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([Ae.SET_FILL_STYLE,sn]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Ae.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=e.getFlatCoordinates(),a=e.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const u=[Ae.CIRCLE,l];this.instructions.push(Qn,u),this.hitDetectionInstructions.push(Qn,u),i.fillStyle!==void 0&&(this.instructions.push(Yo),this.hitDetectionInstructions.push(Yo)),i.strokeStyle!==void 0&&(this.instructions.push(yn),this.hitDetectionInstructions.push(yn)),this.endGeometry(t)}drawPolygon(e,t){const i=this.state,n=i.fillStyle,s=i.strokeStyle;if(n===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([Ae.SET_FILL_STYLE,sn]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Ae.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=e.getEnds(),a=e.getOrientedFlatCoordinates(),l=e.getStride();this.drawFlatCoordinatess_(a,0,o,l),this.endGeometry(t)}drawMultiPolygon(e,t){const i=this.state,n=i.fillStyle,s=i.strokeStyle;if(n===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([Ae.SET_FILL_STYLE,sn]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Ae.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=e.getEndss(),a=e.getOrientedFlatCoordinates(),l=e.getStride();let u=0;for(let f=0,m=o.length;f<m;++f)u=this.drawFlatCoordinatess_(a,u,o[f],l);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,n=t.length;i<n;++i)t[i]=Kn(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}}const ff=J_;function Q_(r,e,t,i,n){let s=t,o=t,a=0,l=0,u=t,f,m,_,C,R,L,A,S,P,k;for(m=t;m<i;m+=n){const H=e[m],K=e[m+1];R!==void 0&&(P=H-R,k=K-L,C=Math.sqrt(P*P+k*k),A!==void 0&&(l+=_,f=Math.acos((A*P+S*k)/(_*C)),f>r&&(l>a&&(a=l,s=u,o=m),l=0,u=m-n)),_=C,A=P,S=k),R=H,L=K}return l+=C,l>a?[u,m]:[s,o]}const kr={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class ey extends ho{constructor(e,t,i,n){super(e,t,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t){const i=this.textFillState_,n=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!i&&!n)return;const o=this.coordinates;let a=o.length;const l=e.getType();let u=null,f=e.getStride();if(s.placement==="line"&&(l=="LineString"||l=="MultiLineString"||l=="Polygon"||l=="MultiPolygon")){if(!Nt(this.getBufferedMaxExtent(),e.getExtent()))return;let m;if(u=e.getFlatCoordinates(),l=="LineString")m=[u.length];else if(l=="MultiLineString")m=e.getEnds();else if(l=="Polygon")m=e.getEnds().slice(0,1);else if(l=="MultiPolygon"){const L=e.getEndss();m=[];for(let A=0,S=L.length;A<S;++A)m.push(L[A][0])}this.beginGeometry(e,t);const _=s.textAlign;let C=0,R;for(let L=0,A=m.length;L<A;++L){if(_==null){const P=Q_(s.maxAngle,u,C,m[L],f);C=P[0],R=P[1]}else R=m[L];for(let P=C;P<R;P+=f)o.push(u[P],u[P+1]);const S=o.length;C=m[L],this.drawChars_(a,S),a=S}this.endGeometry(t)}else{let m=s.overflow?null:[];switch(l){case"Point":case"MultiPoint":u=e.getFlatCoordinates();break;case"LineString":u=e.getFlatMidpoint();break;case"Circle":u=e.getCenter();break;case"MultiLineString":u=e.getFlatMidpoints(),f=2;break;case"Polygon":u=e.getFlatInteriorPoint(),s.overflow||m.push(u[2]/this.resolution),f=3;break;case"MultiPolygon":const A=e.getFlatInteriorPoints();u=[];for(let S=0,P=A.length;S<P;S+=3)s.overflow||m.push(A[S+2]/this.resolution),u.push(A[S],A[S+1]);if(u.length===0)return;f=2;break}const _=this.appendFlatPointCoordinates(u,f);if(_===a)return;if(m&&(_-a)/2!==u.length/f){let A=a/2;m=m.filter((S,P)=>{const k=o[(A+P)*2]===u[P*f]&&o[(A+P)*2+1]===u[P*f+1];return k||--A,k})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t);let C=s.padding;if(C!=Jn&&(s.scale[0]<0||s.scale[1]<0)){let A=s.padding[0],S=s.padding[1],P=s.padding[2],k=s.padding[3];s.scale[0]<0&&(S=-S,k=-k),s.scale[1]<0&&(A=-A,P=-P),C=[A,S,P,k]}const R=this.pixelRatio;this.instructions.push([Ae.DRAW_IMAGE,a,_,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,C==Jn?Jn:C.map(function(A){return A*R}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,m]);const L=1/R;this.hitDetectionInstructions.push([Ae.DRAW_IMAGE,a,_,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[L,L],NaN,void 0,this.declutterImageWithText_,C,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,m]),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,n=this.strokeKey_;e&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:t.font,textAlign:t.textAlign||qr,justify:t.justify,textBaseline:t.textBaseline||ba,scale:t.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,n=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,u=kr[n.textBaseline],f=this.textOffsetY_*l,m=this.text_,_=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([Ae.DRAW_CHARS,e,t,u,n.overflow,a,n.maxAngle,l,f,s,_*l,m,o,1]),this.hitDetectionInstructions.push([Ae.DRAW_CHARS,e,t,u,n.overflow,a,n.maxAngle,1,f,s,_,m,o,1/l])}setTextStyle(e,t){let i,n,s;if(!e)this.text_="";else{const o=e.getFill();o?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=Ni(o.getColor()||sn)):(n=null,this.textFillState_=n);const a=e.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const R=a.getLineDash(),L=a.getLineDashOffset(),A=a.getWidth(),S=a.getMiterLimit();s.lineCap=a.getLineCap()||pa,s.lineDash=R?R.slice():Yr,s.lineDashOffset=L===void 0?Kr:L,s.lineJoin=a.getLineJoin()||Qs,s.lineWidth=A===void 0?Jr:A,s.miterLimit=S===void 0?$r:S,s.strokeStyle=Ni(a.getColor()||Zr)}i=this.textState_;const l=e.getFont()||Ig;__(l);const u=e.getScaleArray();i.overflow=e.getOverflow(),i.font=l,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||ba,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||Jn,i.scale=u===void 0?[1,1]:u;const f=e.getOffsetX(),m=e.getOffsetY(),_=e.getRotateWithView(),C=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=f===void 0?0:f,this.textOffsetY_=m===void 0?0:m,this.textRotateWithView_=_===void 0?!1:_,this.textRotation_=C===void 0?0:C,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:Ie(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n?typeof n.fillStyle=="string"?n.fillStyle:"|"+Ie(n.fillStyle):""}this.declutterImageWithText_=t}}const ty={Circle:ff,Default:ho,Image:$_,LineString:q_,Polygon:ff,Text:ey};class iy{constructor(e,t,i,n){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const n in i){const s=i[n].finish();e[t][n]=s}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);let s=n[t];if(s===void 0){const o=ty[t];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=s}return s}}const gf=iy;class ny extends hr{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.declutterExecutorGroup=null}getFeatures(e){return Ze()}getData(e){return null}prepareFrame(e){return Ze()}renderFrame(e,t){return Ze()}loadedTileCallback(e,t,i){e[t]||(e[t]={}),e[t][i.tileCoord.toString()]=i}createLoadedTileFinder(e,t,i){return function(n,s){const o=this.loadedTileCallback.bind(this,i,n);return e.forEachLoadedTile(t,n,s,o)}.bind(this)}forEachFeatureAtCoordinate(e,t,i,n,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){e.target.getState()===Ne.LOADED&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=Ne.LOADED&&t!=Ne.ERROR&&e.addEventListener(Te.CHANGE,this.boundHandleImageChange_),t==Ne.IDLE&&(e.load(),t=e.getState()),t==Ne.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Hg=ny;class sy extends Ei{constructor(e,t,i,n){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=n}}const Nr=sy,mf=[];let Os=null;function ry(){const r=document.createElement("canvas");r.width=1,r.height=1,Os=r.getContext("2d")}class oy extends Hg{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=ai(),this.pixelTransform=ai(),this.inversePixelTransform=ai(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,i){Os||ry(),Os.clearRect(0,0,1,1);let n;try{Os.drawImage(e,t,i,1,1,0,0,1,1),n=Os.getImageData(0,0,1,1).data}catch{return Os=null,null}return n}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const n=this.getLayer().getClassName();let s,o;if(e&&e.className===n&&(!i||e&&e.style.backgroundColor&&xn(Xr(e.style.backgroundColor),Xr(i)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){s=document.createElement("div"),s.className=n;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=hi();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const n=ps(i),s=Ga(i),o=Na(i),a=ka(i);St(t.coordinateToPixelTransform,n),St(t.coordinateToPixelTransform,s),St(t.coordinateToPixelTransform,o),St(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;St(l,n),St(l,s),St(l,o),St(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}dispatchRenderEvent_(e,t,i){const n=this.getLayer();if(n.hasListener(e)){const s=new Nr(e,this.inversePixelTransform,i,t);n.dispatchEvent(s)}}preRender(e,t){this.frameState=t,this.dispatchRenderEvent_(oi.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(oi.POSTRENDER,e,t)}getRenderTransform(e,t,i,n,s,o,a){const l=s/2,u=o/2,f=n/t,m=-f,_=-e[0]+a,C=-e[1];return vi(this.tempTransform,l,u,f,m,-i,_,C)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const qh=oy;function ay(r,e,t,i,n,s,o,a,l,u,f,m){let _=r[e],C=r[e+1],R=0,L=0,A=0,S=0;function P(){R=_,L=C,e+=i,_=r[e],C=r[e+1],S+=A,A=Math.sqrt((_-R)*(_-R)+(C-L)*(C-L))}do P();while(e<t-i&&S+A<s);let k=A===0?0:(s-S)/A;const H=Zi(R,_,k),K=Zi(L,C,k),ie=e-i,te=S,ee=s+a*l(u,n,f);for(;e<t-i&&S+A<ee;)P();k=A===0?0:(ee-S)/A;const ne=Zi(R,_,k),ue=Zi(L,C,k);let de;if(m){const we=[H,K,ne,ue];Fh(we,0,4,2,m,we,we),de=we[0]>we[2]}else de=H>ne;const oe=Math.PI,ye=[],xe=ie+i===e;e=ie,A=0,S=te,_=r[e],C=r[e+1];let pe;if(xe){P(),pe=Math.atan2(C-L,_-R),de&&(pe+=pe>0?-oe:oe);const we=(ne+H)/2,fe=(ue+K)/2;return ye[0]=[we,fe,(ee-s)/2,pe,n],ye}n=n.replace(/\n/g," ");for(let we=0,fe=n.length;we<fe;){P();let Se=Math.atan2(C-L,_-R);if(de&&(Se+=Se>0?-oe:oe),pe!==void 0){let De=Se-pe;if(De+=De>oe?-2*oe:De<-oe?2*oe:0,Math.abs(De)>o)return null}pe=Se;const it=we;let Ue=0;for(;we<fe;++we){const De=de?fe-we-1:we,Fe=a*l(u,n[De],f);if(e+i<t&&S+A<s+Ue+Fe/2)break;Ue+=Fe}if(we===it)continue;const at=de?n.substring(fe-it,fe-we):n.substring(it,we);k=A===0?0:(s+Ue/2-S)/A;const ae=Zi(R,_,k),pt=Zi(L,C,k);ye.push([ae,pt,Ue/2,Se,at]),s+=Ue}return ye}const Ls=pi(),un=[],Wi=[],Xi=[],dn=[];function pf(r){return r[3].declutterBox}const ly=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function bf(r,e){return(e==="start"||e==="end")&&!ly.test(r)&&(e=e==="start"?"left":"right"),kr[e]}function hy(r,e,t){return t>0&&r.push(`
`,""),r.push(e,""),r}class cy{constructor(e,t,i,n){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=ai(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}createLabel(e,t,i,n){const s=e+t+i+n;if(this.labels_[s])return this.labels_[s];const o=n?this.strokeStates[n]:null,a=i?this.fillStates[i]:null,l=this.textStates[t],u=this.pixelRatio,f=[l.scale[0]*u,l.scale[1]*u],m=Array.isArray(e),_=l.justify?kr[l.justify]:bf(Array.isArray(e)?e[0]:e,l.textAlign||qr),C=n&&o.lineWidth?o.lineWidth:0,R=m?e:e.split(`
`).reduce(hy,[]),{width:L,height:A,widths:S,heights:P,lineWidths:k}=v_(l,R),H=L+C,K=[],ie=(H+2)*f[0],te=(A+C)*f[1],ee={width:ie<0?Math.floor(ie):Math.ceil(ie),height:te<0?Math.floor(te):Math.ceil(te),contextInstructions:K};(f[0]!=1||f[1]!=1)&&K.push("scale",f),n&&(K.push("strokeStyle",o.strokeStyle),K.push("lineWidth",C),K.push("lineCap",o.lineCap),K.push("lineJoin",o.lineJoin),K.push("miterLimit",o.miterLimit),K.push("setLineDash",[o.lineDash]),K.push("lineDashOffset",o.lineDashOffset)),i&&K.push("fillStyle",a.fillStyle),K.push("textBaseline","middle"),K.push("textAlign","center");const ne=.5-_;let ue=_*H+ne*C;const de=[],oe=[];let ye=0,xe=0,pe=0,we=0,fe;for(let Se=0,it=R.length;Se<it;Se+=2){const Ue=R[Se];if(Ue===`
`){xe+=ye,ye=0,ue=_*H+ne*C,++we;continue}const at=R[Se+1]||l.font;at!==fe&&(n&&de.push("font",at),i&&oe.push("font",at),fe=at),ye=Math.max(ye,P[pe]);const ae=[Ue,ue+ne*S[pe]+_*(S[pe]-k[we]),.5*(C+ye)+xe];ue+=S[pe],n&&de.push("strokeText",ae),i&&oe.push("fillText",ae),++pe}return Array.prototype.push.apply(K,de),Array.prototype.push.apply(K,oe),this.labels_[s]=ee,ee}replayTextBackground_(e,t,i,n,s,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,n),e.lineTo.apply(e,s),e.lineTo.apply(e,t),o&&(this.alignFill_=o[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,n,s,o,a,l,u,f,m,_,C,R,L,A){a*=_[0],l*=_[1];let S=i-a,P=n-l;const k=s+u>e?e-u:s,H=o+f>t?t-f:o,K=R[3]+k*_[0]+R[1],ie=R[0]+H*_[1]+R[2],te=S-R[3],ee=P-R[0];(L||m!==0)&&(un[0]=te,dn[0]=te,un[1]=ee,Wi[1]=ee,Wi[0]=te+K,Xi[0]=Wi[0],Xi[1]=ee+ie,dn[1]=Xi[1]);let ne;return m!==0?(ne=vi(ai(),i,n,1,1,m,-i,-n),St(ne,un),St(ne,Wi),St(ne,Xi),St(ne,dn),zi(Math.min(un[0],Wi[0],Xi[0],dn[0]),Math.min(un[1],Wi[1],Xi[1],dn[1]),Math.max(un[0],Wi[0],Xi[0],dn[0]),Math.max(un[1],Wi[1],Xi[1],dn[1]),Ls)):zi(Math.min(te,te+K),Math.min(ee,ee+ie),Math.max(te,te+K),Math.max(ee,ee+ie),Ls),C&&(S=Math.round(S),P=Math.round(P)),{drawImageX:S,drawImageY:P,drawImageW:k,drawImageH:H,originX:u,originY:f,declutterBox:{minX:Ls[0],minY:Ls[1],maxX:Ls[2],maxY:Ls[3],value:A},canvasTransform:ne,scale:_}}replayImageOrLabel_(e,t,i,n,s,o,a){const l=!!(o||a),u=n.declutterBox,f=e.canvas,m=a?a[2]*n.scale[0]/2:0;return u.minX-m<=f.width/t&&u.maxX+m>=0&&u.minY-m<=f.height/t&&u.maxY+m>=0&&(l&&this.replayTextBackground_(e,un,Wi,Xi,dn,o,a),E_(e,n.canvasTransform,s,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(e){if(this.alignFill_){const t=St(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;e.save(),e.translate(t[0]%i,t[1]%i),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,i,n){const s=this.textStates[t],o=this.createLabel(e,t,n,i),a=this.strokeStates[i],l=this.pixelRatio,u=bf(Array.isArray(e)?e[0]:e,s.textAlign||qr),f=kr[s.textBaseline||ba],m=a&&a.lineWidth?a.lineWidth:0,_=o.width/l-2*s.scale[0],C=u*_+2*(.5-u)*m,R=f*o.height/l+2*(.5-f)*m;return{label:o,anchorX:C,anchorY:R}}execute_(e,t,i,n,s,o,a,l){let u;this.pixelCoordinates_&&xn(i,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=is(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),bb(this.renderedTransform_,i));let f=0;const m=n.length;let _=0,C,R,L,A,S,P,k,H,K,ie,te,ee,ne=0,ue=0,de=null,oe=null;const ye=this.coordinateCache_,xe=this.viewRotation_,pe=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,we={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:xe},fe=this.instructions!=n||this.overlaps?0:200;let Se,it,Ue,at;for(;f<m;){const ae=n[f];switch(ae[0]){case Ae.BEGIN_GEOMETRY:Se=ae[1],at=ae[3],Se.getGeometry()?a!==void 0&&!Nt(a,at.getExtent())?f=ae[2]+1:++f:f=ae[2];break;case Ae.BEGIN_PATH:ne>fe&&(this.fill_(e),ne=0),ue>fe&&(e.stroke(),ue=0),!ne&&!ue&&(e.beginPath(),A=NaN,S=NaN),++f;break;case Ae.CIRCLE:_=ae[1];const De=u[_],Fe=u[_+1],ht=u[_+2],Lt=u[_+3],ut=ht-De,ct=Lt-Fe,Z=Math.sqrt(ut*ut+ct*ct);e.moveTo(De+Z,Fe),e.arc(De,Fe,Z,0,2*Math.PI,!0),++f;break;case Ae.CLOSE_PATH:e.closePath(),++f;break;case Ae.CUSTOM:_=ae[1],C=ae[2];const Ht=ae[3],Qe=ae[4],Ut=ae.length==6?ae[5]:void 0;we.geometry=Ht,we.feature=Se,f in ye||(ye[f]=[]);const ui=ye[f];Ut?Ut(u,_,C,2,ui):(ui[0]=u[_],ui[1]=u[_+1],ui.length=2),Qe(ui,we),++f;break;case Ae.DRAW_IMAGE:_=ae[1],C=ae[2],H=ae[3],R=ae[4],L=ae[5];let Di=ae[6];const wi=ae[7],et=ae[8],on=ae[9],an=ae[10];let Jt=ae[11];const An=ae[12];let Ot=ae[13];const Vt=ae[14],Qt=ae[15];if(!H&&ae.length>=20){K=ae[19],ie=ae[20],te=ae[21],ee=ae[22];const Wt=this.drawLabelWithPointPlacement_(K,ie,te,ee);H=Wt.label,ae[3]=H;const bt=ae[23];R=(Wt.anchorX-bt)*this.pixelRatio,ae[4]=R;const rt=ae[24];L=(Wt.anchorY-rt)*this.pixelRatio,ae[5]=L,Di=H.height,ae[6]=Di,Ot=H.width,ae[13]=Ot}let J;ae.length>25&&(J=ae[25]);let Re,ei,Ai;ae.length>17?(Re=ae[16],ei=ae[17],Ai=ae[18]):(Re=Jn,ei=!1,Ai=!1),an&&pe?Jt+=xe:!an&&!pe&&(Jt-=xe);let ln=0;for(;_<C;_+=2){if(J&&J[ln++]<Ot/this.pixelRatio)continue;const Wt=this.calculateImageOrLabelDimensions_(H.width,H.height,u[_],u[_+1],Ot,Di,R,L,et,on,Jt,An,s,Re,ei||Ai,Se),bt=[e,t,H,Wt,wi,ei?de:null,Ai?oe:null];if(l){if(Vt==="none")continue;if(Vt==="obstacle"){l.insert(Wt.declutterBox);continue}else{let rt,Ye;if(Qt){const Xt=C-_;if(!Qt[Xt]){Qt[Xt]=bt;continue}if(rt=Qt[Xt],delete Qt[Xt],Ye=pf(rt),l.collides(Ye))continue}if(l.collides(Wt.declutterBox))continue;rt&&(l.insert(Ye),this.replayImageOrLabel_.apply(this,rt)),l.insert(Wt.declutterBox)}}this.replayImageOrLabel_.apply(this,bt)}++f;break;case Ae.DRAW_CHARS:const Je=ae[1],yt=ae[2],ys=ae[3],Mn=ae[4];ee=ae[5];const vo=ae[6],Eo=ae[7],wo=ae[8];te=ae[9];const gr=ae[10];K=ae[11],ie=ae[12];const Co=[ae[13],ae[13]],mr=this.textStates[ie],In=mr.font,Fn=[mr.scale[0]*Eo,mr.scale[1]*Eo];let Pn;In in this.widths_?Pn=this.widths_[In]:(Pn={},this.widths_[In]=Pn);const pr=wg(u,Je,yt,2),br=Math.abs(Fn[0])*of(In,K,Pn);if(Mn||br<=pr){const Wt=this.textStates[ie].textAlign,bt=(pr-br)*kr[Wt],rt=ay(u,Je,yt,2,K,bt,vo,Math.abs(Fn[0]),of,In,Pn,pe?0:this.viewRotation_);e:if(rt){const Ye=[];let Xt,Yt,Ui,kt,Kt;if(te)for(Xt=0,Yt=rt.length;Xt<Yt;++Xt){Kt=rt[Xt],Ui=Kt[4],kt=this.createLabel(Ui,ie,"",te),R=Kt[2]+(Fn[0]<0?-gr:gr),L=ys*kt.height+(.5-ys)*2*gr*Fn[1]/Fn[0]-wo;const bi=this.calculateImageOrLabelDimensions_(kt.width,kt.height,Kt[0],Kt[1],kt.width,kt.height,R,L,0,0,Kt[3],Co,!1,Jn,!1,Se);if(l&&l.collides(bi.declutterBox))break e;Ye.push([e,t,kt,bi,1,null,null])}if(ee)for(Xt=0,Yt=rt.length;Xt<Yt;++Xt){Kt=rt[Xt],Ui=Kt[4],kt=this.createLabel(Ui,ie,ee,""),R=Kt[2],L=ys*kt.height-wo;const bi=this.calculateImageOrLabelDimensions_(kt.width,kt.height,Kt[0],Kt[1],kt.width,kt.height,R,L,0,0,Kt[3],Co,!1,Jn,!1,Se);if(l&&l.collides(bi.declutterBox))break e;Ye.push([e,t,kt,bi,1,null,null])}l&&l.load(Ye.map(pf));for(let bi=0,xo=Ye.length;bi<xo;++bi)this.replayImageOrLabel_.apply(this,Ye[bi])}}++f;break;case Ae.END_GEOMETRY:if(o!==void 0){Se=ae[1];const Wt=o(Se,at);if(Wt)return Wt}++f;break;case Ae.FILL:fe?ne++:this.fill_(e),++f;break;case Ae.MOVE_TO_LINE_TO:for(_=ae[1],C=ae[2],it=u[_],Ue=u[_+1],P=it+.5|0,k=Ue+.5|0,(P!==A||k!==S)&&(e.moveTo(it,Ue),A=P,S=k),_+=2;_<C;_+=2)it=u[_],Ue=u[_+1],P=it+.5|0,k=Ue+.5|0,(_==C-2||P!==A||k!==S)&&(e.lineTo(it,Ue),A=P,S=k);++f;break;case Ae.SET_FILL_STYLE:de=ae,this.alignFill_=ae[2],ne&&(this.fill_(e),ne=0,ue&&(e.stroke(),ue=0)),e.fillStyle=ae[1],++f;break;case Ae.SET_STROKE_STYLE:oe=ae,ue&&(e.stroke(),ue=0),this.setStrokeStyle_(e,ae),++f;break;case Ae.STROKE:fe?ue++:e.stroke(),++f;break;default:++f;break}}ne&&this.fill_(e),ue&&e.stroke()}execute(e,t,i,n,s,o){this.viewRotation_=n,this.execute_(e,t,i,this.instructions,s,void 0,void 0,o)}executeHitDetection(e,t,i,n,s){return this.viewRotation_=i,this.execute_(e,1,t,this.hitDetectionInstructions,!0,n,s)}}const uy=cy,yl=["Polygon","Circle","LineString","Image","Text","Default"];class dy{constructor(e,t,i,n,s,o){this.maxExtent_=e,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=ai(),this.createExecutors_(s)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e){for(const t in e){let i=this.executorsByZIndex_[t];i===void 0&&(i={},this.executorsByZIndex_[t]=i);const n=e[t];for(const s in n){const o=n[s];i[s]=new uy(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let n=0,s=e.length;n<s;++n)if(e[n]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,n,s,o){n=Math.round(n);const a=n*2+1,l=vi(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-i,-e[0],-e[1]),u=!this.hitDetectionContext_;u&&(this.hitDetectionContext_=hi(a,a));const f=this.hitDetectionContext_;f.canvas.width!==a||f.canvas.height!==a?(f.canvas.width=a,f.canvas.height=a):u||f.clearRect(0,0,a,a);let m;this.renderBuffer_!==void 0&&(m=pi(),Or(m,e),no(m,t*(this.renderBuffer_+n),m));const _=fy(n);let C;function R(K,ie){const te=f.getImageData(0,0,a,a).data;for(let ee=0,ne=_.length;ee<ne;ee++)if(te[_[ee]]>0){if(!o||C!=="Image"&&C!=="Text"||o.includes(K)){const ue=(_[ee]-3)/4,de=n-ue%a,oe=n-(ue/a|0),ye=s(K,ie,de*de+oe*oe);if(ye)return ye}f.clearRect(0,0,a,a);break}}const L=Object.keys(this.executorsByZIndex_).map(Number);L.sort(wn);let A,S,P,k,H;for(A=L.length-1;A>=0;--A){const K=L[A].toString();for(P=this.executorsByZIndex_[K],S=yl.length-1;S>=0;--S)if(C=yl[S],k=P[C],k!==void 0&&(H=k.executeHitDetection(f,l,i,R,m),H))return H}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],n=t[1],s=t[2],o=t[3],a=[i,n,i,o,s,o,s,n];return is(a,0,8,2,e,a),a}isEmpty(){return Ur(this.executorsByZIndex_)}execute(e,t,i,n,s,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(wn),this.maxExtent_&&(e.save(),this.clip(e,i)),o=o||yl;let u,f,m,_,C,R;for(a&&l.reverse(),u=0,f=l.length;u<f;++u){const L=l[u].toString();for(C=this.executorsByZIndex_[L],m=0,_=o.length;m<_;++m){const A=o[m];R=C[A],R!==void 0&&R.execute(e,t,i,n,s,a)}}this.maxExtent_&&e.restore()}}const vl={};function fy(r){if(vl[r]!==void 0)return vl[r];const e=r*2+1,t=r*r,i=new Array(t+1);for(let s=0;s<=r;++s)for(let o=0;o<=r;++o){const a=s*s+o*o;if(a>t)break;let l=i[a];l||(l=[],i[a]=l),l.push(((r+s)*e+(r+o))*4+3),s>0&&l.push(((r-s)*e+(r+o))*4+3),o>0&&(l.push(((r+s)*e+(r-o))*4+3),s>0&&l.push(((r-s)*e+(r-o))*4+3))}const n=[];for(let s=0,o=i.length;s<o;++s)i[s]&&n.push(...i[s]);return vl[r]=n,n}const _f=dy,It={ANIMATING:0,INTERACTING:1};class gy extends jg{constructor(e,t,i,n,s,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=n,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=ai()}drawImages_(e,t,i,n){if(!this.image_)return;const s=is(e,t,i,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let u=this.imageRotation_;this.imageRotateWithView_&&(u+=this.viewRotation_);for(let f=0,m=s.length;f<m;f+=2){const _=s[f]-this.imageAnchorX_,C=s[f+1]-this.imageAnchorY_;if(u!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const R=_+this.imageAnchorX_,L=C+this.imageAnchorY_;vi(a,R,L,1,1,u,-R,-L),o.setTransform.apply(o,a),o.translate(R,L),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,_,C,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=is(e,t,i,n,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);t<i;t+=n){const l=s[t]+this.textOffsetX_,u=s[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.translate(l-this.textOffsetX_,u-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,l,u),this.textFillState_&&o.fillText(this.text_,l,u))}}moveToLineTo_(e,t,i,n,s){const o=this.context_,a=is(e,t,i,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let u=2;u<l;u+=2)o.lineTo(a[u],a[u+1]);return s&&o.closePath(),i}drawRings_(e,t,i,n){for(let s=0,o=i.length;s<o;++s)t=this.moveToLineTo_(e,t,i[s],n,!0);return t}drawCircle(e){if(!!Nt(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=e_(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],n=t[3]-t[1],s=Math.sqrt(i*i+n*n),o=this.context_;o.beginPath(),o.arc(t[0],t[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);!i||!Nt(this.extent_,i.getExtent())||(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,n=t.length;i<n;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Nt(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(!!Nt(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=e.getFlatCoordinates();let s=0;const o=e.getEnds(),a=e.getStride();i.beginPath();for(let l=0,u=o.length;l<u;++l)s=this.moveToLineTo_(n,s,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Nt(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Nt(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let n=0;const s=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=s.length;a<l;++a){const u=s[a];n=this.drawRings_(i,n,u,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),xn(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,n=e.textAlign?e.textAlign:qr;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=n&&(i.textAlign=n,t.textAlign=n),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=n,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:n,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:Ni(i||sn)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),n=t.getLineCap(),s=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),u=t.getMiterLimit(),f=s||Yr;this.strokeState_={lineCap:n!==void 0?n:pa,lineDash:this.pixelRatio_===1?f:f.map(m=>m*this.pixelRatio_),lineDashOffset:(o||Kr)*this.pixelRatio_,lineJoin:a!==void 0?a:Qs,lineWidth:(l!==void 0?l:Jr)*this.pixelRatio_,miterLimit:u!==void 0?u:$r,strokeStyle:Ni(i||Zr)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),n=e.getAnchor(),s=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const C=t.getColor();this.textFillState_={fillStyle:Ni(C||sn)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const C=i.getColor(),R=i.getLineCap(),L=i.getLineDash(),A=i.getLineDashOffset(),S=i.getLineJoin(),P=i.getWidth(),k=i.getMiterLimit();this.textStrokeState_={lineCap:R!==void 0?R:pa,lineDash:L||Yr,lineDashOffset:A||Kr,lineJoin:S!==void 0?S:Qs,lineWidth:P!==void 0?P:Jr,miterLimit:k!==void 0?k:$r,strokeStyle:Ni(C||Zr)}}const n=e.getFont(),s=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),u=e.getScaleArray(),f=e.getText(),m=e.getTextAlign(),_=e.getTextBaseline();this.textState_={font:n!==void 0?n:Ig,textAlign:m!==void 0?m:qr,textBaseline:_!==void 0?_:ba},this.text_=f!==void 0?Array.isArray(f)?f.reduce((C,R,L)=>C+=L%2?" ":R,""):f:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*u[0],this.pixelRatio_*u[1]]}}}const my=gy,Oi=.5;function py(r,e,t,i,n,s,o){const a=r[0]*Oi,l=r[1]*Oi,u=hi(a,l);u.imageSmoothingEnabled=!1;const f=u.canvas,m=new my(u,Oi,n,null,o),_=t.length,C=Math.floor((256*256*256-1)/_),R={};for(let A=1;A<=_;++A){const S=t[A-1],P=S.getStyleFunction()||i;if(!i)continue;let k=P(S,s);if(!k)continue;Array.isArray(k)||(k=[k]);const H=A*C,K="#"+("000000"+H.toString(16)).slice(-6);for(let ie=0,te=k.length;ie<te;++ie){const ee=k[ie],ne=ee.getGeometryFunction()(S);if(!ne||!Nt(n,ne.getExtent()))continue;const ue=ee.clone(),de=ue.getFill();de&&de.setColor(K);const oe=ue.getStroke();oe&&(oe.setColor(K),oe.setLineDash(null)),ue.setText(void 0);const ye=ee.getImage();if(ye&&ye.getOpacity()!==0){const we=ye.getImageSize();if(!we)continue;const fe=hi(we[0],we[1],void 0,{alpha:!1}),Se=fe.canvas;fe.fillStyle=K,fe.fillRect(0,0,Se.width,Se.height),ue.setImage(new Bg({img:Se,imgSize:we,anchor:ye.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:ye.getOrigin(),opacity:1,size:ye.getSize(),scale:ye.getScale(),rotation:ye.getRotation(),rotateWithView:ye.getRotateWithView()}))}const xe=ue.getZIndex()||0;let pe=R[xe];pe||(pe={},R[xe]=pe,pe.Polygon=[],pe.Circle=[],pe.LineString=[],pe.Point=[]),pe[ne.getType().replace("Multi","")].push(ne,ue)}}const L=Object.keys(R).map(Number).sort(wn);for(let A=0,S=L.length;A<S;++A){const P=R[L[A]];for(const k in P){const H=P[k];for(let K=0,ie=H.length;K<ie;K+=2){m.setStyle(H[K+1]);for(let te=0,ee=e.length;te<ee;++te)m.setTransform(e[te]),m.drawGeometry(H[K])}}}return u.getImageData(0,0,f.width,f.height)}function by(r,e,t){const i=[];if(t){const n=Math.floor(Math.round(r[0])*Oi),s=Math.floor(Math.round(r[1])*Oi),o=(wt(n,0,t.width-1)+wt(s,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],f=t.data[o+2]+256*(l+256*a),m=Math.floor((256*256*256-1)/e.length);f&&f%m===0&&i.push(e[f/m-1])}return i}const _y=.5,Ug={Point:Sy,LineString:xy,Polygon:Dy,MultiPoint:Ly,MultiLineString:Ty,MultiPolygon:Ry,GeometryCollection:Cy,Circle:Ey};function yy(r,e){return parseInt(Ie(r),10)-parseInt(Ie(e),10)}function vy(r,e){const t=oh(r,e);return t*t}function oh(r,e){return _y*r/e}function Ey(r,e,t,i,n){const s=t.getFill(),o=t.getStroke();if(s||o){const l=r.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(e,i)}const a=t.getText();if(a&&a.getText()){const l=(n||r).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}function yf(r,e,t,i,n,s,o){let a=!1;const l=t.getImage();if(l){const u=l.getImageState();u==Ne.LOADED||u==Ne.ERROR?l.unlistenImageChange(n):(u==Ne.IDLE&&l.load(),l.listenImageChange(n),a=!0)}return wy(r,e,t,i,s,o),a}function wy(r,e,t,i,n,s){const o=t.getGeometryFunction()(e);if(!o)return;const a=o.simplifyTransformed(i,n);if(t.getRenderer())Vg(r,a,t,e);else{const u=Ug[a.getType()];u(r,a,t,e,s)}}function Vg(r,e,t,i){if(e.getType()=="GeometryCollection"){const s=e.getGeometries();for(let o=0,a=s.length;o<a;++o)Vg(r,s[o],t,i);return}r.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer())}function Cy(r,e,t,i,n){const s=e.getGeometriesArray();let o,a;for(o=0,a=s.length;o<a;++o){const l=Ug[s[o].getType()];l(r,s[o],t,i,n)}}function xy(r,e,t,i,n){const s=t.getStroke();if(s){const a=r.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(e,i)}const o=t.getText();if(o&&o.getText()){const a=(n||r).getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i)}}function Ty(r,e,t,i,n){const s=t.getStroke();if(s){const a=r.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(e,i)}const o=t.getText();if(o&&o.getText()){const a=(n||r).getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i)}}function Ry(r,e,t,i,n){const s=t.getFill(),o=t.getStroke();if(o||s){const l=r.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(e,i)}const a=t.getText();if(a&&a.getText()){const l=(n||r).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}function Sy(r,e,t,i,n){const s=t.getImage(),o=t.getText();let a;if(s){if(s.getImageState()!=Ne.LOADED)return;let l=r;if(n){const f=s.getDeclutterMode();if(f!=="none")if(l=n,f==="obstacle"){const m=r.getBuilder(t.getZIndex(),"Image");m.setImageStyle(s,a),m.drawPoint(e,i)}else o&&o.getText()&&(a={})}const u=l.getBuilder(t.getZIndex(),"Image");u.setImageStyle(s,a),u.drawPoint(e,i)}if(o&&o.getText()){let l=r;n&&(l=n);const u=l.getBuilder(t.getZIndex(),"Text");u.setTextStyle(o,a),u.drawText(e,i)}}function Ly(r,e,t,i,n){const s=t.getImage(),o=t.getText();let a;if(s){if(s.getImageState()!=Ne.LOADED)return;let l=r;if(n){const f=s.getDeclutterMode();if(f!=="none")if(l=n,f==="obstacle"){const m=r.getBuilder(t.getZIndex(),"Image");m.setImageStyle(s,a),m.drawMultiPoint(e,i)}else o&&o.getText()&&(a={})}const u=l.getBuilder(t.getZIndex(),"Image");u.setImageStyle(s,a),u.drawMultiPoint(e,i)}if(o&&o.getText()){let l=r;n&&(l=n);const u=l.getBuilder(t.getZIndex(),"Text");u.setTextStyle(o,a),u.drawText(e,i)}}function Dy(r,e,t,i,n){const s=t.getFill(),o=t.getStroke();if(s||o){const l=r.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(e,i)}const a=t.getText();if(a&&a.getText()){const l=(n||r).getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i)}}class Ay extends qh{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=pi(),this.wrappedRenderedExtent_=pi(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,i){const n=t.extent,s=t.viewState,o=s.center,a=s.resolution,l=s.projection,u=s.rotation,f=l.getExtent(),m=this.getLayer().getSource(),_=t.pixelRatio,C=t.viewHints,R=!(C[It.ANIMATING]||C[It.INTERACTING]),L=this.compositionContext_,A=Math.round(t.size[0]*_),S=Math.round(t.size[1]*_),P=m.getWrapX()&&l.canWrapX(),k=P?ot(f):null,H=P?Math.ceil((n[2]-f[2])/k)+1:1;let K=P?Math.floor((n[0]-f[0])/k):0;do{const ie=this.getRenderTransform(o,a,u,_,A,S,K*k);e.execute(L,1,ie,u,R,void 0,i)}while(++K<H)}setupCompositionContext_(){if(this.opacity_!==1){const e=hi(this.context.canvas.width,this.context.canvas.height,mf);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,Ag(this.compositionContext_),mf.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())}renderFrame(e,t){const i=e.pixelRatio,n=e.layerStatesArray[e.layerIndex];_b(this.pixelTransform,1/i,1/i),Oa(this.inversePixelTransform,this.pixelTransform);const s=xh(this.pixelTransform);this.useContainer(t,s,this.getBackground(e));const o=this.context,a=o.canvas,l=this.replayGroup_,u=this.declutterExecutorGroup;if((!l||l.isEmpty())&&(!u||u.isEmpty()))return null;const f=Math.round(e.size[0]*i),m=Math.round(e.size[1]*i);a.width!=f||a.height!=m?(a.width=f,a.height=m,a.style.transform!==s&&(a.style.transform=s)):this.containerReused||o.clearRect(0,0,f,m),this.preRender(o,e);const _=e.viewState;_.projection,this.opacity_=n.opacity,this.setupCompositionContext_();let C=!1,R=!0;if(n.extent&&this.clipping){const L=yi(n.extent);R=Nt(L,e.extent),C=R&&!Zn(L,e.extent),C&&this.clipUnrotated(this.compositionContext_,e,L)}return R&&this.renderWorlds(l,e),C&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,e),this.renderedRotation_!==_.rotation&&(this.renderedRotation_=_.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise(function(t){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];St(this.pixelTransform,i);const n=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,u=this.getLayer(),f=[],m=i[0]*Oi,_=i[1]*Oi;f.push(this.getRenderTransform(n,s,o,Oi,m,_,0).slice());const C=u.getSource(),R=a.getExtent();if(C.getWrapX()&&a.canWrapX()&&!Zn(R,l)){let L=l[0];const A=ot(R);let S=0,P;for(;L<R[0];)--S,P=A*S,f.push(this.getRenderTransform(n,s,o,Oi,m,_,P).slice()),L+=A;for(S=0,L=l[2];L>R[2];)++S,P=A*S,f.push(this.getRenderTransform(n,s,o,Oi,m,_,P).slice()),L-=A}this.hitDetectionImageData_=py(i,f,this.renderedFeatures_,u.getStyleFunction(),l,s,o)}t(by(e,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))}forEachFeatureAtCoordinate(e,t,i,n,s){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),u={},f=function(C,R,L){const A=Ie(C),S=u[A];if(S){if(S!==!0&&L<S.distanceSq){if(L===0)return u[A]=!0,s.splice(s.lastIndexOf(S),1),n(C,l,R);S.geometry=R,S.distanceSq=L}}else{if(L===0)return u[A]=!0,n(C,l,R);s.push(u[A]={feature:C,layer:l,geometry:R,distanceSq:L,callback:n})}};let m;const _=[this.replayGroup_];return this.declutterExecutorGroup&&_.push(this.declutterExecutorGroup),_.some(C=>m=C.forEachFeatureAtCoordinate(e,o,a,i,f,C===this.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map(R=>R.value):null)),m}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const n=e.viewHints[It.ANIMATING],s=e.viewHints[It.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,u=e.viewState,f=u.projection,m=u.resolution,_=e.pixelRatio,C=t.getRevision(),R=t.getRenderBuffer();let L=t.getRenderOrder();L===void 0&&(L=yy);const A=u.center.slice(),S=no(l,R*m),P=S.slice(),k=[S.slice()],H=f.getExtent();if(i.getWrapX()&&f.canWrapX()&&!Zn(H,e.extent)){const pe=ot(H),we=Math.max(ot(S)/2,pe);S[0]=H[0]-we,S[2]=H[2]+we,dg(A,f);const fe=ug(k[0],f);fe[0]<H[0]&&fe[2]<H[2]?k.push([fe[0]+pe,fe[1],fe[2]+pe,fe[3]]):fe[0]>H[0]&&fe[2]>H[2]&&k.push([fe[0]-pe,fe[1],fe[2]-pe,fe[3]])}if(this.ready&&this.renderedResolution_==m&&this.renderedRevision_==C&&this.renderedRenderOrder_==L&&Zn(this.wrappedRenderedExtent_,S))return xn(this.renderedExtent_,P)||(this.hitDetectionImageData_=null,this.renderedExtent_=P),this.renderedCenter_=A,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const K=new gf(oh(m,_),S,m,_);let ie;this.getLayer().getDeclutter()&&(ie=new gf(oh(m,_),S,m,_));let te;for(let pe=0,we=k.length;pe<we;++pe)i.loadFeatures(k[pe],m,f);const ee=vy(m,_);let ne=!0;const ue=function(pe){let we;const fe=pe.getStyleFunction()||t.getStyleFunction();if(fe&&(we=fe(pe,m)),we){const Se=this.renderFeature(pe,ee,we,K,te,ie);ne=ne&&!Se}}.bind(this),de=za(S),oe=i.getFeaturesInExtent(de);L&&oe.sort(L);for(let pe=0,we=oe.length;pe<we;++pe)ue(oe[pe]);this.renderedFeatures_=oe,this.ready=ne;const ye=K.finish(),xe=new _f(S,m,_,i.getOverlaps(),ye,t.getRenderBuffer());return ie&&(this.declutterExecutorGroup=new _f(S,m,_,i.getOverlaps(),ie.finish(),t.getRenderBuffer())),this.renderedResolution_=m,this.renderedRevision_=C,this.renderedRenderOrder_=L,this.renderedExtent_=P,this.wrappedRenderedExtent_=S,this.renderedCenter_=A,this.renderedProjection_=f,this.replayGroup_=xe,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,n,s,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let l=0,u=i.length;l<u;++l)a=yf(n,e,i[l],t,this.boundHandleStyleImageChange_,s,o)||a;else a=yf(n,e,i,t,this.boundHandleStyleImageChange_,s,o);return a}}const My=Ay;class Iy extends W_{constructor(e){super(e)}createRenderer(){return new My(this)}}const Jh=Iy;class Fy{constructor(e){this.rbush_=new Gg(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[Ie(t)]=i}load(e,t){const i=new Array(t.length);for(let n=0,s=t.length;n<s;n++){const o=e[n],a=t[n],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[n]=l,this.items_[Ie(a)]=l}this.rbush_.load(i)}remove(e){const t=Ie(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[Ie(t)],n=[i.minX,i.minY,i.maxX,i.maxY];Js(n,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(n){return n.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let n=0,s=e.length;n<s;n++)if(i=t(e[n]),i)return i;return i}isEmpty(){return Ur(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return zi(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const Ea=Fy;class Py extends Hi{constructor(e){super(),this.projection=li(e.projection),this.attributions_=vf(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,n){t.viewResolver=i,t.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(){return Ze()}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=vf(e),this.changed()}setState(e){this.state_=e,this.changed()}}function vf(r){return r?Array.isArray(r)?function(e){return r}:typeof r=="function"?r:function(e){return[r]}:null}const Qh=Py,$t={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function Oy(r,e){return[[-1/0,-1/0,1/0,1/0]]}let ky=!1;function Ny(r,e,t,i,n,s,o){const a=new XMLHttpRequest;a.open("GET",typeof r=="function"?r(t,i,n):r,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=ky,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const u=e.getType();let f;u=="json"||u=="text"?f=a.responseText:u=="xml"?(f=a.responseXML,f||(f=new DOMParser().parseFromString(a.responseText,"application/xml"))):u=="arraybuffer"&&(f=a.response),f?s(e.readFeatures(f,{extent:t,featureProjection:n}),e.readProjection(f)):o()}else o()},a.onerror=o,a.send()}function Ef(r,e){return function(t,i,n,s,o){const a=this;Ny(r,e,t,i,n,function(l,u){a.addFeatures(l),s!==void 0&&s(l)},o||os)}}class fn extends Ei{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class Gy extends Qh{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=os,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(Xe(this.format_,7),this.loader_=Ef(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:Oy;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new Ea:null,this.loadedExtentsRtree_=new Ea,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,n;Array.isArray(e.features)?n=e.features:e.features&&(i=e.features,n=i.getArray()),!t&&i===void 0&&(i=new mi(n)),n!==void 0&&this.addFeaturesInternal(n),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=Ie(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new fn($t.ADDFEATURE,e))}setupChangeEvents_(e,t){this.featureChangeKeys_[e]=[ze(t,Te.CHANGE,this.handleFeatureChange_,this),ze(t,Zs.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(e,t){let i=!0;const n=t.getId();return n!==void 0&&(n.toString()in this.idIndex_?i=!1:this.idIndex_[n.toString()]=t),i&&(Xe(!(e in this.uidIndex_),30),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],n=[];for(let s=0,o=e.length;s<o;s++){const a=e[s],l=Ie(a);this.addToIndex_(l,a)&&i.push(a)}for(let s=0,o=i.length;s<o;s++){const a=i[s],l=Ie(a);this.setupChangeEvents_(l,a);const u=a.getGeometry();if(u){const f=u.getExtent();t.push(f),n.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,n),this.hasListener($t.ADDFEATURE))for(let s=0,o=i.length;s<o;s++)this.dispatchEvent(new fn($t.ADDFEATURE,i[s]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener($t.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener($t.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(Ft.ADD,function(i){t||(t=!0,this.addFeature(i.element),t=!1)}.bind(this)),e.addEventListener(Ft.REMOVE,function(i){t||(t=!0,this.removeFeature(i.element),t=!1)}.bind(this)),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(lt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=function(n){this.removeFeatureInternal(n)}.bind(this);this.featuresRtree_.forEach(i);for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new fn($t.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(n){if(n.getGeometry().intersectsCoordinate(e))return t(n)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){if(i.getGeometry().intersectsExtent(e)){const s=t(i);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),Ur(this.nullGeometryFeatures_)||en(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const n=Tb(e,t);return[].concat(...n.map(s=>this.featuresRtree_.getInExtent(s)))}else return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],n=e[1];let s=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||rs,this.featuresRtree_.forEachInExtent(l,function(u){if(t(u)){const f=u.getGeometry(),m=a;if(a=f.closestPointXY(i,n,o,a),a<m){s=u;const _=Math.sqrt(a);l[0]=i-_,l[1]=n-_,l[2]=i+_,l[3]=n+_}}}),s}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=Ie(t),n=t.getGeometry();if(!n)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const o=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const s=t.getId();if(s!==void 0){const o=s.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new fn($t.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:Ie(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Ur(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const n=this.loadedExtentsRtree_,s=this.strategy_(e,t,i);for(let o=0,a=s.length;o<a;++o){const l=s[o];n.forEachInExtent(l,function(f){return Zn(f.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new fn($t.FEATURESLOADSTART)),this.loader_.call(this,l,t,i,function(f){--this.loadingExtentsCount_,this.dispatchEvent(new fn($t.FEATURESLOADEND,void 0,f))}.bind(this),function(){--this.loadingExtentsCount_,this.dispatchEvent(new fn($t.FEATURESLOADERROR))}.bind(this)),n.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let i;t.forEachInExtent(e,function(n){if(Js(n.extent,e))return i=n,!0}),i&&t.remove(i)}removeFeature(e){if(!e)return;const t=Ie(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=Ie(e),i=this.featureChangeKeys_[t];if(!i)return;i.forEach(lt),delete this.featureChangeKeys_[t];const n=e.getId();return n!==void 0&&delete this.idIndex_[n.toString()],delete this.uidIndex_[t],this.dispatchEvent(new fn($t.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===e){delete this.idIndex_[i],t=!0;break}return t}setLoader(e){this.loader_=e}setUrl(e){Xe(this.format_,7),this.url_=e,this.setLoader(Ef(e,this.format_))}}const ec=Gy;class qi extends Ei{constructor(e,t){super(e),this.layer=t}}const El={LAYERS:"layers"};class bs extends kg{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(El.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new mi(i.slice(),{unique:!0}):Xe(typeof i.getArray=="function",43):i=new mi(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(lt),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(ze(e,Ft.ADD,this.handleLayersAdd_,this),ze(e,Ft.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(lt);ar(this.listenerKeys_);const t=e.getArray();for(let i=0,n=t.length;i<n;i++){const s=t[i];this.registerLayerListeners_(s),this.dispatchEvent(new qi("addlayer",s))}this.changed()}registerLayerListeners_(e){const t=[ze(e,Zs.PROPERTYCHANGE,this.handleLayerChange_,this),ze(e,Te.CHANGE,this.handleLayerChange_,this)];e instanceof bs&&t.push(ze(e,"addlayer",this.handleLayerGroupAdd_,this),ze(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Ie(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new qi("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new qi("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new qi("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=Ie(t);this.listenerKeys_[i].forEach(lt),delete this.listenerKeys_[i],this.dispatchEvent(new qi("removelayer",t)),this.changed()}getLayers(){return this.get(El.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let n=0,s=i.length;n<s;++n)this.dispatchEvent(new qi("removelayer",i[n]))}this.set(El.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const n=this.getLayerState();let s=n.zIndex;!e&&n.zIndex===void 0&&(s=0);for(let o=i,a=t.length;o<a;o++){const l=t[o];l.opacity*=n.opacity,l.visible=l.visible&&n.visible,l.maxResolution=Math.min(l.maxResolution,n.maxResolution),l.minResolution=Math.max(l.minResolution,n.minResolution),l.minZoom=Math.max(l.minZoom,n.minZoom),l.maxZoom=Math.min(l.maxZoom,n.maxZoom),n.extent!==void 0&&(l.extent!==void 0?l.extent=Li(l.extent,n.extent):l.extent=n.extent),l.zIndex===void 0&&(l.zIndex=s)}return t}getSourceState(){return"ready"}}const zy=Object.freeze(Object.defineProperty({__proto__:null,GroupEvent:qi,default:bs},Symbol.toStringTag,{value:"Module"})),tc=34962,ic=34963,By=35040,nc=35044,jy=35048,Hy=5121,Uy=5123,Vy=5125,Wg=5126,wf=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Xg(r,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!fb},e);const t=wf.length;for(let i=0;i<t;++i)try{const n=r.getContext(wf[i],e);if(n)return n}catch{}return null}const Wy={STATIC_DRAW:nc,STREAM_DRAW:By,DYNAMIC_DRAW:jy};class Xy{constructor(e,t){this.array=null,this.type=e,Xe(e===tc||e===ic,62),this.usage=t!==void 0?t:Wy.STATIC_DRAW}ofSize(e){this.array=new(wl(this.type))(e)}fromArray(e){this.array=wl(this.type).from(e)}fromArrayBuffer(e){this.array=new(wl(this.type))(e)}getType(){return this.type}getArray(){return this.array}getUsage(){return this.usage}getSize(){return this.array?this.array.length:0}}function wl(r){switch(r){case tc:return Float32Array;case ic:return Uint32Array;default:return Float32Array}}const Yg=Xy,Ko={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Yy=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Ky=`
  precision mediump float;
   
  uniform sampler2D u_image;
  uniform float u_opacity;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class $y{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer();const i=t.createShader(t.VERTEX_SHADER);t.shaderSource(i,e.vertexShader||Yy),t.compileShader(i);const n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e.fragmentShader||Ky),t.compileShader(n),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,i),t.attachShader(this.renderTargetProgram_,n),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(function(o){this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})}.bind(this))}getGL(){return this.gl_}init(e){const t=this.getGL(),i=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;const n=0,s=t.RGBA,o=0,a=t.RGBA,l=t.UNSIGNED_BYTE,u=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,n,s,i[0],i[1],o,a,l,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0)}}apply(e,t,i,n){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const l=Ie(s.canvas);if(!e.renderTargets[l]){const u=s.getContextAttributes();u&&u.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT)),e.renderTargets[l]=!0}}s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),i&&i(s,e),s.drawArrays(s.TRIANGLES,0,6),n&&n(s,e)}getFrameBuffer(){return this.frameBuffer_}applyUniforms(e){const t=this.getGL();let i,n=1;this.uniforms_.forEach(function(s){if(i=typeof s.value=="function"?s.value(e):s.value,i instanceof HTMLCanvasElement||i instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${n}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,i.width,i.height,0,t.UNSIGNED_BYTE,new Uint8Array(i.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.uniform1i(s.location,n++);else if(Array.isArray(i))switch(i.length){case 2:t.uniform2f(s.location,i[0],i[1]);return;case 3:t.uniform3f(s.location,i[0],i[1],i[2]);return;case 4:t.uniform4f(s.location,i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&t.uniform1f(s.location,i)})}}const Cf=$y;function Kg(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function aa(r,e){return r[0]=e[0],r[1]=e[1],r[4]=e[2],r[5]=e[3],r[12]=e[4],r[13]=e[5],r}const Xn={PROJECTION_MATRIX:"u_projectionMatrix",OFFSET_SCALE_MATRIX:"u_offsetScaleMatrix",OFFSET_ROTATION_MATRIX:"u_offsetRotateMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",SIZE_PX:"u_sizePx",PIXEL_RATIO:"u_pixelRatio"},Fr={UNSIGNED_BYTE:Hy,UNSIGNED_SHORT:Uy,UNSIGNED_INT:Vy,FLOAT:Wg},wa={};function xf(r){return"shared/"+r}let Tf=0;function Zy(){const r="unique/"+Tf;return Tf+=1,r}function qy(r){let e=wa[r];if(!e){const t=document.createElement("canvas");t.style.position="absolute",t.style.left="0",e={users:0,canvas:t},wa[r]=e}return e.users+=1,e.canvas}function Jy(r){const e=wa[r];if(!e||(e.users-=1,e.users>0))return;const t=e.canvas,n=Xg(t).getExtension("WEBGL_lose_context");n&&n.loseContext(),delete wa[r]}class Qy extends Fa{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?xf(e.canvasCacheKey):Zy(),this.canvas_=qy(this.canvasCacheKey_),this.gl_=Xg(this.canvas_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.canvas_.addEventListener(Ko.LOST,this.boundHandleWebGLContextLost_),this.canvas_.addEventListener(Ko.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=ai(),this.offsetScaleMatrix_=ai(),this.tmpMat4_=Kg(),this.uniformLocations_={},this.attribLocations_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms);const t=this.getGL();this.postProcessPasses_=e.postProcesses?e.postProcesses.map(function(i){return new Cf({webGlContext:t,scaleRatio:i.scaleRatio,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,uniforms:i.uniforms})}):[new Cf({webGlContext:t})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[];for(const t in e)this.uniforms_.push({name:t,value:e[t]});this.uniformLocations_={}}canvasCacheKeyMatches(e){return this.canvasCacheKey_===xf(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.getGL(),i=Ie(e);let n=this.bufferCache_[i];if(!n){const s=t.createBuffer();n={buffer:e,webGlBuffer:s},this.bufferCache_[i]=n}t.bindBuffer(e.getType(),n.webGlBuffer)}flushBufferData(e){const t=this.getGL();this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=this.getGL(),i=Ie(e),n=this.bufferCache_[i];n&&!t.isContextLost()&&t.deleteBuffer(n.webGlBuffer),delete this.bufferCache_[i]}disposeInternal(){this.canvas_.removeEventListener(Ko.LOST,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(Ko.RESTORED,this.boundHandleWebGLContextRestored_),Jy(this.canvasCacheKey_),delete this.gl_,delete this.canvas_}prepareDraw(e,t){const i=this.getGL(),n=this.getCanvas(),s=e.size,o=e.pixelRatio;n.width=s[0]*o,n.height=s[1]*o,n.style.width=s[0]+"px",n.style.height=s[1]+"px";for(let a=this.postProcessPasses_.length-1;a>=0;a--)this.postProcessPasses_[a].init(e);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,t?i.ZERO:i.ONE_MINUS_SRC_ALPHA)}prepareDrawToRenderTarget(e,t,i){const n=this.getGL(),s=t.getSize();n.bindFramebuffer(n.FRAMEBUFFER,t.getFramebuffer()),n.viewport(0,0,s[0],s[1]),n.bindTexture(n.TEXTURE_2D,t.getTexture()),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,i?n.ZERO:n.ONE_MINUS_SRC_ALPHA)}drawElements(e,t){const i=this.getGL();this.getExtension("OES_element_index_uint");const n=i.UNSIGNED_INT,s=4,o=t-e,a=e*s;i.drawElements(i.TRIANGLES,o,n,a)}finalizeDraw(e,t,i){for(let n=0,s=this.postProcessPasses_.length;n<s;n++)n===s-1?this.postProcessPasses_[n].apply(e,null,t,i):this.postProcessPasses_[n].apply(e,this.postProcessPasses_[n+1])}getCanvas(){return this.canvas_}getGL(){return this.gl_}applyFrameState(e){const t=e.size,i=e.viewState.rotation,n=e.pixelRatio,s=sa(this.offsetScaleMatrix_);Kl(s,2/t[0],2/t[1]);const o=sa(this.offsetRotateMatrix_);i!==0&&og(o,-i),this.setUniformMatrixValue(Xn.OFFSET_SCALE_MATRIX,aa(this.tmpMat4_,s)),this.setUniformMatrixValue(Xn.OFFSET_ROTATION_MATRIX,aa(this.tmpMat4_,o)),this.setUniformFloatValue(Xn.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Xn.ZOOM,e.viewState.zoom),this.setUniformFloatValue(Xn.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(Xn.PIXEL_RATIO,n),this.setUniformFloatVec2(Xn.SIZE_PX,[t[0],t[1]])}applyUniforms(e){const t=this.getGL();let i,n=0;this.uniforms_.forEach(function(s){if(i=typeof s.value=="function"?s.value(e):s.value,i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData)s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${n}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),(!(i instanceof HTMLImageElement)||i.complete)&&s.prevValue!==i&&(s.prevValue=i,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)),t.uniform1i(this.getUniformLocation(s.name),n++);else if(Array.isArray(i)&&i.length===6)this.setUniformMatrixValue(s.name,aa(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:t.uniform2f(this.getUniformLocation(s.name),i[0],i[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),i[0],i[1],i[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),i[0],i[1],i[2],i[3]);return;default:return}else typeof i=="number"&&t.uniform1f(this.getUniformLocation(s.name),i)}.bind(this))}useProgram(e,t){this.getGL().useProgram(e),this.currentProgram_=e,this.uniformLocations_={},this.attribLocations_={},this.applyFrameState(t),this.applyUniforms(t)}compileShader(e,t){const i=this.getGL(),n=i.createShader(t);return i.shaderSource(n,e),i.compileShader(n),n}getProgram(e,t){const i=this.getGL(),n=this.compileShader(e,i.FRAGMENT_SHADER),s=this.compileShader(t,i.VERTEX_SHADER),o=i.createProgram();if(i.attachShader(o,n),i.attachShader(o,s),i.linkProgram(o),!i.getShaderParameter(n,i.COMPILE_STATUS)){const a=`Fragment shader compliation failed: ${i.getShaderInfoLog(n)}`;throw new Error(a)}if(i.deleteShader(n),!i.getShaderParameter(s,i.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${i.getShaderInfoLog(s)}`;throw new Error(a)}if(i.deleteShader(s),!i.getProgramParameter(o,i.LINK_STATUS)){const a=`GL program linking failed: ${i.getShaderInfoLog(s)}`;throw new Error(a)}return o}getUniformLocation(e){return this.uniformLocations_[e]===void 0&&(this.uniformLocations_[e]=this.getGL().getUniformLocation(this.currentProgram_,e)),this.uniformLocations_[e]}getAttributeLocation(e){return this.attribLocations_[e]===void 0&&(this.attribLocations_[e]=this.getGL().getAttribLocation(this.currentProgram_,e)),this.attribLocations_[e]}makeProjectionTransform(e,t){const i=e.size,n=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return sa(t),vi(t,0,0,2/(s*i[0]),2/(s*i[1]),-n,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.getGL().uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.getGL().uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.getGL().uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.getGL().uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,i,n,s){const o=this.getAttributeLocation(e);o<0||(this.getGL().enableVertexAttribArray(o),this.getGL().vertexAttribPointer(o,t,i,!1,n,s))}enableAttributes(e){const t=ev(e);let i=0;for(let n=0;n<e.length;n++){const s=e[n];this.enableAttributeArray_(s.name,s.size,s.type||Wg,t,i),i+=s.size*$g(s.type)}}handleWebGLContextLost(){ar(this.bufferCache_),this.currentProgram_=null}handleWebGLContextRestored(){}createTexture(e,t,i){const n=this.getGL();i=i||n.createTexture();const s=0,o=n.RGBA,a=0,l=n.RGBA,u=n.UNSIGNED_BYTE;return n.bindTexture(n.TEXTURE_2D,i),t?n.texImage2D(n.TEXTURE_2D,s,o,l,u,t):n.texImage2D(n.TEXTURE_2D,s,o,e[0],e[1],a,l,u,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),i}}function ev(r){let e=0;for(let t=0;t<r.length;t++){const i=r[t];e+=i.size*$g(i.type)}return e}function $g(r){switch(r){case Fr.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Fr.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Fr.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Fr.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class sc extends Hg{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=ai(),this.pixelContext_=null,this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,e.addChangeListener(st.MAP,this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const i=this.getLayer();if(i.hasListener(oi.PRECOMPOSE)){const n=new Nr(oi.PRECOMPOSE,void 0,t,e);i.dispatchEvent(n)}}dispatchPostComposeEvent(e,t){const i=this.getLayer();if(i.hasListener(oi.POSTCOMPOSE)){const n=new Nr(oi.POSTCOMPOSE,void 0,t,e);i.dispatchEvent(n)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,i=-1,n;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const l=e.layerStatesArray[o].layer,u=l.getRenderer();if(!(u instanceof sc)){t=!0;continue}const f=l.getClassName();if((t||f!==n)&&(i+=1,t=!1),n=f,u===this)break}const s="map/"+e.mapId+"/group/"+i;(!this.helper||!this.helper.canvasCacheKeyMatches(s))&&(this.removeHelper(),this.helper=new Qy({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),n&&(this.helper.getCanvas().className=n),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(e,t,i){const n=this.getLayer();if(n.hasListener(e)){vi(this.inversePixelTransform_,0,0,i.pixelRatio,-i.pixelRatio,0,0,-i.size[1]);const s=new Nr(e,this.inversePixelTransform_,i,t);n.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(oi.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(oi.POSTRENDER,e,t)}}const tv=sc;var ah=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function iv(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function rc(r){var e=r.default;if(typeof e=="function"){var t=function(){return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var n=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return r[i]}})}),t}class nv extends ao{constructor(e){e=e||{},super(e)}}const sv=nv;class rv extends qh{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,n=e.viewState,s=n.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=Li(l,yi(t.extent,n.projection))),!a[It.ANIMATING]&&!a[It.INTERACTING]&&!ro(l))if(o){const u=n.projection,f=o.getImage(l,s,i,u);f&&(this.loadImage(f)?this.image_=f:f.getState()===Ne.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=St(t.pixelToCoordinateTransform,e.slice()),s=i.getExtent();if(s&&!as(s,n))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=ot(o),u=Math.floor(a.width*((n[0]-o[0])/l));if(u<0||u>=a.width)return null;const f=jt(o),m=Math.floor(a.height*((o[3]-n[1])/f));return m<0||m>=a.height?null:this.getImageData(a,u,m)}renderFrame(e,t){const i=this.image_,n=i.getExtent(),s=i.getResolution(),o=i.getPixelRatio(),a=e.layerStatesArray[e.layerIndex],l=e.pixelRatio,u=e.viewState,f=u.center,m=u.resolution,_=l*s/(m*o),C=e.extent,R=u.resolution,L=u.rotation,A=Math.round(ot(C)/R*l),S=Math.round(jt(C)/R*l);vi(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/l,1/l,L,-A/2,-S/2),Oa(this.inversePixelTransform,this.pixelTransform);const P=xh(this.pixelTransform);this.useContainer(t,P,this.getBackground(e));const k=this.context,H=k.canvas;H.width!=A||H.height!=S?(H.width=A,H.height=S):this.containerReused||k.clearRect(0,0,A,S);let K=!1,ie=!0;if(a.extent){const de=yi(a.extent,u.projection);ie=Nt(de,e.extent),K=ie&&!Zn(de,e.extent),K&&this.clipUnrotated(k,e,de)}const te=i.getImage(),ee=vi(this.tempTransform,A/2,S/2,_,_,0,o*(n[0]-f[0])/s,o*(f[1]-n[3])/s);this.renderedResolution=s*l/o;const ne=te.width*ee[0],ue=te.height*ee[3];if(this.getLayer().getSource().getInterpolate()||(k.imageSmoothingEnabled=!1),this.preRender(k,e),ie&&ne>=.5&&ue>=.5){const de=ee[4],oe=ee[5],ye=a.opacity;let xe;ye!==1&&(xe=k.globalAlpha,k.globalAlpha=ye),k.drawImage(te,0,0,+te.width,+te.height,de,oe,ne,ue),ye!==1&&(k.globalAlpha=xe)}return this.postRender(k,e),K&&k.restore(),k.imageSmoothingEnabled=!0,P!==H.style.transform&&(H.style.transform=P),this.container}}const ov=rv;class av extends sv{constructor(e){super(e)}createRenderer(){return new ov(this)}getData(e){return super.getData(e)}}const lv=av;class Ca extends Tn{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{let n=this.getLayout();const s=e,o=[],a=[];for(let l=0,u=s.length;l<u;++l){const f=s[l];l===0&&(n=f.getLayout()),en(o,f.getFlatCoordinates()),a.push(o.length)}this.setFlatCoordinates(n,o),this.ends_=a}}appendLineString(e){this.flatCoordinates?en(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Ca(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<ms(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Oh(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Nh(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,n))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,a_(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return Wr(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new Vs(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,n=[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],u=new Vs(e.slice(s,l),i);n.push(u),s=l}return n}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const n=this.ends_,s=this.stride;for(let o=0,a=n.length;o<a;++o){const l=n[o],u=yg(t,i,l,s,.5);en(e,u),i=l}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=s_(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new Ca(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return c_(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Gh(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}const Zg=Ca;class oc extends Tn{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){this.flatCoordinates?en(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()}clone(){const e=new oc(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){if(n<ms(this.getExtent(),e,t))return n;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const u=tn(e,t,s[a],s[a+1]);if(u<n){n=u;for(let f=0;f<o;++f)i[f]=s[a+f];i.length=o}}return n}getCoordinates(){return bn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return e<0||t<=e?null:new ns(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,n=[];for(let s=0,o=e.length;s<o;s+=i){const a=new ns(e.slice(s,s+i),t);n.push(a)}return n}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let n=0,s=t.length;n<s;n+=i){const o=t[n],a=t[n+1];if(Th(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ba(this.flatCoordinates,0,e,this.stride),this.changed()}}const qg=oc;function Jg(r,e,t,i){let n=0,s=r[t-i],o=r[t-i+1];for(;e<t;e+=i){const a=r[e],l=r[e+1];n+=o*a-s*l,s=a,o=l}return n/2}function Qg(r,e,t,i){let n=0;for(let s=0,o=t.length;s<o;++s){const a=t[s];n+=Jg(r,e,a,i),e=a}return n}function hv(r,e,t,i){let n=0;for(let s=0,o=t.length;s<o;++s){const a=t[s];n+=Qg(r,e,a,i),e=a[a.length-1]}return n}class xa extends Tn{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new xa(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,n){return n<ms(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ph(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),kh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,n))}getArea(){return Jg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return bn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=zh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new xa(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ba(this.flatCoordinates,0,e,this.stride),this.changed()}}const Rf=xa;function em(r,e,t,i,n,s,o){let a,l,u,f,m,_,C;const R=n[s+1],L=[];for(let P=0,k=t.length;P<k;++P){const H=t[P];for(f=r[H-i],_=r[H-i+1],a=e;a<H;a+=i)m=r[a],C=r[a+1],(R<=_&&C<=R||_<=R&&R<=C)&&(u=(R-_)/(C-_)*(m-f)+f,L.push(u)),f=m,_=C}let A=NaN,S=-1/0;for(L.sort(wn),f=L[0],a=1,l=L.length;a<l;++a){m=L[a];const P=Math.abs(m-f);P>S&&(u=(f+m)/2,Bh(r,e,t,i,u,R)&&(A=u,S=P)),f=m}return isNaN(A)&&(A=n[s]),o?(o.push(A,R,S),o):[A,R,S]}function cv(r,e,t,i,n){let s=[];for(let o=0,a=t.length;o<a;++o){const l=t[o];s=em(r,e,l,i,n,2*o,s),e=l[l.length-1]}return s}function uv(r,e,t,i){for(;e<t-i;){for(let n=0;n<i;++n){const s=r[e+n];r[e+n]=r[t-i+n],r[t-i+n]=s}e+=i,t-=i}}function tm(r,e,t,i){let n=0,s=r[t-i],o=r[t-i+1];for(;e<t;e+=i){const a=r[e],l=r[e+1];n+=(a-s)*(l+o),s=a,o=l}return n===0?void 0:n>0}function im(r,e,t,i,n){n=n!==void 0?n:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=tm(r,e,a,i);if(s===0){if(n&&l||!n&&!l)return!1}else if(n&&!l||!n&&l)return!1;e=a}return!0}function dv(r,e,t,i,n){for(let s=0,o=t.length;s<o;++s){const a=t[s];if(!im(r,e,a,i,n))return!1;a.length&&(e=a[a.length-1])}return!0}function lh(r,e,t,i,n){n=n!==void 0?n:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=tm(r,e,a,i);(s===0?n&&l||!n&&!l:n&&!l||!n&&l)&&uv(r,e,a,i),e=a}return e}function Sf(r,e,t,i,n){for(let s=0,o=t.length;s<o;++s)e=lh(r,e,t[s],i,n);return e}class Bi extends Tn{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?en(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Bi(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,n){return n<ms(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Oh(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Nh(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,n))}containsXY(e,t){return Bh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return Qg(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),lh(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Wr(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=rn(this.getExtent());this.flatInteriorPoint_=em(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new ns(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new Rf(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,n=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],u=new Rf(t.slice(s,l),e);n.push(u),s=l}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;im(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=lh(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=bg(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new Bi(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return Eg(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Gh(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function Lf(r){const e=r[0],t=r[1],i=r[2],n=r[3],s=[e,t,e,n,i,n,i,t,e,t];return new Bi(s,"XY",[s.length])}function fv(r,e,t){e=e||32;const i=r.getStride(),n=r.getLayout(),s=r.getCenter(),o=i*(e+1),a=new Array(o);for(let f=0;f<o;f+=i){a[f]=0,a[f+1]=0;for(let m=2;m<i;m++)a[f+m]=s[m]}const l=[a.length],u=new Bi(a,n,l);return gv(u,s,r.getRadius(),t),u}function gv(r,e,t,i){const n=r.getFlatCoordinates(),s=r.getStride(),o=n.length/s-1,a=i||0;for(let l=0;l<=o;++l){const u=l*s,f=a+ts(l,o)*2*Math.PI/o;n[u]=e[0]+t*Math.cos(f),n[u+1]=e[1]+t*Math.sin(f)}r.changed()}function mv(r,e,t,i){const n=[];let s=pi();for(let o=0,a=t.length;o<a;++o){const l=t[o];s=lg(r,e,l[0],i),n.push((s[0]+s[2])/2,(s[1]+s[3])/2),e=l[l.length-1]}return n}class Ta extends Tn{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){let n=this.getLayout();const s=e,o=[],a=[];for(let l=0,u=s.length;l<u;++l){const f=s[l];l===0&&(n=f.getLayout());const m=o.length,_=f.getEnds();for(let C=0,R=_.length;C<R;++C)_[C]+=m;en(o,f.getFlatCoordinates()),a.push(_)}t=n,e=o,i=a}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;en(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let n=0,s=t.length;n<s;++n)t[n]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let n=0;n<e;++n)t[n]=this.endss_[n].slice();const i=new Ta(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,n){return n<ms(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(t_(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),i_(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,n))}containsXY(e,t){return h_(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return hv(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Sf(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,th(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=mv(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=cv(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new qg(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;dv(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Sf(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=o_(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new Ta(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const s=this.endss_[e-1];t=s[s.length-1]}const i=this.endss_[e].slice(),n=i[i.length-1];if(t!==0)for(let s=0,o=i.length;s<o;++s)i[s]-=t;return new Bi(this.flatCoordinates.slice(t,n),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,n=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),u=l[l.length-1];if(s!==0)for(let m=0,_=l.length;m<_;++m)l[m]-=s;const f=new Bi(t.slice(s,u),e,l);n.push(f),s=u}return n}getType(){return"MultiPolygon"}intersectsExtent(e){return u_(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=n_(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const n=i[i.length-1];this.flatCoordinates.length=n.length===0?0:n[n.length-1]}this.changed()}}const nm=Ta;class Va extends Tn{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new Va(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){const s=this.flatCoordinates,o=e-s[0],a=t-s[1],l=o*o+a*a;if(l<n){if(l===0)for(let u=0;u<this.stride;++u)i[u]=s[u];else{const u=this.getRadius()/Math.sqrt(l);i[0]=s[0]+u*o,i[1]=s[1]+u*a;for(let f=2;f<this.stride;++f)i[f]=s[f]}return i.length=this.stride,l}else return n}containsXY(e,t){const i=this.flatCoordinates,n=e-i[0],s=t-i[1];return n*n+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return zi(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(Nt(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:Rh(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],n=e.slice();n[t]=n[0]+i;for(let s=1;s<t;++s)n[t+s]=e[s];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let s=pg(n,0,e,this.stride);n[s++]=n[0]+t;for(let o=1,a=this.stride;o<a;++o)n[s++]=n[o];n.length=s,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),n=this.getStride();this.setCenter(Fh(i,0,i.length,n,e,t,i)),this.changed()}translate(e,t){const i=this.getCenter(),n=this.getStride();this.setCenter(gg(i,0,i.length,n,e,t,i)),this.changed()}}Va.prototype.transform;const pv=Va;class Ra extends mg{constructor(e){super(),this.geometries_=e||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(lt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(!!this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)this.changeEventsKeys_.push(ze(this.geometries_[e],Te.CHANGE,this.changed,this))}clone(){const e=new Ra(null);return e.setGeometries(this.geometries_),e.applyProperties(this),e}closestPointXY(e,t,i,n){if(n<ms(this.getExtent(),e,t))return n;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)n=s[o].closestPointXY(e,t,i,n);return n}containsXY(e,t){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)if(i[n].containsXY(e,t))return!0;return!1}computeExtent(e){so(e);const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)hg(e,t[i].getExtent());return e}getGeometries(){return Df(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let n=!1;for(let s=0,o=i.length;s<o;++s){const a=i[s],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(n=!0)}if(n){const s=new Ra(null);return s.setGeometriesArray(t),s}else return this.simplifiedGeometryMaxMinSquaredTolerance=e,this}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].rotate(e,t);this.changed()}scale(e,t,i){i||(i=rn(this.getExtent()));const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)n[s].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(Df(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,n=t.length;i<n;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Df(r){const e=[];for(let t=0,i=r.length;t<i;++t)e.push(r[t].clone());return e}const bv=Ra,ge={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function sm(r){return Math.pow(r,3)}function cr(r){return 1-sm(1-r)}function _v(r){return 3*r*r-2*r*r*r}function yv(r){return r}class vv extends lr{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(Te.CHANGE)}release(){this.state===ge.ERROR&&this.setState(ge.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let e=this.interimTile;do{if(e.getState()==ge.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){if(!this.interimTile)return;let e=this.interimTile,t=this;do{if(e.getState()==ge.LOADED){e.interimTile=null;break}else e.getState()==ge.LOADING?t=e:e.getState()==ge.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==ge.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){Ze()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const n=t-i+1e3/60;return n>=this.transition_?1:sm(n/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}const ac=vv;class Ev extends ac{constructor(e,t,i,n,s,o){super(e,t,o),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=ge.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=ge.ERROR,this.unlistenImage_(),this.image_=wv(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=ge.LOADED:this.state=ge.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==ge.ERROR&&(this.state=ge.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==ge.IDLE&&(this.state=ge.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=$h(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function wv(){const r=hi(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}const Sa=Ev,rm=.5,Cv=10,Af=.25;class xv{constructor(e,t,i,n,s,o){this.sourceProj_=e,this.targetProj_=t;let a={};const l=fa(this.targetProj_,this.sourceProj_);this.transformInv_=function(P){const k=P[0]+"/"+P[1];return a[k]||(a[k]=l(P)),a[k]},this.maxSourceExtent_=n,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&ot(n)==ot(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?ot(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?ot(this.targetProj_.getExtent()):null;const u=ps(i),f=Ga(i),m=Na(i),_=ka(i),C=this.transformInv_(u),R=this.transformInv_(f),L=this.transformInv_(m),A=this.transformInv_(_),S=Cv+(o?Math.max(0,Math.ceil(Math.log2(Zl(i)/(o*o*256*256)))):0);if(this.addQuad_(u,f,m,_,C,R,L,A,S),this.wrapsXInSource_){let P=1/0;this.triangles_.forEach(function(k,H,K){P=Math.min(P,k.source[0][0],k.source[1][0],k.source[2][0])}),this.triangles_.forEach(function(k){if(Math.max(k.source[0][0],k.source[1][0],k.source[2][0])-P>this.sourceWorldWidth_/2){const H=[[k.source[0][0],k.source[0][1]],[k.source[1][0],k.source[1][1]],[k.source[2][0],k.source[2][1]]];H[0][0]-P>this.sourceWorldWidth_/2&&(H[0][0]-=this.sourceWorldWidth_),H[1][0]-P>this.sourceWorldWidth_/2&&(H[1][0]-=this.sourceWorldWidth_),H[2][0]-P>this.sourceWorldWidth_/2&&(H[2][0]-=this.sourceWorldWidth_);const K=Math.min(H[0][0],H[1][0],H[2][0]);Math.max(H[0][0],H[1][0],H[2][0])-K<this.sourceWorldWidth_/2&&(k.source=H)}}.bind(this))}a={}}addTriangle_(e,t,i,n,s,o){this.triangles_.push({source:[n,s,o],target:[e,t,i]})}addQuad_(e,t,i,n,s,o,a,l,u){const f=Bt([s,o,a,l]),m=this.sourceWorldWidth_?ot(f)/this.sourceWorldWidth_:null,_=this.sourceWorldWidth_,C=this.sourceProj_.canWrapX()&&m>.5&&m<1;let R=!1;if(u>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const A=Bt([e,t,i,n]);R=ot(A)/this.targetWorldWidth_>Af||R}!C&&this.sourceProj_.isGlobal()&&m&&(R=m>Af||R)}if(!R&&this.maxSourceExtent_&&isFinite(f[0])&&isFinite(f[1])&&isFinite(f[2])&&isFinite(f[3])&&!Nt(f,this.maxSourceExtent_))return;let L=0;if(!R&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(u>0)R=!0;else if(L=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),L!=1&&L!=2&&L!=4&&L!=8)return}if(u>0){if(!R){const A=[(e[0]+i[0])/2,(e[1]+i[1])/2],S=this.transformInv_(A);let P;C?P=(ts(s[0],_)+ts(a[0],_))/2-ts(S[0],_):P=(s[0]+a[0])/2-S[0];const k=(s[1]+a[1])/2-S[1];R=P*P+k*k>this.errorThresholdSquared_}if(R){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const A=[(t[0]+i[0])/2,(t[1]+i[1])/2],S=this.transformInv_(A),P=[(n[0]+e[0])/2,(n[1]+e[1])/2],k=this.transformInv_(P);this.addQuad_(e,t,A,P,s,o,S,k,u-1),this.addQuad_(P,A,i,n,k,S,a,l,u-1)}else{const A=[(e[0]+t[0])/2,(e[1]+t[1])/2],S=this.transformInv_(A),P=[(i[0]+n[0])/2,(i[1]+n[1])/2],k=this.transformInv_(P);this.addQuad_(e,A,P,n,s,S,k,l,u-1),this.addQuad_(A,t,i,P,S,o,a,k,u-1)}return}}if(C){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(L&11)==0&&this.addTriangle_(e,i,n,s,a,l),(L&14)==0&&this.addTriangle_(e,i,t,s,a,o),L&&((L&13)==0&&this.addTriangle_(t,n,e,o,l,s),(L&7)==0&&this.addTriangle_(t,n,i,o,l,a))}calculateSourceExtent(){const e=pi();return this.triangles_.forEach(function(t,i,n){const s=t.source;Or(e,s[0]),Or(e,s[1]),Or(e,s[2])}),e}getTriangles(){return this.triangles_}}const om=xv;let Cl;const am=[];function Mf(r,e,t,i,n){r.beginPath(),r.moveTo(0,0),r.lineTo(e,t),r.lineTo(i,n),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(e,i)+1,Math.max(t,n)),r.restore()}function xl(r,e){return Math.abs(r[e*4]-210)>2||Math.abs(r[e*4+3]-.75*255)>2}function Tv(){if(Cl===void 0){const r=document.createElement("canvas").getContext("2d");r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",Mf(r,4,5,4,0),Mf(r,4,5,0,5);const e=r.getImageData(0,0,3,3).data;Cl=xl(e,0)||xl(e,4)||xl(e,8)}return Cl}function hh(r,e,t,i){const n=$b(t,e,r);let s=Zd(e,i,t);const o=e.getMetersPerUnit();o!==void 0&&(s*=o);const a=r.getMetersPerUnit();a!==void 0&&(s/=a);const l=r.getExtent();if(!l||as(l,n)){const u=Zd(r,s,n)/s;isFinite(u)&&u>0&&(s/=u)}return s}function Rv(r,e,t,i){const n=rn(t);let s=hh(r,e,n,i);return(!isFinite(s)||s<=0)&&Rh(t,function(o){return s=hh(r,e,o,i),isFinite(s)&&s>0}),s}function lm(r,e,t,i,n,s,o,a,l,u,f,m){const _=hi(Math.round(t*r),Math.round(t*e),am);if(m||(_.imageSmoothingEnabled=!1),l.length===0)return _.canvas;_.scale(t,t);function C(H){return Math.round(H*t)/t}_.globalCompositeOperation="lighter";const R=pi();l.forEach(function(H,K,ie){hg(R,H.extent)});const L=ot(R),A=jt(R),S=hi(Math.round(t*L/i),Math.round(t*A/i));m||(S.imageSmoothingEnabled=!1);const P=t/i;l.forEach(function(H,K,ie){const te=H.extent[0]-R[0],ee=-(H.extent[3]-R[3]),ne=ot(H.extent),ue=jt(H.extent);H.image.width>0&&H.image.height>0&&S.drawImage(H.image,u,u,H.image.width-2*u,H.image.height-2*u,te*P,ee*P,ne*P,ue*P)});const k=ps(o);return a.getTriangles().forEach(function(H,K,ie){const te=H.source,ee=H.target;let ne=te[0][0],ue=te[0][1],de=te[1][0],oe=te[1][1],ye=te[2][0],xe=te[2][1];const pe=C((ee[0][0]-k[0])/s),we=C(-(ee[0][1]-k[1])/s),fe=C((ee[1][0]-k[0])/s),Se=C(-(ee[1][1]-k[1])/s),it=C((ee[2][0]-k[0])/s),Ue=C(-(ee[2][1]-k[1])/s),at=ne,ae=ue;ne=0,ue=0,de-=at,oe-=ae,ye-=at,xe-=ae;const pt=[[de,oe,0,0,fe-pe],[ye,xe,0,0,it-pe],[0,0,de,oe,Se-we],[0,0,ye,xe,Ue-we]],De=Gb(pt);if(!!De){if(_.save(),_.beginPath(),Tv()||!m){_.moveTo(fe,Se);const Fe=4,ht=pe-fe,Lt=we-Se;for(let ut=0;ut<Fe;ut++)_.lineTo(fe+C((ut+1)*ht/Fe),Se+C(ut*Lt/(Fe-1))),ut!=Fe-1&&_.lineTo(fe+C((ut+1)*ht/Fe),Se+C((ut+1)*Lt/(Fe-1)));_.lineTo(it,Ue)}else _.moveTo(fe,Se),_.lineTo(pe,we),_.lineTo(it,Ue);_.clip(),_.transform(De[0],De[2],De[1],De[3],pe,we),_.translate(R[0]-at,R[3]-ae),_.scale(i/t,-i/t),_.drawImage(S.canvas,0,0),_.restore()}}),f&&(_.save(),_.globalCompositeOperation="source-over",_.strokeStyle="black",_.lineWidth=1,a.getTriangles().forEach(function(H,K,ie){const te=H.target,ee=(te[0][0]-k[0])/s,ne=-(te[0][1]-k[1])/s,ue=(te[1][0]-k[0])/s,de=-(te[1][1]-k[1])/s,oe=(te[2][0]-k[0])/s,ye=-(te[2][1]-k[1])/s;_.beginPath(),_.moveTo(ue,de),_.lineTo(ee,ne),_.lineTo(oe,ye),_.closePath(),_.stroke()}),_.restore()),_.canvas}class Sv extends ac{constructor(e,t,i,n,s,o,a,l,u,f,m,_){super(s,ge.IDLE,{interpolate:!!_}),this.renderEdges_=m!==void 0?m:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const C=n.getTileCoordExtent(this.wrappedTileCoord_),R=this.targetTileGrid_.getExtent();let L=this.sourceTileGrid_.getExtent();const A=R?Li(C,R):C;if(Zl(A)===0){this.state=ge.EMPTY;return}const S=e.getExtent();S&&(L?L=Li(L,S):L=S);const P=n.getResolution(this.wrappedTileCoord_[0]),k=Rv(e,i,A,P);if(!isFinite(k)||k<=0){this.state=ge.EMPTY;return}const H=f!==void 0?f:rm;if(this.triangulation_=new om(e,i,A,L,k*H,P),this.triangulation_.getTriangles().length===0){this.state=ge.EMPTY;return}this.sourceZ_=t.getZForResolution(k);let K=this.triangulation_.calculateSourceExtent();if(L&&(e.canWrapX()?(K[1]=wt(K[1],L[1],L[3]),K[3]=wt(K[3],L[1],L[3])):K=Li(K,L)),!Zl(K))this.state=ge.EMPTY;else{const ie=t.getTileRangeForExtentAndZ(K,this.sourceZ_);for(let te=ie.minX;te<=ie.maxX;te++)for(let ee=ie.minY;ee<=ie.maxY;ee++){const ne=u(this.sourceZ_,te,ee,a);ne&&this.sourceTiles_.push(ne)}this.sourceTiles_.length===0&&(this.state=ge.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(function(t,i,n){t&&t.getState()==ge.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}.bind(this)),this.sourceTiles_.length=0,e.length===0)this.state=ge.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=lm(n,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=ge.LOADED}this.changed()}load(){if(this.state==ge.IDLE){this.state=ge.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(t,i,n){const s=t.getState();if(s==ge.IDLE||s==ge.LOADING){e++;const o=ze(t,Te.CHANGE,function(a){const l=t.getState();(l==ge.LOADED||l==ge.ERROR||l==ge.EMPTY)&&(lt(o),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}.bind(this)),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,n){t.getState()==ge.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(lt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Ag(this.canvas_.getContext("2d")),am.push(this.canvas_),this.canvas_=null),super.release()}}const er=Sv;class hm{constructor(e,t,i,n){this.minX=e,this.maxX=t,this.minY=i,this.maxY=n}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function Ds(r,e,t,i,n){return n!==void 0?(n.minX=r,n.maxX=e,n.minY=t,n.maxY=i,n):new hm(r,e,t,i)}const lc=hm;class Lv extends qh{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=pi(),this.tmpTileRange_=new lc(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),n=t.getUseInterimTilesOnError();return i==ge.LOADED||i==ge.EMPTY||i==ge.ERROR&&!n}getTile(e,t,i,n){const s=n.pixelRatio,o=n.viewState.projection,a=this.getLayer();let u=a.getSource().getTile(e,t,i,s,o);return u.getState()==ge.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(u)||(u=u.getInterimTile()),u}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=St(t.pixelToCoordinateTransform,e.slice()),s=i.getExtent();if(s&&!as(s,n))return null;const o=t.pixelRatio,a=t.viewState.projection,l=t.viewState,u=i.getRenderSource(),f=u.getTileGridForProjection(l.projection),m=u.getTilePixelRatio(t.pixelRatio);for(let _=f.getZForResolution(l.resolution);_>=f.getMinZoom();--_){const C=f.getTileCoordForCoordAndZ(n,_),R=u.getTile(_,C[1],C[2],o,a);if(!(R instanceof Sa||R instanceof er)||R instanceof er&&R.getState()===ge.EMPTY)return null;if(R.getState()!==ge.LOADED)continue;const L=f.getOrigin(_),A=Pt(f.getTileSize(_)),S=f.getResolution(_),P=Math.floor(m*((n[0]-L[0])/S-C[1]*A[0])),k=Math.floor(m*((L[1]-n[1])/S-C[2]*A[1])),H=Math.round(m*u.getGutterForProjection(l.projection));return this.getImageData(R.getImage(),P+H,k+H)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],n=e.viewState,s=n.projection,o=n.resolution,a=n.center,l=n.rotation,u=e.pixelRatio,f=this.getLayer(),m=f.getSource(),_=m.getRevision(),C=m.getTileGridForProjection(s),R=C.getZForResolution(o,m.zDirection),L=C.getResolution(R);let A=e.extent;const S=e.viewState.resolution,P=m.getTilePixelRatio(u),k=Math.round(ot(A)/S*u),H=Math.round(jt(A)/S*u),K=i.extent&&yi(i.extent);K&&(A=Li(A,yi(i.extent)));const ie=L*k/2/P,te=L*H/2/P,ee=[a[0]-ie,a[1]-te,a[0]+ie,a[1]+te],ne=C.getTileRangeForExtentAndZ(A,R),ue={};ue[R]={};const de=this.createLoadedTileFinder(m,s,ue),oe=this.tmpExtent,ye=this.tmpTileRange_;this.newTiles_=!1;const xe=l?Jl(n.center,S,l,e.size):void 0;for(let pt=ne.minX;pt<=ne.maxX;++pt)for(let De=ne.minY;De<=ne.maxY;++De){if(l&&!C.tileCoordIntersectsViewport([R,pt,De],xe))continue;const Fe=this.getTile(R,pt,De,e);if(this.isDrawableTile(Fe)){const ut=Ie(this);if(Fe.getState()==ge.LOADED){ue[R][Fe.tileCoord.toString()]=Fe;let ct=Fe.inTransition(ut);ct&&i.opacity!==1&&(Fe.endTransition(ut),ct=!1),!this.newTiles_&&(ct||!this.renderedTiles.includes(Fe))&&(this.newTiles_=!0)}if(Fe.getAlpha(ut,e.time)===1)continue}const ht=C.getTileCoordChildTileRange(Fe.tileCoord,ye,oe);let Lt=!1;ht&&(Lt=de(R+1,ht)),Lt||C.forEachTileCoordParentTileRange(Fe.tileCoord,de,ye,oe)}const pe=L/o*u/P;vi(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/u,1/u,l,-k/2,-H/2);const we=xh(this.pixelTransform);this.useContainer(t,we,this.getBackground(e));const fe=this.context,Se=fe.canvas;Oa(this.inversePixelTransform,this.pixelTransform),vi(this.tempTransform,k/2,H/2,pe,pe,0,-k/2,-H/2),Se.width!=k||Se.height!=H?(Se.width=k,Se.height=H):this.containerReused||fe.clearRect(0,0,k,H),K&&this.clipUnrotated(fe,e,K),m.getInterpolate()||(fe.imageSmoothingEnabled=!1),this.preRender(fe,e),this.renderedTiles.length=0;let it=Object.keys(ue).map(Number);it.sort(wn);let Ue,at,ae;i.opacity===1&&(!this.containerReused||m.getOpaque(e.viewState.projection))?it=it.reverse():(Ue=[],at=[]);for(let pt=it.length-1;pt>=0;--pt){const De=it[pt],Fe=m.getTilePixelSize(De,u,s),Lt=C.getResolution(De)/L,ut=Fe[0]*Lt*pe,ct=Fe[1]*Lt*pe,Z=C.getTileCoordForCoordAndZ(ps(ee),De),Ht=C.getTileCoordExtent(Z),Qe=St(this.tempTransform,[P*(Ht[0]-ee[0])/L,P*(ee[3]-Ht[3])/L]),Ut=P*m.getGutterForProjection(s),ui=ue[De];for(const Di in ui){const wi=ui[Di],et=wi.tileCoord,on=Z[1]-et[1],an=Math.round(Qe[0]-(on-1)*ut),Jt=Z[2]-et[2],An=Math.round(Qe[1]-(Jt-1)*ct),Ot=Math.round(Qe[0]-on*ut),Vt=Math.round(Qe[1]-Jt*ct),Qt=an-Ot,J=An-Vt,Re=R===De,ei=Re&&wi.getAlpha(Ie(this),e.time)!==1;let Ai=!1;if(!ei)if(Ue){ae=[Ot,Vt,Ot+Qt,Vt,Ot+Qt,Vt+J,Ot,Vt+J];for(let ln=0,Je=Ue.length;ln<Je;++ln)if(R!==De&&De<at[ln]){const yt=Ue[ln];Nt([Ot,Vt,Ot+Qt,Vt+J],[yt[0],yt[3],yt[4],yt[7]])&&(Ai||(fe.save(),Ai=!0),fe.beginPath(),fe.moveTo(ae[0],ae[1]),fe.lineTo(ae[2],ae[3]),fe.lineTo(ae[4],ae[5]),fe.lineTo(ae[6],ae[7]),fe.moveTo(yt[6],yt[7]),fe.lineTo(yt[4],yt[5]),fe.lineTo(yt[2],yt[3]),fe.lineTo(yt[0],yt[1]),fe.clip())}Ue.push(ae),at.push(De)}else fe.clearRect(Ot,Vt,Qt,J);this.drawTileImage(wi,e,Ot,Vt,Qt,J,Ut,Re),Ue&&!ei?(Ai&&fe.restore(),this.renderedTiles.unshift(wi)):this.renderedTiles.push(wi),this.updateUsedTiles(e.usedTiles,m,wi)}}return this.renderedRevision=_,this.renderedResolution=L,this.extentChanged=!this.renderedExtent_||!Js(this.renderedExtent_,ee),this.renderedExtent_=ee,this.renderedPixelRatio=u,this.renderedProjection=s,this.manageTilePyramid(e,m,C,u,s,A,R,f.getPreload()),this.scheduleExpireCache(e,m),this.postRender(fe,e),i.extent&&fe.restore(),fe.imageSmoothingEnabled=!0,we!==Se.style.transform&&(Se.style.transform=we),this.container}drawTileImage(e,t,i,n,s,o,a,l){const u=this.getTileImage(e);if(!u)return;const f=Ie(this),m=t.layerStatesArray[t.layerIndex],_=m.opacity*(l?e.getAlpha(f,t.time):1),C=_!==this.context.globalAlpha;C&&(this.context.save(),this.context.globalAlpha=_),this.context.drawImage(u,a,a,u.width-2*a,u.height-2*a,i,n,s,o),C&&this.context.restore(),_!==m.opacity?t.animate=!0:l&&e.endTransition(f)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=function(n,s,o){const a=Ie(n);a in o.usedTiles&&n.expireCache(o.viewState.projection,o.usedTiles[a])}.bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const n=Ie(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}manageTilePyramid(e,t,i,n,s,o,a,l,u){const f=Ie(t);f in e.wantedTiles||(e.wantedTiles[f]={});const m=e.wantedTiles[f],_=e.tileQueue,C=i.getMinZoom(),R=e.viewState.rotation,L=R?Jl(e.viewState.center,e.viewState.resolution,R,e.size):void 0;let A=0,S,P,k,H,K,ie;for(ie=C;ie<=a;++ie)for(P=i.getTileRangeForExtentAndZ(o,ie,P),k=i.getResolution(ie),H=P.minX;H<=P.maxX;++H)for(K=P.minY;K<=P.maxY;++K)R&&!i.tileCoordIntersectsViewport([ie,H,K],L)||(a-ie<=l?(++A,S=t.getTile(ie,H,K,n,s),S.getState()==ge.IDLE&&(m[S.getKey()]=!0,_.isKeyQueued(S.getKey())||_.enqueue([S,f,i.getTileCoordCenter(S.tileCoord),k])),u!==void 0&&u(S)):t.useTile(ie,H,K,s));t.updateCacheSize(A,s)}}const Dv=Lv,$o={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Av{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return Xe(i!==void 0,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return Xe(t!==void 0,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){if(!!this.containsKey(e))return this.entries_[e].value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){Xe(!(e in this.entries_),16);const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}const cm=Av;function La(r,e,t,i){return i!==void 0?(i[0]=r,i[1]=e,i[2]=t,i):[r,e,t]}function co(r,e,t){return r+"/"+e+"/"+t}function to(r){return co(r[0],r[1],r[2])}function Mv(r){return r.split("/").map(Number)}function Iv(r){return(r[1]<<r[0])+r[2]}function Fv(r,e){const t=r[0],i=r[1],n=r[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(i,n):!0}class Pv extends cm{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=Mv(e)[0];this.forEach(function(n){n.tileCoord[0]!==i&&(this.remove(to(n.tileCoord)),n.release())}.bind(this))}}const um=Pv,Ov=42,hc=256,kv=[0,0,0],gn=5;class Nv{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,Xe(ib(this.resolutions_,function(n,s){return s-n},!0),17);let t;if(!e.origins){for(let n=0,s=this.resolutions_.length-1;n<s;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,Xe(this.origins_.length==this.resolutions_.length,20));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=ps(i)),Xe(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,Xe(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:hc,Xe(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map(function(n,s){const o=new lc(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const n=this.getTileRangeForExtentAndZ(e,t);for(let s=n.minX,o=n.maxX;s<=o;++s)for(let a=n.minY,l=n.maxY;a<=l;++a)i([t,s,a])}forEachTileCoordParentTileRange(e,t,i,n){let s,o,a,l=null,u=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,n);u>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),a=Math.floor(a/2),s=Ds(o,o,a,a,i)):s=this.getTileRangeForExtentAndZ(l,u,i),t(u,s))return!0;--u}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,o=e[2]*2;return Ds(s,s+1,o,o+1,t)}const n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],s=e[1],o=e[2];if(t===n)return Ds(s,o,s,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-n),u=Math.floor(s*l),f=Math.floor(o*l);if(t<n)return Ds(u,u,f,f,i);const m=Math.floor(l*(s+1))-1,_=Math.floor(l*(o+1))-1;return Ds(u,m,f,_,i)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,i)}getTileRangeExtent(e,t,i){const n=this.getOrigin(e),s=this.getResolution(e),o=Pt(this.getTileSize(e),this.tmpSize_),a=n[0]+t.minX*o[0]*s,l=n[0]+(t.maxX+1)*o[0]*s,u=n[1]+t.minY*o[1]*s,f=n[1]+(t.maxY+1)*o[1]*s;return zi(a,u,l,f,i)}getTileRangeForExtentAndZ(e,t,i){const n=kv;this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,n);const s=n[1],o=n[2];return this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,n),Ds(s,n[1],o,n[2],i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=Pt(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),s=Pt(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*s[0]*n,a=i[1]-(e[2]+1)*s[1]*n,l=o+s[0]*n,u=a+s[1]*n;return zi(o,a,l,u,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,s){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),u=Pt(this.getTileSize(o),this.tmpSize_);let f=a*(e-l[0])/i/u[0],m=a*(l[1]-t)/i/u[1];return n?(f=Uo(f,gn)-1,m=Uo(m,gn)-1):(f=Ho(f,gn),m=Ho(m,gn)),La(o,f,m,s)}getTileCoordForXYAndZ_(e,t,i,n,s){const o=this.getOrigin(i),a=this.getResolution(i),l=Pt(this.getTileSize(i),this.tmpSize_);let u=(e-o[0])/a/l[0],f=(o[1]-t)/a/l[1];return n?(u=Uo(u,gn)-1,f=Uo(f,gn)-1):(u=Ho(u,gn),f=Ho(f,gn)),La(i,u,f,s)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=Pa(this.resolutions_,e,t||0);return wt(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return vg(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}}const cc=Nv,Xs={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function dm(r){let e=r.getDefaultTileGrid();return e||(e=Bv(r),r.setDefaultTileGrid(e)),e}function Gv(r,e,t){const i=e[0],n=r.getTileCoordCenter(e),s=Wa(t);if(as(s,n))return e;{const o=ot(s),a=Math.ceil((s[0]-n[0])/o);return n[0]+=o*a,r.getTileCoordForCoordAndZ(n,i)}}function zv(r,e,t,i){i=i!==void 0?i:"top-left";const n=gm(r,e,t);return new cc({extent:r,origin:wb(r,i),resolutions:n,tileSize:t})}function fm(r){const e=r||{},t=e.extent||li("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:gm(t,e.maxZoom,e.tileSize,e.maxResolution)};return new cc(i)}function gm(r,e,t,i){e=e!==void 0?e:Ov,t=Pt(t!==void 0?t:hc);const n=jt(r),s=ot(r);i=i>0?i:Math.max(s/t[0],n/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function Bv(r,e,t,i){const n=Wa(r);return zv(n,e,t,i)}function Wa(r){r=li(r);let e=r.getExtent();if(!e){const t=180*Vr.degrees/r.getMetersPerUnit();e=zi(-t,-t,t,t)}return e}class jv extends Qh{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&Pt(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new um(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,n){const s=this.getTileCacheForProjection(e);if(!s)return!1;let o=!0,a,l,u;for(let f=i.minX;f<=i.maxX;++f)for(let m=i.minY;m<=i.maxY;++m)l=co(t,f,m),u=!1,s.containsKey(l)&&(a=s.get(l),u=a.getState()===ge.LOADED,u&&(u=n(a)!==!1)),u||(o=!1);return o}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(){return this.tileGrid?this.tileGrid.getResolutions():null}getTile(e,t,i,n,s){return Ze()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:dm(e)}getTileCacheForProjection(e){const t=this.getProjection();return Xe(t===null||pn(t,e),68),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),s=this.getTilePixelRatio(t),o=Pt(n.getTileSize(e),this.tmpSize);return s==1?o:d_(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=Gv(i,e,t)),Fv(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,n){}}class mm extends Ei{constructor(e,t){super(e),this.tile=t}}const pm=jv;function Hv(r,e){const t=/\{z\}/g,i=/\{x\}/g,n=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return r.replace(t,o[0].toString()).replace(i,o[1].toString()).replace(n,o[2].toString()).replace(s,function(){const u=o[0],f=e.getFullTileRange(u);return Xe(f,55),(f.getHeight()-o[2]-1).toString()})}}function Uv(r,e){const t=r.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=Hv(r[n],e);return Vv(i)}function Vv(r){return r.length===1?r[0]:function(e,t,i){if(e){const n=Iv(e),s=ts(n,r.length);return r[s](e,t,i)}else return}}function Wv(r){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(r);if(t){const i=t[1].charCodeAt(0),n=t[2].charCodeAt(0);let s;for(s=i;s<=n;++s)e.push(r.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(r),t){const i=parseInt(t[2],10);for(let n=parseInt(t[1],10);n<=i;n++)e.push(r.replace(t[0],n.toString()));return e}return e.push(r),e}class uc extends pm{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===uc.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=Ie(t),n=t.getState();let s;n==ge.LOADING?(this.tileLoadingKeys_[i]=!0,s=Xs.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==ge.ERROR?Xs.TILELOADERROR:n==ge.LOADED?Xs.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new mm(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=Wv(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Uv(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const n=co(e,t,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}const Xv=uc;class Yv extends Fa{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){Ze()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;vi(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Oa(n,i)}forEachFeatureAtCoordinate(e,t,i,n,s,o,a,l){let u;const f=t.viewState;function m(H,K,ie,te){return s.call(o,K,H?ie:null,te)}const _=f.projection,C=dg(e.slice(),_),R=[[0,0]];if(_.canWrapX()&&n){const H=_.getExtent(),K=ot(H);R.push([-K,0],[K,0])}const L=t.layerStatesArray,A=L.length,S=[],P=[];for(let H=0;H<R.length;H++)for(let K=A-1;K>=0;--K){const ie=L[K],te=ie.layer;if(te.hasRenderer()&&Kh(ie,f)&&a.call(l,te)){const ee=te.getRenderer(),ne=te.getSource();if(ee&&ne){const ue=ne.getWrapX()?C:e,de=m.bind(null,ie.managed);P[0]=ue[0]+R[H][0],P[1]=ue[1]+R[H][1],u=ee.forEachFeatureAtCoordinate(P,t,i,de,S)}if(u)return u}}if(S.length===0)return;const k=1/S.length;return S.forEach((H,K)=>H.distanceSq+=K*k),S.sort((H,K)=>H.distanceSq-K.distanceSq),S.some(H=>u=H.callback(H.feature,H.layer,H.geometry)),u}hasFeatureAtCoordinate(e,t,i,n,s,o){return this.forEachFeatureAtCoordinate(e,t,i,n,rs,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(e){Ze()}scheduleExpireIconCache(e){va.canExpireCache()&&e.postRenderFunctions.push(Kv)}}function Kv(r,e){va.expire()}const $v=Yv;class Zv extends $v{constructor(e){super(e),this.fontChangeListenerKey_=ze(Yi,Zs.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=Ha+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const n=new Nr(e,void 0,t);i.dispatchEvent(n)}}disposeInternal(){lt(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(oi.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),i=e.viewState;this.children_.length=0;const n=[];let s=null;for(let o=0,a=t.length;o<a;++o){const l=t[o];e.layerIndex=o;const u=l.layer,f=u.getSourceState();if(!Kh(l,i)||f!="ready"&&f!="undefined"){u.unrender();continue}const m=u.render(e,s);!m||(m!==s&&(this.children_.push(m),s=m),"getDeclutter"in u&&n.push(u))}for(let o=n.length-1;o>=0;--o)n[o].renderDeclutter(e);p_(this.element_,this.children_),this.dispatchRenderEvent(oi.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}}const qv=Zv;class Jv extends Ei{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}const ks=Jv;class Qv extends ks{constructor(e,t,i,n,s,o){super(e,t,s),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=n!==void 0?n:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Ki=Qv,qe={SINGLECLICK:"singleclick",CLICK:Te.CLICK,DBLCLICK:Te.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},ch={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class e0 extends lr{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=ze(i,ch.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=ze(i,ch.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Te.TOUCHMOVE,this.boundHandleTouchMove_,rg?{passive:!1}:!1)}emulateClick_(e){let t=new Ki(qe.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new Ki(qe.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;const i=new Ki(qe.SINGLECLICK,this.map_,e);this.dispatchEvent(i)}.bind(this),250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==qe.POINTERUP||t.type==qe.POINTERCANCEL){delete this.trackedTouches_[i];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==t.target){delete this.trackedTouches_[n];break}}else(t.type==qe.POINTERDOWN||t.type==qe.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new Ki(qe.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(lt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new Ki(qe.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.down_={};for(const i in e){const n=e[i];this.down_[i]=typeof n=="function"?os:n}if(this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(ze(i,qe.POINTERMOVE,this.handlePointerMove_,this),ze(i,qe.POINTERUP,this.handlePointerUp_,this),ze(this.element_,qe.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(ze(this.element_.getRootNode(),qe.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new Ki(qe.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new Ki(qe.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(lt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Te.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(lt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(lt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const t0=e0,mn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},zt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Da=1/0;class i0{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,ar(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(e){Xe(!(this.keyFunction_(e)in this.queuedElements_),31);const t=this.priorityFunction_(e);return t!=Da?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,n=t.length,s=t[e],o=i[e],a=e;for(;e<n>>1;){const l=this.getLeftChildIndex_(e),u=this.getRightChildIndex_(e),f=u<n&&i[u]<i[l]?u:l;t[e]=t[f],i[e]=i[f],e=f}t[e]=s,i[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const i=this.elements_,n=this.priorities_,s=i[t],o=n[t];for(;t>e;){const a=this.getParentIndex_(t);if(n[a]>o)i[t]=i[a],n[t]=n[a],t=a;else break}i[t]=s,n[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let n=0;const s=t.length;let o,a,l;for(a=0;a<s;++a)o=t[a],l=e(o),l==Da?delete this.queuedElements_[this.keyFunction_(o)]:(i[n]=l,t[n++]=o);t.length=n,i.length=n,this.heapify_()}}const n0=i0;class s0 extends n0{constructor(e,t){super(function(i){return e.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(Te.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===ge.LOADED||i===ge.ERROR||i===ge.EMPTY){i!==ge.ERROR&&t.removeEventListener(Te.CHANGE,this.boundHandleTileChange_);const n=t.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0,n,s,o;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),n=s.getState(),n===ge.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,s.load())}}const r0=s0;function o0(r,e,t,i,n){if(!r||!(t in r.wantedTiles)||!r.wantedTiles[t][e.getKey()])return Da;const s=r.viewState.center,o=i[0]-s[0],a=i[1]-s[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n}const xi={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function If(r,e,t){return function(i,n,s,o,a){if(!i)return;if(!n&&!e)return i;const l=e?0:s[0]*n,u=e?0:s[1]*n,f=a?a[0]:0,m=a?a[1]:0;let _=r[0]+l/2+f,C=r[2]-l/2+f,R=r[1]+u/2+m,L=r[3]-u/2+m;_>C&&(_=(C+_)/2,C=_),R>L&&(R=(L+R)/2,L=R);let A=wt(i[0],_,C),S=wt(i[1],R,L);if(o&&t&&n){const P=30*n;A+=-P*Math.log(1+Math.max(0,_-i[0])/P)+P*Math.log(1+Math.max(0,i[0]-C)/P),S+=-P*Math.log(1+Math.max(0,R-i[1])/P)+P*Math.log(1+Math.max(0,i[1]-L)/P)}return[A,S]}}function a0(r){return r}function dc(r,e,t,i){const n=ot(e)/t[0],s=jt(e)/t[1];return i?Math.min(r,Math.max(n,s)):Math.min(r,Math.min(n,s))}function fc(r,e,t){let i=Math.min(r,e);const n=50;return i*=Math.log(1+n*Math.max(0,r/e-1))/n+1,t&&(i=Math.max(i,t),i/=Math.log(1+n*Math.max(0,t/r-1))/n+1),wt(i,t/2,e*2)}function l0(r,e,t,i){return e=e!==void 0?e:!0,function(n,s,o,a){if(n!==void 0){const l=r[0],u=r[r.length-1],f=t?dc(l,t,o,i):l;if(a)return e?fc(n,f,u):wt(n,u,f);const m=Math.min(f,n),_=Math.floor(Pa(r,m,s));return r[_]>f&&_<r.length-1?r[_+1]:r[_]}else return}}function h0(r,e,t,i,n,s){return i=i!==void 0?i:!0,t=t!==void 0?t:0,function(o,a,l,u){if(o!==void 0){const f=n?dc(e,n,l,s):e;if(u)return i?fc(o,f,t):wt(o,t,f);const m=1e-9,_=Math.ceil(Math.log(e/f)/Math.log(r)-m),C=-a*(.5-m)+.5,R=Math.min(f,o),L=Math.floor(Math.log(e/R)/Math.log(r)+C),A=Math.max(_,L),S=e/Math.pow(r,A);return wt(S,t,f)}else return}}function Ff(r,e,t,i,n){return t=t!==void 0?t:!0,function(s,o,a,l){if(s!==void 0){const u=i?dc(r,i,a,n):r;return!t||!l?wt(s,e,u):fc(s,u,e)}else return}}function gc(r){if(r!==void 0)return 0}function Pf(r){if(r!==void 0)return r}function c0(r){const e=2*Math.PI/r;return function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function u0(r){return r=r||oa(5),function(e,t){if(t)return e;if(e!==void 0)return Math.abs(e)<=r?0:e}}const Tl=0;class d0 extends Hi{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Mh(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&Wb(),e.center&&(e.center=ft(e.center,this.projection_)),e.extent&&(e.extent=yi(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in xi)delete t[a];this.setProperties(t,!0);const i=g0(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const n=f0(e),s=i.constraint,o=m0(e);this.constraints_={center:n,resolution:s,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenter();if(i){const n=e||[0,0,0,0];t=t||[0,0,0,0];const s=this.getResolution(),o=s/2*(n[3]-t[3]+t[1]-n[1]),a=s/2*(n[0]-t[0]+t[2]-n[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let n=arguments[i];n.center&&(n=Object.assign({},n),n.center=ft(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=ft(n.anchor,this.getProjection())),t[i]=n}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let n=0;for(;n<t&&!this.isDef();++n){const f=arguments[n];f.center&&this.setCenterInternal(f.center),f.zoom!==void 0?this.setZoom(f.zoom):f.resolution&&this.setResolution(f.resolution),f.rotation!==void 0&&this.setRotation(f.rotation)}if(n===t){i&&Zo(i,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const u=[];for(;n<t;++n){const f=arguments[n],m={start:s,complete:!1,anchor:f.anchor,duration:f.duration!==void 0?f.duration:1e3,easing:f.easing||_v,callback:i};if(f.center&&(m.sourceCenter=o,m.targetCenter=f.center.slice(),o=m.targetCenter),f.zoom!==void 0?(m.sourceResolution=a,m.targetResolution=this.getResolutionForZoom(f.zoom),a=m.targetResolution):f.resolution&&(m.sourceResolution=a,m.targetResolution=f.resolution,a=m.targetResolution),f.rotation!==void 0){m.sourceRotation=l;const _=ts(f.rotation-l+Math.PI,2*Math.PI)-Math.PI;m.targetRotation=l+_,l=m.targetRotation}p0(m)?m.complete=!0:s+=m.duration,u.push(m)}this.animations_.push(u),this.setHint(It.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[It.ANIMATING]>0}getInteracting(){return this.hints_[It.INTERACTING]>0}cancelAnimations(){this.setHint(It.ANIMATING,-this.hints_[It.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const n=this.animations_[t];if(n[0].callback&&Zo(n[0].callback,!1),!e)for(let s=0,o=n.length;s<o;++s){const a=n[s];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let s=!0;for(let o=0,a=n.length;o<a;++o){const l=n[o];if(l.complete)continue;const u=e-l.start;let f=l.duration>0?u/l.duration:1;f>=1?(l.complete=!0,f=1):s=!1;const m=l.easing(f);if(l.sourceCenter){const _=l.sourceCenter[0],C=l.sourceCenter[1],R=l.targetCenter[0],L=l.targetCenter[1];this.nextCenter_=l.targetCenter;const A=_+m*(R-_),S=C+m*(L-C);this.targetCenter_=[A,S]}if(l.sourceResolution&&l.targetResolution){const _=m===1?l.targetResolution:l.sourceResolution+m*(l.targetResolution-l.sourceResolution);if(l.anchor){const C=this.getViewportSize_(this.getRotation()),R=this.constraints_.resolution(_,0,C,!0);this.targetCenter_=this.calculateCenterZoom(R,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=_,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const _=m===1?ts(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+m*(l.targetRotation-l.sourceRotation);if(l.anchor){const C=this.constraints_.rotation(_,!0);this.targetCenter_=this.calculateCenterRotate(C,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=_}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(s){this.animations_[i]=null,this.setHint(It.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=n[0].callback;o&&Zo(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const n=this.getCenterInternal();return n!==void 0&&(i=[n[0]-t[0],n[1]-t[1]],Dh(i,e-this.getRotation()),zb(i,t)),i}calculateCenterZoom(e,t){let i;const n=this.getCenterInternal(),s=this.getResolution();if(n!==void 0&&s!==void 0){const o=t[0]-e*(t[0]-n[0])/s,a=t[1]-e*(t[1]-n[1])/s;i=[o,a]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],n=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(n*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(n*Math.cos(e))]}else return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&ls(e,this.getProjection())}getCenterInternal(){return this.get(xi.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return za(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();Xe(t,1);const i=this.getResolution();Xe(i!==void 0,2);const n=this.getRotation();return Xe(n!==void 0,3),ql(t,i,n,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(xi.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(yi(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=ot(e)/t[0],n=jt(e)/t[1];return Math.max(i,n)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,n=Math.log(t/i)/Math.log(e);return function(s){return t/Math.pow(e,s*n)}}getRotation(){return this.get(xi.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(i/n)/t;return function(o){return Math.log(i/o)/t/s}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();n=Rl(n,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],t,i)}return{center:n.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,n;if(this.resolutions_){const s=Pa(this.resolutions_,e,1);t=s,i=this.resolutions_[s],s==this.resolutions_.length-1?n=2:n=i/this.resolutions_[s+1]}else i=this.maxResolution_,n=this.zoomFactor_;return t+Math.log(i/e)/Math.log(n)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=wt(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,wt(e-t,0,1))}else return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(Xe(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function",24),Array.isArray(e)){Xe(!ro(e),25);const n=yi(e,this.getProjection());i=Lf(n)}else if(e.getType()==="Circle"){const n=yi(e.getExtent(),this.getProjection());i=Lf(n),i.rotate(this.getRotation(),rn(n))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),n=Math.sin(-t),s=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,u=-1/0,f=-1/0;for(let m=0,_=s.length;m<_;m+=o){const C=s[m]*i-s[m+1]*n,R=s[m]*n+s[m+1]*i;a=Math.min(a,C),l=Math.min(l,R),u=Math.max(u,C),f=Math.max(f,R)}return[a,l,u,f]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const n=t.padding!==void 0?t.padding:[0,0,0,0],s=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const u=this.getRotation(),f=Math.sin(u),m=Math.cos(u),_=rn(a);_[0]+=(n[1]-n[3])/2*l,_[1]+=(n[0]-n[2])/2*l;const C=_[0]*m-_[1]*f,R=_[1]*m+_[0]*f,L=this.getConstrainedCenter([C,R],l),A=t.callback?t.callback:os;t.duration!==void 0?this.animateInternal({resolution:l,center:L,duration:t.duration,easing:t.easing},A):(this.targetResolution_=l,this.targetCenter_=L,this.applyTargetState_(!1,!0),Zo(A,!0))}centerOn(e,t,i){this.centerOnInternal(ft(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(Rl(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,n){let s;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-i),l=Rl(e,n,[a[0]/2+o[3],a[1]/2+o[0]],t,i);s=[e[0]-l[0],e[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=ls(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&ft(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*e,0,n,i);t&&(this.targetCenter_=this.calculateCenterZoom(s,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=ft(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(n,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&ft(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,n=this.constraints_.rotation(this.targetRotation_,i),s=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,s,i),a=this.constraints_.center(this.targetCenter_,o,s,i,this.calculateCenterShift(this.targetCenter_,o,n,s));this.get(xi.ROTATION)!==n&&this.set(xi.ROTATION,n),this.get(xi.RESOLUTION)!==o&&(this.set(xi.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(xi.CENTER)||!Ri(this.get(xi.CENTER),a))&&this.set(xi.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const n=t||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,n,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!Ri(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:e,easing:cr,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(It.INTERACTING,1)}endInteraction(e,t,i){i=i&&ft(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.setHint(It.INTERACTING,-1),this.resolveConstraints(e,t,i)}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function Zo(r,e){setTimeout(function(){r(e)},0)}function f0(r){if(r.extent!==void 0){const t=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return If(r.extent,r.constrainOnlyCenter,t)}const e=Mh(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,If(t,!1,!1)}return a0}function g0(r){let e,t,i,o=r.minZoom!==void 0?r.minZoom:Tl,a=r.maxZoom!==void 0?r.maxZoom:28;const l=r.zoomFactor!==void 0?r.zoomFactor:2,u=r.multiWorld!==void 0?r.multiWorld:!1,f=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,m=r.showFullExtent!==void 0?r.showFullExtent:!1,_=Mh(r.projection,"EPSG:3857"),C=_.getExtent();let R=r.constrainOnlyCenter,L=r.extent;if(!u&&!L&&_.isGlobal()&&(R=!1,L=C),r.resolutions!==void 0){const A=r.resolutions;t=A[o],i=A[a]!==void 0?A[a]:A[A.length-1],r.constrainResolution?e=l0(A,f,!R&&L,m):e=Ff(t,i,f,!R&&L,m)}else{const S=(C?Math.max(ot(C),jt(C)):360*Vr.degrees/_.getMetersPerUnit())/hc/Math.pow(2,Tl),P=S/Math.pow(2,28-Tl);t=r.maxResolution,t!==void 0?o=0:t=S/Math.pow(l,o),i=r.minResolution,i===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?i=t/Math.pow(l,a):i=S/Math.pow(l,a):i=P),a=o+Math.floor(Math.log(t/i)/Math.log(l)),i=t/Math.pow(l,a-o),r.constrainResolution?e=h0(l,t,i,f,!R&&L,m):e=Ff(t,i,f,!R&&L,m)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:o,zoomFactor:l}}function m0(r){if(r.enableRotation!==void 0?r.enableRotation:!0){const t=r.constrainRotation;return t===void 0||t===!0?u0():t===!1?Pf:typeof t=="number"?c0(t):Pf}else return gc}function p0(r){return!(r.sourceCenter&&r.targetCenter&&!Ri(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function Rl(r,e,t,i,n){const s=Math.cos(-n);let o=Math.sin(-n),a=r[0]*s-r[1]*o,l=r[1]*s+r[0]*o;a+=(e[0]/2-t[0])*i,l+=(t[1]-e[1]/2)*i,o=-o;const u=a*s-l*o,f=l*s+a*o;return[u,f]}const ki=d0;class b0 extends Hi{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){nh(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&nh(this.element);for(let t=0,i=this.listenerKeys.length;t<i;++t)lt(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==os&&this.listenerKeys.push(ze(e,mn.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}const _s=b0,_0=Object.freeze(Object.defineProperty({__proto__:null,default:_s},Symbol.toStringTag,{value:"Module"}));class y0 extends _s{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",n=e.expandClassName!==void 0?e.expandClassName:t+"-expand",s=e.collapseLabel!==void 0?e.collapseLabel:"\u203A",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(Te.CLICK,this.handleClick_.bind(this),!1);const u=t+" "+Ha+" "+Vh+(this.collapsed_&&this.collapsible_?" "+sf:"")+(this.collapsible_?"":" ol-uncollapsible"),f=this.element;f.className=u,f.appendChild(this.toggleButton_),f.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t={},i=[];let n=!0;const s=e.layerStatesArray;for(let o=0,a=s.length;o<a;++o){const l=s[o];if(!Kh(l,e.viewState))continue;const u=l.layer.getSource();if(!u)continue;const f=u.getAttributions();if(!f)continue;const m=f(e);if(!!m)if(n=n&&u.getAttributionsCollapsible()!==!1,Array.isArray(m))for(let _=0,C=m.length;_<C;++_)m[_]in t||(i.push(m[_]),t[m[_]]=!0);else m in t||(i.push(m),t[m]=!0)}return this.overrideCollapsible_||this.setCollapsible(n),i}updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=this.collectSourceAttributions_(e),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!xn(t,this.renderedAttributions_)){m_(this.ulElement_);for(let n=0,s=t.length;n<s;++n){const o=document.createElement("li");o.innerHTML=t[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(sf),this.collapsed_?nf(this.collapseLabel_,this.label_):nf(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}const v0=y0;class E0 extends _s{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"\u21E7",n=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const s=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(Te.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+Ha+" "+Vh,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Vo)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:cr}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const n="rotate("+i+"rad)";if(this.autoHide_){const s=this.element.classList.contains(Vo);!s&&i===0?this.element.classList.add(Vo):s&&i!==0&&this.element.classList.remove(Vo)}this.label_.style.transform=n}this.rotation_=i}}const w0=E0;class C0 extends _s{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,n=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",s=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"\u2013",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",u=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",f=document.createElement("button");f.className=n,f.setAttribute("type","button"),f.title=l,f.appendChild(typeof o=="string"?document.createTextNode(o):o),f.addEventListener(Te.CLICK,this.handleClick_.bind(this,i),!1);const m=document.createElement("button");m.className=s,m.setAttribute("type","button"),m.title=u,m.appendChild(typeof a=="string"?document.createTextNode(a):a),m.addEventListener(Te.CLICK,this.handleClick_.bind(this,-i),!1);const _=t+" "+Ha+" "+Vh,C=this.element;C.className=_,C.appendChild(f),C.appendChild(m),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const n=i.getZoom();if(n!==void 0){const s=i.getConstrainedZoom(n+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:s,duration:this.duration_,easing:cr})):i.setZoom(s)}}}const x0=C0;function T0(r){r=r||{};const e=new mi;return(r.zoom!==void 0?r.zoom:!0)&&e.push(new x0(r.zoomOptions)),(r.rotate!==void 0?r.rotate:!0)&&e.push(new w0(r.rotateOptions)),(r.attribution!==void 0?r.attribution:!0)&&e.push(new v0(r.attributionOptions)),e}const uh={ACTIVE:"active"};class R0 extends Hi{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(uh.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(uh.ACTIVE,e)}setMap(e){this.map_=e}}function S0(r,e,t){const i=r.getCenterInternal();if(i){const n=[i[0]+e[0],i[1]+e[1]];r.animateInternal({duration:t!==void 0?t:250,easing:yv,center:r.getConstrainedCenter(n)})}}function mc(r,e,t,i){const n=r.getZoom();if(n===void 0)return;const s=r.getConstrainedZoom(n+e),o=r.getResolutionForZoom(s);r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:o,anchor:t,duration:i!==void 0?i:250,easing:cr})}const uo=R0;class L0 extends uo{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==qe.DBLCLICK){const i=e.originalEvent,n=e.map,s=e.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=n.getView();mc(a,o,s,this.duration_),i.preventDefault(),t=!0}return!t}}const D0=L0;class A0 extends uo{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==qe.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==qe.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==qe.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==qe.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function pc(r){const e=r.length;let t=0,i=0;for(let n=0;n<e;n++)t+=r[n].clientX,i+=r[n].clientY;return[t/e,i/e]}const Rn=A0;function dh(r){const e=arguments;return function(t){let i=!0;for(let n=0,s=e.length;n<s&&(i=i&&e[n](t),!!i);++n);return i}}const M0=function(r){const e=r.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},I0=function(r){const e=r.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},F0=function(r){const e=r.map.getTargetElement(),t=r.map.getOwnerDocument().activeElement;return e.contains(t)},bm=function(r){return r.map.getTargetElement().hasAttribute("tabindex")?F0(r):!0},Aa=rs,_m=function(r){const e=r.originalEvent;return e.button==0&&!(gb&&mb&&e.ctrlKey)},P0=gs,O0=function(r){return r.type==qe.SINGLECLICK},bc=function(r){const e=r.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},ym=function(r){const e=r.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},vm=function(r){const e=r.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Sl=function(r){const e=r.originalEvent;return Xe(e!==void 0,56),e.pointerType=="mouse"},Em=function(r){const e=r.originalEvent;return Xe(e!==void 0,56),e.isPrimary&&e.button===0};class k0 extends Rn{constructor(e){super({stopDown:gs}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:dh(bc,Em);this.condition_=e.onFocusOnly?dh(bm,t):t,this.noKinetic_=!1}handleDragEvent(e){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());const t=this.targetPointers,i=pc(t);if(t.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const n=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],o=e.map.getView();jb(n,o.getResolution()),Dh(n,o.getRotation()),o.adjustCenterInternal(n)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=t.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-n*Math.cos(s),a[1]-n*Math.sin(s)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:cr})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}else return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}else return!1}}const N0=k0;class G0 extends Rn{constructor(e){e=e||{},super({stopDown:gs}),this.condition_=e.condition?e.condition:I0,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Sl(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===gc)return;const n=t.getSize(),s=e.pixel,o=Math.atan2(n[1]/2-s[1],s[0]-n[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return Sl(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Sl(e)&&_m(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}const z0=G0;class B0 extends Fa{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(e[0],t[0])+i,n.top=Math.min(e[1],t[1])+i,n.width=Math.abs(t[0]-e[0])+i,n.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new Bi([n])}getGeometry(){return this.geometry_}}const j0=B0,qo={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Ll extends Ei{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class H0 extends Rn{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new j0(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:_m,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const n=i[0]-t[0],s=i[1]-t[1];return n*n+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new Ll(qo.BOXDRAG,e.coordinate,e))}handleUpEvent(e){this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new Ll(t?qo.BOXEND:qo.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Ll(qo.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}}const U0=H0;class V0 extends U0{constructor(e){e=e||{};const t=e.condition?e.condition:ym;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let n=this.getGeometry();if(this.out_){const s=i.rotatedExtentForGeometry(n),o=i.getResolutionForExtentInternal(s),a=i.getResolution()/o;n=n.clone(),n.scale(a*a)}i.fitInternal(n,{duration:this.duration_,easing:cr})}}const W0=V0,Yn={LEFT:37,UP:38,RIGHT:39,DOWN:40};class X0 extends uo{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return bc(t)&&vm(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==Te.KEYDOWN){const i=e.originalEvent,n=i.keyCode;if(this.condition_(e)&&(n==Yn.DOWN||n==Yn.LEFT||n==Yn.RIGHT||n==Yn.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,u=0;n==Yn.DOWN?u=-a:n==Yn.LEFT?l=-a:n==Yn.RIGHT?l=a:u=a;const f=[l,u];Dh(f,o.getRotation()),S0(o,f,this.duration_),i.preventDefault(),t=!0}}return!t}}const Y0=X0;class K0 extends uo{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:vm,this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==Te.KEYDOWN||e.type==Te.KEYPRESS){const i=e.originalEvent,n=i.charCode;if(this.condition_(e)&&(n=="+".charCodeAt(0)||n=="-".charCodeAt(0))){const s=e.map,o=n=="+".charCodeAt(0)?this.delta_:-this.delta_,a=s.getView();mc(a,o,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}const $0=K0;class Z0{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const n=this.points_[t+2]-this.points_[i+2];if(n<1e3/60)return!1;const s=this.points_[t]-this.points_[i],o=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const q0=Z0;class J0 extends uo{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:Aa;this.condition_=e.onFocusOnly?dh(bm,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==Te.WHEEL)return!0;const i=e.map,n=e.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let s;if(e.type==Te.WHEEL&&(s=n.deltaY,ub&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=sg),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-wt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),mc(t,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}const Q0=J0;class eE extends Rn{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=gs),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],n=this.targetPointers[1],s=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(this.lastAngle_!==void 0){const f=s-this.lastAngle_;this.rotationDelta_+=f,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=f}this.lastAngle_=s;const o=e.map,a=o.getView();if(a.getConstraints().rotation===gc)return;const l=o.getViewport().getBoundingClientRect(),u=pc(this.targetPointers);u[0]-=l.left,u[1]-=l.top,this.anchor_=o.getCoordinateFromPixelInternal(u),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}else return!1}}const tE=eE;class iE extends Rn{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=gs),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],n=this.targetPointers[1],s=i.clientX-n.clientX,o=i.clientY-n.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,u=l.getView();t!=1&&(this.lastScaleDelta_=t);const f=l.getViewport().getBoundingClientRect(),m=pc(this.targetPointers);m[0]-=f.left,m[1]-=f.top,this.anchor_=l.getCoordinateFromPixelInternal(m),l.render(),u.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,n),!1}else return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}else return!1}}const nE=iE;function sE(r){r=r||{};const e=new mi,t=new q0(-.005,.05,100);return(r.altShiftDragRotate!==void 0?r.altShiftDragRotate:!0)&&e.push(new z0),(r.doubleClickZoom!==void 0?r.doubleClickZoom:!0)&&e.push(new D0({delta:r.zoomDelta,duration:r.zoomDuration})),(r.dragPan!==void 0?r.dragPan:!0)&&e.push(new N0({onFocusOnly:r.onFocusOnly,kinetic:t})),(r.pinchRotate!==void 0?r.pinchRotate:!0)&&e.push(new tE),(r.pinchZoom!==void 0?r.pinchZoom:!0)&&e.push(new nE({duration:r.zoomDuration})),(r.keyboard!==void 0?r.keyboard:!0)&&(e.push(new Y0),e.push(new $0({delta:r.zoomDelta,duration:r.zoomDuration}))),(r.mouseWheelZoom!==void 0?r.mouseWheelZoom:!0)&&e.push(new Q0({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration})),(r.shiftDragZoom!==void 0?r.shiftDragZoom:!0)&&e.push(new W0({duration:r.zoomDuration})),e}function wm(r){if(r instanceof ao){r.setMapInternal(null);return}r instanceof bs&&r.getLayers().forEach(wm)}function Cm(r,e){if(r instanceof ao){r.setMapInternal(e);return}if(r instanceof bs){const t=r.getLayers().getArray();for(let i=0,n=t.length;i<n;++i)Cm(t[i],e)}}class rE extends Hi{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=oE(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:sg,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=ai(),this.pixelToCoordinateTransform_=ai(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.controls=t.controls||T0(),this.interactions=t.interactions||sE({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new r0(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(zt.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(zt.VIEW,this.handleViewChanged_),this.addChangeListener(zt.SIZE,this.handleSizeChanged_),this.addChangeListener(zt.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof ki)&&e.view.then(function(n){i.setView(new ki(n))}),this.controls.addEventListener(Ft.ADD,function(n){n.element.setMap(this)}.bind(this)),this.controls.addEventListener(Ft.REMOVE,function(n){n.element.setMap(null)}.bind(this)),this.interactions.addEventListener(Ft.ADD,function(n){n.element.setMap(this)}.bind(this)),this.interactions.addEventListener(Ft.REMOVE,function(n){n.element.setMap(null)}.bind(this)),this.overlays_.addEventListener(Ft.ADD,function(n){this.addOverlayInternal_(n.element)}.bind(this)),this.overlays_.addEventListener(Ft.REMOVE,function(n){const s=n.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],n.element.setMap(null)}.bind(this)),this.controls.forEach(function(n){n.setMap(this)}.bind(this)),this.interactions.forEach(function(n){n.setMap(this)}.bind(this)),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){Cm(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const s=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:rs,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,s,a,t,null,o,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(n){i.push(n)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(n){n instanceof bs?t(n.getLayers()):e.push(n)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const n=t.layerFilter!==void 0?t.layerFilter:rs,s=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,s,o,n,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const t=this.viewport_.getBoundingClientRect(),i="changedTouches"in e?e.changedTouches[0]:e;return[i.clientX-t.left,i.clientY-t.top]}getTarget(){return this.get(zt.TARGET)}getTargetElement(){const e=this.getTarget();return e!==void 0?typeof e=="string"?document.getElementById(e):e:null}getCoordinateFromPixel(e){return ls(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?St(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(zt.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof mi){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t];if(!n.visible)continue;const s=n.layer.getRenderer();if(s&&!s.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=ft(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?St(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(zt.SIZE)}getView(){return this.get(zt.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,n){return o0(this.frameState_,e,t,i,n)}handleBrowserEvent(e,t){t=t||e.type;const i=new Ki(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===ch.POINTERDOWN||i===Te.WHEEL||i===Te.KEYDOWN){const n=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=t.target;if(this.overlayContainerStopEvent_.contains(o)||!(s===n?n.documentElement:s).contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const n=this.getInteractions().getArray().slice();for(let s=n.length-1;s>=0;s--){const o=n[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,s=n;if(e){const o=e.viewHints;if(o[It.ANIMATING]||o[It.INTERACTING]){const a=Date.now()-e.time>8;n=a?0:8,s=a?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,s))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(oi.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(oi.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new ks(mn.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new ks(mn.LOADSTART,this,e))));const i=this.postRenderFunctions_;for(let n=0,s=i.length;n<s;++n)i[n](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let t=0,i=this.targetChangeHandlerKeys_.length;t<i;++t)lt(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Te.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(Te.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,nh(this.viewport_)}const e=this.getTargetElement();if(!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new qv(this)),this.mapBrowserEventHandler_=new t0(this,this.moveTolerance_);for(const n in qe)this.mapBrowserEventHandler_.addEventListener(qe[n],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Te.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(Te.WHEEL,this.boundHandleBrowserEvent_,rg?{passive:!1}:!1);const t=this.getOwnerDocument().defaultView,i=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[ze(i,Te.KEYDOWN,this.handleBrowserEvent,this),ze(i,Te.KEYPRESS,this.handleBrowserEvent,this),ze(t,Te.RESIZE,this.updateSize,this)]}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(lt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(lt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=ze(e,Zs.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ze(e,Te.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(lt),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new qi("addlayer",e)),this.layerGroupPropertyListenerKeys_=[ze(e,Zs.PROPERTYCHANGE,this.render,this),ze(e,Te.CHANGE,this.render,this),ze(e,"addlayer",this.handleLayerAdd_,this),ze(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){wm(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),n=this.frameState_;let s=null;if(t!==void 0&&ef(t)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:ql(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:Ie(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=ql(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),n&&(!this.previousExtent_||!ro(this.previousExtent_)&&!Js(s.extent,this.previousExtent_))&&(this.dispatchEvent(new ks(mn.MOVESTART,this,n)),this.previousExtent_=so(this.previousExtent_)),this.previousExtent_&&!s.viewHints[It.ANIMATING]&&!s.viewHints[It.INTERACTING]&&!Js(s.extent,this.previousExtent_)&&(this.dispatchEvent(new ks(mn.MOVEEND,this,s)),ag(s.extent,this.previousExtent_))),this.dispatchEvent(new ks(mn.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(mn.LOADSTART)||this.hasListener(mn.LOADEND)||this.hasListener(oi.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new qi("removelayer",t)),this.set(zt.LAYERGROUP,e)}setSize(e){this.set(zt.SIZE,e)}setTarget(e){this.set(zt.TARGET,e)}setView(e){if(!e||e instanceof ki){this.set(zt.VIEW,e);return}this.set(zt.VIEW,new ki);const t=this;e.then(function(i){t.setView(new ki(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const i=getComputedStyle(e),n=e.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),s=e.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(n)&&!isNaN(s)&&(t=[n,s],!ef(t)&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0."))}this.setSize(t),this.updateViewportSize_()}updateViewportSize_(){const e=this.getView();if(e){let t;const i=getComputedStyle(this.viewport_);i.width&&i.height&&(t=[parseInt(i.width,10),parseInt(i.height,10)]),e.setViewportSize(t)}}}function oE(r){let e=null;r.keyboardEventTarget!==void 0&&(e=typeof r.keyboardEventTarget=="string"?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget);const t={},i=r.layers&&typeof r.layers.getLayers=="function"?r.layers:new bs({layers:r.layers});t[zt.LAYERGROUP]=i,t[zt.TARGET]=r.target,t[zt.VIEW]=r.view instanceof ki?r.view:new ki;let n;r.controls!==void 0&&(Array.isArray(r.controls)?n=new mi(r.controls.slice()):(Xe(typeof r.controls.getArray=="function",47),n=r.controls));let s;r.interactions!==void 0&&(Array.isArray(r.interactions)?s=new mi(r.interactions.slice()):(Xe(typeof r.interactions.getArray=="function",48),s=r.interactions));let o;return r.overlays!==void 0?Array.isArray(r.overlays)?o=new mi(r.overlays.slice()):(Xe(typeof r.overlays.getArray=="function",49),o=r.overlays):o=new mi,{controls:n,interactions:s,keyboardEventTarget:e,overlays:o,values:t}}const aE=rE;class lE extends Xv{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:hE,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:Sa,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const n in this.tileCacheForProjection){const s=this.tileCacheForProjection[n];s.expireCache(s==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!pn(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!pn(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||pn(t,e)))return this.tileGrid;{const i=Ie(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=dm(e)),this.tileGridForProjection[i]}}getTileCacheForProjection(e){const t=this.getProjection();if(!t||pn(t,e))return this.tileCache;{const i=Ie(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new um(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}}createTile_(e,t,i,n,s,o){const a=[e,t,i],l=this.getTileCoordForTileUrlFunction(a,s),u=l?this.tileUrlFunction(l,n,s):void 0,f=new this.tileClass(a,u!==void 0?ge.IDLE:ge.EMPTY,u!==void 0?u:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return f.key=o,f.addEventListener(Te.CHANGE,this.handleTileChange.bind(this)),f}getTile(e,t,i,n,s){const o=this.getProjection();if(!o||!s||pn(o,s))return this.getTileInternal(e,t,i,n,o||s);{const a=this.getTileCacheForProjection(s),l=[e,t,i];let u;const f=to(l);a.containsKey(f)&&(u=a.get(f));const m=this.getKey();if(u&&u.key==m)return u;{const _=this.getTileGridForProjection(o),C=this.getTileGridForProjection(s),R=this.getTileCoordForTileUrlFunction(l,s),L=new er(o,_,s,C,l,R,this.getTilePixelRatio(n),this.getGutter(),function(A,S,P,k){return this.getTileInternal(A,S,P,k,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return L.key=m,u?(L.interimTile=u,L.refreshInterimChain(),a.replace(f,L)):a.set(f,L),L}}}getTileInternal(e,t,i,n,s){let o=null;const a=co(e,t,i),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(e,t,i,n,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const u=o;o=this.createTile_(e,t,i,n,s,l),u.getState()==ge.IDLE?o.interimTile=u.interimTile:o.interimTile=u,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=li(e);if(i){const n=Ie(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function hE(r,e){r.getImage().src=e}const cE=lE;class uE extends ao{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get($o.PRELOAD)}setPreload(e){this.set($o.PRELOAD,e)}getUseInterimTilesOnError(){return this.get($o.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set($o.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const xm=uE;class dE extends xm{constructor(e){super(e)}createRenderer(){return new Dv(this)}}const fE=dE;class gE{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}}const mE=gE;class pE extends ac{constructor(e){const t=ge.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||[256,256]}getSize(){return this.size_}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==ge.IDLE&&this.state!==ge.ERROR)return;this.state=ge.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=ge.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=ge.ERROR,e.changed()})}}const Tm=pE;function Rm(r,e,t){const i=t?r.LINEAR:r.NEAREST;r.bindTexture(r.TEXTURE_2D,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,i)}function bE(r,e,t,i){Rm(r,e,i),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}function Of(r,e,t,i,n,s){const o=r.getGL();let a,l;t instanceof Float32Array?(a=o.FLOAT,r.getExtension("OES_texture_float"),l=r.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,l=!0),Rm(o,e,s&&l);const u=t.byteLength/i[1];let f=1;u%8===0?f=8:u%4===0?f=4:u%2===0&&(f=2);let m;switch(n){case 1:{m=o.LUMINANCE;break}case 2:{m=o.LUMINANCE_ALPHA;break}case 3:{m=o.RGB;break}case 4:{m=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${n}`)}const _=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,f),o.texImage2D(o.TEXTURE_2D,0,m,i[0],i[1],0,m,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,_)}let Ns=null;function _E(){const r=document.createElement("canvas");r.width=1,r.height=1,Ns=r.getContext("2d")}class yE extends lr{constructor(e){super(),this.tile,this.textures=[],this.handleTileChange_=this.handleTileChange_.bind(this),this.renderSize_=Pt(e.grid.getTileSize(e.tile.tileCoord[0])),this.gutter_=e.gutter||0,this.bandCount=NaN,this.helper_=e.helper;const t=new Yg(tc,nc);t.fromArray([0,1,1,1,1,0,0,0]),this.helper_.flushBufferData(t),this.coords=t,this.setTile(e.tile)}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(Te.CHANGE,this.handleTileChange_),this.tile=e,this.textures.length=0,this.loaded=e.getState()===ge.LOADED,this.loaded)this.uploadTile_();else{if(e instanceof Sa){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(Te.CHANGE,this.handleTileChange_)}}uploadTile_(){const e=this.helper_,t=e.getGL(),i=this.tile;if(i instanceof Sa||i instanceof er){const S=t.createTexture();this.textures.push(S),this.bandCount=4,bE(t,S,i.getImage(),i.interpolate);return}const n=i.getSize(),s=[n[0]+2*this.gutter_,n[1]+2*this.gutter_],o=i.getData(),a=o instanceof Float32Array,l=s[0]*s[1],u=a?Float32Array:Uint8Array,f=u.BYTES_PER_ELEMENT,m=o.byteLength/s[1];this.bandCount=Math.floor(m/f/s[0]);const _=Math.ceil(this.bandCount/4);if(_===1){const S=t.createTexture();this.textures.push(S),Of(e,S,o,s,this.bandCount,i.interpolate);return}const C=new Array(_);for(let S=0;S<_;++S){const P=t.createTexture();this.textures.push(P);const k=S<_-1?4:(this.bandCount-1)%4+1;C[S]=new u(l*k)}let R=0,L=0;const A=s[0]*this.bandCount;for(let S=0;S<s[1];++S){for(let P=0;P<A;++P){const k=o[L+P],H=Math.floor(R/this.bandCount),K=P%this.bandCount,ie=Math.floor(K/4),te=C[ie],ee=te.length/l,ne=K%4;te[H*ee+ne]=k,++R}L+=m/f}for(let S=0;S<_;++S){const P=this.textures[S],k=C[S],H=k.length/l;Of(e,P,k,s,H,i.interpolate)}}handleTileChange_(){this.tile.getState()===ge.LOADED&&(this.loaded=!0,this.uploadTile_(),this.dispatchEvent(Te.CHANGE))}disposeInternal(){const e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(let t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(Te.CHANGE,this.handleTileChange_)}getPixelData(e,t){if(!this.loaded)return null;const i=this.renderSize_[0],n=this.renderSize_[1],s=this.gutter_;if(this.tile instanceof Tm){const R=this.tile.getSize(),L=R[0],A=R[1],S=L+2*s,P=A+2*s,k=s+Math.floor(L*(e/i)),H=s+Math.floor(A*(t/n)),K=this.tile.getData();if(K instanceof DataView){const te=K.byteLength/(S*P),ee=te*(H*S+k),ne=K.buffer.slice(ee,ee+te);return new DataView(ne)}const ie=this.bandCount*(H*S+k);return K.slice(ie,ie+this.bandCount)}Ns||_E(),Ns.clearRect(0,0,1,1);const o=this.tile.getImage(),a=o.width,l=o.height,u=a-2*s,f=l-2*s,m=s+Math.floor(u*(e/i)),_=s+Math.floor(f*(t/n));let C;try{Ns.drawImage(o,m,_,1,1,0,0,1,1),C=Ns.getImageData(0,0,1,1).data}catch{return Ns=null,null}return C}}const vE=yE,Oe={TILE_TEXTURE_ARRAY:"u_tileTextures",TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY",RENDER_EXTENT:"u_renderExtent",RESOLUTION:"u_resolution",ZOOM:"u_zoom"},la={TEXTURE_COORD:"a_textureCoord"},EE=[{name:la.TEXTURE_COORD,size:2,type:Fr.FLOAT}],wE={};function CE(r){return 2*(1-1/(r+1))-1}function kf(r,e,t){t in r||(r[t]=[]),r[t].push(e)}function Dl(r,e){const t=r.layerStatesArray[r.layerIndex];t.extent&&(e=Li(e,yi(t.extent,r.viewState.projection)));const i=t.layer.getRenderSource();if(!i.getWrapX()){const n=i.getTileGridForProjection(r.viewState.projection).getExtent();n&&(e=Li(e,n))}return e}function Al(r,e){return`${r.getKey()},${to(e)}`}class xE extends tv{constructor(e,t){super(e,{uniforms:t.uniforms}),this.renderComplete=!1,this.tileTransform_=ai(),this.tempMat4_=Kg(),this.tempTileRange_=new lc(0,0,0,0),this.tempTileCoord_=La(0,0,0),this.tempSize_=[0,0],this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new Yg(ic,nc),this.indices_.fromArray([0,1,3,1,2,3]);const i=t.cacheSize!==void 0?t.cacheSize:512;this.tileTextureCache_=new cm(i),this.paletteTextures_=t.paletteTextures||[],this.frameState_=null,this.projection_=void 0}reset(e){super.reset({uniforms:e.uniforms}),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}isDrawableTile_(e){const t=this.getLayer(),i=e.getState(),n=t.getUseInterimTilesOnError();return i==ge.LOADED||i==ge.EMPTY||i==ge.ERROR&&!n}prepareFrameInternal(e){this.projection_?e.viewState.projection!==this.projection_&&(this.clearCache(),this.projection_=e.viewState.projection):this.projection_=e.viewState.projection;const i=this.getLayer().getRenderSource();return!i||ro(Dl(e,e.extent))?!1:i.getState()==="ready"}enqueueTiles(e,t,i,n,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),u=l.getTileGridForProjection(o.projection),f=l.getGutterForProjection(o.projection),m=Ie(l);m in e.wantedTiles||(e.wantedTiles[m]={});const _=e.wantedTiles[m],C=this.tileTextureCache_,R=a.getMapInternal(),L=Math.max(i-s,u.getMinZoom(),u.getZForResolution(Math.min(a.getMaxResolution(),R?R.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):u.getResolution(0)),l.zDirection));for(let A=i;A>=L;--A){const S=u.getTileRangeForExtentAndZ(t,A,this.tempTileRange_),P=u.getResolution(A);for(let k=S.minX;k<=S.maxX;++k)for(let H=S.minY;H<=S.maxY;++H){const K=La(A,k,H,this.tempTileCoord_),ie=Al(l,K);let te,ee;if(C.containsKey(ie)&&(te=C.get(ie),ee=te.tile),!te||te.tile.key!==l.getKey())if(ee=l.getTile(A,k,H,e.pixelRatio,o.projection),!te)te=new vE({tile:ee,grid:u,helper:this.helper,gutter:f}),C.set(ie,te);else if(this.isDrawableTile_(ee))te.setTile(ee);else{const ue=ee.getInterimTile();te.setTile(ue)}kf(n,te,A);const ne=ee.getKey();_[ne]=!0,ee.getState()===ge.IDLE&&(e.tileQueue.isKeyQueued(ne)||e.tileQueue.enqueue([ee,m,u.getTileCoordCenter(K),P]))}}}renderFrame(e){this.frameState_=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const i=e.viewState,n=this.getLayer(),s=n.getRenderSource(),o=s.getTileGridForProjection(i.projection),a=s.getGutterForProjection(i.projection),l=Dl(e,e.extent),u=o.getZForResolution(i.resolution,s.zDirection),f={},m=n.getPreload();if(e.nextExtent){const te=o.getZForResolution(i.nextResolution,s.zDirection),ee=Dl(e,e.nextExtent);this.enqueueTiles(e,ee,te,f,m)}this.enqueueTiles(e,l,u,f,0),m>0&&setTimeout(()=>{this.enqueueTiles(e,l,u-1,f,m-1)},0);const _={},C=Ie(this),R=e.time;let L=!1;const A=f[u];for(let te=0,ee=A.length;te<ee;++te){const ne=A[te],ue=ne.tile;if(ue instanceof er&&ue.getState()===ge.EMPTY)continue;const de=ue.tileCoord;if(ne.loaded){const xe=ue.getAlpha(C,R);if(xe===1){ue.endTransition(C);continue}L=!0;const pe=to(de);_[pe]=xe}if(this.renderComplete=!1,this.findAltTiles_(o,de,u+1,f))continue;const ye=o.getMinZoom();for(let xe=u-1;xe>=ye&&!this.findAltTiles_(o,de,xe,f);--xe);}this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e,!L);const S=Object.keys(f).map(Number).sort(wn),P=i.center[0],k=i.center[1];for(let te=0,ee=S.length;te<ee;++te){const ne=S[te],ue=o.getResolution(ne),de=Pt(o.getTileSize(ne),this.tempSize_),oe=o.getOrigin(ne),ye=de[0]+2*a,xe=de[1]+2*a,pe=ye/xe,we=(P-oe[0])/(de[0]*ue),fe=(oe[1]-k)/(de[1]*ue),Se=i.resolution/ue,it=CE(ne),Ue=f[ne];for(let at=0,ae=Ue.length;at<ae;++at){const pt=Ue[at];if(!pt.loaded)continue;const Fe=pt.tile.tileCoord,ht=to(Fe),Lt=Fe[1],ut=Fe[2];sa(this.tileTransform_),Kl(this.tileTransform_,2/(e.size[0]*Se/ye),-2/(e.size[1]*Se/ye)),og(this.tileTransform_,i.rotation),Kl(this.tileTransform_,1,1/pe),yb(this.tileTransform_,(de[0]*(Lt-we)-a)/ye,(de[1]*(ut-fe)-a)/xe),this.helper.setUniformMatrixValue(Oe.TILE_TRANSFORM,aa(this.tempMat4_,this.tileTransform_)),this.helper.bindBuffer(pt.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(EE);let ct=0;for(;ct<pt.textures.length;){const Qe="TEXTURE"+ct,Ut=`${Oe.TILE_TEXTURE_ARRAY}[${ct}]`;t.activeTexture(t[Qe]),t.bindTexture(t.TEXTURE_2D,pt.textures[ct]),t.uniform1i(this.helper.getUniformLocation(Ut),ct),++ct}for(let Qe=0;Qe<this.paletteTextures_.length;++Qe){const Ut=this.paletteTextures_[Qe];t.activeTexture(t["TEXTURE"+ct]);const ui=Ut.getTexture(t);t.bindTexture(t.TEXTURE_2D,ui),t.uniform1i(this.helper.getUniformLocation(Ut.name),ct),++ct}const Z=ht in _?_[ht]:1;Z<1&&(e.animate=!0),this.helper.setUniformFloatValue(Oe.TRANSITION_ALPHA,Z),this.helper.setUniformFloatValue(Oe.DEPTH,it),this.helper.setUniformFloatValue(Oe.TEXTURE_PIXEL_WIDTH,ye),this.helper.setUniformFloatValue(Oe.TEXTURE_PIXEL_HEIGHT,xe),this.helper.setUniformFloatValue(Oe.TEXTURE_RESOLUTION,ue),this.helper.setUniformFloatValue(Oe.TEXTURE_ORIGIN_X,oe[0]+Lt*de[0]*ue-a*ue),this.helper.setUniformFloatValue(Oe.TEXTURE_ORIGIN_Y,oe[1]-ut*de[1]*ue+a*ue);let Ht=l;a>0&&(Ht=o.getTileCoordExtent(Fe),Li(Ht,l,Ht)),this.helper.setUniformFloatVec4(Oe.RENDER_EXTENT,Ht),this.helper.setUniformFloatValue(Oe.RESOLUTION,i.resolution),this.helper.setUniformFloatValue(Oe.ZOOM,i.zoom),this.helper.drawElements(0,this.indices_.getSize())}}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const H=this.helper.getCanvas(),K=this.tileTextureCache_;for(;K.canExpireCache();)K.pop().dispose();const ie=function(te,ee){s.updateCacheSize(.1,ee.viewState.projection),s.expireCache(ee.viewState.projection,wE)};return e.postRenderFunctions.push(ie),this.postRender(t,e),H}getData(e){if(!this.helper.getGL())return null;const i=this.frameState_;if(!i)return null;const n=this.getLayer(),s=St(i.pixelToCoordinateTransform,e.slice()),o=i.viewState,a=n.getExtent();if(a&&!as(yi(a,o.projection),s))return null;const l=n.getSources(Bt([s]),o.resolution);let u,f,m;for(u=l.length-1;u>=0;--u)if(f=l[u],f.getState()==="ready"){if(m=f.getTileGridForProjection(o.projection),f.getWrapX())break;const C=m.getExtent();if(!C||as(C,s))break}if(u<0)return null;const _=this.tileTextureCache_;for(let C=m.getZForResolution(o.resolution);C>=m.getMinZoom();--C){const R=m.getTileCoordForCoordAndZ(s,C),L=Al(f,R);if(!_.containsKey(L))continue;const A=_.get(L),S=A.tile;if(S instanceof er&&S.getState()===ge.EMPTY)return null;if(!A.loaded)continue;const P=m.getOrigin(C),k=Pt(m.getTileSize(C)),H=m.getResolution(C),K=(s[0]-P[0])/H-R[1]*k[0],ie=(P[1]-s[1])/H-R[2]*k[1];return A.getPixelData(K,ie)}return null}findAltTiles_(e,t,i,n){const s=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileTextureCache_,l=this.getLayer().getRenderSource();for(let u=s.minX;u<=s.maxX;++u)for(let f=s.minY;f<=s.maxY;++f){const m=Al(l,[i,u,f]);let _=!1;if(a.containsKey(m)){const C=a.get(m);C.loaded&&(kf(n,C,i),_=!0)}_||(o=!1)}return o}clearCache(){const e=this.tileTextureCache_;e.forEach(t=>t.dispose()),e.clear()}removeHelper(){this.helper&&this.clearCache(),super.removeHelper()}disposeInternal(){const e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)),super.disposeInternal(),delete this.indices_,delete this.tileTextureCache_,delete this.frameState_}}const TE=xE,me={NUMBER:1,STRING:2,COLOR:4,BOOLEAN:8,NUMBER_ARRAY:16,ANY:31,NONE:0},Ge={};function ji(r){if(typeof r=="number")return me.NUMBER;if(typeof r=="boolean")return me.BOOLEAN;if(typeof r=="string")return g_(r)?me.COLOR|me.STRING:me.STRING;if(!Array.isArray(r))throw new Error(`Unhandled value type: ${JSON.stringify(r)}`);const e=r;if(e.every(function(n){return typeof n=="number"}))return e.length===3||e.length===4?me.COLOR|me.NUMBER_ARRAY:me.NUMBER_ARRAY;if(typeof e[0]!="string")throw new Error(`Expected an expression operator but received: ${JSON.stringify(e)}`);const i=Ge[e[0]];if(i===void 0)throw new Error(`Unrecognized expression operator: ${JSON.stringify(e)}`);return i.getReturnType(e.slice(1))}function RE(r){return Math.log2(r)%1===0}function Xa(r){const e=r.toString();return e.includes(".")?e:e+".0"}function Sm(r){if(r.length<2||r.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${r.length}(${r.map(Xa).join(", ")})`}function SE(r){const e=Xr(r).slice();return e.length<4&&e.push(1),Sm(e.map(function(t,i){return i<3?t/255:t}))}function Lm(r,e){return r.stringLiteralsMap[e]===void 0&&(r.stringLiteralsMap[e]=Object.keys(r.stringLiteralsMap).length),r.stringLiteralsMap[e]}function LE(r,e){return Xa(Lm(r,e))}function _e(r,e,t){if(Array.isArray(e)&&typeof e[0]=="string"){const n=Ge[e[0]];if(n===void 0)throw new Error(`Unrecognized expression operator: ${JSON.stringify(e)}`);return n.toGlsl(r,e.slice(1),t)}const i=ji(e);if((i&me.NUMBER)>0)return Xa(e);if((i&me.BOOLEAN)>0)return e.toString();if((i&me.STRING)>0&&(t===void 0||t==me.STRING))return LE(r,e.toString());if((i&me.COLOR)>0&&(t===void 0||t==me.COLOR))return SE(e);if((i&me.NUMBER_ARRAY)>0)return Sm(e);throw new Error(`Unexpected expression ${e} (expected type ${t})`)}function Dm(r){if(!(ji(r)&me.NUMBER))throw new Error(`A numeric value was expected, got ${JSON.stringify(r)} instead`)}function xt(r){for(let e=0;e<r.length;e++)Dm(r[e])}function Am(r){if(!(ji(r)&me.STRING))throw new Error(`A string value was expected, got ${JSON.stringify(r)} instead`)}function _c(r){if(!(ji(r)&me.BOOLEAN))throw new Error(`A boolean value was expected, got ${JSON.stringify(r)} instead`)}function dt(r,e){if(r.length!==e)throw new Error(`Exactly ${e} arguments were expected, got ${r.length} instead`)}function Sn(r,e){if(r.length<e)throw new Error(`At least ${e} arguments were expected, got ${r.length} instead`)}function Ya(r,e){if(r.length>e)throw new Error(`At most ${e} arguments were expected, got ${r.length} instead`)}function Mm(r){if(r.length%2!==0)throw new Error(`An even amount of arguments was expected, got ${r} instead`)}function DE(r){if(r.length%2===0)throw new Error(`An odd amount of arguments was expected, got ${r} instead`)}function yc(r,e){if(!RE(e))throw new Error(`Could not infer only one type from the following expression: ${JSON.stringify(r)}`)}Ge.get={getReturnType:function(r){return me.ANY},toGlsl:function(r,e){dt(e,1),Am(e[0]);const t=e[0].toString();return r.attributes.includes(t)||r.attributes.push(t),(r.inFragmentShader?"v_":"a_")+t}};function Im(r){return"u_var_"+r}Ge.var={getReturnType:function(r){return me.ANY},toGlsl:function(r,e){dt(e,1),Am(e[0]);const t=e[0].toString();return r.variables.includes(t)||r.variables.push(t),Im(t)}};const Fm="u_paletteTextures";Ge.palette={getReturnType:function(r){return me.COLOR},toGlsl:function(r,e){dt(e,2),Dm(e[0]);const t=_e(r,e[0]),i=e[1];if(!Array.isArray(i))throw new Error("The second argument of palette must be an array");const n=i.length,s=new Uint8Array(n*4);for(let l=0;l<n;l++){const u=i[l];let f;if(typeof u=="string")f=Lg(u);else{if(!Array.isArray(u))throw new Error("The second argument of palette must be an array of strings or colors");const _=u.length;if(_===4)f=u;else{if(_!==3)throw new Error(`Expected palette color to have 3 or 4 values, got ${_}`);f=[u[0],u[1],u[2],1]}}const m=l*4;s[m]=f[0],s[m+1]=f[1],s[m+2]=f[2],s[m+3]=f[3]*255}r.paletteTextures||(r.paletteTextures=[]);const o=`${Fm}[${r.paletteTextures.length}]`,a=new mE(o,s);return r.paletteTextures.push(a),`texture2D(${o}, vec2((${t} + 0.5) / ${n}.0, 0.5))`}};const Ml="getBandValue";Ge.band={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){Sn(e,1),Ya(e,3);const t=e[0];if(!(Ml in r.functions)){let o="";const a=r.bandCount||1;for(let l=0;l<a;l++){const u=Math.floor(l/4);let f=l%4;l===a-1&&f===1&&(f=3);const m=`${Oe.TILE_TEXTURE_ARRAY}[${u}]`;o+=`
          if (band == ${l+1}.0) {
            return texture2D(${m}, v_textureCoord + vec2(dx, dy))[${f}];
          }
        `}r.functions[Ml]=`
        float getBandValue(float band, float xOffset, float yOffset) {
          float dx = xOffset / ${Oe.TEXTURE_PIXEL_WIDTH};
          float dy = yOffset / ${Oe.TEXTURE_PIXEL_HEIGHT};
          ${o}
        }
      `}const i=_e(r,t),n=_e(r,e[1]||0),s=_e(r,e[2]||0);return`${Ml}(${i}, ${n}, ${s})`}};Ge.time={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,0),"u_time"}};Ge.zoom={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,0),"u_zoom"}};Ge.resolution={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,0),"u_resolution"}};Ge["*"]={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,2),xt(e),`(${_e(r,e[0])} * ${_e(r,e[1])})`}};Ge["/"]={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,2),xt(e),`(${_e(r,e[0])} / ${_e(r,e[1])})`}};Ge["+"]={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,2),xt(e),`(${_e(r,e[0])} + ${_e(r,e[1])})`}};Ge["-"]={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,2),xt(e),`(${_e(r,e[0])} - ${_e(r,e[1])})`}};Ge.clamp={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){dt(e,3),xt(e);const t=_e(r,e[1]),i=_e(r,e[2]);return`clamp(${_e(r,e[0])}, ${t}, ${i})`}};Ge["%"]={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,2),xt(e),`mod(${_e(r,e[0])}, ${_e(r,e[1])})`}};Ge["^"]={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,2),xt(e),`pow(${_e(r,e[0])}, ${_e(r,e[1])})`}};Ge.abs={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,1),xt(e),`abs(${_e(r,e[0])})`}};Ge.floor={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,1),xt(e),`floor(${_e(r,e[0])})`}};Ge.round={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,1),xt(e),`floor(${_e(r,e[0])} + 0.5)`}};Ge.ceil={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,1),xt(e),`ceil(${_e(r,e[0])})`}};Ge.sin={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,1),xt(e),`sin(${_e(r,e[0])})`}};Ge.cos={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return dt(e,1),xt(e),`cos(${_e(r,e[0])})`}};Ge.atan={getReturnType:function(r){return me.NUMBER},toGlsl:function(r,e){return Sn(e,1),Ya(e,2),xt(e),e.length===2?`atan(${_e(r,e[0])}, ${_e(r,e[1])})`:`atan(${_e(r,e[0])})`}};Ge[">"]={getReturnType:function(r){return me.BOOLEAN},toGlsl:function(r,e){return dt(e,2),xt(e),`(${_e(r,e[0])} > ${_e(r,e[1])})`}};Ge[">="]={getReturnType:function(r){return me.BOOLEAN},toGlsl:function(r,e){return dt(e,2),xt(e),`(${_e(r,e[0])} >= ${_e(r,e[1])})`}};Ge["<"]={getReturnType:function(r){return me.BOOLEAN},toGlsl:function(r,e){return dt(e,2),xt(e),`(${_e(r,e[0])} < ${_e(r,e[1])})`}};Ge["<="]={getReturnType:function(r){return me.BOOLEAN},toGlsl:function(r,e){return dt(e,2),xt(e),`(${_e(r,e[0])} <= ${_e(r,e[1])})`}};function Pm(r){return{getReturnType:function(e){return me.BOOLEAN},toGlsl:function(e,t){dt(t,2);let i=me.ANY;for(let n=0;n<t.length;n++)i&=ji(t[n]);if(i===me.NONE)throw new Error(`All arguments should be of compatible type, got ${JSON.stringify(t)} instead`);return i&=~me.COLOR,`(${_e(e,t[0],i)} ${r} ${_e(e,t[1],i)})`}}}Ge["=="]=Pm("==");Ge["!="]=Pm("!=");Ge["!"]={getReturnType:function(r){return me.BOOLEAN},toGlsl:function(r,e){return dt(e,1),_c(e[0]),`(!${_e(r,e[0])})`}};function Om(r){return{getReturnType:function(e){return me.BOOLEAN},toGlsl:function(e,t){Sn(t,2);for(let n=0;n<t.length;n++)_c(t[n]);let i="";return i=t.map(n=>_e(e,n)).join(` ${r} `),i=`(${i})`,i}}}Ge.all=Om("&&");Ge.any=Om("||");Ge.between={getReturnType:function(r){return me.BOOLEAN},toGlsl:function(r,e){dt(e,3),xt(e);const t=_e(r,e[1]),i=_e(r,e[2]),n=_e(r,e[0]);return`(${n} >= ${t} && ${n} <= ${i})`}};Ge.array={getReturnType:function(r){return me.NUMBER_ARRAY},toGlsl:function(r,e){Sn(e,2),Ya(e,4),xt(e);const t=e.map(function(i){return _e(r,i,me.NUMBER)});return`vec${e.length}(${t.join(", ")})`}};Ge.color={getReturnType:function(r){return me.COLOR},toGlsl:function(r,e){Sn(e,3),Ya(e,4),xt(e);const t=e;e.length===3&&t.push(1);const i=e.map(function(n,s){return _e(r,n,me.NUMBER)+(s<3?" / 255.0":"")});return`vec${e.length}(${i.join(", ")})`}};Ge.interpolate={getReturnType:function(r){let e=me.COLOR|me.NUMBER;for(let t=3;t<r.length;t+=2)e=e&ji(r[t]);return e},toGlsl:function(r,e,t){Mm(e),Sn(e,6);const i=e[0];let n;switch(i[0]){case"linear":n=1;break;case"exponential":n=i[1];break;default:n=null}if(!n)throw new Error(`Invalid interpolation type for "interpolate" operator, received: ${JSON.stringify(i)}`);t=t!==void 0?t:me.ANY;const s=Ge.interpolate.getReturnType(e)&t;yc(e,s);const o=_e(r,e[1]),a=Xa(n);let l="";for(let u=2;u<e.length-2;u+=2){const f=_e(r,e[u]),m=l||_e(r,e[u+1],s),_=_e(r,e[u+2]),C=_e(r,e[u+3],s);l=`mix(${m}, ${C}, pow(clamp((${o} - ${f}) / (${_} - ${f}), 0.0, 1.0), ${a}))`}return l}};Ge.match={getReturnType:function(r){let e=me.ANY;for(let t=2;t<r.length;t+=2)e=e&ji(r[t]);return e=e&ji(r[r.length-1]),e},toGlsl:function(r,e,t){Mm(e),Sn(e,4),t=t!==void 0?t:me.ANY;const i=Ge.match.getReturnType(e)&t;yc(e,i);const n=_e(r,e[0]),s=_e(r,e[e.length-1],i);let o=null;for(let a=e.length-3;a>=1;a-=2){const l=_e(r,e[a]),u=_e(r,e[a+1],i);o=`(${n} == ${l} ? ${u} : ${o||s})`}return o}};Ge.case={getReturnType:function(r){let e=me.ANY;for(let t=1;t<r.length;t+=2)e=e&ji(r[t]);return e=e&ji(r[r.length-1]),e},toGlsl:function(r,e,t){DE(e),Sn(e,3),t=t!==void 0?t:me.ANY;const i=Ge.case.getReturnType(e)&t;yc(e,i);for(let o=0;o<e.length-1;o+=2)_c(e[o]);const n=_e(r,e[e.length-1],i);let s=null;for(let o=e.length-3;o>=0;o-=2){const a=_e(r,e[o]),l=_e(r,e[o+1],i);s=`(${a} ? ${l} : ${s||n})`}return s}};function Nf(r,e){const t=`
    attribute vec2 ${la.TEXTURE_COORD};
    uniform mat4 ${Oe.TILE_TRANSFORM};
    uniform float ${Oe.TEXTURE_PIXEL_WIDTH};
    uniform float ${Oe.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Oe.TEXTURE_RESOLUTION};
    uniform float ${Oe.TEXTURE_ORIGIN_X};
    uniform float ${Oe.TEXTURE_ORIGIN_Y};
    uniform float ${Oe.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${la.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${Oe.TEXTURE_ORIGIN_X} + ${Oe.TEXTURE_RESOLUTION} * ${Oe.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${Oe.TEXTURE_ORIGIN_Y} - ${Oe.TEXTURE_RESOLUTION} * ${Oe.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${Oe.TILE_TRANSFORM} * vec4(${la.TEXTURE_COORD}, ${Oe.DEPTH}, 1.0);
    }
  `,i={inFragmentShader:!0,variables:[],attributes:[],stringLiteralsMap:{},functions:{},bandCount:e},n=[];if(r.color!==void 0){const m=_e(i,r.color,me.COLOR);n.push(`color = ${m};`)}if(r.contrast!==void 0){const m=_e(i,r.contrast,me.NUMBER);n.push(`color.rgb = clamp((${m} + 1.0) * color.rgb - (${m} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.exposure!==void 0){const m=_e(i,r.exposure,me.NUMBER);n.push(`color.rgb = clamp((${m} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.saturation!==void 0){const m=_e(i,r.saturation,me.NUMBER);n.push(`
      float saturation = ${m} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(r.gamma!==void 0){const m=_e(i,r.gamma,me.NUMBER);n.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${m}));`)}if(r.brightness!==void 0){const m=_e(i,r.brightness,me.NUMBER);n.push(`color.rgb = clamp(color.rgb + ${m}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=i.variables.length;if(o>1&&!r.variables)throw new Error(`Missing variables in style (expected ${i.variables})`);for(let m=0;m<o;++m){const _=i.variables[m];if(!(_ in r.variables))throw new Error(`Missing '${_}' in style variables`);const C=Im(_);s[C]=function(){let R=r.variables[_];return typeof R=="string"&&(R=Lm(i,R)),R!==void 0?R:-9999999}}const a=Object.keys(s).map(function(m){return`uniform float ${m};`}),l=Math.ceil(e/4);a.push(`uniform sampler2D ${Oe.TILE_TEXTURE_ARRAY}[${l}];`),i.paletteTextures&&a.push(`uniform sampler2D ${Fm}[${i.paletteTextures.length}];`);const u=Object.keys(i.functions).map(function(m){return i.functions[m]}),f=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${Oe.RENDER_EXTENT};
    uniform float ${Oe.TRANSITION_ALPHA};
    uniform float ${Oe.TEXTURE_PIXEL_WIDTH};
    uniform float ${Oe.TEXTURE_PIXEL_HEIGHT};
    uniform float ${Oe.RESOLUTION};
    uniform float ${Oe.ZOOM};

    ${a.join(`
`)}

    ${u.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${Oe.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${Oe.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${Oe.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${Oe.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${Oe.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${n.join(`
`)}

      if (color.a == 0.0) {
        discard;
      }

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${Oe.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:f,uniforms:s,paletteTextures:i.paletteTextures}}class km extends xm{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style;const i=e.cacheSize;delete e.cacheSize,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.cacheSize_=i,this.styleVariables_=this.style_.variables||{},this.addChangeListener(st.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const i=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:i?[i]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache(),this.getSource()&&this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=Nf(this.style_,this.getSourceBandCount_());return new TE(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})}renderSources(e,t){const i=this.getRenderer();let n;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],i.prepareFrame(e)&&(n=i.renderFrame(e));return n}render(e,t){this.rendered=!0;const i=e.viewState,n=this.getSources(e.extent,i.resolution);let s=!0;for(let a=0,l=n.length;a<l;++a){const u=n[a],f=u.getState();if(f=="loading"){const m=()=>{u.getState()=="ready"&&(u.removeEventListener("change",m),this.changed())};u.addEventListener("change",m)}s=s&&f=="ready"}const o=this.renderSources(e,n);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=i.resolution,o;if(this.renderedResolution_>.5*i.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(l=>!n.includes(l));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){this.styleVariables_=e.variables||{},this.style_=e;const t=Nf(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}km.prototype.dispose;const AE=km;class ME extends cE{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:fm({extent:Wa(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const IE=ME;class FE extends pm{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let i=e.tileGrid;i===void 0&&t&&(i=fm({extent:Wa(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:i,opaque:e.opaque,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?Pt(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?Pt(t.getTileSize(e)):[256,256]}getGutterForProjection(e){return this.gutter_}setLoader(e){this.loader_=e}getTile(e,t,i,n,s){const o=this.getTileSize(e),a=co(e,t,i);if(this.tileCache.containsKey(a))return this.tileCache.get(a);const l=this.loader_;function u(){return sb(function(){return l(e,t,i)})}const f=Object.assign({tileCoord:[e,t,i],loader:u,size:o},this.tileOptions),m=new Tm(f);return m.key=this.getKey(),m.addEventListener(Te.CHANGE,this.handleTileChange_),this.tileCache.set(a,m),m}handleTileChange_(e){const t=e.target,i=Ie(t),n=t.getState();let s;n==ge.LOADING?(this.tileLoadingKeys_[i]=!0,s=Xs.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==ge.ERROR?Xs.TILELOADERROR:n==ge.LOADED?Xs.TILELOADEND:void 0),s&&this.dispatchEvent(new mm(s,t))}}const PE=FE;function Gt(r){return(e,...t)=>OE(r,e,t)}function ur(r,e){return Gt(Nm(r,e).get)}const{apply:OE,construct:s1,defineProperty:r1,get:o1,getOwnPropertyDescriptor:Nm,getPrototypeOf:vc,has:a1,ownKeys:kE,set:l1,setPrototypeOf:h1}=Reflect,{iterator:fo,species:c1,toStringTag:NE,for:u1}=Symbol,GE=Object,{create:Ec,defineProperty:zE,freeze:d1,is:f1}=GE,BE=Array,jE=BE.prototype,Gm=jE[fo],HE=Gt(Gm),zm=ArrayBuffer,UE=zm.prototype;ur(UE,"byteLength");const Gf=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Gf&&ur(Gf.prototype,"byteLength");const Bm=vc(Uint8Array);Bm.from;const qt=Bm.prototype;qt[fo];Gt(qt.keys);Gt(qt.values);Gt(qt.entries);Gt(qt.set);Gt(qt.reverse);Gt(qt.fill);Gt(qt.copyWithin);Gt(qt.sort);Gt(qt.slice);Gt(qt.subarray);ur(qt,"buffer");ur(qt,"byteOffset");ur(qt,"length");ur(qt,NE);const dr=Uint32Array,VE=Float32Array,Ma=vc([][fo]()),WE=Gt(Ma.next),XE=Gt(function*(){}().next),YE=vc(Ma),KE=DataView.prototype,$E=Gt(KE.getUint16),wc=WeakMap,jm=wc.prototype,Hm=Gt(jm.get),ZE=Gt(jm.set),Um=new wc,qE=Ec(null,{next:{value:function(){const e=Hm(Um,this);return WE(e)}},[fo]:{value:function(){return this}}});function JE(r){if(r[fo]===Gm)return r;const e=Ec(qE);return ZE(Um,e,HE(r)),e}const QE=new wc,ew=Ec(YE,{next:{value:function(){const e=Hm(QE,this);return XE(e)},writable:!0,configurable:!0}});for(const r of kE(Ma))r!=="next"&&zE(ew,r,Nm(Ma,r));const Vm=new zm(4),tw=new VE(Vm),iw=new dr(Vm),Ii=new dr(512),Fi=new dr(512);for(let r=0;r<256;++r){const e=r-127;e<-27?(Ii[r]=0,Ii[r|256]=32768,Fi[r]=24,Fi[r|256]=24):e<-14?(Ii[r]=1024>>-e-14,Ii[r|256]=1024>>-e-14|32768,Fi[r]=-e-1,Fi[r|256]=-e-1):e<=15?(Ii[r]=e+15<<10,Ii[r|256]=e+15<<10|32768,Fi[r]=13,Fi[r|256]=13):e<128?(Ii[r]=31744,Ii[r|256]=64512,Fi[r]=24,Fi[r|256]=24):(Ii[r]=31744,Ii[r|256]=64512,Fi[r]=13,Fi[r|256]=13)}const Cc=new dr(2048),fr=new dr(64),Wm=new dr(64);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;(e&8388608)===0;)e<<=1,t-=8388608;e&=-8388609,t+=947912704,Cc[r]=e|t}for(let r=1024;r<2048;++r)Cc[r]=939524096+(r-1024<<13);for(let r=1;r<31;++r)fr[r]=r<<23;fr[31]=1199570944;fr[32]=2147483648;for(let r=33;r<63;++r)fr[r]=2147483648+(r-32<<23);fr[63]=3347054592;for(let r=1;r<64;++r)r!==32&&(Wm[r]=1024);function nw(r){const e=r>>10;return iw[0]=Cc[Wm[e]+(r&1023)]+fr[e],tw[0]}function Xm(r,e,...t){return nw($E(r,e,...JE(t)))}var Gr={exports:{}};function Ym(r,e,t){const i=t&&t.debug||!1;i&&console.log("getting "+e+" in "+r);const n=typeof r=="object"?r.outer:r,s=`${e}\\="([^"]*)"`;i&&console.log("pattern:",s);const a=new RegExp(s).exec(n);if(i&&console.log("match:",a),a)return a[1]}Gr.exports=Ym;Gr.exports.default=Ym;var xc={exports:{}},Tc={exports:{}},Rc={exports:{}};function Km(r,e,t){const n=new RegExp(e).exec(r.slice(t));return n?t+n.index:-1}Rc.exports=Km;Rc.exports.default=Km;var Sc={exports:{}};function $m(r,e,t){const n=new RegExp(e).exec(r.slice(t));return n?t+n.index+n[0].length-1:-1}Sc.exports=$m;Sc.exports.default=$m;var Lc={exports:{}};function Zm(r,e){const t=new RegExp(e,"g"),i=r.match(t);return i?i.length:0}Lc.exports=Zm;Lc.exports.default=Zm;const sw=Rc.exports,Il=Sc.exports,zf=Lc.exports;function qm(r,e,t){const i=t&&t.debug||!1,n=!(t&&typeof t.nested===!1),s=t&&t.startIndex||0;i&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=sw(r,`<${e}[ >/]`,s);if(i&&console.log("[xml-utils] start:",o),o===-1)return;const a=r.slice(o+e.length);let l=Il(a,"^[^<]*[ /]>",0);const u=l!==-1&&a[l-1]==="/";if(i&&console.log("[xml-utils] selfClosing:",u),u===!1)if(n){let C=0,R=1,L=0;for(;(l=Il(a,"[ /]"+e+">",C))!==-1;){const A=a.substring(C,l+1);if(R+=zf(A,"<"+e),L+=zf(A,"/"+e+">"),L>=R)break;C=l}}else l=Il(a,"[ /]"+e+">",0);const f=o+e.length+l+1;if(i&&console.log("[xml-utils] end:",f),f===-1)return;const m=r.slice(o,f);let _;return u?_=null:_=m.slice(m.indexOf(">")+1,m.lastIndexOf("<")),{inner:_,outer:m,start:o,end:f}}Tc.exports=qm;Tc.exports.default=qm;const rw=Tc.exports;function Jm(r,e,t){const i=[],n=t&&t.debug||!1,s=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=rw(r,e,{debug:n,startIndex:o});)s?o=a.start+1+e.length:o=a.end,i.push(a);return n&&console.log("findTagsByName found",i.length,"tags"),i}xc.exports=Jm;xc.exports.default=Jm;const zr={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Pi={};for(const r in zr)zr.hasOwnProperty(r)&&(Pi[zr[r]]=parseInt(r,10));const ow=[Pi.BitsPerSample,Pi.ExtraSamples,Pi.SampleFormat,Pi.StripByteCounts,Pi.StripOffsets,Pi.StripRowCounts,Pi.TileByteCounts,Pi.TileOffsets,Pi.SubIFDs],Fl={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},ke={};for(const r in Fl)Fl.hasOwnProperty(r)&&(ke[Fl[r]]=parseInt(r,10));const si={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},aw={Unspecified:0,Assocalpha:1,Unassalpha:2},g1={Version:0,AddCompression:1},m1={None:0,Deflate:1},lw={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function hw(r,e){const{width:t,height:i}=r,n=new Uint8Array(t*i*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=256-r[o]/e*256,n[a]=s,n[a+1]=s,n[a+2]=s;return n}function cw(r,e){const{width:t,height:i}=r,n=new Uint8Array(t*i*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=r[o]/e*256,n[a]=s,n[a+1]=s,n[a+2]=s;return n}function uw(r,e){const{width:t,height:i}=r,n=new Uint8Array(t*i*3),s=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<r.length;++a,l+=3){const u=r[a];n[l]=e[u]/65536*256,n[l+1]=e[u+s]/65536*256,n[l+2]=e[u+o]/65536*256}return n}function dw(r){const{width:e,height:t}=r,i=new Uint8Array(e*t*3);for(let n=0,s=0;n<r.length;n+=4,s+=3){const o=r[n],a=r[n+1],l=r[n+2],u=r[n+3];i[s]=255*((255-o)/256)*((255-u)/256),i[s+1]=255*((255-a)/256)*((255-u)/256),i[s+2]=255*((255-l)/256)*((255-u)/256)}return i}function fw(r){const{width:e,height:t}=r,i=new Uint8ClampedArray(e*t*3);for(let n=0,s=0;n<r.length;n+=3,s+=3){const o=r[n],a=r[n+1],l=r[n+2];i[s]=o+1.402*(l-128),i[s+1]=o-.34414*(a-128)-.71414*(l-128),i[s+2]=o+1.772*(a-128)}return i}const gw=.95047,mw=1,pw=1.08883;function bw(r){const{width:e,height:t}=r,i=new Uint8Array(e*t*3);for(let n=0,s=0;n<r.length;n+=3,s+=3){const o=r[n+0],a=r[n+1]<<24>>24,l=r[n+2]<<24>>24;let u=(o+16)/116,f=a/500+u,m=u-l/200,_,C,R;f=gw*(f*f*f>.008856?f*f*f:(f-16/116)/7.787),u=mw*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),m=pw*(m*m*m>.008856?m*m*m:(m-16/116)/7.787),_=f*3.2406+u*-1.5372+m*-.4986,C=f*-.9689+u*1.8758+m*.0415,R=f*.0557+u*-.204+m*1.057,_=_>.0031308?1.055*_**(1/2.4)-.055:12.92*_,C=C>.0031308?1.055*C**(1/2.4)-.055:12.92*C,R=R>.0031308?1.055*R**(1/2.4)-.055:12.92*R,i[s]=Math.max(0,Math.min(1,_))*255,i[s+1]=Math.max(0,Math.min(1,C))*255,i[s+2]=Math.max(0,Math.min(1,R))*255}return i}const _w="modulepreload",yw=function(r){return"/SelfGeoRef/"+r},Bf={},Ln=function(e,t,i){return!t||t.length===0?e():Promise.all(t.map(n=>{if(n=yw(n),n in Bf)return;Bf[n]=!0;const s=n.endsWith(".css"),o=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${o}`))return;const a=document.createElement("link");if(a.rel=s?"stylesheet":_w,s||(a.as="script",a.crossOrigin=""),a.href=n,document.head.appendChild(a),s)return new Promise((l,u)=>{a.addEventListener("load",l),a.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())},Qm=new Map;function Dn(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>Qm.set(t,e))}async function ep(r){const e=Qm.get(r.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const t=await e();return new t(r)}Dn([void 0,1],()=>Ln(()=>import("./raw.c45fc51f.js"),["assets/raw.c45fc51f.js","assets/basedecoder.c2fc4d47.js"]).then(r=>r.default));Dn(5,()=>Ln(()=>import("./lzw.654ab67e.js"),["assets/lzw.654ab67e.js","assets/basedecoder.c2fc4d47.js"]).then(r=>r.default));Dn(6,()=>{throw new Error("old style JPEG compression is not supported.")});Dn(7,()=>Ln(()=>import("./jpeg.0079b036.js"),["assets/jpeg.0079b036.js","assets/basedecoder.c2fc4d47.js"]).then(r=>r.default));Dn([8,32946],()=>Ln(()=>import("./deflate.e51481f5.js"),["assets/deflate.e51481f5.js","assets/pako.esm.9c7e9728.js","assets/basedecoder.c2fc4d47.js"]).then(r=>r.default));Dn(32773,()=>Ln(()=>import("./packbits.d5c3724c.js"),["assets/packbits.d5c3724c.js","assets/basedecoder.c2fc4d47.js"]).then(r=>r.default));Dn(34887,()=>Ln(()=>import("./lerc.1a06ce9b.js"),["assets/lerc.1a06ce9b.js","assets/pako.esm.9c7e9728.js","assets/basedecoder.c2fc4d47.js"]).then(r=>r.default));Dn(50001,()=>Ln(()=>import("./webimage.eace165f.js"),["assets/webimage.eace165f.js","assets/basedecoder.c2fc4d47.js"]).then(r=>r.default));function Ka(r,e,t,i=1){return new(Object.getPrototypeOf(r)).constructor(e*t*i)}function vw(r,e,t,i,n){const s=e/i,o=t/n;return r.map(a=>{const l=Ka(a,i,n);for(let u=0;u<n;++u){const f=Math.min(Math.round(o*u),t-1);for(let m=0;m<i;++m){const _=Math.min(Math.round(s*m),e-1),C=a[f*e+_];l[u*i+m]=C}}return l})}function Ys(r,e,t){return(1-t)*r+t*e}function Ew(r,e,t,i,n){const s=e/i,o=t/n;return r.map(a=>{const l=Ka(a,i,n);for(let u=0;u<n;++u){const f=o*u,m=Math.floor(f),_=Math.min(Math.ceil(f),t-1);for(let C=0;C<i;++C){const R=s*C,L=R%1,A=Math.floor(R),S=Math.min(Math.ceil(R),e-1),P=a[m*e+A],k=a[m*e+S],H=a[_*e+A],K=a[_*e+S],ie=Ys(Ys(P,k,L),Ys(H,K,L),f%1);l[u*i+C]=ie}}return l})}function ww(r,e,t,i,n,s="nearest"){switch(s.toLowerCase()){case"nearest":return vw(r,e,t,i,n);case"bilinear":case"linear":return Ew(r,e,t,i,n);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function Cw(r,e,t,i,n,s){const o=e/i,a=t/n,l=Ka(r,i,n,s);for(let u=0;u<n;++u){const f=Math.min(Math.round(a*u),t-1);for(let m=0;m<i;++m){const _=Math.min(Math.round(o*m),e-1);for(let C=0;C<s;++C){const R=r[f*e*s+_*s+C];l[u*i*s+m*s+C]=R}}}return l}function xw(r,e,t,i,n,s){const o=e/i,a=t/n,l=Ka(r,i,n,s);for(let u=0;u<n;++u){const f=a*u,m=Math.floor(f),_=Math.min(Math.ceil(f),t-1);for(let C=0;C<i;++C){const R=o*C,L=R%1,A=Math.floor(R),S=Math.min(Math.ceil(R),e-1);for(let P=0;P<s;++P){const k=r[m*e*s+A*s+P],H=r[m*e*s+S*s+P],K=r[_*e*s+A*s+P],ie=r[_*e*s+S*s+P],te=Ys(Ys(k,H,L),Ys(K,ie,L),f%1);l[u*i*s+C*s+P]=te}}}return l}function Tw(r,e,t,i,n,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return Cw(r,e,t,i,n,s);case"bilinear":case"linear":return xw(r,e,t,i,n,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function Rw(r,e,t){let i=0;for(let n=e;n<t;++n)i+=r[n];return i}function fh(r,e,t){switch(r){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function Sw(r,e){return(r===1||r===2)&&e<=32&&e%8===0?!1:!(r===3&&(e===16||e===32||e===64))}function Lw(r,e,t,i,n,s,o){const a=new DataView(r),l=t===2?o*s:o*s*i,u=t===2?1:i,f=fh(e,n,l),m=parseInt("1".repeat(n),2);if(e===1){let _;t===1?_=i*n:_=n;let C=s*_;(C&7)!==0&&(C=C+7&-8);for(let R=0;R<o;++R){const L=R*C;for(let A=0;A<s;++A){const S=L+A*u*n;for(let P=0;P<u;++P){const k=S+P*n,H=(R*s+A)*u+P,K=Math.floor(k/8),ie=k%8;if(ie+n<=8)f[H]=a.getUint8(K)>>8-n-ie&m;else if(ie+n<=16)f[H]=a.getUint16(K)>>16-n-ie&m;else if(ie+n<=24){const te=a.getUint16(K)<<8|a.getUint8(K+2);f[H]=te>>24-n-ie&m}else f[H]=a.getUint32(K)>>32-n-ie&m}}}}return f.buffer}class Dw{constructor(e,t,i,n,s,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=i,this.littleEndian=n,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,i=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(i<=8)return DataView.prototype.getUint8;if(i<=16)return DataView.prototype.getUint16;if(i<=32)return DataView.prototype.getUint32;break;case 2:if(i<=8)return DataView.prototype.getInt8;if(i<=16)return DataView.prototype.getInt16;if(i<=32)return DataView.prototype.getInt32;break;case 3:switch(i){case 16:return function(n,s){return Xm(this,n,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const i=this.getSampleFormat(e),n=this.getBitsPerSample(e);return fh(i,n,t)}async getTileOrStrip(e,t,i,n,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:u}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=i*o*a+t*o+e);let f,m;this.isTiled?(f=this.fileDirectory.TileOffsets[l],m=this.fileDirectory.TileByteCounts[l]):(f=this.fileDirectory.StripOffsets[l],m=this.fileDirectory.StripByteCounts[l]);const _=(await this.source.fetch([{offset:f,length:m}],s))[0];let C;return u===null||!u[l]?(C=(async()=>{let R=await n.decode(this.fileDirectory,_);const L=this.getSampleFormat(),A=this.getBitsPerSample();return Sw(L,A)&&(R=Lw(R,L,this.planarConfiguration,this.getSamplesPerPixel(),A,this.getTileWidth(),this.getBlockHeight(t))),R})(),u!==null&&(u[l]=C)):C=u[l],{x:e,y:t,sample:i,data:await C}}async _readRaster(e,t,i,n,s,o,a,l,u){const f=this.getTileWidth(),m=this.getTileHeight(),_=this.getWidth(),C=this.getHeight(),R=Math.max(Math.floor(e[0]/f),0),L=Math.min(Math.ceil(e[2]/f),Math.ceil(_/f)),A=Math.max(Math.floor(e[1]/m),0),S=Math.min(Math.ceil(e[3]/m),Math.ceil(C/m)),P=e[2]-e[0];let k=this.getBytesPerPixel();const H=[],K=[];for(let ee=0;ee<t.length;++ee)this.planarConfiguration===1?H.push(Rw(this.fileDirectory.BitsPerSample,0,t[ee])/8):H.push(0),K.push(this.getReaderForSample(t[ee]));const ie=[],{littleEndian:te}=this;for(let ee=A;ee<S;++ee)for(let ne=R;ne<L;++ne)for(let ue=0;ue<t.length;++ue){const de=ue,oe=t[ue];this.planarConfiguration===2&&(k=this.getSampleByteSize(ue));const ye=this.getTileOrStrip(ne,ee,oe,s,u);ie.push(ye),ye.then(xe=>{const pe=xe.data,we=new DataView(pe),fe=this.getBlockHeight(xe.y),Se=xe.y*m,it=xe.x*f,Ue=Se+fe,at=(xe.x+1)*f,ae=K[de],pt=Math.min(fe,fe-(Ue-e[3]),C-Se),De=Math.min(f,f-(at-e[2]),_-it);for(let Fe=Math.max(0,e[1]-Se);Fe<pt;++Fe)for(let ht=Math.max(0,e[0]-it);ht<De;++ht){const Lt=(Fe*f+ht)*k,ut=ae.call(we,Lt+H[de],te);let ct;n?(ct=(Fe+Se-e[1])*P*t.length+(ht+it-e[0])*t.length+de,i[ct]=ut):(ct=(Fe+Se-e[1])*P+ht+it-e[0],i[de][ct]=ut)}})}if(await Promise.all(ie),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let ee;return n?ee=Tw(i,e[2]-e[0],e[3]-e[1],o,a,t.length,l):ee=ww(i,e[2]-e[0],e[3]-e[1],o,a,l),ee.width=o,ee.height=a,ee}return i.width=o||e[2]-e[0],i.height=a||e[3]-e[1],i}async readRasters({window:e,samples:t=[],interleave:i,pool:n=null,width:s,height:o,resampleMethod:a,fillValue:l,signal:u}={}){const f=e||[0,0,this.getWidth(),this.getHeight()];if(f[0]>f[2]||f[1]>f[3])throw new Error("Invalid subsets");const m=f[2]-f[0],_=f[3]-f[1],C=m*_,R=this.getSamplesPerPixel();if(!t||!t.length)for(let P=0;P<R;++P)t.push(P);else for(let P=0;P<t.length;++P)if(t[P]>=R)return Promise.reject(new RangeError(`Invalid sample index '${t[P]}'.`));let L;if(i){const P=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,k=Math.max.apply(null,this.fileDirectory.BitsPerSample);L=fh(P,k,C*t.length),l&&L.fill(l)}else{L=[];for(let P=0;P<t.length;++P){const k=this.getArrayForSample(t[P],C);Array.isArray(l)&&P<l.length?k.fill(l[P]):l&&!Array.isArray(l)&&k.fill(l),L.push(k)}}const A=n||await ep(this.fileDirectory);return await this._readRaster(f,t,L,i,A,s,o,a,u)}async readRGB({window:e,interleave:t=!0,pool:i=null,width:n,height:s,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const f=this.fileDirectory.PhotometricInterpretation;if(f===si.RGB){let S=[0,1,2];if(this.fileDirectory.ExtraSamples!==aw.Unspecified&&a){S=[];for(let P=0;P<this.fileDirectory.BitsPerSample.length;P+=1)S.push(P)}return this.readRasters({window:e,interleave:t,samples:S,pool:i,width:n,height:s,resampleMethod:o,signal:l})}let m;switch(f){case si.WhiteIsZero:case si.BlackIsZero:case si.Palette:m=[0];break;case si.CMYK:m=[0,1,2,3];break;case si.YCbCr:case si.CIELab:m=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const _={window:u,interleave:!0,samples:m,pool:i,width:n,height:s,resampleMethod:o,signal:l},{fileDirectory:C}=this,R=await this.readRasters(_),L=2**this.fileDirectory.BitsPerSample[0];let A;switch(f){case si.WhiteIsZero:A=hw(R,L);break;case si.BlackIsZero:A=cw(R,L);break;case si.Palette:A=uw(R,C.ColorMap);break;case si.CMYK:A=dw(R);break;case si.YCbCr:A=fw(R);break;case si.CIELab:A=bw(R);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const S=new Uint8Array(A.length/3),P=new Uint8Array(A.length/3),k=new Uint8Array(A.length/3);for(let H=0,K=0;H<A.length;H+=3,++K)S[K]=A[H],P[K]=A[H+1],k[K]=A[H+2];A=[S,P,k]}return A.width=R.width,A.height=R.height,A}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const i=this.fileDirectory.GDAL_METADATA;let n=xc.exports(i,"Item");e===null?n=n.filter(s=>Gr.exports(s,"sample")===void 0):n=n.filter(s=>Number(Gr.exports(s,"sample"))===e);for(let s=0;s<n.length;++s){const o=n[s];t[Gr.exports(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,i=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(i)return[i[0],i[5],i[10]];if(e){const[n,s,o]=e.getResolution();return[n*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const e=this.getOrigin(),t=this.getResolution(),i=e[0],n=e[1],s=i+t[0]*this.getWidth(),o=n+t[1]*this.getHeight();return[Math.min(i,s),Math.min(n,o),Math.max(i,s),Math.max(n,o)]}}const tp=Dw;class Aw{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const i=this.getUint32(e,t),n=this.getUint32(e+4,t);let s;if(t){if(s=i+2**32*n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*i+n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let i=0;const n=(this._dataView.getUint8(e+(t?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));n&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),i+=a*256**o}return n&&(i=-i),i}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return Xm(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class Mw{constructor(e,t,i,n){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=i,this._bigTiff=n}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),i=this.readUint32(e+4);let n;if(this._littleEndian){if(n=t+2**32*i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*t+i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}readInt64(e){let t=0;const i=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let n=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(this._littleEndian?s:7-s));i&&(n?o!==0&&(o=~(o-1)&255,n=!1):o=~o&255),t+=o*256**s}return i&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const Iw=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class Fw{constructor(e=Iw,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(i=>{Ln(()=>import("./decoder.f53bb359.js"),[]).then(n=>{i(n.create)})}),this._awaitingDecoder.then(i=>{this._awaitingDecoder=null,this.workers=[];for(let n=0;n<e;n++)this.workers.push({worker:i(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?ep(e).then(i=>i.decode(e,t)):new Promise(i=>{const n=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];n.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(n.idle=!0,i(a.data.decoded),n.worker.removeEventListener("message",o))};n.worker.addEventListener("message",o),n.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const Pw=Fw,jf=`\r
\r
`;function ip(r){if(typeof Object.fromEntries<"u")return Object.fromEntries(r);const e={};for(const[t,i]of r)e[t.toLowerCase()]=i;return e}function Ow(r){const e=r.split(`\r
`).map(t=>{const i=t.split(":").map(n=>n.trim());return i[0]=i[0].toLowerCase(),i});return ip(e)}function kw(r){const[e,...t]=r.split(";").map(n=>n.trim()),i=t.map(n=>n.split("="));return{type:e,params:ip(i)}}function gh(r){let e,t,i;return r&&([,e,t,i]=r.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),i=parseInt(i,10)),{start:e,end:t,total:i}}function Nw(r,e){let t=null;const i=new TextDecoder("ascii"),n=[],s=`--${e}`,o=`${s}--`;for(let a=0;a<10;++a)i.decode(new Uint8Array(r,a,s.length))===s&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<r.byteLength;){const a=i.decode(new Uint8Array(r,t,Math.min(s.length+1024,r.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const l=a.substr(s.length+2);if(l.length===0)break;const u=l.indexOf(jf),f=Ow(l.substr(0,u)),{start:m,end:_,total:C}=gh(f["content-range"]),R=t+s.length+u+jf.length,L=parseInt(_,10)+1-parseInt(m,10);n.push({headers:f,data:r.slice(R,R+L),offset:m,length:L,fileSize:C}),t=R+L+4}return n}class Dc{async fetch(e,t=void 0){return Promise.all(e.map(i=>this.fetchSlice(i,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}var Pl,Hf;function Gw(){return Hf||(Hf=1,Pl=function(r){r.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}),Pl}var zw=tt;tt.Node=hs;tt.create=tt;function tt(r){var e=this;if(e instanceof tt||(e=new tt),e.tail=null,e.head=null,e.length=0,r&&typeof r.forEach=="function")r.forEach(function(n){e.push(n)});else if(arguments.length>0)for(var t=0,i=arguments.length;t<i;t++)e.push(arguments[t]);return e}tt.prototype.removeNode=function(r){if(r.list!==this)throw new Error("removing node which does not belong to this list");var e=r.next,t=r.prev;return e&&(e.prev=t),t&&(t.next=e),r===this.head&&(this.head=e),r===this.tail&&(this.tail=t),r.list.length--,r.next=null,r.prev=null,r.list=null,e};tt.prototype.unshiftNode=function(r){if(r!==this.head){r.list&&r.list.removeNode(r);var e=this.head;r.list=this,r.next=e,e&&(e.prev=r),this.head=r,this.tail||(this.tail=r),this.length++}};tt.prototype.pushNode=function(r){if(r!==this.tail){r.list&&r.list.removeNode(r);var e=this.tail;r.list=this,r.prev=e,e&&(e.next=r),this.tail=r,this.head||(this.head=r),this.length++}};tt.prototype.push=function(){for(var r=0,e=arguments.length;r<e;r++)jw(this,arguments[r]);return this.length};tt.prototype.unshift=function(){for(var r=0,e=arguments.length;r<e;r++)Hw(this,arguments[r]);return this.length};tt.prototype.pop=function(){if(!!this.tail){var r=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,r}};tt.prototype.shift=function(){if(!!this.head){var r=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,r}};tt.prototype.forEach=function(r,e){e=e||this;for(var t=this.head,i=0;t!==null;i++)r.call(e,t.value,i,this),t=t.next};tt.prototype.forEachReverse=function(r,e){e=e||this;for(var t=this.tail,i=this.length-1;t!==null;i--)r.call(e,t.value,i,this),t=t.prev};tt.prototype.get=function(r){for(var e=0,t=this.head;t!==null&&e<r;e++)t=t.next;if(e===r&&t!==null)return t.value};tt.prototype.getReverse=function(r){for(var e=0,t=this.tail;t!==null&&e<r;e++)t=t.prev;if(e===r&&t!==null)return t.value};tt.prototype.map=function(r,e){e=e||this;for(var t=new tt,i=this.head;i!==null;)t.push(r.call(e,i.value,this)),i=i.next;return t};tt.prototype.mapReverse=function(r,e){e=e||this;for(var t=new tt,i=this.tail;i!==null;)t.push(r.call(e,i.value,this)),i=i.prev;return t};tt.prototype.reduce=function(r,e){var t,i=this.head;if(arguments.length>1)t=e;else if(this.head)i=this.head.next,t=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=0;i!==null;n++)t=r(t,i.value,n),i=i.next;return t};tt.prototype.reduceReverse=function(r,e){var t,i=this.tail;if(arguments.length>1)t=e;else if(this.tail)i=this.tail.prev,t=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=this.length-1;i!==null;n--)t=r(t,i.value,n),i=i.prev;return t};tt.prototype.toArray=function(){for(var r=new Array(this.length),e=0,t=this.head;t!==null;e++)r[e]=t.value,t=t.next;return r};tt.prototype.toArrayReverse=function(){for(var r=new Array(this.length),e=0,t=this.tail;t!==null;e++)r[e]=t.value,t=t.prev;return r};tt.prototype.slice=function(r,e){e=e||this.length,e<0&&(e+=this.length),r=r||0,r<0&&(r+=this.length);var t=new tt;if(e<r||e<0)return t;r<0&&(r=0),e>this.length&&(e=this.length);for(var i=0,n=this.head;n!==null&&i<r;i++)n=n.next;for(;n!==null&&i<e;i++,n=n.next)t.push(n.value);return t};tt.prototype.sliceReverse=function(r,e){e=e||this.length,e<0&&(e+=this.length),r=r||0,r<0&&(r+=this.length);var t=new tt;if(e<r||e<0)return t;r<0&&(r=0),e>this.length&&(e=this.length);for(var i=this.length,n=this.tail;n!==null&&i>e;i--)n=n.prev;for(;n!==null&&i>r;i--,n=n.prev)t.push(n.value);return t};tt.prototype.splice=function(r,e,...t){r>this.length&&(r=this.length-1),r<0&&(r=this.length+r);for(var i=0,n=this.head;n!==null&&i<r;i++)n=n.next;for(var s=[],i=0;n&&i<e;i++)s.push(n.value),n=this.removeNode(n);n===null&&(n=this.tail),n!==this.head&&n!==this.tail&&(n=n.prev);for(var i=0;i<t.length;i++)n=Bw(this,n,t[i]);return s};tt.prototype.reverse=function(){for(var r=this.head,e=this.tail,t=r;t!==null;t=t.prev){var i=t.prev;t.prev=t.next,t.next=i}return this.head=e,this.tail=r,this};function Bw(r,e,t){var i=e===r.head?new hs(t,null,e,r):new hs(t,e,e.next,r);return i.next===null&&(r.tail=i),i.prev===null&&(r.head=i),r.length++,i}function jw(r,e){r.tail=new hs(e,r.tail,null,r),r.head||(r.head=r.tail),r.length++}function Hw(r,e){r.head=new hs(e,null,r.head,r),r.tail||(r.tail=r.head),r.length++}function hs(r,e,t,i){if(!(this instanceof hs))return new hs(r,e,t,i);this.list=i,this.value=r,e?(e.next=this,this.prev=e):this.prev=null,t?(t.prev=this,this.next=t):this.next=null}try{Gw()(tt)}catch{}const Uw=zw,$n=Symbol("max"),Ji=Symbol("length"),As=Symbol("lengthCalculator"),Br=Symbol("allowStale"),es=Symbol("maxAge"),$i=Symbol("dispose"),Uf=Symbol("noDisposeOnSet"),At=Symbol("lruList"),Ti=Symbol("cache"),np=Symbol("updateAgeOnGet"),Ol=()=>1;class Vw{constructor(e){if(typeof e=="number"&&(e={max:e}),e||(e={}),e.max&&(typeof e.max!="number"||e.max<0))throw new TypeError("max must be a non-negative number");this[$n]=e.max||1/0;const t=e.length||Ol;if(this[As]=typeof t!="function"?Ol:t,this[Br]=e.stale||!1,e.maxAge&&typeof e.maxAge!="number")throw new TypeError("maxAge must be a number");this[es]=e.maxAge||0,this[$i]=e.dispose,this[Uf]=e.noDisposeOnSet||!1,this[np]=e.updateAgeOnGet||!1,this.reset()}set max(e){if(typeof e!="number"||e<0)throw new TypeError("max must be a non-negative number");this[$n]=e||1/0,Ar(this)}get max(){return this[$n]}set allowStale(e){this[Br]=!!e}get allowStale(){return this[Br]}set maxAge(e){if(typeof e!="number")throw new TypeError("maxAge must be a non-negative number");this[es]=e,Ar(this)}get maxAge(){return this[es]}set lengthCalculator(e){typeof e!="function"&&(e=Ol),e!==this[As]&&(this[As]=e,this[Ji]=0,this[At].forEach(t=>{t.length=this[As](t.value,t.key),this[Ji]+=t.length})),Ar(this)}get lengthCalculator(){return this[As]}get length(){return this[Ji]}get itemCount(){return this[At].length}rforEach(e,t){t=t||this;for(let i=this[At].tail;i!==null;){const n=i.prev;Vf(this,e,i,t),i=n}}forEach(e,t){t=t||this;for(let i=this[At].head;i!==null;){const n=i.next;Vf(this,e,i,t),i=n}}keys(){return this[At].toArray().map(e=>e.key)}values(){return this[At].toArray().map(e=>e.value)}reset(){this[$i]&&this[At]&&this[At].length&&this[At].forEach(e=>this[$i](e.key,e.value)),this[Ti]=new Map,this[At]=new Uw,this[Ji]=0}dump(){return this[At].map(e=>Ia(this,e)?!1:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[At]}set(e,t,i){if(i=i||this[es],i&&typeof i!="number")throw new TypeError("maxAge must be a number");const n=i?Date.now():0,s=this[As](t,e);if(this[Ti].has(e)){if(s>this[$n])return Ks(this,this[Ti].get(e)),!1;const l=this[Ti].get(e).value;return this[$i]&&(this[Uf]||this[$i](e,l.value)),l.now=n,l.maxAge=i,l.value=t,this[Ji]+=s-l.length,l.length=s,this.get(e),Ar(this),!0}const o=new Ww(e,t,s,n,i);return o.length>this[$n]?(this[$i]&&this[$i](e,t),!1):(this[Ji]+=o.length,this[At].unshift(o),this[Ti].set(e,this[At].head),Ar(this),!0)}has(e){if(!this[Ti].has(e))return!1;const t=this[Ti].get(e).value;return!Ia(this,t)}get(e){return kl(this,e,!0)}peek(e){return kl(this,e,!1)}pop(){const e=this[At].tail;return e?(Ks(this,e),e.value):null}del(e){Ks(this,this[Ti].get(e))}load(e){this.reset();const t=Date.now();for(let i=e.length-1;i>=0;i--){const n=e[i],s=n.e||0;if(s===0)this.set(n.k,n.v);else{const o=s-t;o>0&&this.set(n.k,n.v,o)}}}prune(){this[Ti].forEach((e,t)=>kl(this,t,!1))}}const kl=(r,e,t)=>{const i=r[Ti].get(e);if(i){const n=i.value;if(Ia(r,n)){if(Ks(r,i),!r[Br])return}else t&&(r[np]&&(i.value.now=Date.now()),r[At].unshiftNode(i));return n.value}},Ia=(r,e)=>{if(!e||!e.maxAge&&!r[es])return!1;const t=Date.now()-e.now;return e.maxAge?t>e.maxAge:r[es]&&t>r[es]},Ar=r=>{if(r[Ji]>r[$n])for(let e=r[At].tail;r[Ji]>r[$n]&&e!==null;){const t=e.prev;Ks(r,e),e=t}},Ks=(r,e)=>{if(e){const t=e.value;r[$i]&&r[$i](t.key,t.value),r[Ji]-=t.length,r[Ti].delete(t.key),r[At].removeNode(e)}};class Ww{constructor(e,t,i,n,s){this.key=e,this.value=t,this.length=i,this.now=n,this.maxAge=s||0}}const Vf=(r,e,t,i)=>{let n=t.value;Ia(r,n)&&(Ks(r,t),r[Br]||(n=void 0)),n&&e.call(i,n.value,n.key,r)};var Xw=Vw;async function Yw(r){return new Promise(e=>setTimeout(e,r))}function Wf(r,e){const t=Array.isArray(r)?r:Array.from(r),i=Array.isArray(e)?e:Array.from(e);return t.map((n,s)=>[n,i[s]])}class tr extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,tr),this.name="AbortError"}}class Kw extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const $w=Kw;class Zw{constructor(e,t,i=null){this.offset=e,this.length=t,this.data=i}get top(){return this.offset+this.length}}class Xf{constructor(e,t,i){this.offset=e,this.length=t,this.blockIds=i}}class qw extends Dc{constructor(e,{blockSize:t=65536,cacheSize:i=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new Xw({max:i}),this.blockRequests=new Map,this.blockIdsToFetch=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const i=new Map,n=new Map,s=new Set;for(const{offset:u,length:f}of e){let m=u+f;const{fileSize:_}=this;_!==null&&(m=Math.min(m,_));const C=Math.floor(u/this.blockSize)*this.blockSize;for(let R=C;R<m;R+=this.blockSize){const L=Math.floor(R/this.blockSize);this.blockCache.has(L)?i.set(L,this.blockCache.get(L)):this.blockRequests.has(L)?n.set(L,this.blockRequests.get(L)):(this.blockIdsToFetch.has(L)||this.blockIdsToFetch.add(L),s.add(L))}}await Yw(),this.fetchBlocks(t);for(const u of s){const f=this.blockRequests.get(u),m=this.blockCache.get(u);if(f)n.set(u,f);else if(m)i.set(u,m);else throw new Error(`Block ${u} is not in the block requests`)}let o=await Promise.allSettled(Array.from(n.values()));if(o.some(u=>u.status==="rejected")){const u=new Set;for(const[f,m]of Wf(n.keys(),o)){const{rejected:_,reason:C}=m;_&&C.name==="AbortError"&&C.signal!==t&&(this.blockIdsToFetch.add(f),u.add(f))}if(this.blockIdsToFetch.length>0){this.fetchBlocks(t);for(const f of u){const m=this.blockRequests.get(f);if(!m)throw new Error(`Block ${f} is not in the block requests`);n.set(f,m)}o=await Promise.allSettled(Array.from(n.values()))}}if(o.some(u=>u.status==="rejected"))throw t&&t.aborted?new tr("Request was aborted"):new $w(o.filter(u=>u.status==="rejected").map(u=>u.reason),"Request failed");const a=o.map(u=>u.value),l=new Map(Wf(Array.from(n.keys()),a));for(const[u,f]of i)l.set(u,f);return this.readSliceData(e,l)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),i=this.source.fetch(t,e);for(let n=0;n<t.length;++n){const s=t[n];for(const o of s.blockIds){const a=(async()=>{try{const l=(await i)[n],u=o*this.blockSize,f=u-l.offset,m=Math.min(f+this.blockSize,l.data.byteLength),_=l.data.slice(f,m),C=new Zw(u,_.byteLength,_);return this.blockCache.set(o,C),C}catch(l){throw l.name==="AbortError"&&(l.signal=e),l}finally{this.blockRequests.delete(o)}})();this.blockRequests.set(o,a)}}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let i=[],n=null;const s=[];for(const o of t)n===null||n+1===o?(i.push(o),n=o):(s.push(new Xf(i[0]*this.blockSize,i.length*this.blockSize,i)),i=[o],n=o);return s.push(new Xf(i[0]*this.blockSize,i.length*this.blockSize,i)),s}readSliceData(e,t){return e.map(i=>{const n=i.offset+i.length,s=Math.floor(i.offset/this.blockSize),o=Math.floor((i.offset+i.length)/this.blockSize),a=new ArrayBuffer(i.length),l=new Uint8Array(a);for(let u=s;u<=o;++u){const f=t.get(u),m=f.offset-i.offset,_=f.top-n;let C=0,R=0,L;m<0?C=-m:m>0&&(R=m),_<0?L=f.length-C:L=n-f.offset-C;const A=new Uint8Array(f.data,C,L);l.set(A,R)}return a})}}class Ac{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Mc{constructor(e){this.url=e}async request({headers:e,credentials:t,signal:i}={}){throw new Error("request is not implemented")}}class Jw extends Ac{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class Qw extends Mc{constructor(e,t){super(e),this.credentials=t}async request({headers:e,credentials:t,signal:i}={}){const n=await fetch(this.url,{headers:e,credentials:t,signal:i});return new Jw(n)}}class eC extends Ac{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class tC extends Mc{constructRequest(e,t){return new Promise((i,n)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(e))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;i(new eC(s,o))},s.onerror=n,s.onabort=()=>n(new tr("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const Nl={};class iC extends Ac{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class nC extends Mc{constructor(e){super(e),this.parsedUrl=Nl.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Nl)}constructRequest(e,t){return new Promise((i,n)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const u=[];o.on("data",f=>{u.push(f)}),o.on("end",()=>{const f=Buffer.concat(u).buffer;l(f)}),o.on("error",n)});i(new iC(o,a))});s.on("error",n),t&&(t.aborted&&s.destroy(new tr("Request aborted")),t.addEventListener("abort",()=>s.destroy(new tr("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class Ic extends Dc{constructor(e,t,i,n){super(),this.client=e,this.headers=t,this.maxRanges=i,this.allowFullFile=n,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(i=>this.fetchSlice(i,t))))}async fetchSlices(e,t){const i=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:n,length:s})=>`${n}-${n+s}`).join(",")}`},signal:t});if(i.ok)if(i.status===206){const{type:n,params:s}=kw(i.getHeader("content-type"));if(n==="multipart/byteranges"){const m=Nw(await i.getData(),s.boundary);return this._fileSize=m[0].fileSize||null,m}const o=await i.getData(),{start:a,end:l,total:u}=gh(i.getHeader("content-range"));this._fileSize=u||null;const f=[{data:o,offset:a,length:l-a}];if(e.length>1){const m=await Promise.all(e.slice(1).map(_=>this.fetchSlice(_,t)));return f.concat(m)}return f}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const n=await i.getData();return this._fileSize=n.byteLength,[{data:n,offset:0,length:n.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:i,length:n}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${i}-${i+n}`},signal:t});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=gh(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:i,length:n}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Fc(r,{blockSize:e,cacheSize:t}){return e===null?r:new qw(r,e,t)}function sC(r,{headers:e={},credentials:t,maxRanges:i=0,allowFullFile:n=!1,...s}={}){const o=new Qw(r,t),a=new Ic(o,e,i,n);return Fc(a,s)}function rC(r,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...n}={}){const s=new tC(r),o=new Ic(s,e,t,i);return Fc(o,n)}function oC(r,{headers:e={},maxRanges:t=0,allowFullFile:i=!1,...n}={}){const s=new nC(r),o=new Ic(s,e,t,i);return Fc(o,n)}function mh(r,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?sC(r,t):typeof XMLHttpRequest<"u"?rC(r,t):oC(r,t)}class aC extends Dc{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((i,n)=>{const s=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>i(a.target.result),o.onerror=n,o.onabort=n,o.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>o.abort())})}}function lC(r){return new aC(r)}function ph(r){switch(r){case ke.BYTE:case ke.ASCII:case ke.SBYTE:case ke.UNDEFINED:return 1;case ke.SHORT:case ke.SSHORT:return 2;case ke.LONG:case ke.SLONG:case ke.FLOAT:case ke.IFD:return 4;case ke.RATIONAL:case ke.SRATIONAL:case ke.DOUBLE:case ke.LONG8:case ke.SLONG8:case ke.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function hC(r){const e=r.GeoKeyDirectory;if(!e)return null;const t={};for(let i=4;i<=e[3]*4;i+=4){const n=lw[e[i]],s=e[i+1]?zr[e[i+1]]:null,o=e[i+2],a=e[i+3];let l=null;if(!s)l=a;else{if(l=r[s],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${n}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[n]=l}return t}function Ms(r,e,t,i){let n=null,s=null;const o=ph(e);switch(e){case ke.BYTE:case ke.ASCII:case ke.UNDEFINED:n=new Uint8Array(t),s=r.readUint8;break;case ke.SBYTE:n=new Int8Array(t),s=r.readInt8;break;case ke.SHORT:n=new Uint16Array(t),s=r.readUint16;break;case ke.SSHORT:n=new Int16Array(t),s=r.readInt16;break;case ke.LONG:case ke.IFD:n=new Uint32Array(t),s=r.readUint32;break;case ke.SLONG:n=new Int32Array(t),s=r.readInt32;break;case ke.LONG8:case ke.IFD8:n=new Array(t),s=r.readUint64;break;case ke.SLONG8:n=new Array(t),s=r.readInt64;break;case ke.RATIONAL:n=new Uint32Array(t*2),s=r.readUint32;break;case ke.SRATIONAL:n=new Int32Array(t*2),s=r.readInt32;break;case ke.FLOAT:n=new Float32Array(t),s=r.readFloat32;break;case ke.DOUBLE:n=new Float64Array(t),s=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===ke.RATIONAL||e===ke.SRATIONAL)for(let a=0;a<t;a+=2)n[a]=s.call(r,i+a*o),n[a+1]=s.call(r,i+(a*o+4));else for(let a=0;a<t;++a)n[a]=s.call(r,i+a*o);return e===ke.ASCII?new TextDecoder("utf-8").decode(n):n}class cC{constructor(e,t,i){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=i}}class Jo extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class sp{async readRasters(e={}){const{window:t,width:i,height:n}=e;let{resX:s,resY:o,bbox:a}=e;const l=await this.getImage();let u=l;const f=await this.getImageCount(),m=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(i||n){if(t){const[R,L]=l.getOrigin(),[A,S]=l.getResolution();a=[R+t[0]*A,L+t[1]*S,R+t[2]*A,L+t[3]*S]}const C=a||m;if(i){if(s)throw new Error("Both width and resX passed");s=(C[2]-C[0])/i}if(n){if(o)throw new Error("Both width and resY passed");o=(C[3]-C[1])/n}}if(s||o){const C=[];for(let R=0;R<f;++R){const L=await this.getImage(R),{SubfileType:A,NewSubfileType:S}=L.fileDirectory;(R===0||A===2||S&1)&&C.push(L)}C.sort((R,L)=>R.getWidth()-L.getWidth());for(let R=0;R<C.length;++R){const L=C[R],A=(m[2]-m[0])/L.getWidth(),S=(m[3]-m[1])/L.getHeight();if(u=L,s&&s>A||o&&o>S)break}}let _=t;if(a){const[C,R]=l.getOrigin(),[L,A]=u.getResolution(l);_=[Math.round((a[0]-C)/L),Math.round((a[1]-R)/A),Math.round((a[2]-C)/L),Math.round((a[3]-R)/A)],_=[Math.min(_[0],_[2]),Math.min(_[1],_[3]),Math.max(_[0],_[2]),Math.max(_[1],_[3])]}return u.readRasters({...e,window:_})}}class ir extends sp{constructor(e,t,i,n,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=i,this.firstIFDOffset=n,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const i=this.bigTiff?4048:1024;return new Mw((await this.source.fetch([{offset:e,length:typeof t<"u"?t:i}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,i=this.bigTiff?8:2;let n=await this.getSlice(e);const s=this.bigTiff?n.readUint64(e):n.readUint16(e),o=s*t+(this.bigTiff?16:6);n.covers(e,o)||(n=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let m=0;m<s;l+=t,++m){const _=n.readUint16(l),C=n.readUint16(l+2),R=this.bigTiff?n.readUint64(l+4):n.readUint32(l+4);let L,A;const S=ph(C),P=l+(this.bigTiff?12:8);if(S*R<=(this.bigTiff?8:4))L=Ms(n,C,R,P);else{const k=n.readOffset(P),H=ph(C)*R;if(n.covers(k,H))L=Ms(n,C,R,k);else{const K=await this.getSlice(k,H);L=Ms(K,C,R,k)}}R===1&&ow.indexOf(_)===-1&&!(C===ke.RATIONAL||C===ke.SRATIONAL)?A=L[0]:A=L,a[zr[_]]=A}const u=hC(a),f=n.readOffset(e+i+t*s);return new cC(a,u,f)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof Jo?new Jo(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new Jo(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new tp(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(i){if(i instanceof Jo)t=!1;else throw i}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",i=t.length+100;let n=await this.getSlice(e,i);if(t===Ms(n,ke.ASCII,t.length,e)){const o=Ms(n,ke.ASCII,i,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>i&&(n=await this.getSlice(e,a));const l=Ms(n,ke.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(u=>u.length>0).map(u=>u.split("=")).forEach(([u,f])=>{this.ghostValues[u]=f})}return this.ghostValues}static async fromSource(e,t,i){const n=(await e.fetch([{offset:0,length:1024}],i))[0],s=new Aw(n),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=s.getUint16(2,a);let u;if(l===42)u=!1;else if(l===43){if(u=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const f=u?s.getUint64(8,a):s.getUint32(4,a);return new ir(e,a,u,f,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class uC extends sp{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,i=0;for(let n=0;n<this.imageFiles.length;n++){const s=this.imageFiles[n];for(let o=0;o<this.imageCounts[n];o++){if(e===t){const a=await s.requestIFD(i);return new tp(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,i++}i=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,i)=>t+i,0),this.imageCount}}async function dC(r,e={},t){return ir.fromSource(mh(r,e),t)}async function fC(r,e){return ir.fromSource(lC(r),e)}async function gC(r,e=[],t={},i){const n=await ir.fromSource(mh(r,t),i),s=await Promise.all(e.map(o=>ir.fromSource(mh(o,t))));return new uC(n,s)}function mC(r){return((r.fileDirectory.NewSubfileType||0)&4)===4}function pC(r,e){if(!r)return!1;if(r===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,i=si;return t===i.CMYK||t===i.YCbCr||t===i.CIELab||t===i.ICCLab}const Yf="STATISTICS_MAXIMUM",Kf="STATISTICS_MINIMUM";let Gl;function bC(){return Gl||(Gl=new Pw),Gl}function _C(r){try{return r.getBoundingBox()}catch{const t=r.fileDirectory;return[0,0,t.ImageWidth,t.ImageLength]}}function yC(r){try{return r.getOrigin().slice(0,2)}catch{return[0,r.fileDirectory.ImageLength]}}function vC(r,e){try{return r.getResolution(e)}catch{return[e.fileDirectory.ImageWidth/r.fileDirectory.ImageWidth,e.fileDirectory.ImageHeight/r.fileDirectory.ImageHeight]}}function EC(r){const e=r.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let i=li(t);if(!i){const n=Wd(e.ProjLinearUnitsGeoKey);n&&(i=new ca({code:t,units:n}))}return i}if(e.GeographicTypeGeoKey){const t="EPSG:"+e.GeographicTypeGeoKey;let i=li(t);if(!i){const n=Wd(e.GeogAngularUnitsGeoKey);n&&(i=new ca({code:t,units:n}))}return i}return null}function wC(r){return r.getImageCount().then(function(e){const t=new Array(e);for(let i=0;i<e;++i)t[i]=r.getImage(i);return Promise.all(t)})}function CC(r,e){let t;return r.blob?t=fC(r.blob):r.overviews?t=gC(r.url,r.overviews,e):t=dC(r.url,e),t.then(wC)}function Pr(r,e,t,i,n){if(Array.isArray(r)){const s=r.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(i);throw n(o),o}for(let o=0;o<s;++o)Pr(r[o],e[o],t,i,n);return}if(e=e,Math.abs(r-e)>t*r)throw new Error(i)}function xC(r){return r instanceof Int8Array?-128:r instanceof Int16Array?-32768:r instanceof Int32Array?-2147483648:r instanceof Float32Array?12e-39:0}function TC(r){return r instanceof Int8Array?127:r instanceof Uint8Array||r instanceof Uint8ClampedArray?255:r instanceof Int16Array?32767:r instanceof Uint16Array?65535:r instanceof Int32Array?2147483647:r instanceof Uint32Array?4294967295:r instanceof Float32Array?34e37:255}class rp extends PE{constructor(e){super({state:"loading",tileGrid:null,projection:null,opaque:e.opaque,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const i=this,n=new Array(t);for(let s=0;s<t;++s)n[s]=CC(this.sourceInfo_[s],this.sourceOptions_);Promise.all(n).then(function(s){i.configure_(s)}).catch(function(s){console.error(s),i.error_=s,i.setState("error")})}getError(){return this.error_}configure_(e){let t,i,n,s,o;const a=new Array(e.length),l=new Array(e.length),u=new Array(e.length);let f=0;const m=e.length;for(let L=0;L<m;++L){const A=[],S=[];e[L].forEach(ee=>{mC(ee)?S.push(ee):A.push(ee)});const P=A.length;if(S.length>0&&S.length!==P)throw new Error(`Expected one mask per image found ${S.length} masks and ${P} images`);let k,H;const K=new Array(P),ie=new Array(P),te=new Array(P);l[L]=new Array(P),u[L]=new Array(P);for(let ee=0;ee<P;++ee){const ne=A[ee],ue=ne.getGDALNoData();u[L][ee]=ne.getGDALMetadata(0),l[L][ee]=ue;const de=this.sourceInfo_[L].bands;a[L]=de?de.length:ne.getSamplesPerPixel();const oe=P-(ee+1);k||(k=_C(ne)),H||(H=yC(ne));const ye=vC(ne,A[0]);te[oe]=ye[0];const xe=[ne.getTileWidth(),ne.getTileHeight()];K[oe]=xe;const pe=ye[0]/Math.abs(ye[1]);ie[oe]=[xe[0],xe[1]/pe]}if(t?Li(t,k,t):t=k,!i)i=H;else{const ee=`Origin mismatch for source ${L}, got [${H}] but expected [${i}]`;Pr(i,H,0,ee,this.viewRejector)}if(!o)o=te,this.resolutionFactors_[L]=1;else{o.length-f>te.length&&(f=o.length-te.length);const ee=o[o.length-1]/te[te.length-1];this.resolutionFactors_[L]=ee;const ne=te.map(de=>de*=ee),ue=`Resolution mismatch for source ${L}, got [${ne}] but expected [${o}]`;Pr(o.slice(f,o.length),ne,.02,ue,this.viewRejector)}n?Pr(n.slice(f,n.length),ie,.01,`Tile size mismatch for source ${L}`,this.viewRejector):n=ie,s?Pr(s.slice(f,s.length),K,0,`Tile size mismatch for source ${L}`,this.viewRejector):s=K,this.sourceImagery_[L]=A.reverse(),this.sourceMasks_[L]=S.reverse()}for(let L=0,A=this.sourceImagery_.length;L<A;++L){const S=this.sourceImagery_[L];for(;S.length<o.length;)S.unshift(void 0)}if(!this.getProjection()){const L=e[0];for(let A=L.length-1;A>=0;--A){const S=L[A],P=EC(S);if(P){this.projection=P;break}}}this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=u;e:for(let L=0;L<m;++L){if(this.sourceInfo_[L].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[L].length){this.addAlpha_=!0;break}const A=l[L],S=this.sourceInfo_[L].bands;if(S){for(let P=0;P<S.length;++P)if(A[S[P]-1]!==null){this.addAlpha_=!0;break e}continue}for(let P=0;P<A.length;++P)if(A[P]!==null){this.addAlpha_=!0;break e}}let _=this.addAlpha_?1:0;for(let L=0;L<m;++L)_+=a[L];this.bandCount=_;const C=new cc({extent:t,minZoom:f,origin:i,resolutions:o,tileSizes:n});this.tileGrid=C,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");let R=0;o.length===1&&(o=[o[0]*2,o[0]],R=1),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:ls(rn(t),this.projection),extent:za(t,this.projection),zoom:R})}loadTile_(e,t,i){const n=this.getTileSize(e),s=this.sourceImagery_.length,o=new Array(s*2),a=this.nodataValues_,l=this.sourceInfo_,u=bC();for(let f=0;f<s;++f){const m=l[f],_=this.resolutionFactors_[f],C=[Math.round(t*(n[0]*_)),Math.round(i*(n[1]*_)),Math.round((t+1)*(n[0]*_)),Math.round((i+1)*(n[1]*_))],R=this.sourceImagery_[f][e];let L;m.bands&&(L=m.bands.map(function(H){return H-1}));let A;"nodata"in m&&m.nodata!==null?A=m.nodata:L?A=L.map(function(H){return a[f][H]}):A=a[f];const S={window:C,width:n[0],height:n[1],samples:L,fillValue:A,pool:u,interleave:!1};pC(this.convertToRGB_,R)?o[f]=R.readRGB(S):o[f]=R.readRasters(S);const P=s+f,k=this.sourceMasks_[f][e];if(!k){o[P]=Promise.resolve(null);continue}o[P]=k.readRasters({window:C,width:n[0],height:n[1],samples:[0],pool:u,interleave:!1})}return Promise.all(o).then(this.composeTile_.bind(this,n)).catch(function(f){throw console.error(f),f})}composeTile_(e,t){const i=this.metadata_,n=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,u=this.normalize_,f=this.addAlpha_,m=e[0]*e[1],_=m*o;let C;u?C=new Uint8Array(_):C=new Float32Array(_);let R=0;for(let L=0;L<m;++L){let A=f;for(let S=0;S<s;++S){const P=n[S];let k=P.min,H=P.max,K,ie;if(u){const te=i[S][0];k===void 0&&(te&&Kf in te?k=parseFloat(te[Kf]):k=xC(t[S][0])),H===void 0&&(te&&Yf in te?H=parseFloat(te[Yf]):H=TC(t[S][0])),K=255/(H-k),ie=-k*K}for(let te=0;te<a[S];++te){const ee=t[S][te][L];let ne;if(u?ne=wt(K*ee+ie,0,255):ne=ee,!f)C[R]=ne;else{let ue=P.nodata;if(ue===void 0){let oe;P.bands?oe=P.bands[te]-1:oe=te,ue=l[S][oe]}const de=isNaN(ue);(!de&&ee!==ue||de&&!isNaN(ee))&&(A=!1,C[R]=ne)}R++}if(!A){const te=s+S,ee=t[te];ee&&!ee[0][L]&&(A=!0)}}f&&(A||(C[R]=255),R++)}return C}}rp.prototype.getView;const RC=rp;class SC extends zg{constructor(e,t,i,n,s,o,a){const l=e.getExtent(),u=t.getExtent(),f=u?Li(i,u):i,m=rn(f),_=hh(e,t,m,n),C=rm,R=new om(e,t,f,l,_*C,n),L=R.calculateSourceExtent(),A=o(L,_,s),S=A?Ne.IDLE:Ne.EMPTY,P=A?A.getPixelRatio():1;super(i,n,P,S),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=R,this.targetResolution_=n,this.targetExtent_=i,this.sourceImage_=A,this.sourcePixelRatio_=P,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==Ne.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==Ne.LOADED){const t=ot(this.targetExtent_)/this.targetResolution_,i=jt(this.targetExtent_)/this.targetResolution_;this.canvas_=lm(t,i,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=e,this.changed()}load(){if(this.state==Ne.IDLE){this.state=Ne.LOADING,this.changed();const e=this.sourceImage_.getState();e==Ne.LOADED||e==Ne.ERROR?this.reproject_():(this.sourceListenerKey_=ze(this.sourceImage_,Te.CHANGE,function(t){const i=this.sourceImage_.getState();(i==Ne.LOADED||i==Ne.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){lt(this.sourceListenerKey_),this.sourceListenerKey_=null}}const LC=SC,zl={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class DC extends Ei{constructor(e,t){super(e),this.image=t}}class AC extends Qh{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0}getResolutions(){return this.resolutions_}findNearestResolution(e){if(this.resolutions_){const t=Pa(this.resolutions_,e,0);e=this.resolutions_[t]}return e}getImage(e,t,i,n){const s=this.getProjection();if(!s||!n||pn(s,n))return s&&(n=s),this.getImageInternal(e,t,i,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&pn(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==t&&Js(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new LC(s,n,e,t,i,function(o,a,l){return this.getImageInternal(o,a,l,s)}.bind(this),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,n){return Ze()}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case Ne.LOADING:this.loading=!0,i=zl.IMAGELOADSTART;break;case Ne.LOADED:this.loading=!1,i=zl.IMAGELOADEND;break;case Ne.ERROR:this.loading=!1,i=zl.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new DC(i,t))}}function MC(r,e){r.getImage().src=e}const IC=AC;class FC extends IC{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,i=e.imageLoadFunction!==void 0?e.imageLoadFunction:MC;super({attributions:e.attributions,interpolate:e.interpolate,projection:li(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image_=new z_(this.imageExtent_,void 0,1,this.url_,t,i),this.imageSize_=e.imageSize?e.imageSize:null,this.image_.addEventListener(Te.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,i,n){return Nt(e,this.image_.getExtent())?this.image_:null}getUrl(){return this.url_}handleImageChange(e){if(this.image_.getState()==Ne.LOADED){const t=this.image_.getExtent(),i=this.image_.getImage();let n,s;this.imageSize_?(n=this.imageSize_[0],s=this.imageSize_[1]):(n=i.width,s=i.height);const o=ot(t),a=jt(t),l=o/n,u=a/s;let f=n,m=s;if(l>u?f=Math.round(o/u):m=Math.round(a/l),f!==n||m!==s){const _=hi(f,m);this.getInterpolate()||(_.imageSmoothingEnabled=!1);const C=_.canvas;_.drawImage(i,0,0,n,s,0,0,C.width,C.height),this.image_.setImage(C)}}super.handleImageChange(e)}}const PC=FC,OC='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class kC extends IE{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[OC];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",n=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:n,wrapX:e.wrapX,zDirection:e.zDirection})}}const NC=kC;var op={exports:{}};const GC=rc(_0),zC=rc(ob),BC=rc(zy);(function(r,e){(function(t,i){r.exports=i(GC,zC,BC)})(ah,function(t,i,n){t="default"in t?t.default:t,n="default"in n?n.default:n;const s="layer-switcher-";class o extends t{constructor(l){const u=Object.assign({},l),f=document.createElement("div");super({element:f,target:u.target}),this.activationMode=u.activationMode||"mouseover",this.startActive=u.startActive===!0,this.label=u.label!==void 0?u.label:"",this.collapseLabel=u.collapseLabel!==void 0?u.collapseLabel:"\xBB",this.tipLabel=u.tipLabel?u.tipLabel:"Legend",this.collapseTipLabel=u.collapseTipLabel?u.collapseTipLabel:"Collapse legend",this.groupSelectStyle=o.getGroupSelectStyle(u.groupSelectStyle),this.reverse=u.reverse!==!1,this.mapListeners=[],this.hiddenClassName="ol-unselectable ol-control layer-switcher",o.isTouchDevice_()&&(this.hiddenClassName+=" touch"),this.shownClassName="shown",f.className=this.hiddenClassName,this.button=document.createElement("button"),f.appendChild(this.button),this.panel=document.createElement("div"),this.panel.className="panel",f.appendChild(this.panel),o.enableTouchScroll_(this.panel),f.classList.add(s+"group-select-style-"+this.groupSelectStyle),f.classList.add(s+"activation-mode-"+this.activationMode),this.activationMode==="click"?(f.classList.add("activationModeClick"),this.button.onclick=m=>{const _=m||window.event;this.element.classList.contains(this.shownClassName)?this.hidePanel():this.showPanel(),_.preventDefault()}):(this.button.onmouseover=()=>{this.showPanel()},this.button.onclick=m=>{const _=m||window.event;this.showPanel(),_.preventDefault()},this.panel.onmouseout=m=>{this.panel.contains(m.relatedTarget)||this.hidePanel()}),this.updateButton()}setMap(l){for(let u=0;u<this.mapListeners.length;u++)i.unByKey(this.mapListeners[u]);this.mapListeners.length=0,super.setMap(l),l&&(this.startActive?this.showPanel():this.renderPanel(),this.activationMode!=="click"&&this.mapListeners.push(l.on("pointerdown",()=>{this.hidePanel()})))}showPanel(){this.element.classList.contains(this.shownClassName)||(this.element.classList.add(this.shownClassName),this.updateButton(),this.renderPanel()),this.dispatchEvent("show")}hidePanel(){this.element.classList.contains(this.shownClassName)&&(this.element.classList.remove(this.shownClassName),this.updateButton()),this.dispatchEvent("hide")}updateButton(){this.element.classList.contains(this.shownClassName)?(this.button.textContent=this.collapseLabel,this.button.setAttribute("title",this.collapseTipLabel),this.button.setAttribute("aria-label",this.collapseTipLabel)):(this.button.textContent=this.label,this.button.setAttribute("title",this.tipLabel),this.button.setAttribute("aria-label",this.tipLabel))}renderPanel(){this.dispatchEvent("render"),o.renderPanel(this.getMap(),this.panel,{groupSelectStyle:this.groupSelectStyle,reverse:this.reverse}),this.dispatchEvent("rendercomplete")}static renderPanel(l,u,f){const m=new Event("render");for(u.dispatchEvent(m),f=f||{},f.groupSelectStyle=o.getGroupSelectStyle(f.groupSelectStyle),o.ensureTopVisibleBaseLayerShown(l,f.groupSelectStyle);u.firstChild;)u.removeChild(u.firstChild);o.forEachRecursive(l,function(R,L,A){R.set("indeterminate",!1)}),f.groupSelectStyle==="children"||f.groupSelectStyle==="none"?o.setGroupVisibility(l):f.groupSelectStyle==="group"&&o.setChildVisibility(l);const _=document.createElement("ul");u.appendChild(_),o.renderLayers_(l,l,_,f,function(L){o.renderPanel(l,u,f)});const C=new Event("rendercomplete");u.dispatchEvent(C)}static isBaseGroup(l){if(l instanceof n){const u=l.getLayers().getArray();return u.length&&u[0].get("type")==="base"}else return!1}static setGroupVisibility(l){o.getGroupsAndLayers(l,function(f){return f instanceof n&&!f.get("combine")&&!o.isBaseGroup(f)}).reverse().forEach(function(f){const m=f.getLayersArray().map(function(_){return _.getVisible()});m.every(function(_){return _===!0})?(f.setVisible(!0),f.set("indeterminate",!1)):m.every(function(_){return _===!1})?(f.setVisible(!1),f.set("indeterminate",!1)):(f.setVisible(!0),f.set("indeterminate",!0))})}static setChildVisibility(l){o.getGroupsAndLayers(l,function(f){return f instanceof n&&!f.get("combine")&&!o.isBaseGroup(f)}).forEach(function(f){const m=f,_=m.getVisible(),C=m.get("indeterminate");m.getLayers().getArray().forEach(function(R){R.set("indeterminate",!1),(!_||C)&&R.getVisible()&&R.set("indeterminate",!0)})})}static ensureTopVisibleBaseLayerShown(l,u){let f;o.forEachRecursive(l,function(m,_,C){m.get("type")==="base"&&m.getVisible()&&(f=m)}),f&&o.setVisible_(l,f,!0,u)}static getGroupsAndLayers(l,u){const f=[];return u=u||function(m,_,C){return!0},o.forEachRecursive(l,function(m,_,C){m.get("title")&&u(m,_,C)&&f.push(m)}),f}static setVisible_(l,u,f,m){u.setVisible(f),f&&u.get("type")==="base"&&o.forEachRecursive(l,function(_,C,R){_!=u&&_.get("type")==="base"&&_.setVisible(!1)}),u instanceof n&&!u.get("combine")&&m==="children"&&u.getLayers().forEach(_=>{o.setVisible_(l,_,u.getVisible(),m)})}static renderLayer_(l,u,f,m,_){const C=document.createElement("li"),R=u.get("title"),L=o.uuid(),A=document.createElement("label");if(u instanceof n&&!u.get("combine")){const S=o.isBaseGroup(u);if(C.classList.add("group"),S&&C.classList.add(s+"base-group"),u.get("fold")){C.classList.add(s+"fold"),C.classList.add(s+u.get("fold"));const k=document.createElement("button");k.onclick=function(H){const K=H||window.event;o.toggleFold_(u,C),K.preventDefault()},C.appendChild(k)}if(!S&&m.groupSelectStyle!="none"){const k=document.createElement("input");k.type="checkbox",k.id=L,k.checked=u.getVisible(),k.indeterminate=u.get("indeterminate"),k.onchange=function(H){const K=H.target;o.setVisible_(l,u,K.checked,m.groupSelectStyle),_(u)},C.appendChild(k),A.htmlFor=L}A.innerHTML=R,C.appendChild(A);const P=document.createElement("ul");C.appendChild(P),o.renderLayers_(l,u,P,m,_)}else{C.className="layer";const S=document.createElement("input");u.get("type")==="base"?S.type="radio":S.type="checkbox",S.id=L,S.checked=u.get("visible"),S.indeterminate=u.get("indeterminate"),S.onchange=function(k){const H=k.target;o.setVisible_(l,u,H.checked,m.groupSelectStyle),_(u)},C.appendChild(S),A.htmlFor=L,A.innerHTML=R;const P=l.getView().getResolution();if(P>=u.getMaxResolution()||P<u.getMinResolution())A.className+=" disabled";else if(u.getMinZoom&&u.getMaxZoom){const k=l.getView().getZoom();(k<=u.getMinZoom()||k>u.getMaxZoom())&&(A.className+=" disabled")}C.appendChild(A)}return C}static renderLayers_(l,u,f,m,_){let C=u.getLayers().getArray().slice();m.reverse&&(C=C.reverse());for(let R=0,L;R<C.length;R++)L=C[R],L.get("title")&&f.appendChild(o.renderLayer_(l,L,R,m,_))}static forEachRecursive(l,u){l.getLayers().forEach(function(f,m,_){u(f,m,_),f instanceof n&&o.forEachRecursive(f,u)})}static uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){const u=Math.random()*16|0;return(l=="x"?u:u&3|8).toString(16)})}static enableTouchScroll_(l){if(o.isTouchDevice_()){let u=0;l.addEventListener("touchstart",function(f){u=this.scrollTop+f.touches[0].pageY},!1),l.addEventListener("touchmove",function(f){this.scrollTop=u-f.touches[0].pageY},!1)}}static isTouchDevice_(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}static toggleFold_(l,u){u.classList.remove(s+l.get("fold")),l.set("fold",l.get("fold")==="open"?"close":"open"),u.classList.add(s+l.get("fold"))}static getGroupSelectStyle(l){return["none","children","group"].indexOf(l)>=0?l:"children"}}return window.ol&&window.ol.control&&(window.ol.control.LayerSwitcher=o),o})})(op);const jC=op.exports;class ap extends aE{constructor(e){super({target:e,view:new ki({center:[5e6,6e6],zoom:5})}),this.addControl(new jC)}addSlfgrRaster(e){this.addLayer(e.layer);const t=new ki({extent:no(e.extent,e.extent[2])});t.fit(e.extent,{size:this.getSize(),padding:[75,75,75,75]}),this.setView(t),this.raster=e}}class HC{constructor(e,t="EPSG:3857"){this.img=e,this.crs=t,this.extent=[0,-this.img.height,this.img.width,0],this.layer=new lv({title:"Diamante_1_map_area",source:new PC({url:this.img.src,projection:this.crs,imageExtent:this.extent})})}static fromPath(e){return new Promise((t,i)=>{let n=new Image;n.onload=()=>t(new this(n)),n.onerror=()=>i(),n.src=e})}}const UC="/SelfGeoRef/assets/gdal3.a43b8649.js",VC="/SelfGeoRef/assets/gdal3WebAssembly.7e503367.data",WC="/SelfGeoRef/assets/gdal3WebAssembly.42c9785f.wasm";var lp={exports:{}};(function(r,e){(function(t,i){r.exports=i()})(ah,function(){function t(x){if(x.__esModule)return x;var E=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(x).forEach(function(F){var U=Object.getOwnPropertyDescriptor(x,F);Object.defineProperty(E,F,U.get?U:{enumerable:!0,get:function(){return x[F]}})}),E}var i=t(Object.freeze({__proto__:null,default:{}})),n=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";function s(x,E){var F,U=Object.keys(x);return Object.getOwnPropertySymbols&&(F=Object.getOwnPropertySymbols(x),E&&(F=F.filter(function($){return Object.getOwnPropertyDescriptor(x,$).enumerable})),U.push.apply(U,F)),U}function o(x){for(var E=1;E<arguments.length;E++){var F=arguments[E]!=null?arguments[E]:{};E%2?s(Object(F),!0).forEach(function(U){var $,N;$=x,N=F[U=U],U in $?Object.defineProperty($,U,{value:N,enumerable:!0,configurable:!0,writable:!0}):$[U]=N}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(F)):s(Object(F)).forEach(function(U){Object.defineProperty(x,U,Object.getOwnPropertyDescriptor(F,U))})}return x}function a(x){return(a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E})(x)}function l(x,E){for(var F=0;F<E.length;F++){var U=E[F];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(x,U.key,U)}}function u(x,E){return function(F){if(Array.isArray(F))return F}(x)||function(F,U){var $=F==null?null:typeof Symbol<"u"&&F[Symbol.iterator]||F["@@iterator"];if($!=null){var N,se,W=[],Y=!0,he=!1;try{for($=$.call(F);!(Y=(N=$.next()).done)&&(W.push(N.value),!U||W.length!==U);Y=!0);}catch(Ee){he=!0,se=Ee}finally{try{Y||$.return==null||$.return()}finally{if(he)throw se}}return W}}(x,E)||m(x,E)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function f(x){return function(E){if(Array.isArray(E))return _(E)}(x)||function(E){if(typeof Symbol<"u"&&E[Symbol.iterator]!=null||E["@@iterator"]!=null)return Array.from(E)}(x)||m(x)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function m(x,E){if(x){if(typeof x=="string")return _(x,E);var F=Object.prototype.toString.call(x).slice(8,-1);return(F=F==="Object"&&x.constructor?x.constructor.name:F)==="Map"||F==="Set"?Array.from(x):F==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(F)?_(x,E):void 0}}function _(x,E){(E==null||E>x.length)&&(E=x.length);for(var F=0,U=new Array(E);F<E;F++)U[F]=x[F];return U}var C,ei={exports:{}},R=t(Object.freeze({__proto__:null,default:{}})),vs=ei;function L(x){var E,F,U,$,N,se,W,Y,he,Ee,v=(x=x||{})!==void 0?x:{};function be(){function h(b,y){if(!b)throw y+new Error().stack}function c(b,y,w){this.start=b,this.end=y,this.audio=w}v.FS_createPath("/","usr",!0,!0),v.FS_createPath("/usr","share",!0,!0),v.FS_createPath("/usr/share","gdal",!0,!0),v.FS_createPath("/usr/share","proj",!0,!0),c.prototype={requests:{},open:function(b,y){this.name=y,this.requests[y]=this,v.addRunDependency("fp "+this.name)},send:function(){},onload:function(){var b=this.byteArray.subarray(this.start,this.end);this.finish(b)},finish:function(b){v.FS_createDataFile(this.name,null,b,!0,!0,!0),v.removeRunDependency("fp "+this.name),this.requests[this.name]=null}};for(var d=U.files,g=0;g<d.length;++g)new c(d[g].start,d[g].end,d[g].audio||0).open("GET",d[g].filename);function p(b){h(b,"Loading data file failed."),h(b instanceof ArrayBuffer,"bad input to processPackageData");for(var b=new Uint8Array(b),y=(c.prototype.byteArray=b,U.files),w=0;w<y.length;++w)c.prototype.requests[y[w].filename].onload();v.removeRunDependency("datafile_/home/bugra/Documents/MiniProject/gdal3.js/build/package/gdal3WebAssembly.data")}v.addRunDependency("datafile_/home/bugra/Documents/MiniProject/gdal3.js/build/package/gdal3WebAssembly.data"),v.preloadResults||(v.preloadResults={}),v.preloadResults["/home/bugra/Documents/MiniProject/gdal3.js/build/package/gdal3WebAssembly.data"]={fromCache:!1},Ee?(p(Ee),Ee=null):he=p}v.ready=new Promise(function(h,c){E=h,F=c}),v.expectedDataFileDownloads||(v.expectedDataFileDownloads=0),v.expectedDataFileDownloads++,v.ENVIRONMENT_IS_PTHREAD||(U={files:[{filename:"/usr/share/gdal/jpfgdgml_RdArea.gfs",start:0,end:1515},{filename:"/usr/share/gdal/grib2_table_4_2_0_3.csv",start:1515,end:11849},{filename:"/usr/share/gdal/plscenesconf.json",start:11849,end:47162},{filename:"/usr/share/gdal/header.dxf",start:47162,end:53734},{filename:"/usr/share/gdal/grib2_table_4_2_10_2.csv",start:53734,end:63614},{filename:"/usr/share/gdal/pci_datum.txt",start:63614,end:98719},{filename:"/usr/share/gdal/nitf_spec.xml",start:98719,end:247574},{filename:"/usr/share/gdal/grib2_table_4_2_0_6.csv",start:247574,end:259216},{filename:"/usr/share/gdal/pci_ellips.txt",start:259216,end:262682},{filename:"/usr/share/gdal/grib2_table_4_2_4_5.csv",start:262682,end:272178},{filename:"/usr/share/gdal/grib2_table_4_2_4_4.csv",start:272178,end:281867},{filename:"/usr/share/gdal/inspire_cp_CadastralBoundary.gfs",start:281867,end:283517},{filename:"/usr/share/gdal/ozi_ellips.csv",start:283517,end:284866},{filename:"/usr/share/gdal/grib2_table_4_2_4_1.csv",start:284866,end:294552},{filename:"/usr/share/gdal/grib2_table_4_2_2_0.csv",start:294552,end:306753},{filename:"/usr/share/gdal/ozi_datum.csv",start:306753,end:315235},{filename:"/usr/share/gdal/grib2_table_4_2_10_4.csv",start:315235,end:325428},{filename:"/usr/share/gdal/eedaconf.json",start:325428,end:325807},{filename:"/usr/share/gdal/grib2_table_4_2_10_3.csv",start:325807,end:335583},{filename:"/usr/share/gdal/grib2_table_4_2_local_NCEP.csv",start:335583,end:363560},{filename:"/usr/share/gdal/jpfgdgml_RvrMgtBdry.gfs",start:363560,end:364948},{filename:"/usr/share/gdal/grib2_table_4_2_20_1.csv",start:364948,end:374802},{filename:"/usr/share/gdal/jpfgdgml_BldA.gfs",start:374802,end:376303},{filename:"/usr/share/gdal/vdv452.xsd",start:376303,end:379157},{filename:"/usr/share/gdal/grib2_table_4_2_0_19.csv",start:379157,end:391031},{filename:"/usr/share/gdal/s57expectedinput.csv",start:391031,end:411916},{filename:"/usr/share/gdal/jpfgdgml_WStrA.gfs",start:411916,end:413419},{filename:"/usr/share/gdal/ruian_vf_v1.gfs",start:413419,end:480753},{filename:"/usr/share/gdal/inspire_cp_BasicPropertyUnit.gfs",start:480753,end:482493},{filename:"/usr/share/gdal/grib2_table_4_2_4_6.csv",start:482493,end:492127},{filename:"/usr/share/gdal/GDALLogoGS.svg",start:492127,end:504432},{filename:"/usr/share/gdal/s57objectclasses.csv",start:504432,end:557759},{filename:"/usr/share/gdal/GDALLogoColor.svg",start:557759,end:570064},{filename:"/usr/share/gdal/pds4_template.xml",start:570064,end:573497},{filename:"/usr/share/gdal/default.rsc",start:573497,end:1037129},{filename:"/usr/share/gdal/grib2_table_4_2_0_17.csv",start:1037129,end:1037985},{filename:"/usr/share/gdal/tms_NZTM2000.json",start:1037985,end:1043202},{filename:"/usr/share/gdal/grib2_table_4_2_20_2.csv",start:1043202,end:1052708},{filename:"/usr/share/gdal/jpfgdgml_ElevPt.gfs",start:1052708,end:1054208},{filename:"/usr/share/gdal/cubewerx_extra.wkt",start:1054208,end:1066185},{filename:"/usr/share/gdal/ecw_cs.wkt",start:1066185,end:1429902},{filename:"/usr/share/gdal/grib2_table_4_2_1_2.csv",start:1429902,end:1439700},{filename:"/usr/share/gdal/osmconf.ini",start:1439700,end:1444895},{filename:"/usr/share/gdal/grib2_subcenter.csv",start:1444895,end:1447223},{filename:"/usr/share/gdal/grib2_table_4_2_0_2.csv",start:1447223,end:1458026},{filename:"/usr/share/gdal/grib2_table_4_2_0_16.csv",start:1458026,end:1467697},{filename:"/usr/share/gdal/epsg.wkt",start:1467697,end:1467724},{filename:"/usr/share/gdal/jpfgdgml_SBBdry.gfs",start:1467724,end:1468977},{filename:"/usr/share/gdal/jpfgdgml_BldL.gfs",start:1468977,end:1470480},{filename:"/usr/share/gdal/ruian_vf_st_v1.gfs",start:1470480,end:1516452},{filename:"/usr/share/gdal/grib2_table_4_2_0_190.csv",start:1516452,end:1525959},{filename:"/usr/share/gdal/gmlasconf.xml",start:1525959,end:1533391},{filename:"/usr/share/gdal/grib2_table_4_2_0_0.csv",start:1533391,end:1543754},{filename:"/usr/share/gdal/gt_datum.csv",start:1543754,end:1559558},{filename:"/usr/share/gdal/ruian_vf_st_uvoh_v1.gfs",start:1559558,end:1562158},{filename:"/usr/share/gdal/LICENSE.TXT",start:1562158,end:1581972},{filename:"/usr/share/gdal/jpfgdgml_SBAPt.gfs",start:1581972,end:1583347},{filename:"/usr/share/gdal/ruian_vf_ob_v1.gfs",start:1583347,end:1630122},{filename:"/usr/share/gdal/jpfgdgml_WL.gfs",start:1630122,end:1631621},{filename:"/usr/share/gdal/grib2_table_4_2_2_3.csv",start:1631621,end:1642255},{filename:"/usr/share/gdal/tms_LINZAntarticaMapTileGrid.json",start:1642255,end:1646382},{filename:"/usr/share/gdal/GDALLogoBW.svg",start:1646382,end:1659404},{filename:"/usr/share/gdal/grib2_table_4_2_4_9.csv",start:1659404,end:1668940},{filename:"/usr/share/gdal/gmlasconf.xsd",start:1668940,end:1717594},{filename:"/usr/share/gdal/jpfgdgml_RdCompt.gfs",start:1717594,end:1719240},{filename:"/usr/share/gdal/grib2_process.csv",start:1719240,end:1724166},{filename:"/usr/share/gdal/stateplane.csv",start:1724166,end:1734526},{filename:"/usr/share/gdal/trailer.dxf",start:1734526,end:1736801},{filename:"/usr/share/gdal/nitf_spec.xsd",start:1736801,end:1744488},{filename:"/usr/share/gdal/grib2_table_4_2_3_6.csv",start:1744488,end:1745307},{filename:"/usr/share/gdal/bag_template.xml",start:1745307,end:1754327},{filename:"/usr/share/gdal/s57attributes.csv",start:1754327,end:1774328},{filename:"/usr/share/gdal/vdv452.xml",start:1774328,end:1800144},{filename:"/usr/share/gdal/jpfgdgml_Cntr.gfs",start:1800144,end:1801645},{filename:"/usr/share/gdal/jpfgdgml_SBArea.gfs",start:1801645,end:1803152},{filename:"/usr/share/gdal/grib2_table_4_2_10_0.csv",start:1803152,end:1814925},{filename:"/usr/share/gdal/grib2_table_4_2_4_10.csv",start:1814925,end:1824626},{filename:"/usr/share/gdal/grib2_table_4_2_0_7.csv",start:1824626,end:1835117},{filename:"/usr/share/gdal/jpfgdgml_RailCL.gfs",start:1835117,end:1836624},{filename:"/usr/share/gdal/jpfgdgml_RdEdg.gfs",start:1836624,end:1838266},{filename:"/usr/share/gdal/esri_StatePlane_extra.wkt",start:1838266,end:2170812},{filename:"/usr/share/gdal/jpfgdgml_RdSgmtA.gfs",start:2170812,end:2172456},{filename:"/usr/share/gdal/grib2_table_4_2_10_191.csv",start:2172456,end:2182090},{filename:"/usr/share/gdal/seed_2d.dgn",start:2182090,end:2191306},{filename:"/usr/share/gdal/grib2_table_4_2_local_index.csv",start:2191306,end:2191557},{filename:"/usr/share/gdal/grib2_table_4_2_2_4.csv",start:2191557,end:2202785},{filename:"/usr/share/gdal/grib2_table_4_2_0_5.csv",start:2202785,end:2212611},{filename:"/usr/share/gdal/grib2_table_4_2_1_1.csv",start:2212611,end:2222266},{filename:"/usr/share/gdal/jpfgdgml_LeveeEdge.gfs",start:2222266,end:2223652},{filename:"/usr/share/gdal/grib2_table_4_2_3_3.csv",start:2223652,end:2224436},{filename:"/usr/share/gdal/tms_MapML_CBMTILE.json",start:2224436,end:2232233},{filename:"/usr/share/gdal/grib2_table_4_2_0_20.csv",start:2232233,end:2244359},{filename:"/usr/share/gdal/netcdf_config.xsd",start:2244359,end:2251850},{filename:"/usr/share/gdal/grib2_table_4_2_10_1.csv",start:2251850,end:2261448},{filename:"/usr/share/gdal/grib2_table_4_2_0_14.csv",start:2261448,end:2270999},{filename:"/usr/share/gdal/grib2_table_4_2_4_7.csv",start:2270999,end:2280555},{filename:"/usr/share/gdal/grib2_table_4_2_local_NDFD.csv",start:2280555,end:2283214},{filename:"/usr/share/gdal/grib2_table_4_2_4_2.csv",start:2283214,end:2292874},{filename:"/usr/share/gdal/grib2_table_4_2_3_2.csv",start:2292874,end:2296707},{filename:"/usr/share/gdal/jpfgdgml_RdASL.gfs",start:2296707,end:2297958},{filename:"/usr/share/gdal/jpfgdgml_CommBdry.gfs",start:2297958,end:2299342},{filename:"/usr/share/gdal/vicar.json",start:2299342,end:2301749},{filename:"/usr/share/gdal/grib2_table_4_2_0_18.csv",start:2301749,end:2311973},{filename:"/usr/share/gdal/s57agencies.csv",start:2311973,end:2325277},{filename:"/usr/share/gdal/jpfgdgml_CommPt.gfs",start:2325277,end:2326912},{filename:"/usr/share/gdal/grib2_table_4_2_0_15.csv",start:2326912,end:2336758},{filename:"/usr/share/gdal/grib2_table_4_2_3_1.csv",start:2336758,end:2347421},{filename:"/usr/share/gdal/jpfgdgml_RdMgtBdry.gfs",start:2347421,end:2348807},{filename:"/usr/share/gdal/inspire_cp_CadastralZoning.gfs",start:2348807,end:2353619},{filename:"/usr/share/gdal/inspire_cp_CadastralParcel.gfs",start:2353619,end:2356069},{filename:"/usr/share/gdal/grib2_table_4_2_4_0.csv",start:2356069,end:2365622},{filename:"/usr/share/gdal/grib2_table_4_2_local_MRMS.csv",start:2365622,end:2381209},{filename:"/usr/share/gdal/gt_ellips.csv",start:2381209,end:2382928},{filename:"/usr/share/gdal/seed_3d.dgn",start:2382928,end:2384976},{filename:"/usr/share/gdal/tms_MapML_APSTILE.json",start:2384976,end:2391249},{filename:"/usr/share/gdal/grib2_table_4_2_20_0.csv",start:2391249,end:2400795},{filename:"/usr/share/gdal/grib2_table_4_5.csv",start:2400795,end:2410808},{filename:"/usr/share/gdal/grib2_table_4_2_3_5.csv",start:2410808,end:2411728},{filename:"/usr/share/gdal/template_tiles.mapml",start:2411728,end:2413675},{filename:"/usr/share/gdal/gml_registry.xml",start:2413675,end:2420318},{filename:"/usr/share/gdal/grib2_table_4_2_0_13.csv",start:2420318,end:2429914},{filename:"/usr/share/gdal/jpfgdgml_WA.gfs",start:2429914,end:2431411},{filename:"/usr/share/gdal/grib2_table_versions.csv",start:2431411,end:2431451},{filename:"/usr/share/gdal/jpfgdgml_Cstline.gfs",start:2431451,end:2432960},{filename:"/usr/share/gdal/grib2_table_4_2_0_1.csv",start:2432960,end:2448697},{filename:"/usr/share/gdal/grib2_table_4_2_0_191.csv",start:2448697,end:2458317},{filename:"/usr/share/gdal/jpfgdgml_GCP.gfs",start:2458317,end:2460840},{filename:"/usr/share/gdal/ogrvrt.xsd",start:2460840,end:2486589},{filename:"/usr/share/gdal/grib2_table_4_2_local_HPC.csv",start:2486589,end:2486676},{filename:"/usr/share/gdal/jpfgdgml_AdmPt.gfs",start:2486676,end:2488309},{filename:"/usr/share/gdal/jpfgdgml_AdmArea.gfs",start:2488309,end:2489949},{filename:"/usr/share/gdal/jpfgdgml_WStrL.gfs",start:2489949,end:2491454},{filename:"/usr/share/gdal/grib2_center.csv",start:2491454,end:2495625},{filename:"/usr/share/gdal/gdalvrt.xsd",start:2495625,end:2523196},{filename:"/usr/share/gdal/grib2_table_4_2_3_0.csv",start:2523196,end:2534147},{filename:"/usr/share/gdal/gdalicon.png",start:2534147,end:2536168},{filename:"/usr/share/gdal/gdalmdiminfo_output.schema.json",start:2536168,end:2541629},{filename:"/usr/share/gdal/grib2_table_4_2_2_5.csv",start:2541629,end:2551142},{filename:"/usr/share/gdal/grib2_table_4_2_4_8.csv",start:2551142,end:2560828},{filename:"/usr/share/gdal/grib2_table_4_2_0_4.csv",start:2560828,end:2571139},{filename:"/usr/share/gdal/grib2_table_4_2_4_3.csv",start:2571139,end:2580861},{filename:"/usr/share/gdal/grib2_table_4_2_1_0.csv",start:2580861,end:2591003},{filename:"/usr/share/gdal/grib2_table_4_2_3_4.csv",start:2591003,end:2592054},{filename:"/usr/share/gdal/jpfgdgml_AdmBdry.gfs",start:2592054,end:2593436},{filename:"/usr/share/gdal/grib2_table_4_2_local_Canada.csv",start:2593436,end:2593769},{filename:"/usr/share/gdal/pdfcomposition.xsd",start:2593769,end:2628103},{filename:"/usr/share/proj/proj.ini",start:2628103,end:2629153},{filename:"/usr/share/proj/ITRF2000",start:2629153,end:2631252},{filename:"/usr/share/proj/projjson.schema.json",start:2631252,end:2668530},{filename:"/usr/share/proj/nad83",start:2668530,end:2685123},{filename:"/usr/share/proj/ITRF2014",start:2685123,end:2688612},{filename:"/usr/share/proj/other.extra",start:2688612,end:2692527},{filename:"/usr/share/proj/deformation_model.schema.json",start:2692527,end:2710198},{filename:"/usr/share/proj/nad27",start:2710198,end:2729733},{filename:"/usr/share/proj/triangulation.schema.json",start:2729733,end:2738136},{filename:"/usr/share/proj/nad.lst",start:2738136,end:2744521},{filename:"/usr/share/proj/GL27",start:2744521,end:2745249},{filename:"/usr/share/proj/world",start:2745249,end:2752328},{filename:"/usr/share/proj/CH",start:2752328,end:2753425},{filename:"/usr/share/proj/ITRF2008",start:2753425,end:2759105},{filename:"/usr/share/proj/proj.db",start:2759105,end:11037121}],remote_package_size:11037121},(typeof window>"u"?"undefined":a(window))==="object"?window.encodeURIComponent(window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/"):typeof process>"u"&&typeof location<"u"&&encodeURIComponent(location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"),kn="gdal3WebAssembly.data",typeof v.locateFilePackage!="function"||v.locateFile||(v.locateFile=v.locateFilePackage,Ci("warning: you defined Module.locateFilePackage, that has been renamed to Module.locateFile (using your locateFilePackage for now)")),kn=v.locateFile?v.locateFile(kn,""):kn,ti=U.remote_package_size,he=null,(Ee=v.getPreloadedPackage?v.getPreloadedPackage(kn,ti):null)||($=kn,N=ti,se=function(h){he?(he(h),he=null):Ee=h},W=function(h){console.error("package error:",h)},(typeof process>"u"?"undefined":a(process))==="object"&&a(process.versions)==="object"&&typeof process.versions.node=="string"?i.readFile($,function(h,c){h?W(h):se(c.buffer)}):((Y=new XMLHttpRequest).open("GET",$,!0),Y.responseType="arraybuffer",Y.onprogress=function(h){var c=$,d=N;if(h.total&&(d=h.total),h.loaded){Y.addedTotal?v.dataFileDownloads[c].loaded=h.loaded:(Y.addedTotal=!0,v.dataFileDownloads||(v.dataFileDownloads={}),v.dataFileDownloads[c]={loaded:h.loaded,total:d});var g,p=0,b=0,y=0;for(g in v.dataFileDownloads){var w=v.dataFileDownloads[g];p+=w.total,b+=w.loaded,y++}p=Math.ceil(p*v.expectedDataFileDownloads/y),v.setStatus&&v.setStatus("Downloading data... ("+b+"/"+p+")")}else v.dataFileDownloads||v.setStatus&&v.setStatus("Downloading data...")},Y.onerror=function(h){throw new Error("NetworkError for: "+$)},Y.onload=function(h){if(!(Y.status==200||Y.status==304||Y.status==206||Y.status==0&&Y.response))throw new Error(Y.statusText+" : "+Y.responseURL);var c=Y.response;se(c)},Y.send(null))),v.calledRun?be():(v.preRun||(v.preRun=[]),v.preRun.push(be)));var je,Ke,gt,nt,Tt,Mi,kn=Object.assign({},v),nl="./this.program",sl=function(h,c){throw c},Vc=(typeof window>"u"?"undefined":a(window))=="object",Nn=typeof importScripts=="function",Es=(typeof process>"u"?"undefined":a(process))=="object"&&a(process.versions)=="object"&&typeof process.versions.node=="string",ti="";function di(h){Wc=h}Es?(ti=Nn?R.dirname(ti)+"/":__dirname+"/",Mi=function(){Tt||(nt=i,Tt=R)},je=function(h,c){return Mi(),h=Tt.normalize(h),nt.readFileSync(h,c?void 0:"utf8")},gt=function(h){return h=je(h,!0),h=h.buffer?h:new Uint8Array(h)},Ke=function(h,c,d){Mi(),h=Tt.normalize(h),nt.readFile(h,function(g,p){g?d(g):c(p.buffer)})},1<process.argv.length&&(nl=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(h){if(!(h instanceof hl))throw h}),process.on("unhandledRejection",function(h){throw h}),sl=function(h,c){if(Xc)throw process.exitCode=h,c;(c=c)instanceof hl||Ci("exiting due to exception: "+c),process.exit(h)},v.inspect=function(){return"[Emscripten Module object]"}):(Vc||Nn)&&(Nn?ti=self.location.href:typeof document<"u"&&document.currentScript&&(ti=document.currentScript.src),ti=(ti=C||ti).indexOf("blob:")!==0?ti.substr(0,ti.replace(/[?#].*/,"").lastIndexOf("/")+1):"",je=function(h){var c=new XMLHttpRequest;return c.open("GET",h,!1),c.send(null),c.responseText},Nn&&(gt=function(h){var c=new XMLHttpRequest;return c.open("GET",h,!1),c.responseType="arraybuffer",c.send(null),new Uint8Array(c.response)}),Ke=function(h,c,d){var g=new XMLHttpRequest;g.open("GET",h,!0),g.responseType="arraybuffer",g.onload=function(){g.status==200||g.status==0&&g.response?c(g.response):d()},g.onerror=d,g.send(null)});var vr,rl,Ro=v.print||console.log.bind(console),Ci=v.printErr||console.warn.bind(console),Wc=(Object.assign(v,kn),v.arguments,v.thisProgram&&(nl=v.thisProgram),v.quit&&(sl=v.quit),0),Xc=(v.wasmBinary&&(vr=v.wasmBinary),v.noExitRuntime||!0),So=((typeof WebAssembly>"u"?"undefined":a(WebAssembly))!="object"&&ii("no native wasm support detected"),!1);function ws(h,c){h||ii(c)}var ol,vt,Gn,Er,re,Et,al,ll,zn,Yc=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Cs(h,c,d){for(var g=c+d,p=c;h[p]&&!(g<=p);)++p;if(16<p-c&&h.buffer&&Yc)return Yc.decode(h.subarray(c,p));for(var b="";c<p;){var y,w,D=h[c++];128&D?(w=63&h[c++],(224&D)==192?b+=String.fromCharCode((31&D)<<6|w):(y=63&h[c++],(D=(240&D)==224?(15&D)<<12|w<<6|y:(7&D)<<18|w<<12|y<<6|63&h[c++])<65536?b+=String.fromCharCode(D):(w=D-65536,b+=String.fromCharCode(55296|w>>10,56320|1023&w)))):b+=String.fromCharCode(D)}return b}function Bn(h,c){return h?Cs(Gn,h,c):""}function Lo(h,c,d,g){if(!(0<g))return 0;for(var p=d,b=d+g-1,y=0;y<h.length;++y){var w=h.charCodeAt(y);if((w=55296<=w&&w<=57343?65536+((1023&w)<<10)|1023&h.charCodeAt(++y):w)<=127){if(b<=d)break;c[d++]=w}else if(w<=2047){if(b<=d+1)break;c[d++]=192|w>>6,c[d++]=128|63&w}else if(w<=65535){if(b<=d+2)break;c[d++]=224|w>>12,c[d++]=128|w>>6&63,c[d++]=128|63&w}else{if(b<=d+3)break;c[d++]=240|w>>18,c[d++]=128|w>>12&63,c[d++]=128|w>>6&63,c[d++]=128|63&w}}return c[d]=0,d-p}function wr(h,c,d){return Lo(h,Gn,c,d)}function xs(h){for(var c=0,d=0;d<h.length;++d){var g=h.charCodeAt(d);g<=127?c++:g<=2047?c+=2:55296<=g&&g<=57343?(c+=4,++d):c+=3}return c}function Kc(h){ol=h,v.HEAP8=vt=new Int8Array(h),v.HEAP16=Er=new Int16Array(h),v.HEAP32=re=new Int32Array(h),v.HEAPU8=Gn=new Uint8Array(h),v.HEAPU16=new Uint16Array(h),v.HEAPU32=Et=new Uint32Array(h),v.HEAPF32=al=new Float32Array(h),v.HEAPF64=ll=new Float64Array(h)}v.INITIAL_MEMORY;var $c=[],Zc=[],qc=[];function Wp(){if(v.preRun)for(typeof v.preRun=="function"&&(v.preRun=[v.preRun]);v.preRun.length;)h=v.preRun.shift(),$c.unshift(h);var h;cl($c)}function Xp(){if(v.postRun)for(typeof v.postRun=="function"&&(v.postRun=[v.postRun]);v.postRun.length;)h=v.postRun.shift(),qc.unshift(h);var h;cl(qc)}var fi,$e,Dt,jn=0,Cr=null;function Do(h){jn++,v.monitorRunDependencies&&v.monitorRunDependencies(jn)}function xr(h){var c;jn--,v.monitorRunDependencies&&v.monitorRunDependencies(jn),jn==0&&Cr&&(c=Cr,Cr=null,c())}function ii(h){throw v.onAbort&&v.onAbort(h),Ci(h="Aborted("+h+")"),So=!0,h+=". Build with -sASSERTIONS for more info.",h=new WebAssembly.RuntimeError(h),F(h),h}function Jc(h){return h.startsWith("data:application/octet-stream;base64,")}function Qc(h){return h.startsWith("file://")}function eu(h){try{if(h==fi&&vr)return new Uint8Array(vr);if(gt)return gt(h);throw"both async and sync fetching of the wasm failed"}catch(c){ii(c)}}function hl(h){this.name="ExitStatus",this.message="Program terminated with exit("+h+")",this.status=h}function cl(h){for(;0<h.length;)h.shift()(v)}function tu(h,c){vt.set(h,c)}Jc(fi="gdal3WebAssembly.wasm")||(Po=fi,fi=v.locateFile?v.locateFile(Po,ti):ti+Po);var Tr=[];function X(h){var c=Tr[h];return c||(h>=Tr.length&&(Tr.length=h+1),Tr[h]=c=zn.get(h)),c}var Ao=[],Mo=0,hn=0;function Ts(h){this.excPtr=h,this.ptr=h-24,this.set_type=function(c){Et[this.ptr+4>>2]=c},this.get_type=function(){return Et[this.ptr+4>>2]},this.set_destructor=function(c){Et[this.ptr+8>>2]=c},this.get_destructor=function(){return Et[this.ptr+8>>2]},this.set_refcount=function(c){re[this.ptr>>2]=c},this.set_caught=function(c){vt[this.ptr+12>>0]=c=c?1:0},this.get_caught=function(){return vt[this.ptr+12>>0]!=0},this.set_rethrown=function(c){vt[this.ptr+13>>0]=c=c?1:0},this.get_rethrown=function(){return vt[this.ptr+13>>0]!=0},this.init=function(c,d){this.set_adjusted_ptr(0),this.set_type(c),this.set_destructor(d),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var c=re[this.ptr>>2];re[this.ptr>>2]=c+1},this.release_ref=function(){var c=re[this.ptr>>2];return re[this.ptr>>2]=c-1,c===1},this.set_adjusted_ptr=function(c){Et[this.ptr+16>>2]=c},this.get_adjusted_ptr=function(){return Et[this.ptr+16>>2]},this.get_exception_ptr=function(){if(vu(this.get_type()))return Et[this.excPtr>>2];var c=this.get_adjusted_ptr();return c!==0?c:this.excPtr}}function iu(h){return _u(new Ts(h).ptr)}var Be={isAbs:function(h){return h.charAt(0)==="/"},splitPath:function(h){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(h).slice(1)},normalizeArray:function(h,c){for(var d=0,g=h.length-1;0<=g;g--){var p=h[g];p==="."?h.splice(g,1):p===".."?(h.splice(g,1),d++):d&&(h.splice(g,1),d--)}if(c)for(;d;d--)h.unshift("..");return h},normalize:function(h){var c=Be.isAbs(h),d=h.substr(-1)==="/";return(h=(h=Be.normalizeArray(h.split("/").filter(function(g){return!!g}),!c).join("/"))||c?h:".")&&d&&(h+="/"),(c?"/":"")+h},dirname:function(d){var d=Be.splitPath(d),c=d[0],d=d[1];return c||d?c+(d=d&&d.substr(0,d.length-1)):"."},basename:function(h){if(h==="/")return"/";var c=(h=(h=Be.normalize(h)).replace(/\/$/,"")).lastIndexOf("/");return c===-1?h:h.substr(c+1)},join:function(){var h=Array.prototype.slice.call(arguments,0);return Be.normalize(h.join("/"))},join2:function(h,c){return Be.normalize(h+"/"+c)}};function nu(){var h;if((typeof crypto>"u"?"undefined":a(crypto))=="object"&&typeof crypto.getRandomValues=="function")return h=new Uint8Array(1),function(){return crypto.getRandomValues(h),h[0]};if(Es)try{var c=void 0;return function(){return c.randomBytes(1)[0]}}catch{}return function(){ii("randomDevice")}}var Vi={resolve:function(){for(var h="",c=!1,d=arguments.length-1;-1<=d&&!c;d--){var g=0<=d?arguments[d]:T.cwd();if(typeof g!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!g)return"";h=g+"/"+h,c=Be.isAbs(g)}return(c?"/":"")+(h=Be.normalizeArray(h.split("/").filter(function(p){return!!p}),!c).join("/"))||"."},relative:function(h,c){function d(M){for(var I=0;I<M.length&&M[I]==="";I++);for(var O=M.length-1;0<=O&&M[O]==="";O--);return O<I?[]:M.slice(I,O-I+1)}h=Vi.resolve(h).substr(1),c=Vi.resolve(c).substr(1);for(var g=d(h.split("/")),p=d(c.split("/")),b=Math.min(g.length,p.length),y=b,w=0;w<b;w++)if(g[w]!==p[w]){y=w;break}for(var D=[],w=y;w<g.length;w++)D.push("..");return(D=D.concat(p.slice(y))).join("/")}};function Io(h,c,d){return d=0<d?d:xs(h)+1,d=new Array(d),h=Lo(h,d,0,d.length),c&&(d.length=h),d}var Hn={ttys:[],init:function(){},shutdown:function(){},register:function(h,c){Hn.ttys[h]={input:[],output:[],ops:c},T.registerDevice(h,Hn.stream_ops)},stream_ops:{open:function(h){var c=Hn.ttys[h.node.rdev];if(!c)throw new T.ErrnoError(43);h.tty=c,h.seekable=!1},close:function(h){h.tty.ops.flush(h.tty)},flush:function(h){h.tty.ops.flush(h.tty)},read:function(h,c,d,g,p){if(!h.tty||!h.tty.ops.get_char)throw new T.ErrnoError(60);for(var b,y=0,w=0;w<g;w++){try{b=h.tty.ops.get_char(h.tty)}catch{throw new T.ErrnoError(29)}if(b===void 0&&y===0)throw new T.ErrnoError(6);if(b==null)break;y++,c[d+w]=b}return y&&(h.node.timestamp=Date.now()),y},write:function(h,c,d,g,p){if(!h.tty||!h.tty.ops.put_char)throw new T.ErrnoError(60);try{for(var b=0;b<g;b++)h.tty.ops.put_char(h.tty,c[d+b])}catch{throw new T.ErrnoError(29)}return g&&(h.node.timestamp=Date.now()),b}},default_tty_ops:{get_char:function(h){if(!h.input.length){var c=null;if(Es){var d=Buffer.alloc(256),g=0;try{g=nt.readSync(process.stdin.fd,d,0,256,-1)}catch(p){if(!p.toString().includes("EOF"))throw p;g=0}c=0<g?d.slice(0,g).toString("utf-8"):null}else typeof window<"u"&&typeof window.prompt=="function"?(c=window.prompt("Input: "))!==null&&(c+=`
`):typeof readline=="function"&&(c=readline())!==null&&(c+=`
`);if(!c)return null;h.input=Io(c,!0)}return h.input.shift()},put_char:function(h,c){c===null||c===10?(Ro(Cs(h.output,0)),h.output=[]):c!=0&&h.output.push(c)},flush:function(h){h.output&&0<h.output.length&&(Ro(Cs(h.output,0)),h.output=[])}},default_tty1_ops:{put_char:function(h,c){c===null||c===10?(Ci(Cs(h.output,0)),h.output=[]):c!=0&&h.output.push(c)},flush:function(h){h.output&&0<h.output.length&&(Ci(Cs(h.output,0)),h.output=[])}}};function ul(h){d=h,c=65536,h=Math.ceil(d/c)*c;var c,d=yu(65536,h);return d?(c=h,Gn.fill(0,d,d+c),d):0}var Pe={ops_table:null,mount:function(h){return Pe.createNode(null,"/",16895,0)},createNode:function(h,c,d,g){if(T.isBlkdev(d)||T.isFIFO(d))throw new T.ErrnoError(63);return Pe.ops_table||(Pe.ops_table={dir:{node:{getattr:Pe.node_ops.getattr,setattr:Pe.node_ops.setattr,lookup:Pe.node_ops.lookup,mknod:Pe.node_ops.mknod,rename:Pe.node_ops.rename,unlink:Pe.node_ops.unlink,rmdir:Pe.node_ops.rmdir,readdir:Pe.node_ops.readdir,symlink:Pe.node_ops.symlink},stream:{llseek:Pe.stream_ops.llseek}},file:{node:{getattr:Pe.node_ops.getattr,setattr:Pe.node_ops.setattr},stream:{llseek:Pe.stream_ops.llseek,read:Pe.stream_ops.read,write:Pe.stream_ops.write,allocate:Pe.stream_ops.allocate,mmap:Pe.stream_ops.mmap,msync:Pe.stream_ops.msync}},link:{node:{getattr:Pe.node_ops.getattr,setattr:Pe.node_ops.setattr,readlink:Pe.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Pe.node_ops.getattr,setattr:Pe.node_ops.setattr},stream:T.chrdev_stream_ops}}),d=T.createNode(h,c,d,g),T.isDir(d.mode)?(d.node_ops=Pe.ops_table.dir.node,d.stream_ops=Pe.ops_table.dir.stream,d.contents={}):T.isFile(d.mode)?(d.node_ops=Pe.ops_table.file.node,d.stream_ops=Pe.ops_table.file.stream,d.usedBytes=0,d.contents=null):T.isLink(d.mode)?(d.node_ops=Pe.ops_table.link.node,d.stream_ops=Pe.ops_table.link.stream):T.isChrdev(d.mode)&&(d.node_ops=Pe.ops_table.chrdev.node,d.stream_ops=Pe.ops_table.chrdev.stream),d.timestamp=Date.now(),h&&(h.contents[c]=d,h.timestamp=d.timestamp),d},getFileDataAsTypedArray:function(h){return h.contents?h.contents.subarray?h.contents.subarray(0,h.usedBytes):new Uint8Array(h.contents):new Uint8Array(0)},expandFileStorage:function(h,c){var d=h.contents?h.contents.length:0;c<=d||(c=Math.max(c,d*(d<1048576?2:1.125)>>>0),d!=0&&(c=Math.max(c,256)),d=h.contents,h.contents=new Uint8Array(c),0<h.usedBytes&&h.contents.set(d.subarray(0,h.usedBytes),0))},resizeFileStorage:function(h,c){var d;h.usedBytes!=c&&(c==0?(h.contents=null,h.usedBytes=0):(d=h.contents,h.contents=new Uint8Array(c),d&&h.contents.set(d.subarray(0,Math.min(c,h.usedBytes))),h.usedBytes=c))},node_ops:{getattr:function(h){var c={};return c.dev=T.isChrdev(h.mode)?h.id:1,c.ino=h.id,c.mode=h.mode,c.nlink=1,c.uid=0,c.gid=0,c.rdev=h.rdev,T.isDir(h.mode)?c.size=4096:T.isFile(h.mode)?c.size=h.usedBytes:T.isLink(h.mode)?c.size=h.link.length:c.size=0,c.atime=new Date(h.timestamp),c.mtime=new Date(h.timestamp),c.ctime=new Date(h.timestamp),c.blksize=4096,c.blocks=Math.ceil(c.size/c.blksize),c},setattr:function(h,c){c.mode!==void 0&&(h.mode=c.mode),c.timestamp!==void 0&&(h.timestamp=c.timestamp),c.size!==void 0&&Pe.resizeFileStorage(h,c.size)},lookup:function(h,c){throw T.genericErrors[44]},mknod:function(h,c,d,g){return Pe.createNode(h,c,d,g)},rename:function(h,c,d){if(T.isDir(h.mode)){var g;try{g=T.lookupNode(c,d)}catch{}if(g)for(var p in g.contents)throw new T.ErrnoError(55)}delete h.parent.contents[h.name],h.parent.timestamp=Date.now(),h.name=d,c.contents[d]=h,c.timestamp=h.parent.timestamp,h.parent=c},unlink:function(h,c){delete h.contents[c],h.timestamp=Date.now()},rmdir:function(h,c){for(var d in T.lookupNode(h,c).contents)throw new T.ErrnoError(55);delete h.contents[c],h.timestamp=Date.now()},readdir:function(h){var c,d=[".",".."];for(c in h.contents)h.contents.hasOwnProperty(c)&&d.push(c);return d},symlink:function(h,c,d){return h=Pe.createNode(h,c,41471,0),h.link=d,h},readlink:function(h){if(T.isLink(h.mode))return h.link;throw new T.ErrnoError(28)}},stream_ops:{read:function(h,c,d,g,p){var b=h.node.contents;if(p>=h.node.usedBytes)return 0;var y=Math.min(h.node.usedBytes-p,g);if(8<y&&b.subarray)c.set(b.subarray(p,p+y),d);else for(var w=0;w<y;w++)c[d+w]=b[p+w];return y},write:function(h,c,d,g,p,b){if(c.buffer===vt.buffer&&(b=!1),!g)return 0;var y=h.node;if(y.timestamp=Date.now(),c.subarray&&(!y.contents||y.contents.subarray)){if(b)return y.contents=c.subarray(d,d+g),y.usedBytes=g;if(y.usedBytes===0&&p===0)return y.contents=c.slice(d,d+g),y.usedBytes=g;if(p+g<=y.usedBytes)return y.contents.set(c.subarray(d,d+g),p),g}if(Pe.expandFileStorage(y,p+g),y.contents.subarray&&c.subarray)y.contents.set(c.subarray(d,d+g),p);else for(var w=0;w<g;w++)y.contents[p+w]=c[d+w];return y.usedBytes=Math.max(y.usedBytes,p+g),g},llseek:function(h,c,d){if(d===1?c+=h.position:d===2&&T.isFile(h.node.mode)&&(c+=h.node.usedBytes),c<0)throw new T.ErrnoError(28);return c},allocate:function(h,c,d){Pe.expandFileStorage(h.node,c+d),h.node.usedBytes=Math.max(h.node.usedBytes,c+d)},mmap:function(w,c,d,g,p){if(!T.isFile(w.node.mode))throw new T.ErrnoError(43);var b,y,w=w.node.contents;if(2&p||w.buffer!==ol){if((0<d||d+c<w.length)&&(w=w.subarray?w.subarray(d,d+c):Array.prototype.slice.call(w,d,d+c)),y=!0,!(b=ul(c)))throw new T.ErrnoError(48);vt.set(w,b)}else y=!1,b=w.byteOffset;return{ptr:b,allocated:y}},msync:function(h,c,d,g,p){if(T.isFile(h.node.mode))return 2&p||Pe.stream_ops.write(h,c,0,g,d,!1),0;throw new T.ErrnoError(43)}}},su={},Me={isWindows:!1,staticInit:function(){Me.isWindows=!!process.platform.match(/^win/);var h=process.binding("constants");h.fs&&(h=h.fs),Me.flagsForNodeMap={1024:h.O_APPEND,64:h.O_CREAT,128:h.O_EXCL,256:h.O_NOCTTY,0:h.O_RDONLY,2:h.O_RDWR,4096:h.O_SYNC,512:h.O_TRUNC,1:h.O_WRONLY,131072:h.O_NOFOLLOW}},convertNodeCode:function(h){return h=h.code,su[h]},mount:function(h){return Me.createNode(null,"/",Me.getMode(h.opts.root),0)},createNode:function(h,c,d,g){if(!T.isDir(d)&&!T.isFile(d)&&!T.isLink(d))throw new T.ErrnoError(28);return h=T.createNode(h,c,d),h.node_ops=Me.node_ops,h.stream_ops=Me.stream_ops,h},getMode:function(h){var c;try{c=nt.lstatSync(h),Me.isWindows&&(c.mode=c.mode|(292&c.mode)>>2)}catch(d){throw d.code?new T.ErrnoError(Me.convertNodeCode(d)):d}return c.mode},realPath:function(h){for(var c=[];h.parent!==h;)c.push(h.name),h=h.parent;return c.push(h.mount.opts.root),c.reverse(),Be.join.apply(null,c)},flagsForNode:function(h){h=-2097153&h&-2049&-32769&-524289&-65537;var c,d=0;for(c in Me.flagsForNodeMap)h&c&&(d|=Me.flagsForNodeMap[c],h^=c);if(h)throw new T.ErrnoError(28);return d},node_ops:{getattr:function(d){var c,d=Me.realPath(d);try{c=nt.lstatSync(d)}catch(g){throw g.code?new T.ErrnoError(Me.convertNodeCode(g)):g}return Me.isWindows&&!c.blksize&&(c.blksize=4096),Me.isWindows&&!c.blocks&&(c.blocks=(c.size+c.blksize-1)/c.blksize|0),{dev:c.dev,ino:c.ino,mode:c.mode,nlink:c.nlink,uid:c.uid,gid:c.gid,rdev:c.rdev,size:c.size,atime:c.atime,mtime:c.mtime,ctime:c.ctime,blksize:c.blksize,blocks:c.blocks}},setattr:function(h,c){var d,g=Me.realPath(h);try{c.mode!==void 0&&(nt.chmodSync(g,c.mode),h.mode=c.mode),c.timestamp!==void 0&&(d=new Date(c.timestamp),nt.utimesSync(g,d,d)),c.size!==void 0&&nt.truncateSync(g,c.size)}catch(p){throw p.code?new T.ErrnoError(Me.convertNodeCode(p)):p}},lookup:function(h,c){var d=Be.join2(Me.realPath(h),c),d=Me.getMode(d);return Me.createNode(h,c,d)},mknod:function(h,c,d,g){h=Me.createNode(h,c,d,g),c=Me.realPath(h);try{T.isDir(h.mode)?nt.mkdirSync(c,h.mode):nt.writeFileSync(c,"",{mode:h.mode})}catch(p){throw p.code?new T.ErrnoError(Me.convertNodeCode(p)):p}return h},rename:function(h,p,d){var g=Me.realPath(h),p=Be.join2(Me.realPath(p),d);try{nt.renameSync(g,p)}catch(b){throw b.code?new T.ErrnoError(Me.convertNodeCode(b)):b}h.name=d},unlink:function(h,c){h=Be.join2(Me.realPath(h),c);try{nt.unlinkSync(h)}catch(d){throw d.code?new T.ErrnoError(Me.convertNodeCode(d)):d}},rmdir:function(h,c){h=Be.join2(Me.realPath(h),c);try{nt.rmdirSync(h)}catch(d){throw d.code?new T.ErrnoError(Me.convertNodeCode(d)):d}},readdir:function(h){h=Me.realPath(h);try{return nt.readdirSync(h)}catch(c){throw c.code?new T.ErrnoError(Me.convertNodeCode(c)):c}},symlink:function(h,c,d){h=Be.join2(Me.realPath(h),c);try{nt.symlinkSync(d,h)}catch(g){throw g.code?new T.ErrnoError(Me.convertNodeCode(g)):g}},readlink:function(h){var c=Me.realPath(h);try{return c=nt.readlinkSync(c),Tt.relative(Tt.resolve(h.mount.opts.root),c)}catch(d){throw d.code?d.code==="UNKNOWN"?new T.ErrnoError(28):new T.ErrnoError(Me.convertNodeCode(d)):d}}},stream_ops:{open:function(h){var c=Me.realPath(h.node);try{T.isFile(h.node.mode)&&(h.nfd=nt.openSync(c,Me.flagsForNode(h.flags)))}catch(d){throw d.code?new T.ErrnoError(Me.convertNodeCode(d)):d}},close:function(h){try{T.isFile(h.node.mode)&&h.nfd&&nt.closeSync(h.nfd)}catch(c){throw c.code?new T.ErrnoError(Me.convertNodeCode(c)):c}},read:function(h,c,d,g,p){if(g===0)return 0;try{return nt.readSync(h.nfd,Buffer.from(c.buffer),d,g,p)}catch(b){throw new T.ErrnoError(Me.convertNodeCode(b))}},write:function(h,c,d,g,p){try{return nt.writeSync(h.nfd,Buffer.from(c.buffer),d,g,p)}catch(b){throw new T.ErrnoError(Me.convertNodeCode(b))}},llseek:function(h,c,d){if(d===1)c+=h.position;else if(d===2&&T.isFile(h.node.mode))try{c+=nt.fstatSync(h.nfd).size}catch(g){throw new T.ErrnoError(Me.convertNodeCode(g))}if(c<0)throw new T.ErrnoError(28);return c},mmap:function(h,c,d,g,p){if(!T.isFile(h.node.mode))throw new T.ErrnoError(43);var b=ul(c);return Me.stream_ops.read(h,vt,b,c,d),{ptr:b,allocated:!0}},msync:function(h,c,d,g,p){if(T.isFile(h.node.mode))return 2&p||Me.stream_ops.write(h,c,0,g,d,!1),0;throw new T.ErrnoError(43)}}},Rt={DIR_MODE:16895,FILE_MODE:33279,reader:null,mount:function(h){ws(Nn),Rt.reader||(Rt.reader=new FileReaderSync);var c=Rt.createNode(null,"/",Rt.DIR_MODE,0),d={};function g(b){for(var y=b.split("/"),w=c,D=0;D<y.length-1;D++){var M=y.slice(0,D+1).join("/");d[M]||(d[M]=Rt.createNode(w,y[D],Rt.DIR_MODE,0)),w=d[M]}return w}function p(b){return b=b.split("/"),b[b.length-1]}return Array.prototype.forEach.call(h.opts.files||[],function(b){Rt.createNode(g(b.name),p(b.name),Rt.FILE_MODE,0,b,b.lastModifiedDate)}),(h.opts.blobs||[]).forEach(function(b){Rt.createNode(g(b.name),p(b.name),Rt.FILE_MODE,0,b.data)}),(h.opts.packages||[]).forEach(function(b){b.metadata.files.forEach(function(y){var w=y.filename.substr(1);Rt.createNode(g(w),p(w),Rt.FILE_MODE,0,b.blob.slice(y.start,y.end))})}),c},createNode:function(h,c,d,g,p,b){var y=T.createNode(h,c,d);return y.mode=d,y.node_ops=Rt.node_ops,y.stream_ops=Rt.stream_ops,y.timestamp=(b||new Date).getTime(),ws(Rt.FILE_MODE!==Rt.DIR_MODE),d===Rt.FILE_MODE?(y.size=p.size,y.contents=p):(y.size=4096,y.contents={}),h&&(h.contents[c]=y),y},node_ops:{getattr:function(h){return{dev:1,ino:h.id,mode:h.mode,nlink:1,uid:0,gid:0,rdev:void 0,size:h.size,atime:new Date(h.timestamp),mtime:new Date(h.timestamp),ctime:new Date(h.timestamp),blksize:4096,blocks:Math.ceil(h.size/4096)}},setattr:function(h,c){c.mode!==void 0&&(h.mode=c.mode),c.timestamp!==void 0&&(h.timestamp=c.timestamp)},lookup:function(h,c){throw new T.ErrnoError(44)},mknod:function(h,c,d,g){throw new T.ErrnoError(63)},rename:function(h,c,d){throw new T.ErrnoError(63)},unlink:function(h,c){throw new T.ErrnoError(63)},rmdir:function(h,c){throw new T.ErrnoError(63)},readdir:function(h){var c,d=[".",".."];for(c in h.contents)h.contents.hasOwnProperty(c)&&d.push(c);return d},symlink:function(h,c,d){throw new T.ErrnoError(63)},readlink:function(h){throw new T.ErrnoError(63)}},stream_ops:{read:function(h,c,d,g,p){return p>=h.node.size?0:(h=h.node.contents.slice(p,p+g),p=Rt.reader.readAsArrayBuffer(h),c.set(new Uint8Array(p),d),h.size)},write:function(h,c,d,g,p){throw new T.ErrnoError(29)},llseek:function(h,c,d){if(d===1?c+=h.position:d===2&&T.isFile(h.node.mode)&&(c+=h.node.size),c<0)throw new T.ErrnoError(28);return c}}},T={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(h){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(!(h=Vi.resolve(T.cwd(),h)))return{path:"",node:null};if(8<(c=Object.assign({follow_mount:!0,recurse_count:0},c)).recurse_count)throw new T.ErrnoError(32);for(var d=Be.normalizeArray(h.split("/").filter(function(M){return!!M}),!1),g=T.root,p="/",b=0;b<d.length;b++){var y=b===d.length-1;if(y&&c.parent)break;if(g=T.lookupNode(g,d[b]),p=Be.join2(p,d[b]),!T.isMountpoint(g)||y&&!c.follow_mount||(g=g.mounted.root),!y||c.follow)for(var w=0;T.isLink(g.mode);){var D=T.readlink(p),p=Vi.resolve(Be.dirname(p),D),g=T.lookupPath(p,{recurse_count:c.recurse_count+1}).node;if(40<w++)throw new T.ErrnoError(32)}}return{path:p,node:g}},getPath:function(h){for(var c,d;;){if(T.isRoot(h))return d=h.mount.mountpoint,c?d[d.length-1]!=="/"?d+"/"+c:d+c:d;c=c?h.name+"/"+c:h.name,h=h.parent}},hashName:function(h,c){for(var d=0,g=0;g<c.length;g++)d=(d<<5)-d+c.charCodeAt(g)|0;return(h+d>>>0)%T.nameTable.length},hashAddNode:function(h){var c=T.hashName(h.parent.id,h.name);h.name_next=T.nameTable[c],T.nameTable[c]=h},hashRemoveNode:function(h){var c=T.hashName(h.parent.id,h.name);if(T.nameTable[c]===h)T.nameTable[c]=h.name_next;else for(var d=T.nameTable[c];d;){if(d.name_next===h){d.name_next=h.name_next;break}d=d.name_next}},lookupNode:function(h,c){var d=T.mayLookup(h);if(d)throw new T.ErrnoError(d,h);for(var d=T.hashName(h.id,c),g=T.nameTable[d];g;g=g.name_next){var p=g.name;if(g.parent.id===h.id&&p===c)return g}return T.lookup(h,c)},createNode:function(h,c,d,g){return h=new T.FSNode(h,c,d,g),T.hashAddNode(h),h},destroyNode:function(h){T.hashRemoveNode(h)},isRoot:function(h){return h===h.parent},isMountpoint:function(h){return!!h.mounted},isFile:function(h){return(61440&h)==32768},isDir:function(h){return(61440&h)==16384},isLink:function(h){return(61440&h)==40960},isChrdev:function(h){return(61440&h)==8192},isBlkdev:function(h){return(61440&h)==24576},isFIFO:function(h){return(61440&h)==4096},isSocket:function(h){return(49152&h)==49152},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(h){var c=T.flagModes[h];if(c===void 0)throw new Error("Unknown file open mode: "+h);return c},flagsToPermissionString:function(h){var c=["r","w","rw"][3&h];return 512&h&&(c+="w"),c},nodePermissions:function(h,c){return T.ignorePermissions||(!c.includes("r")||292&h.mode)&&(!c.includes("w")||146&h.mode)&&(!c.includes("x")||73&h.mode)?0:2},mayLookup:function(h){var c=T.nodePermissions(h,"x");return c||(h.node_ops.lookup?0:2)},mayCreate:function(h,c){try{return T.lookupNode(h,c),20}catch{}return T.nodePermissions(h,"wx")},mayDelete:function(h,c,d){var g;try{g=T.lookupNode(h,c)}catch(p){return p.errno}if(c=T.nodePermissions(h,"wx"),c)return c;if(d){if(!T.isDir(g.mode))return 54;if(T.isRoot(g)||T.getPath(g)===T.cwd())return 10}else if(T.isDir(g.mode))return 31;return 0},mayOpen:function(h,c){return h?T.isLink(h.mode)?32:T.isDir(h.mode)&&(T.flagsToPermissionString(c)!=="r"||512&c)?31:T.nodePermissions(h,T.flagsToPermissionString(c)):44},MAX_OPEN_FDS:4096,nextfd:function(){for(var h=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:T.MAX_OPEN_FDS,d=h;d<=c;d++)if(!T.streams[d])return d;throw new T.ErrnoError(33)},getStream:function(h){return T.streams[h]},createStream:function(h,c,d){return T.FSStream||(T.FSStream=function(){this.shared={}},T.FSStream.prototype={},Object.defineProperties(T.FSStream.prototype,{object:{get:function(){return this.node},set:function(g){this.node=g}},isRead:{get:function(){return(2097155&this.flags)!=1}},isWrite:{get:function(){return(2097155&this.flags)!=0}},isAppend:{get:function(){return 1024&this.flags}},flags:{get:function(){return this.shared.flags},set:function(g){this.shared.flags=g}},position:{get:function(){return this.shared.position},set:function(g){this.shared.position=g}}})),h=Object.assign(new T.FSStream,h),c=T.nextfd(c,d),h.fd=c,T.streams[c]=h},closeStream:function(h){T.streams[h]=null},chrdev_stream_ops:{open:function(h){var c=T.getDevice(h.node.rdev);h.stream_ops=c.stream_ops,h.stream_ops.open&&h.stream_ops.open(h)},llseek:function(){throw new T.ErrnoError(70)}},major:function(h){return h>>8},minor:function(h){return 255&h},makedev:function(h,c){return h<<8|c},registerDevice:function(h,c){T.devices[h]={stream_ops:c}},getDevice:function(h){return T.devices[h]},getMounts:function(h){for(var c=[],d=[h];d.length;){var g=d.pop();c.push(g),d.push.apply(d,g.mounts)}return c},syncfs:function(h,c){typeof h=="function"&&(c=h,h=!1),T.syncFSRequests++,1<T.syncFSRequests&&Ci("warning: "+T.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var d=T.getMounts(T.root.mount),g=0;function p(y){return T.syncFSRequests--,c(y)}function b(y){if(y)return b.errored?void 0:(b.errored=!0,p(y));++g>=d.length&&p(null)}d.forEach(function(y){if(!y.type.syncfs)return b(null);y.type.syncfs(y,h,b)})},mount:function(h,c,d){var g,p=d==="/",b=!d;if(p&&T.root)throw new T.ErrnoError(10);if(!p&&!b){if(b=T.lookupPath(d,{follow_mount:!1}),d=b.path,g=b.node,T.isMountpoint(g))throw new T.ErrnoError(10);if(!T.isDir(g.mode))throw new T.ErrnoError(54)}return b={type:h,opts:c,mountpoint:d,mounts:[]},c=h.mount(b),(c.mount=b).root=c,p?T.root=c:g&&(g.mounted=b,g.mount&&g.mount.mounts.push(b)),c},unmount:function(c){if(c=T.lookupPath(c,{follow_mount:!1}),!T.isMountpoint(c.node))throw new T.ErrnoError(28);var c=c.node,g=c.mounted,d=T.getMounts(g),g=(Object.keys(T.nameTable).forEach(function(p){for(var b=T.nameTable[p];b;){var y=b.name_next;d.includes(b.mount)&&T.destroyNode(b),b=y}}),c.mounted=null,c.mount.mounts.indexOf(g));c.mount.mounts.splice(g,1)},lookup:function(h,c){return h.node_ops.lookup(h,c)},mknod:function(p,c,d){var g=T.lookupPath(p,{parent:!0}).node,p=Be.basename(p);if(!p||p==="."||p==="..")throw new T.ErrnoError(28);var b=T.mayCreate(g,p);if(b)throw new T.ErrnoError(b);if(g.node_ops.mknod)return g.node_ops.mknod(g,p,c,d);throw new T.ErrnoError(63)},create:function(h,c){return T.mknod(h,c=(c=c!==void 0?c:438)&4095|32768,0)},mkdir:function(h,c){return T.mknod(h,c=(c=c!==void 0?c:511)&1023|16384,0)},mkdirTree:function(h,c){for(var d=h.split("/"),g="",p=0;p<d.length;++p)if(d[p]){g+="/"+d[p];try{T.mkdir(g,c)}catch(b){if(b.errno!=20)throw b}}},mkdev:function(h,c,d){return d===void 0&&(d=c,c=438),T.mknod(h,c|=8192,d)},symlink:function(h,g){if(!Vi.resolve(h))throw new T.ErrnoError(44);var d=T.lookupPath(g,{parent:!0}).node;if(!d)throw new T.ErrnoError(44);var g=Be.basename(g),p=T.mayCreate(d,g);if(p)throw new T.ErrnoError(p);if(d.node_ops.symlink)return d.node_ops.symlink(d,g,h);throw new T.ErrnoError(63)},rename:function(I,c){var d=Be.dirname(I),g=Be.dirname(c),p=Be.basename(I),b=Be.basename(c),y=T.lookupPath(I,{parent:!0}),y=y.node,w=T.lookupPath(c,{parent:!0}).node;if(!y||!w)throw new T.ErrnoError(44);if(y.mount!==w.mount)throw new T.ErrnoError(75);var D,M=T.lookupNode(y,p),I=Vi.relative(I,g);if(I.charAt(0)!==".")throw new T.ErrnoError(28);if((I=Vi.relative(c,d)).charAt(0)!==".")throw new T.ErrnoError(55);try{D=T.lookupNode(w,b)}catch{}if(M!==D){if(g=T.isDir(M.mode),c=T.mayDelete(y,p,g),c)throw new T.ErrnoError(c);if(c=D?T.mayDelete(w,b,g):T.mayCreate(w,b))throw new T.ErrnoError(c);if(!y.node_ops.rename)throw new T.ErrnoError(63);if(T.isMountpoint(M)||D&&T.isMountpoint(D))throw new T.ErrnoError(10);if(w!==y&&(c=T.nodePermissions(y,"w")))throw new T.ErrnoError(c);T.hashRemoveNode(M);try{y.node_ops.rename(M,w,b)}catch(O){throw O}finally{T.hashAddNode(M)}}},rmdir:function(d){var c=T.lookupPath(d,{parent:!0}).node,d=Be.basename(d),g=T.lookupNode(c,d),p=T.mayDelete(c,d,!0);if(p)throw new T.ErrnoError(p);if(!c.node_ops.rmdir)throw new T.ErrnoError(63);if(T.isMountpoint(g))throw new T.ErrnoError(10);c.node_ops.rmdir(c,d),T.destroyNode(g)},readdir:function(h){if(h=T.lookupPath(h,{follow:!0}).node,h.node_ops.readdir)return h.node_ops.readdir(h);throw new T.ErrnoError(54)},unlink:function(d){var c=T.lookupPath(d,{parent:!0}).node;if(!c)throw new T.ErrnoError(44);var d=Be.basename(d),g=T.lookupNode(c,d),p=T.mayDelete(c,d,!1);if(p)throw new T.ErrnoError(p);if(!c.node_ops.unlink)throw new T.ErrnoError(63);if(T.isMountpoint(g))throw new T.ErrnoError(10);c.node_ops.unlink(c,d),T.destroyNode(g)},readlink:function(h){if(h=T.lookupPath(h).node,!h)throw new T.ErrnoError(44);if(h.node_ops.readlink)return Vi.resolve(T.getPath(h.parent),h.node_ops.readlink(h));throw new T.ErrnoError(28)},stat:function(h,c){if(h=T.lookupPath(h,{follow:!c}).node,!h)throw new T.ErrnoError(44);if(h.node_ops.getattr)return h.node_ops.getattr(h);throw new T.ErrnoError(63)},lstat:function(h){return T.stat(h,!0)},chmod:function(h,c,d){if(!(d=typeof h=="string"?T.lookupPath(h,{follow:!d}).node:h).node_ops.setattr)throw new T.ErrnoError(63);d.node_ops.setattr(d,{mode:4095&c|-4096&d.mode,timestamp:Date.now()})},lchmod:function(h,c){T.chmod(h,c,!0)},fchmod:function(h,c){if(h=T.getStream(h),!h)throw new T.ErrnoError(8);T.chmod(h.node,c)},chown:function(h,c,d,g){if(!(g=typeof h=="string"?T.lookupPath(h,{follow:!g}).node:h).node_ops.setattr)throw new T.ErrnoError(63);g.node_ops.setattr(g,{timestamp:Date.now()})},lchown:function(h,c,d){T.chown(h,c,d,!0)},fchown:function(h,c,d){if(h=T.getStream(h),!h)throw new T.ErrnoError(8);T.chown(h.node,c,d)},truncate:function(h,c){if(c<0)throw new T.ErrnoError(28);if(!(h=typeof h=="string"?T.lookupPath(h,{follow:!0}).node:h).node_ops.setattr)throw new T.ErrnoError(63);if(T.isDir(h.mode))throw new T.ErrnoError(31);if(!T.isFile(h.mode))throw new T.ErrnoError(28);var d=T.nodePermissions(h,"w");if(d)throw new T.ErrnoError(d);h.node_ops.setattr(h,{size:c,timestamp:Date.now()})},ftruncate:function(h,c){if(h=T.getStream(h),!h)throw new T.ErrnoError(8);if((2097155&h.flags)==0)throw new T.ErrnoError(28);T.truncate(h.node,c)},utime:function(h,c,d){h=T.lookupPath(h,{follow:!0}).node,h.node_ops.setattr(h,{timestamp:Math.max(c,d)})},open:function(h,c,d){if(h==="")throw new T.ErrnoError(44);if(d=d===void 0?438:d,d=64&(c=typeof c=="string"?T.modeStringToFlags(c):c)?4095&d|32768:0,a(h)=="object")g=h;else{h=Be.normalize(h);try{var g=T.lookupPath(h,{follow:!(131072&c)}).node}catch{}}var p=!1;if(64&c)if(g){if(128&c)throw new T.ErrnoError(20)}else g=T.mknod(h,d,0),p=!0;if(!g)throw new T.ErrnoError(44);if(T.isChrdev(g.mode)&&(c&=-513),65536&c&&!T.isDir(g.mode))throw new T.ErrnoError(54);if(!p&&(d=T.mayOpen(g,c),d))throw new T.ErrnoError(d);return 512&c&&!p&&T.truncate(g,0),c&=-131713,d=T.createStream({node:g,path:T.getPath(g),flags:c,seekable:!0,position:0,stream_ops:g.stream_ops,ungotten:[],error:!1}),d.stream_ops.open&&d.stream_ops.open(d),!v.logReadFiles||1&c||(T.readFiles||(T.readFiles={}),h in T.readFiles||(T.readFiles[h]=1)),d},close:function(h){if(T.isClosed(h))throw new T.ErrnoError(8);h.getdents&&(h.getdents=null);try{h.stream_ops.close&&h.stream_ops.close(h)}catch(c){throw c}finally{T.closeStream(h.fd)}h.fd=null},isClosed:function(h){return h.fd===null},llseek:function(h,c,d){if(T.isClosed(h))throw new T.ErrnoError(8);if(!h.seekable||!h.stream_ops.llseek)throw new T.ErrnoError(70);if(d!=0&&d!=1&&d!=2)throw new T.ErrnoError(28);return h.position=h.stream_ops.llseek(h,c,d),h.ungotten=[],h.position},read:function(h,c,d,g,p){if(g<0||p<0)throw new T.ErrnoError(28);if(T.isClosed(h))throw new T.ErrnoError(8);if((2097155&h.flags)==1)throw new T.ErrnoError(8);if(T.isDir(h.node.mode))throw new T.ErrnoError(31);if(!h.stream_ops.read)throw new T.ErrnoError(28);var b=p!==void 0;if(b){if(!h.seekable)throw new T.ErrnoError(70)}else p=h.position;return c=h.stream_ops.read(h,c,d,g,p),b||(h.position+=c),c},write:function(h,c,d,g,p,b){if(g<0||p<0)throw new T.ErrnoError(28);if(T.isClosed(h))throw new T.ErrnoError(8);if((2097155&h.flags)==0)throw new T.ErrnoError(8);if(T.isDir(h.node.mode))throw new T.ErrnoError(31);if(!h.stream_ops.write)throw new T.ErrnoError(28);h.seekable&&1024&h.flags&&T.llseek(h,0,2);var y=p!==void 0;if(y){if(!h.seekable)throw new T.ErrnoError(70)}else p=h.position;return c=h.stream_ops.write(h,c,d,g,p,b),y||(h.position+=c),c},allocate:function(h,c,d){if(T.isClosed(h))throw new T.ErrnoError(8);if(c<0||d<=0)throw new T.ErrnoError(28);if((2097155&h.flags)==0)throw new T.ErrnoError(8);if(!T.isFile(h.node.mode)&&!T.isDir(h.node.mode))throw new T.ErrnoError(43);if(!h.stream_ops.allocate)throw new T.ErrnoError(138);h.stream_ops.allocate(h,c,d)},mmap:function(h,c,d,g,p){if((2&g)!=0&&(2&p)==0&&(2097155&h.flags)!=2)throw new T.ErrnoError(2);if((2097155&h.flags)==1)throw new T.ErrnoError(2);if(h.stream_ops.mmap)return h.stream_ops.mmap(h,c,d,g,p);throw new T.ErrnoError(43)},msync:function(h,c,d,g,p){return h&&h.stream_ops.msync?h.stream_ops.msync(h,c,d,g,p):0},munmap:function(h){return 0},ioctl:function(h,c,d){if(h.stream_ops.ioctl)return h.stream_ops.ioctl(h,c,d);throw new T.ErrnoError(59)},readFile:function(p){var c,d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(d.flags=d.flags||0,d.encoding=d.encoding||"binary",d.encoding!=="utf8"&&d.encoding!=="binary")throw new Error('Invalid encoding type "'+d.encoding+'"');var g=T.open(p,d.flags),p=T.stat(p).size,b=new Uint8Array(p);return T.read(g,b,0,p,0),d.encoding==="utf8"?c=Cs(b,0):d.encoding==="binary"&&(c=b),T.close(g),c},writeFile:function(g,c){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},g=(d.flags=d.flags||577,T.open(g,d.flags,d.mode));if(typeof c=="string"){var p=new Uint8Array(xs(c)+1),b=Lo(c,p,0,p.length);T.write(g,p,0,b,void 0,d.canOwn)}else{if(!ArrayBuffer.isView(c))throw new Error("Unsupported data type");T.write(g,c,0,c.byteLength,void 0,d.canOwn)}T.close(g)},cwd:function(){return T.currentPath},chdir:function(h){if(h=T.lookupPath(h,{follow:!0}),h.node===null)throw new T.ErrnoError(44);if(!T.isDir(h.node.mode))throw new T.ErrnoError(54);var c=T.nodePermissions(h.node,"x");if(c)throw new T.ErrnoError(c);T.currentPath=h.path},createDefaultDirectories:function(){T.mkdir("/tmp"),T.mkdir("/home"),T.mkdir("/home/web_user")},createDefaultDevices:function(){T.mkdir("/dev"),T.registerDevice(T.makedev(1,3),{read:function(){return 0},write:function(c,d,g,p,b){return p}}),T.mkdev("/dev/null",T.makedev(1,3)),Hn.register(T.makedev(5,0),Hn.default_tty_ops),Hn.register(T.makedev(6,0),Hn.default_tty1_ops),T.mkdev("/dev/tty",T.makedev(5,0)),T.mkdev("/dev/tty1",T.makedev(6,0));var h=nu();T.createDevice("/dev","random",h),T.createDevice("/dev","urandom",h),T.mkdir("/dev/shm"),T.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){T.mkdir("/proc");var h=T.mkdir("/proc/self");T.mkdir("/proc/self/fd"),T.mount({mount:function(){var c=T.createNode(h,"fd",16895,73);return c.node_ops={lookup:function(d,g){var p=T.getStream(+g);if(!p)throw new T.ErrnoError(8);return g={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return p.path}}},g.parent=g}},c}},{},"/proc/self/fd")},createStandardStreams:function(){v.stdin?T.createDevice("/dev","stdin",v.stdin):T.symlink("/dev/tty","/dev/stdin"),v.stdout?T.createDevice("/dev","stdout",null,v.stdout):T.symlink("/dev/tty","/dev/stdout"),v.stderr?T.createDevice("/dev","stderr",null,v.stderr):T.symlink("/dev/tty1","/dev/stderr"),T.open("/dev/stdin",0),T.open("/dev/stdout",1),T.open("/dev/stderr",1)},ensureErrnoError:function(){T.ErrnoError||(T.ErrnoError=function(h,c){this.node=c,this.setErrno=function(d){this.errno=d},this.setErrno(h),this.message="FS error"},T.ErrnoError.prototype=new Error,T.ErrnoError.prototype.constructor=T.ErrnoError,[44].forEach(function(h){T.genericErrors[h]=new T.ErrnoError(h),T.genericErrors[h].stack="<generic error, no stack>"}))},staticInit:function(){T.ensureErrnoError(),T.nameTable=new Array(4096),T.mount(Pe,{},"/"),T.createDefaultDirectories(),T.createDefaultDevices(),T.createSpecialDirectories(),T.filesystems={MEMFS:Pe,NODEFS:Me,WORKERFS:Rt}},init:function(h,c,d){T.init.initialized=!0,T.ensureErrnoError(),v.stdin=h||v.stdin,v.stdout=c||v.stdout,v.stderr=d||v.stderr,T.createStandardStreams()},quit:function(){T.init.initialized=!1;for(var h=0;h<T.streams.length;h++){var c=T.streams[h];c&&T.close(c)}},getMode:function(h,c){var d=0;return h&&(d|=365),c&&(d|=146),d},findObject:function(h,c){return h=T.analyzePath(h,c),h.exists?h.object:null},analyzePath:function(h,c){try{h=(g=T.lookupPath(h,{follow:!c})).path}catch{}var d={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var g=T.lookupPath(h,{parent:!0});d.parentExists=!0,d.parentPath=g.path,d.parentObject=g.node,d.name=Be.basename(h),g=T.lookupPath(h,{follow:!c}),d.exists=!0,d.path=g.path,d.object=g.node,d.name=g.node.name,d.isRoot=g.path==="/"}catch(p){d.error=p.errno}return d},createPath:function(h,c,d,g){h=typeof h=="string"?h:T.getPath(h);for(var p=c.split("/").reverse();p.length;){var b=p.pop();if(b){var y=Be.join2(h,b);try{T.mkdir(y)}catch{}h=y}}return y},createFile:function(h,c,d,g,p){return h=Be.join2(typeof h=="string"?h:T.getPath(h),c),c=T.getMode(g,p),T.create(h,c)},createDataFile:function(D,w,d,g,p,b){var y=w,w=(D&&(D=typeof D=="string"?D:T.getPath(D),y=w?Be.join2(D,w):D),T.getMode(g,p)),D=T.create(y,w);if(d){if(typeof d=="string"){for(var M=new Array(d.length),I=0,O=d.length;I<O;++I)M[I]=d.charCodeAt(I);d=M}T.chmod(D,146|w),g=T.open(D,577),T.write(g,d,0,d.length,0,b),T.close(g),T.chmod(D,w)}return D},createDevice:function(p,b,d,g){var p=Be.join2(typeof p=="string"?p:T.getPath(p),b),b=T.getMode(!!d,!!g),y=(T.createDevice.major||(T.createDevice.major=64),T.makedev(T.createDevice.major++,0));return T.registerDevice(y,{open:function(w){w.seekable=!1},close:function(w){g&&g.buffer&&g.buffer.length&&g(10)},read:function(w,D,M,I,O){for(var j,V=0,Q=0;Q<I;Q++){try{j=d()}catch{throw new T.ErrnoError(29)}if(j===void 0&&V===0)throw new T.ErrnoError(6);if(j==null)break;V++,D[M+Q]=j}return V&&(w.node.timestamp=Date.now()),V},write:function(w,D,M,I,O){for(var j=0;j<I;j++)try{g(D[M+j])}catch{throw new T.ErrnoError(29)}return I&&(w.node.timestamp=Date.now()),j}}),T.mkdev(p,b,y)},forceLoadFile:function(h){if(h.isDevice||h.isFolder||h.link||h.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!je)throw new Error("Cannot load without read() or XMLHttpRequest.");try{h.contents=Io(je(h.url),!0),h.usedBytes=h.contents.length}catch{throw new T.ErrnoError(29)}},createLazyFile:function(h,c,d,g,p){function b(){this.lengthKnown=!1,this.chunks=[]}if(b.prototype.get=function(I){var O;if(!(I>this.length-1||I<0))return O=I%this.chunkSize,I=I/this.chunkSize|0,this.getter(I)[O]},b.prototype.setDataGetter=function(I){this.getter=I},b.prototype.cacheLength=function(){var V=new XMLHttpRequest;if(V.open("HEAD",d,!1),V.send(null),!(200<=V.status&&V.status<300||V.status===304))throw new Error("Couldn't load "+d+". Status: "+V.status);var I,O=Number(V.getResponseHeader("Content-length")),j=(I=V.getResponseHeader("Accept-Ranges"))&&I==="bytes",V=(I=V.getResponseHeader("Content-Encoding"))&&I==="gzip",Q=1048576,ce=(j||(Q=O),this);ce.setDataGetter(function(le){var q=le*Q,ve=(le+1)*Q-1,ve=Math.min(ve,O-1);if(ce.chunks[le]===void 0&&(ce.chunks[le]=function(Ce,Ve){if(Ve<Ce)throw new Error("invalid range ("+Ce+", "+Ve+") or no bytes requested!");if(O-1<Ve)throw new Error("only "+O+" bytes available! programmer error!");var We=new XMLHttpRequest;if(We.open("GET",d,!1),O!==Q&&We.setRequestHeader("Range","bytes="+Ce+"-"+Ve),We.responseType="arraybuffer",We.overrideMimeType&&We.overrideMimeType("text/plain; charset=x-user-defined"),We.send(null),200<=We.status&&We.status<300||We.status===304)return We.response!==void 0?new Uint8Array(We.response||[]):Io(We.responseText||"",!0);throw new Error("Couldn't load "+d+". Status: "+We.status)}(q,ve)),ce.chunks[le]===void 0)throw new Error("doXHR failed!");return ce.chunks[le]}),!V&&O||(Q=O=1,O=this.getter(0).length,Q=O,Ro("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=O,this._chunkSize=Q,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!Nn)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var y=new b,y=(Object.defineProperties(y,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}}),{isDevice:!1,contents:y})}else y={isDevice:!1,url:d};var w=T.createFile(h,c,y,g,p),D=(y.contents?w.contents=y.contents:y.url&&(w.contents=null,w.url=y.url),Object.defineProperties(w,{usedBytes:{get:function(){return this.contents.length}}}),{});function M(I,O,j,V,Q){var ce=I.node.contents;if(Q>=ce.length)return 0;var le=Math.min(ce.length-Q,V);if(ce.slice)for(var q=0;q<le;q++)O[j+q]=ce[Q+q];else for(q=0;q<le;q++)O[j+q]=ce.get(Q+q);return le}return Object.keys(w.stream_ops).forEach(function(I){var O=w.stream_ops[I];D[I]=function(){return T.forceLoadFile(w),O.apply(null,arguments)}}),D.read=function(I,O,j,V,Q){return T.forceLoadFile(w),M(I,O,j,V,Q)},D.mmap=function(I,O,j,V,Q){T.forceLoadFile(w);var ce=ul(O);if(ce)return M(I,vt,ce,O,j),{ptr:ce,allocated:!0};throw new T.ErrnoError(48)},w.stream_ops=D,w},createPreloadedFile:function(h,c,d,g,p,b,y,w,D,M){var I,O,j,V,Q=c?Vi.resolve(Be.join2(h,c)):h;function ce(le){function q(ve){M&&M(),w||T.createDataFile(h,c,ve,g,p,D),b&&b(),xr()}Browser.handledByPreloadPlugin(le,Q,q,function(){y&&y(),xr()})||q(le)}Do(),typeof d=="string"?(I=d,O=function(le){ce(le)},j=y,V="al "+I,Ke(I,function(le){ws(le,'Loading data file "'+I+'" failed (no arrayBuffer).'),O(new Uint8Array(le)),V&&xr()},function(le){if(!j)throw'Loading data file "'+I+'" failed.';j()}),V&&Do()):ce(d)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(h,c,d){c=c||function(){},d=d||function(){};var g=T.indexedDB();try{var p=g.open(T.DB_NAME(),T.DB_VERSION)}catch(b){return d(b)}p.onupgradeneeded=function(){Ro("creating db"),p.result.createObjectStore(T.DB_STORE_NAME)},p.onsuccess=function(){var b=p.result.transaction([T.DB_STORE_NAME],"readwrite"),y=b.objectStore(T.DB_STORE_NAME),w=0,D=0,M=h.length;function I(){(D==0?c:d)()}h.forEach(function(O){O=y.put(T.analyzePath(O).object.contents,O),O.onsuccess=function(){++w+D==M&&I()},O.onerror=function(){w+ ++D==M&&I()}}),b.onerror=d},p.onerror=d},loadFilesFromDB:function(h,c,d){c=c||function(){},d=d||function(){};var g=T.indexedDB();try{var p=g.open(T.DB_NAME(),T.DB_VERSION)}catch(b){return d(b)}p.onupgradeneeded=d,p.onsuccess=function(){var b=p.result;try{var y=b.transaction([T.DB_STORE_NAME],"readonly")}catch(j){return void d(j)}var w=y.objectStore(T.DB_STORE_NAME),D=0,M=0,I=h.length;function O(){(M==0?c:d)()}h.forEach(function(j){var V=w.get(j);V.onsuccess=function(){T.analyzePath(j).exists&&T.unlink(j),T.createDataFile(Be.dirname(j),Be.basename(j),V.result,!0,!0,!0),++D+M==I&&O()},V.onerror=function(){D+ ++M==I&&O()}}),y.onerror=d},p.onerror=d}},Le={DEFAULT_POLLMASK:5,calculateAt:function(h,c,d){if(Be.isAbs(c))return c;var g;if(h===-100)g=T.cwd();else{if(h=T.getStream(h),!h)throw new T.ErrnoError(8);g=h.path}if(c.length!=0)return Be.join2(g,c);if(d)return g;throw new T.ErrnoError(44)},doStat:function(h,c,d){try{var g=h(c)}catch(p){if(p&&p.node&&Be.normalize(c)!==Be.normalize(T.getPath(p.node)))return-54;throw p}return re[d>>2]=g.dev,re[d+4>>2]=0,re[d+8>>2]=g.ino,re[d+12>>2]=g.mode,re[d+16>>2]=g.nlink,re[d+20>>2]=g.uid,re[d+24>>2]=g.gid,re[d+28>>2]=g.rdev,re[d+32>>2]=0,Dt=[g.size>>>0,($e=g.size,1<=+Math.abs($e)?0<$e?(0|Math.min(+Math.floor($e/4294967296),4294967295))>>>0:~~+Math.ceil(($e-(~~$e>>>0))/4294967296)>>>0:0)],re[d+40>>2]=Dt[0],re[d+44>>2]=Dt[1],re[d+48>>2]=4096,re[d+52>>2]=g.blocks,re[d+56>>2]=g.atime.getTime()/1e3|0,re[d+64>>2]=0,re[d+72>>2]=g.mtime.getTime()/1e3|0,re[d+80>>2]=0,re[d+88>>2]=g.ctime.getTime()/1e3|0,re[d+96>>2]=0,Dt=[g.ino>>>0,($e=g.ino,1<=+Math.abs($e)?0<$e?(0|Math.min(+Math.floor($e/4294967296),4294967295))>>>0:~~+Math.ceil(($e-(~~$e>>>0))/4294967296)>>>0:0)],re[d+104>>2]=Dt[0],re[d+108>>2]=Dt[1],0},doMsync:function(h,c,d,g,p){h=Gn.slice(h,h+d),T.msync(c,h,p,d,g)},varargs:void 0,get:function(){return Le.varargs+=4,re[Le.varargs-4>>2]},getStr:function(h){return Bn(h)},getStreamFromFD:function(h){if(h=T.getStream(h),h)return h;throw new T.ErrnoError(8)}};function Fo(h,c){return c+2097152>>>0<4194305-!!h?(h>>>0)+4294967296*c:NaN}var _t={BUCKET_BUFFER_SIZE:8192,mount:function(h){return T.createNode(null,"/",16895,0)},createPipe:function(){var g={buckets:[],refcnt:2},p=(g.buckets.push({buffer:new Uint8Array(_t.BUCKET_BUFFER_SIZE),offset:0,roffset:0}),_t.nextname()),h=_t.nextname(),c=T.createNode(_t.root,p,4096,0),d=T.createNode(_t.root,h,4096,0),g=(c.pipe=g,d.pipe=g,T.createStream({path:p,node:c,flags:0,seekable:!1,stream_ops:_t.stream_ops})),p=(c.stream=g,T.createStream({path:h,node:d,flags:1,seekable:!1,stream_ops:_t.stream_ops}));return d.stream=p,{readable_fd:g.fd,writable_fd:p.fd}},stream_ops:{poll:function(h){var c=h.node.pipe;if((2097155&h.flags)==1)return 260;if(0<c.buckets.length)for(var d=0;d<c.buckets.length;d++){var g=c.buckets[d];if(0<g.offset-g.roffset)return 65}return 0},ioctl:function(h,c,d){return 28},fsync:function(h){return 28},read:function(h,c,d,g,p){for(var b=h.node.pipe,y=0,w=0;w<b.buckets.length;w++){var D=b.buckets[w];y+=D.offset-D.roffset}ws(c instanceof ArrayBuffer||ArrayBuffer.isView(c));var M=c.subarray(d,d+g);if(g<=0)return 0;if(y==0)throw new T.ErrnoError(6);for(var I=Math.min(y,g),h=I,O=0,w=0;w<b.buckets.length;w++){var j=b.buckets[w],V=j.offset-j.roffset;if(I<=V){var Q=j.buffer.subarray(j.roffset,j.offset);I<V?(Q=Q.subarray(0,I),j.roffset+=I):O++,M.set(Q);break}Q=j.buffer.subarray(j.roffset,j.offset),M.set(Q),M=M.subarray(Q.byteLength),I-=Q.byteLength,O++}return O&&O==b.buckets.length&&(b.buckets[--O].offset=0,b.buckets[O].roffset=0),b.buckets.splice(0,O),h},write:function(w,c,d,g,p){var b=w.node.pipe,y=(ws(c instanceof ArrayBuffer||ArrayBuffer.isView(c)),c.subarray(d,d+g)),w=y.byteLength;if(w<=0)return 0;if(c=null,b.buckets.length==0?(c={buffer:new Uint8Array(_t.BUCKET_BUFFER_SIZE),offset:0,roffset:0},b.buckets.push(c)):c=b.buckets[b.buckets.length-1],ws(c.offset<=_t.BUCKET_BUFFER_SIZE),d=_t.BUCKET_BUFFER_SIZE-c.offset,w<=d)return c.buffer.set(y,c.offset),c.offset+=w,w;0<d&&(c.buffer.set(y.subarray(0,d),c.offset),c.offset+=d,y=y.subarray(d,y.byteLength));for(var D=y.byteLength/_t.BUCKET_BUFFER_SIZE|0,g=y.byteLength%_t.BUCKET_BUFFER_SIZE,M=0;M<D;M++){var I={buffer:new Uint8Array(_t.BUCKET_BUFFER_SIZE),offset:_t.BUCKET_BUFFER_SIZE,roffset:0};b.buckets.push(I),I.buffer.set(y.subarray(0,_t.BUCKET_BUFFER_SIZE)),y=y.subarray(_t.BUCKET_BUFFER_SIZE,y.byteLength)}return 0<g&&(I={buffer:new Uint8Array(_t.BUCKET_BUFFER_SIZE),offset:y.byteLength,roffset:0},b.buckets.push(I),I.buffer.set(y)),w},close:function(h){h=h.node.pipe,h.refcnt--,h.refcnt===0&&(h.buckets=null)}},nextname:function(){return _t.nextname.current||(_t.nextname.current=0),"pipe["+_t.nextname.current+++"]"}},ru="To use dlopen, you need enable dynamic linking, see https://github.com/emscripten-core/emscripten/wiki/Linking";function ou(h){var c=xs(h)+1,d=fl(c);return d&&Lo(h,vt,d,c),d}function dl(h,c,d){var g,p,b,y,w;function D(M){return M=M.toTimeString().match(/\(([A-Za-z ]+)\)$/),M?M[1]:"GMT"}dl.called||(dl.called=!0,h=h,c=c,d=d,g=new Date().getFullYear(),p=new Date(g,0,1),g=new Date(g,6,1),b=p.getTimezoneOffset(),y=g.getTimezoneOffset(),w=Math.max(b,y),re[h>>2]=60*w,re[c>>2]=Number(b!=y),h=D(p),w=D(g),c=ou(h),p=ou(w),y<b?(Et[d>>2]=c,Et[d+4>>2]=p):(Et[d>>2]=p,Et[d+4>>2]=c))}function au(){return 2147483648}var Po=Es?function(){var h=process.hrtime();return 1e3*h[0]+h[1]/1e6}:function(){return performance.now()},Oo={};function Rr(){if(!Rr.strings){var h={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:((typeof navigator>"u"?"undefined":a(navigator))=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:nl||"./this.program"};for(c in Oo)Oo[c]===void 0?delete h[c]:h[c]=Oo[c];var c,d=[];for(c in h)d.push(c+"="+h[c]);Rr.strings=d}return Rr.strings}function Yp(h,c){h=h,Xc||(v.onExit&&v.onExit(h),So=!0),sl(h,new hl(h))}function ko(h,c){ko.randomDevice||(ko.randomDevice=nu());for(var d=0;d<c;d++)vt[h+d>>0]=ko.randomDevice();return 0}function No(h){return h%4==0&&(h%100!=0||h%400==0)}var lu=[31,29,31,30,31,30,31,31,30,31,30,31],hu=[31,28,31,30,31,30,31,31,30,31,30,31];function cu(h,c,d,g){var p=re[g+40>>2],b={tm_sec:re[g>>2],tm_min:re[g+4>>2],tm_hour:re[g+8>>2],tm_mday:re[g+12>>2],tm_mon:re[g+16>>2],tm_year:re[g+20>>2],tm_wday:re[g+24>>2],tm_yday:re[g+28>>2],tm_isdst:re[g+32>>2],tm_gmtoff:re[g+36>>2],tm_zone:p?Bn(p):""},le=Bn(d),y={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(Q in y)le=le.replace(new RegExp(Q,"g"),y[Q]);var w=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],D=["January","February","March","April","May","June","July","August","September","October","November","December"];function M(q,ve,Ce){for(var Ve=typeof q=="number"?q.toString():q||"";Ve.length<ve;)Ve=Ce[0]+Ve;return Ve}function I(q,ve){return M(q,ve,"0")}function O(q,ve){function Ce(We){return We<0?-1:0<We?1:0}var Ve;return Ve=(Ve=Ce(q.getFullYear()-ve.getFullYear()))===0&&(Ve=Ce(q.getMonth()-ve.getMonth()))===0?Ce(q.getDate()-ve.getDate()):Ve}function j(q){switch(q.getDay()){case 0:return new Date(q.getFullYear()-1,11,29);case 1:return q;case 2:return new Date(q.getFullYear(),0,3);case 3:return new Date(q.getFullYear(),0,2);case 4:return new Date(q.getFullYear(),0,1);case 5:return new Date(q.getFullYear()-1,11,31);case 6:return new Date(q.getFullYear()-1,11,30)}}function V(ve){var ve=function(We,ni){for(var Ct=new Date(We.getTime());0<ni;){var cn=No(Ct.getFullYear()),Vn=Ct.getMonth(),cn=(cn?lu:hu)[Vn];if(!(ni>cn-Ct.getDate()))return Ct.setDate(Ct.getDate()+ni),Ct;ni-=cn-Ct.getDate()+1,Ct.setDate(1),Vn<11?Ct.setMonth(Vn+1):(Ct.setMonth(0),Ct.setFullYear(Ct.getFullYear()+1))}return Ct}(new Date(ve.tm_year+1900,0,1),ve.tm_yday),Ce=new Date(ve.getFullYear(),0,4),Ve=new Date(ve.getFullYear()+1,0,4),Ce=j(Ce),Ve=j(Ve);return O(Ce,ve)<=0?O(Ve,ve)<=0?ve.getFullYear()+1:ve.getFullYear():ve.getFullYear()-1}var Q,ce={"%a":function(q){return w[q.tm_wday].substring(0,3)},"%A":function(q){return w[q.tm_wday]},"%b":function(q){return D[q.tm_mon].substring(0,3)},"%B":function(q){return D[q.tm_mon]},"%C":function(q){return I((q.tm_year+1900)/100|0,2)},"%d":function(q){return I(q.tm_mday,2)},"%e":function(q){return M(q.tm_mday,2," ")},"%g":function(q){return V(q).toString().substring(2)},"%G":V,"%H":function(q){return I(q.tm_hour,2)},"%I":function(q){return q=q.tm_hour,q==0?q=12:12<q&&(q-=12),I(q,2)},"%j":function(q){return I(q.tm_mday+function(ve,Ce){for(var Ve=0,We=0;We<=Ce;Ve+=ve[We++]);return Ve}(No(q.tm_year+1900)?lu:hu,q.tm_mon-1),3)},"%m":function(q){return I(q.tm_mon+1,2)},"%M":function(q){return I(q.tm_min,2)},"%n":function(){return`
`},"%p":function(q){return 0<=q.tm_hour&&q.tm_hour<12?"AM":"PM"},"%S":function(q){return I(q.tm_sec,2)},"%t":function(){return"	"},"%u":function(q){return q.tm_wday||7},"%U":function(q){return q=q.tm_yday+7-q.tm_wday,I(Math.floor(q/7),2)},"%V":function(q){var ve,Ce=Math.floor((q.tm_yday+7-(q.tm_wday+6)%7)/7);return(q.tm_wday+371-q.tm_yday-2)%7<=2&&Ce++,Ce?Ce!=53||(ve=(q.tm_wday+371-q.tm_yday)%7)==4||ve==3&&No(q.tm_year)||(Ce=1):(Ce=52,((ve=(q.tm_wday+7-q.tm_yday-1)%7)==4||ve==5&&No(q.tm_year%400-1))&&Ce++),I(Ce,2)},"%w":function(q){return q.tm_wday},"%W":function(q){return q=q.tm_yday+7-(q.tm_wday+6)%7,I(Math.floor(q/7),2)},"%y":function(q){return(q.tm_year+1900).toString().substring(2)},"%Y":function(q){return q.tm_year+1900},"%z":function(Ce){var ve=0<=(Ce=Ce.tm_gmtoff),Ce=Math.abs(Ce)/60;return(ve?"+":"-")+String("0000"+(Ce/60*100+Ce%60)).slice(-4)},"%Z":function(q){return q.tm_zone},"%%":function(){return"%"}},le=le.replace(/%%/g,"\0\0");for(Q in ce)le.includes(Q)&&(le=le.replace(new RegExp(Q,"g"),ce[Q](b)));return g=Io(le=le.replace(/\0\0/g,"%"),!1),g.length>c?0:(tu(g,h),g.length-1)}function uu(h,c){h<128?c.push(h):c.push(h%128|128,h>>7)}function Kp(h,c){if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(function(w){for(var D={i:"i32",j:"i64",f:"f32",d:"f64",p:"i32"},M={parameters:[],results:w[0]=="v"?[]:[D[w[0]]]},I=1;I<w.length;++I)M.parameters.push(D[w[I]]);return M}(c),h);var d=[1,96],g=c.slice(0,1),p=c.slice(1),b={i:127,p:127,j:126,f:125,d:124};uu(p.length,d);for(var y=0;y<p.length;++y)d.push(b[p[y]]);return g=="v"?d.push(0):d.push(1,b[g]),c=[0,97,115,109,1,0,0,0,1],uu(d.length,c),c.push.apply(c,d),c.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),g=new WebAssembly.Module(new Uint8Array(c)),new WebAssembly.Instance(g,{e:{f:h}}).exports.f}var Un=void 0,du=[];function fu(h,c){zn.set(h,c),Tr[h]=zn.get(h)}function gu(h){return v["_"+h]}function mu(y,c,d,g,p){var b={string:function(O){var j,V=0;return O!=null&&O!==0&&(j=1+(O.length<<2),wr(O,V=gl(j),j)),V},array:function(O){var j=gl(O.length);return tu(O,j),j}},y=gu(y),w=[],D=0;if(g)for(var M=0;M<g.length;M++){var I=b[d[M]];I?(D===0&&(D=z()),w[M]=I(g[M])):w[M]=g[M]}return y=y.apply(null,w),y=y,D!==0&&B(D),y=y,c==="string"?Bn(y):c==="boolean"?Boolean(y):y}function pu(h,c,d,g){this.parent=h=h||this,this.mount=h.mount,this.mounted=null,this.id=T.nextInode++,this.name=c,this.mode=d,this.node_ops={},this.stream_ops={},this.rdev=g}Object.defineProperties(pu.prototype,{read:{get:function(){return(365&this.mode)==365},set:function(h){h?this.mode|=365:this.mode&=-366}},write:{get:function(){return(146&this.mode)==146},set:function(h){h?this.mode|=146:this.mode&=-147}},isFolder:{get:function(){return T.isDir(this.mode)}},isDevice:{get:function(){return T.isChrdev(this.mode)}}}),T.FSNode=pu,T.staticInit(),v.FS_createPath=T.createPath,v.FS_createDataFile=T.createDataFile,v.FS_createPreloadedFile=T.createPreloadedFile,v.FS_unlink=T.unlink,v.FS_createLazyFile=T.createLazyFile,v.FS_createDevice=T.createDevice,Es&&(Mi(),Me.staticInit()),su={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135};var Go,$p={t:function(h,c,d,g){ii("Assertion failed: "+Bn(h)+", at: "+[c?Bn(c):"unknown filename",d,g?Bn(g):"unknown function"])},re:function(h,c){X(h)(c)},o:function(h){return fl(h+24)+24},u:function(h){return(h=new Ts(h)).get_caught()||(h.set_caught(!0),Mo--),h.set_rethrown(!1),Ao.push(h),h.add_ref(),h.get_exception_ptr()},Ne:function(h){throw Ci("Unexpected exception thrown, this is not properly supported - aborting"),So=!0,h},y:function(){G(0);var h,c=Ao.pop();(c=c).release_ref()&&!c.get_rethrown()&&((h=c.get_destructor())&&X(h)(c.excPtr),iu(c.excPtr)),hn=0},b:function(){var h=hn;if(!h)return di(0),0;var c=new Ts(h),d=(c.set_adjusted_ptr(h),c.get_type());if(!d)return di(0),h;for(var g=Array.prototype.slice.call(arguments),p=0;p<g.length;p++){var b=g[p];if(b===0||b===d)break;var y=c.ptr+16;if(zo(b,d,y))return di(b),h}return di(d),h},j:function(){var h=hn;if(!h)return di(0),0;var c=new Ts(h),d=(c.set_adjusted_ptr(h),c.get_type());if(!d)return di(0),h;for(var g=Array.prototype.slice.call(arguments),p=0;p<g.length;p++){var b=g[p];if(b===0||b===d)break;var y=c.ptr+16;if(zo(b,d,y))return di(b),h}return di(d),h},C:function(){var h=hn;if(!h)return di(0),0;var c=new Ts(h),d=(c.set_adjusted_ptr(h),c.get_type());if(!d)return di(0),h;for(var g=Array.prototype.slice.call(arguments),p=0;p<g.length;p++){var b=g[p];if(b===0||b===d)break;var y=c.ptr+16;if(zo(b,d,y))return di(b),h}return di(d),h},p:iu,wb:function(){var h=Ao.pop(),c=(h||ii("no exception to throw"),h.excPtr);throw h.get_rethrown()||(Ao.push(h),h.set_rethrown(!0),h.set_caught(!1),Mo++),hn=c},J:function(h,c,d){throw new Ts(h).init(c,d),Mo++,hn=h},uc:function(){return Mo},f:function(h){throw hn=hn||h,h},dc:function(h,c){try{return h=Le.getStr(h),T.chmod(h,c),0}catch(d){if(T!==void 0&&d instanceof T.ErrnoError)return-d.errno;throw d}},lc:function(h,c,d,g){try{if(c=Le.getStr(c),c=Le.calculateAt(h,c),-8&d)return-28;var p=T.lookupPath(c,{follow:!0}).node;if(!p)return-44;var b="";return 4&d&&(b+="r"),2&d&&(b+="w"),1&d&&(b+="x"),b&&T.nodePermissions(p,b)?-2:0}catch(y){if(T!==void 0&&y instanceof T.ErrnoError)return-y.errno;throw y}},Fd:function(h,c,d,g,p,b){try{var y=Fo(d,g);if(isNaN(y))return-61;var w=Fo(p,b);if(isNaN(w))return-61;var D=Le.getStreamFromFD(h);return T.allocate(D,y,w),0}catch(M){if(T!==void 0&&M instanceof T.ErrnoError)return-M.errno;throw M}},ec:function(h,c){try{return T.fchmod(h,c),0}catch(d){if(T!==void 0&&d instanceof T.ErrnoError)return-d.errno;throw d}},cc:function(h,c,d){try{return T.fchown(h,c,d),0}catch(g){if(T!==void 0&&g instanceof T.ErrnoError)return-g.errno;throw g}},wa:function(h,c,d){Le.varargs=d;try{var g=Le.getStreamFromFD(h);switch(c){case 0:return(p=Le.get())<0?-28:T.createStream(g,p).fd;case 1:case 2:return 0;case 3:return g.flags;case 4:var p=Le.get();return g.flags|=p,0;case 5:return p=Le.get(),Er[p+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return b=28,re[bu()>>2]=b,-1;default:return-28}}catch(y){if(T!==void 0&&y instanceof T.ErrnoError)return-y.errno;throw y}var b},jc:function(h){try{return Le.getStreamFromFD(h),0}catch(c){if(T!==void 0&&c instanceof T.ErrnoError)return-c.errno;throw c}},ve:function(h,c){try{var d=Le.getStreamFromFD(h);return Le.doStat(T.stat,d.path,c)}catch(g){if(T!==void 0&&g instanceof T.ErrnoError)return-g.errno;throw g}},Pd:function(h,c,d){try{var g=Fo(c,d);return isNaN(g)?-61:(T.ftruncate(h,g),0)}catch(p){if(T!==void 0&&p instanceof T.ErrnoError)return-p.errno;throw p}},vc:function(h,c){try{if(c===0)return-28;var d=T.cwd(),g=xs(d)+1;return c<g?-68:(wr(d,h,c),g)}catch(p){if(T!==void 0&&p instanceof T.ErrnoError)return-p.errno;throw p}},pc:function(h,c,d){try{for(var g=Le.getStreamFromFD(h),p=(g.getdents||(g.getdents=T.readdir(g.path)),0),b=T.llseek(g,0,1),y=Math.floor(b/280);y<g.getdents.length&&p+280<=d;){var w,D,M,I=g.getdents[y];D=I==="."?(w=g.node.id,4):I===".."?(w=T.lookupPath(g.path,{parent:!0}).node.id,4):(w=(M=T.lookupNode(g.node,I)).id,T.isChrdev(M.mode)?2:T.isDir(M.mode)?4:T.isLink(M.mode)?10:8),Dt=[w>>>0,($e=w,1<=+Math.abs($e)?0<$e?(0|Math.min(+Math.floor($e/4294967296),4294967295))>>>0:~~+Math.ceil(($e-(~~$e>>>0))/4294967296)>>>0:0)],re[c+p>>2]=Dt[0],re[c+p+4>>2]=Dt[1],Dt=[280*(y+1)>>>0,($e=280*(y+1),1<=+Math.abs($e)?0<$e?(0|Math.min(+Math.floor($e/4294967296),4294967295))>>>0:~~+Math.ceil(($e-(~~$e>>>0))/4294967296)>>>0:0)],re[c+p+8>>2]=Dt[0],re[c+p+12>>2]=Dt[1],Er[c+p+16>>1]=280,vt[c+p+18>>0]=D,wr(I,c+p+19,256),p+=280,y+=1}return T.llseek(g,280*y,0),p}catch(O){if(T!==void 0&&O instanceof T.ErrnoError)return-O.errno;throw O}},Ce:function(h,c,d){Le.varargs=d;try{var g=Le.getStreamFromFD(h);switch(c){case 21509:case 21505:return g.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return g.tty?0:-59;case 21519:if(!g.tty)return-59;var p=Le.get();return re[p>>2]=0;case 21520:return g.tty?-28:-59;case 21531:return p=Le.get(),T.ioctl(g,c,p);case 21523:case 21524:return g.tty?0:-59;default:ii("bad ioctl syscall "+c)}}catch(b){if(T!==void 0&&b instanceof T.ErrnoError)return-b.errno;throw b}},be:function(h,c){try{return h=Le.getStr(h),Le.doStat(T.lstat,h,c)}catch(d){if(T!==void 0&&d instanceof T.ErrnoError)return-d.errno;throw d}},rc:function(h,c,d){try{return c=Le.getStr(c),c=Le.calculateAt(h,c),(c=Be.normalize(c))[c.length-1]==="/"&&(c=c.substr(0,c.length-1)),T.mkdir(c,d,0),0}catch(g){if(T!==void 0&&g instanceof T.ErrnoError)return-g.errno;throw g}},je:function(h,c,d,g){try{c=Le.getStr(c);var p=256&g,b=4096&g;return g&=-4353,c=Le.calculateAt(h,c,b),Le.doStat(p?T.lstat:T.stat,c,d)}catch(y){if(T!==void 0&&y instanceof T.ErrnoError)return-y.errno;throw y}},Tb:function(h,c,d,g){Le.varargs=g;try{c=Le.getStr(c),c=Le.calculateAt(h,c);var p=g?Le.get():0;return T.open(c,d,p).fd}catch(b){if(T!==void 0&&b instanceof T.ErrnoError)return-b.errno;throw b}},Ie:function(h){try{if(h==0)throw new T.ErrnoError(21);var c=_t.createPipe();return re[h>>2]=c.readable_fd,re[h+4>>2]=c.writable_fd,0}catch(d){if(T!==void 0&&d instanceof T.ErrnoError)return-d.errno;throw d}},$b:function(h,c,d,g){try{if(c=Le.getStr(c),c=Le.calculateAt(h,c),g<=0)return-28;var p=T.readlink(c),b=Math.min(g,xs(p)),y=vt[d+b];return wr(p,d,g+1),vt[d+b]=y,b}catch(w){if(T!==void 0&&w instanceof T.ErrnoError)return-w.errno;throw w}},sc:function(h,c,d,g){try{return c=Le.getStr(c),g=Le.getStr(g),c=Le.calculateAt(h,c),g=Le.calculateAt(d,g),T.rename(c,g),0}catch(p){if(T!==void 0&&p instanceof T.ErrnoError)return-p.errno;throw p}},qc:function(h){try{return h=Le.getStr(h),T.rmdir(h),0}catch(c){if(T!==void 0&&c instanceof T.ErrnoError)return-c.errno;throw c}},pe:function(h,c){try{return h=Le.getStr(h),Le.doStat(T.stat,h,c)}catch(d){if(T!==void 0&&d instanceof T.ErrnoError)return-d.errno;throw d}},oc:function(h,c,d){try{return h=Le.getStr(h),re[d+4>>2]=4096,re[d+40>>2]=4096,re[d+8>>2]=1e6,re[d+12>>2]=5e5,re[d+16>>2]=5e5,re[d+20>>2]=T.nextInode,re[d+24>>2]=1e6,re[d+28>>2]=42,re[d+44>>2]=2,re[d+36>>2]=255,0}catch(g){if(T!==void 0&&g instanceof T.ErrnoError)return-g.errno;throw g}},tc:function(h,c,d){try{return c=Le.getStr(c),c=Le.calculateAt(h,c),d===0?T.unlink(c):d===512?T.rmdir(c):ii("Invalid flags passed to unlinkat"),0}catch(g){if(T!==void 0&&g instanceof T.ErrnoError)return-g.errno;throw g}},fc:function(h,c,d,g){try{var p,b;return c=Le.getStr(c),c=Le.calculateAt(h,c,!0),b=d?(p=1e3*re[d>>2]+re[d+8>>2]/1e6,1e3*re[(d+=16)>>2]+re[d+8>>2]/1e6):p=Date.now(),T.utime(c,p,b),0}catch(y){if(T!==void 0&&y instanceof T.ErrnoError)return-y.errno;throw y}},gc:function(h){},ic:function(h,c){ii(ru)},hc:function(h,c){ii(ru)},Sa:function(){return Date.now()},Oe:function(){throw 1/0},Gd:function(p,c){var p=new Date(1e3*re[p>>2]),g=(re[c>>2]=p.getSeconds(),re[c+4>>2]=p.getMinutes(),re[c+8>>2]=p.getHours(),re[c+12>>2]=p.getDate(),re[c+16>>2]=p.getMonth(),re[c+20>>2]=p.getFullYear()-1900,re[c+24>>2]=p.getDay(),new Date(p.getFullYear(),0,1)),d=(p.getTime()-g.getTime())/864e5|0,d=(re[c+28>>2]=d,re[c+36>>2]=-60*p.getTimezoneOffset(),new Date(p.getFullYear(),6,1).getTimezoneOffset()),g=g.getTimezoneOffset(),p=0|(d!=g&&p.getTimezoneOffset()==Math.min(g,d));re[c+32>>2]=p},Rd:function(h){var c=new Date(re[h+20>>2]+1900,re[h+16>>2],re[h+12>>2],re[h+8>>2],re[h+4>>2],re[h>>2],0),w=re[h+32>>2],d=c.getTimezoneOffset(),g=new Date(c.getFullYear(),0,1),p=new Date(c.getFullYear(),6,1).getTimezoneOffset(),b=g.getTimezoneOffset(),y=Math.min(b,p),w=(w<0?re[h+32>>2]=Number(p!=b&&y==d):0<w!=(y==d)&&(b=Math.max(b,p),p=0<w?y:b,c.setTime(c.getTime()+6e4*(p-d))),re[h+24>>2]=c.getDay(),(c.getTime()-g.getTime())/864e5|0);return re[h+28>>2]=w,re[h>>2]=c.getSeconds(),re[h+4>>2]=c.getMinutes(),re[h+8>>2]=c.getHours(),re[h+12>>2]=c.getDate(),re[h+16>>2]=c.getMonth(),c.getTime()/1e3|0},ac:function(h,c,d,g,p,b){try{var y=T.getStream(g);if(!y)return-8;var w=T.mmap(y,h,p,c,d),D=w.ptr;return re[b>>2]=w.allocated,D}catch(M){if(T!==void 0&&M instanceof T.ErrnoError)return-M.errno;throw M}},bc:function(h,c,d,g,p,b){try{var y=T.getStream(p);y&&(2&d&&Le.doMsync(h,y,c,g,b),T.munmap(y))}catch(w){if(T!==void 0&&w instanceof T.ErrnoError)return-w.errno;throw w}},Zd:dl,Z:function(){ii("")},Ke:au,vb:Po,Pe:function(h,c,d){Gn.copyWithin(h,c,c+d)},Qe:function(h){var c=Gn.length,d=au();if(d<(h>>>=0))return!1;for(var g,p=1;p<=4;p*=2){var b=c*(1+.2/p),b=Math.min(b,h+100663296);if(function(y){try{return rl.grow(y-ol.byteLength+65535>>>16),Kc(rl.buffer),1}catch{}}(Math.min(d,(b=Math.max(h,b))+((g=65536)-b%g)%g)))return!0}return!1},mc:function(h,c){var d=0;return Rr().forEach(function(g,p){for(var b=c+d,y=(Et[h+4*p>>2]=b,g),w=b,p=void 0,D=0;D<y.length;++D)vt[w++>>0]=y.charCodeAt(D);p||(vt[w>>0]=0),d+=g.length+1}),0},nc:function(h,c){var d=Rr(),g=(Et[h>>2]=d.length,0);return d.forEach(function(p){g+=p.length+1}),Et[c>>2]=g,0},Ba:Yp,Ma:function(h){try{var c=Le.getStreamFromFD(h);return T.close(c),0}catch(d){if(T!==void 0&&d instanceof T.ErrnoError)return d.errno;throw d}},xb:function(h,c){try{var d=Le.getStreamFromFD(h),g=d.tty?2:T.isDir(d.mode)?3:T.isLink(d.mode)?7:4;return vt[c>>0]=g,0}catch(p){if(T!==void 0&&p instanceof T.ErrnoError)return p.errno;throw p}},Qb:function(h,c,d,g){try{var p=function(b,y,w,D){for(var M=0,I=0;I<w;I++){var j=Et[y>>2],O=Et[y+4>>2],j=(y+=8,T.read(b,vt,j,O,D));if(j<0)return-1;if(M+=j,j<O)break}return M}(Le.getStreamFromFD(h),c,d);return re[g>>2]=p,0}catch(b){if(T!==void 0&&b instanceof T.ErrnoError)return b.errno;throw b}},Vd:function(h,c,d,g,p){try{var b=Fo(c,d);if(isNaN(b))return 61;var y=Le.getStreamFromFD(h);return T.llseek(y,b,g),Dt=[y.position>>>0,($e=y.position,1<=+Math.abs($e)?0<$e?(0|Math.min(+Math.floor($e/4294967296),4294967295))>>>0:~~+Math.ceil(($e-(~~$e>>>0))/4294967296)>>>0:0)],re[p>>2]=Dt[0],re[p+4>>2]=Dt[1],y.getdents&&b===0&&g===0&&(y.getdents=null),0}catch(w){if(T!==void 0&&w instanceof T.ErrnoError)return w.errno;throw w}},jb:function(h,c,d,g){try{var p=function(b,y,w,D){for(var M=0,I=0;I<w;I++){var j=Et[y>>2],O=Et[y+4>>2],j=(y+=8,T.write(b,vt,j,O,D));if(j<0)return-1;M+=j}return M}(Le.getStreamFromFD(h),c,d);return Et[g>>2]=p,0}catch(b){if(T!==void 0&&b instanceof T.ErrnoError)return b.errno;throw b}},a:function(){return Wc},Me:ko,db:function(h,c){var d=z();try{return X(h)(c)}catch(g){if(B(d),g!==g+0)throw g;G(1,0)}},Za:function(h,c,d){var g=z();try{return X(h)(c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},pb:function(h,c,d){var g=z();try{return X(h)(c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},Yd:function(h,c,d,g){var p=z();try{return X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},q:function(h,c){var d=z();try{return X(h)(c)}catch(g){if(B(d),g!==g+0)throw g;G(1,0)}},ha:function(h,c,d){var g=z();try{return X(h)(c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},z:function(h,c,d){var g=z();try{return X(h)(c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},xa:function(h,c,d,g){var p=z();try{return X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},E:function(h,c,d,g,p){var b=z();try{return X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},F:function(h,c,d,g){var p=z();try{return X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},Cb:function(h,c,d,g,p){var b=z();try{return X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},Ea:function(h,c,d,g,p,b,y){var w=z();try{return X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},Vb:function(h,c,d,g,p,b,y,w,D){var M=z();try{return X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},Ra:function(h,c,d,g){var p=z();try{return X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},B:function(h){var c=z();try{return X(h)()}catch(d){if(B(c),d!==d+0)throw d;G(1,0)}},na:function(h,c){var d=z();try{return X(h)(c)}catch(g){if(B(d),g!==g+0)throw g;G(1,0)}},ne:function(h,c,d){var g=z();try{return X(h)(c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},Ia:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},La:function(h,c,d,g,p,b,y){var w=z();try{return X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},Fe:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve,Ce,Ve,We,ni,Ct,Vn){var cn=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve,Ce,Ve,We,ni,Ct,Vn)}catch(Sr){if(B(cn),Sr!==Sr+0)throw Sr;G(1,0)}},ja:function(h,c,d,g,p){var b=z();try{return X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},Q:function(h,c,d){var g=z();try{return X(h)(c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},$:function(h,c,d,g){var p=z();try{return X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},c:function(h,c){var d=z();try{return X(h)(c)}catch(g){if(B(d),g!==g+0)throw g;G(1,0)}},D:function(h,c,d){var g=z();try{return X(h)(c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},T:function(h,c,d,g){var p=z();try{return X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},W:function(h,c,d,g,p){var b=z();try{return X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},P:function(h,c,d,g,p,b){var y=z();try{return X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},V:function(h,c,d,g,p,b,y){var w=z();try{return X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},fa:function(h,c,d,g,p,b,y,w){var D=z();try{return X(h)(c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},ra:function(h,c,d,g,p,b,y,w,D){var M=z();try{return X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},Ya:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{return X(h)(c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},ye:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q){var ce=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q)}catch(le){if(B(ce),le!==le+0)throw le;G(1,0)}},qb:function(h,c,d,g,p,b,y){var w=z();try{return X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},Ee:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{return X(h)(c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},$d:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve,Ce,Ve){var We=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve,Ce,Ve)}catch(ni){if(B(We),ni!==ni+0)throw ni;G(1,0)}},Wb:function(h,c,d,g,p,b){var y=z();try{return X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},ab:function(h,c,d,g,p){var b=z();try{return X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},ob:function(h,c,d,g,p,b){var y=z();try{return X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Aa:function(h,c,d,g,p,b,y){var w=z();try{return X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},Bb:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{return X(h)(c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},A:function(h,c,d,g){var p=z();try{return X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},fe:function(h,c,d,g,p,b,y,w,D){var M=z();try{return X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},we:function(h,c,d,g,p,b){var y=z();try{return X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},d:function(h,c,d){var g=z();try{return X(h)(c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},H:function(h,c,d,g){var p=z();try{return X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},zb:function(h,c,d,g,p){var b=z();try{return X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},ga:function(h,c,d,g,p,b){var y=z();try{return X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Je:function(h,c,d,g,p,b,y,w,D){var M=z();try{return X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},Ha:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},Ge:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q){var ce=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q)}catch(le){if(B(ce),le!==le+0)throw le;G(1,0)}},Ab:function(h,c,d,g,p,b,y,w,D,M,I,O,j){var V=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j)}catch(Q){if(B(V),Q!==Q+0)throw Q;G(1,0)}},Mb:function(h,c,d,g,p,b,y,w,D){var M=z();try{return X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},Pb:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{return X(h)(c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},sb:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},zc:function(h,c,d,g,p,b,y,w,D){var M=z();try{return ed(h,c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},Rb:function(h,c,d,g,p,b,y){var w=z();try{return X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},ue:function(h,c,d,g,p,b,y,w){var D=z();try{return X(h)(c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},ta:function(h,c,d,g,p){var b=z();try{return X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},Oa:function(h,c,d,g,p,b){var y=z();try{return X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},X:function(h,c,d,g,p,b,y){var w=z();try{return X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},bb:function(h,c,d,g,p,b,y,w,D){var M=z();try{return X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},Nb:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{return X(h)(c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},Le:function(h,c,d,g,p,b){var y=z();try{return X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},e:function(h,c,d,g){var p=z();try{return X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},Y:function(h,c,d,g,p){var b=z();try{return X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},he:function(h,c,d,g,p,b){var y=z();try{return X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},ge:function(h,c,d,g,p,b,y,w){var D=z();try{return X(h)(c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},Sb:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},_a:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce){var le=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce)}catch(q){if(B(le),q!==q+0)throw q;G(1,0)}},Ja:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V){var Q=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V)}catch(ce){if(B(Q),ce!==ce+0)throw ce;G(1,0)}},Fb:function(h,c,d,g,p,b,y,w,D){var M=z();try{return X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},Kb:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q){var ce=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q)}catch(le){if(B(ce),le!==le+0)throw le;G(1,0)}},Lb:function(h,c,d,g,p,b,y){var w=z();try{return X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},_d:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},Da:function(h,c,d,g,p,b){var y=z();try{return X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},nb:function(h,c,d,g,p,b,y){var w=z();try{return X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},l:function(h,c,d,g,p){var b=z();try{return X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},ya:function(h,c,d,g,p,b){var y=z();try{return X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Xd:function(h,c,d,g,p,b,y,w){var D=z();try{return X(h)(c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},Gb:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},de:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},Jb:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},aa:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},Ub:function(h,c,d,g,p,b,y){var w=z();try{return X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},m:function(h,c,d,g,p,b){var y=z();try{return X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Na:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{return X(h)(c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},te:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},oe:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q){var ve=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q)}catch(Ce){if(B(ve),Ce!==Ce+0)throw Ce;G(1,0)}},qe:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce){var le=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce)}catch(q){if(B(le),q!==q+0)throw q;G(1,0)}},He:function(h,c,d,g,p,b,y,w,D){var M=z();try{return X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},Ka:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{return X(h)(c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},x:function(h,c,d,g,p,b,y){var w=z();try{return X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},ie:function(h,c,d,g,p,b,y,w){var D=z();try{return X(h)(c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},xe:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},Be:function(h,c,d,g,p,b,y,w,D,M,I,O,j){var V=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j)}catch(Q){if(B(V),Q!==Q+0)throw Q;G(1,0)}},ke:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},le:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},I:function(h,c,d,g,p,b,y,w){var D=z();try{return X(h)(c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},ce:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},mb:function(h,c,d,g,p,b,y,w,D,M,I,O,j){var V=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j)}catch(Q){if(B(V),Q!==Q+0)throw Q;G(1,0)}},me:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{return X(h)(c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},O:function(h,c,d,g,p,b,y,w,D){var M=z();try{return X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},De:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},yb:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q){var ve=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q)}catch(Ce){if(B(ve),Ce!==Ce+0)throw Ce;G(1,0)}},Ib:function(h,c,d,g,p,b,y,w,D,M,I,O,j){var V=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j)}catch(Q){if(B(V),Q!==Q+0)throw Q;G(1,0)}},U:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{return X(h)(c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},da:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},Ca:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V){var Q=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V)}catch(ce){if(B(Q),ce!==ce+0)throw ce;G(1,0)}},ia:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},ua:function(h,c,d,g,p,b,y,w,D,M,I,O,j){var V=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j)}catch(Q){if(B(V),Q!==Q+0)throw Q;G(1,0)}},pa:function(h,c,d,g,p,b,y,w,D,M,I,O,j){var V=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j)}catch(Q){if(B(V),Q!==Q+0)throw Q;G(1,0)}},Wd:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V){var Q=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V)}catch(ce){if(B(Q),ce!==ce+0)throw ce;G(1,0)}},Fa:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V){var Q=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V)}catch(ce){if(B(Q),ce!==ce+0)throw ce;G(1,0)}},fb:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q){var ce=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q)}catch(le){if(B(ce),le!==le+0)throw le;G(1,0)}},Xa:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce){var le=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce)}catch(q){if(B(le),q!==q+0)throw q;G(1,0)}},ee:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve,Ce){var Ve=z();try{return X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve,Ce)}catch(We){if(B(Ve),We!==We+0)throw We;G(1,0)}},xc:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q){var ve=z();try{return Bd(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q)}catch(Ce){if(B(ve),Ce!==Ce+0)throw Ce;G(1,0)}},hd:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve){var Ce=z();try{return rd(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve)}catch(Ve){if(B(Ce),Ve!==Ve+0)throw Ve;G(1,0)}},nd:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve,Ce){var Ve=z();try{return $u(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve,Ce)}catch(We){if(B(Ve),We!==We+0)throw We;G(1,0)}},ud:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce){var le=z();try{return Zu(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce)}catch(q){if(B(le),q!==q+0)throw q;G(1,0)}},Ec:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le){var q=z();try{return Od(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le)}catch(ve){if(B(q),ve!==ve+0)throw ve;G(1,0)}},Nc:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return Sd(h,c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},Uc:function(h,c,d,g,p,b,y,w,D,M,I,O,j){var V=z();try{return Ed(h,c,d,g,p,b,y,w,D,M,I,O,j)}catch(Q){if(B(V),Q!==Q+0)throw Q;G(1,0)}},Vc:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q){var ce=z();try{return vd(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q)}catch(le){if(B(ce),le!==le+0)throw le;G(1,0)}},rd:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return Qu(h,c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},Rc:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return xd(h,c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},pd:function(h,c,d,g,p,b,y,w){var D=z();try{return ku(h,c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},sd:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{return td(h,c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},Fc:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{return Mu(h,c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},Jd:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return ld(h,c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},Hd:function(h,c,d,g,p,b,y){var w=z();try{return Au(h,c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},Bd:function(h,c,d,g,p,b,y,w){var D=z();try{return Vu(h,c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},Mc:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return Ld(h,c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},gd:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return od(h,c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},Sc:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return Cd(h,c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},cd:function(h,c,d,g,p,b){var y=z();try{return Fu(h,c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},md:function(h,c,d,g,p,b,y){var w=z();try{return Gu(h,c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},yc:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return zd(h,c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},qd:function(h,c,d,g,p,b,y,w,D){var M=z();try{return Gd(h,c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},Md:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return Su(h,c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},Ld:function(h,c,d,g,p){var b=z();try{return Lu(h,c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},ld:function(h,c,d,g,p,b){var y=z();try{return Ru(h,c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},kd:function(h,c,d,g,p,b,y,w){var D=z();try{return nd(h,c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},Zc:function(h,c,d,g,p,b,y,w,D){var M=z();try{return bd(h,c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},yd:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{return yd(h,c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},Ad:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return Xu(h,c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},od:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{return qu(h,c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},Xc:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return _d(h,c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},$c:function(h,c,d,g,p,b,y){var w=z();try{return md(h,c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},Tc:function(h,c,d,g,p,b,y,w,D){var M=z();try{return wd(h,c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},id:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return sd(h,c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},Nd:function(h,c,d,g){var p=z();try{return Tu(h,c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},Od:function(h,c,d,g,p){var b=z();try{return Cu(h,c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},Oc:function(h,c,d,g,p,b){var y=z();try{return Ou(h,c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Hc:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{return Id(h,c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},vd:function(h,c,d){var g=z();try{return zu(h,c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},fd:function(h,c,d,g){var p=z();try{return ad(h,c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},Kd:function(h){var c=z();try{return Du(h)}catch(d){if(B(c),d!==d+0)throw d;G(1,0)}},Sd:function(h,c){var d=z();try{return xu(h,c)}catch(g){if(B(d),g!==g+0)throw g;G(1,0)}},Qd:function(h,c,d){var g=z();try{return wu(h,c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},Dd:function(h,c,d,g){var p=z();try{return Hu(h,c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},Ic:function(h,c,d,g,p){var b=z();try{return Pd(h,c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},Ud:function(h,c,d,g,p){var b=z();try{return Eu(h,c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},jd:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve,Ce,Ve,We,ni,Ct,Vn,cn){var Sr=z();try{return id(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve,Ce,Ve,We,ni,Ct,Vn,cn)}catch(ml){if(B(Sr),ml!==ml+0)throw ml;G(1,0)}},_c:function(h,c,d,g,p,b){var y=z();try{return hd(h,c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Yc:function(h,c,d,g,p,b,y,w){var D=z();try{return cd(h,c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},Gc:function(h,c,d,g){var p=z();try{return Yu(h,c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},Lc:function(h,c,d,g,p,b){var y=z();try{return Md(h,c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Cc:function(h,c,d,g){var p=z();try{return kd(h,c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},n:function(h){var c=z();try{X(h)()}catch(d){if(B(c),d!==d+0)throw d;G(1,0)}},la:function(h,c){var d=z();try{X(h)(c)}catch(g){if(B(d),g!==g+0)throw g;G(1,0)}},ae:function(h,c,d,g,p,b,y){var w=z();try{X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},Db:function(h,c,d,g,p){var b=z();try{X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},h:function(h,c){var d=z();try{X(h)(c)}catch(g){if(B(d),g!==g+0)throw g;G(1,0)}},_:function(h,c,d){var g=z();try{X(h)(c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},M:function(h,c,d,g){var p=z();try{X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},ca:function(h,c,d,g,p){var b=z();try{X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},ma:function(h,c,d,g,p,b){var y=z();try{X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},ib:function(h,c,d,g,p,b,y){var w=z();try{X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},se:function(h,c,d,g,p,b,y,w){var D=z();try{X(h)(c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},rb:function(h,c,d,g,p,b,y,w,D){var M=z();try{X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},kb:function(h,c,d,g,p,b){var y=z();try{X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},va:function(h,c,d,g,p){var b=z();try{X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},R:function(h,c,d,g){var p=z();try{X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},lb:function(h,c,d,g,p){var b=z();try{X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},ba:function(h,c,d,g,p,b){var y=z();try{X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Eb:function(h,c,d,g,p,b,y){var w=z();try{X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},i:function(h,c,d){var g=z();try{X(h)(c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},G:function(h,c,d,g){var p=z();try{X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},K:function(h,c,d,g,p){var b=z();try{X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},ka:function(h,c,d,g,p,b){var y=z();try{X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Va:function(h,c,d,g,p,b,y){var w=z();try{X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},Wa:function(h,c,d,g,p,b,y,w,D){var M=z();try{X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},eb:function(h,c,d,g,p){var b=z();try{X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},L:function(h,c,d,g,p,b){var y=z();try{X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Qa:function(h,c,d,g,p,b,y){var w=z();try{X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},g:function(h,c,d,g){var p=z();try{X(h)(c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},sa:function(h,c,d,g,p){var b=z();try{X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},cb:function(h,c,d,g,p,b,y){var w=z();try{X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},wc:function(h,c,d,g,p,b){var y=z();try{X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},k:function(h,c,d,g,p){var b=z();try{X(h)(c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},Pa:function(h,c,d,g,p,b){var y=z();try{X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Ua:function(h,c,d,g,p,b,y,w){var D=z();try{X(h)(c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},$a:function(h,c,d,g,p,b,y,w,D,M,I,O,j){var V=z();try{X(h)(c,d,g,p,b,y,w,D,M,I,O,j)}catch(Q){if(B(V),Q!==Q+0)throw Q;G(1,0)}},Zb:function(h,c,d,g,p,b,y,w,D,M,I,O,j){var V=z();try{X(h)(c,d,g,p,b,y,w,D,M,I,O,j)}catch(Q){if(B(V),Q!==Q+0)throw Q;G(1,0)}},hb:function(h,c,d,g,p,b,y,w,D){var M=z();try{X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},Yb:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{X(h)(c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},Ta:function(h,c,d,g,p,b,y){var w=z();try{X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},Ob:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{X(h)(c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},s:function(h,c,d,g,p,b){var y=z();try{X(h)(c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},_b:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve,Ce,Ve,We){var ni=z();try{X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le,q,ve,Ce,Ve,We)}catch(Ct){if(B(ni),Ct!==Ct+0)throw Ct;G(1,0)}},ub:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V){var Q=z();try{X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V)}catch(ce){if(B(Q),ce!==ce+0)throw ce;G(1,0)}},tb:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{X(h)(c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},Hb:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q){var ce=z();try{X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q)}catch(le){if(B(ce),le!==le+0)throw le;G(1,0)}},v:function(h,c,d,g,p,b,y){var w=z();try{X(h)(c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},N:function(h,c,d,g,p,b,y,w){var D=z();try{X(h)(c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},ea:function(h,c,d,g,p,b,y,w,D){var M=z();try{X(h)(c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},ze:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{X(h)(c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},S:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{X(h)(c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},za:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le){var q=z();try{X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce,le)}catch(ve){if(B(q),ve!==ve+0)throw ve;G(1,0)}},oa:function(h,c,d,g,p,b,y,w,D,M,I){var O=z();try{X(h)(c,d,g,p,b,y,w,D,M,I)}catch(j){if(B(O),j!==j+0)throw j;G(1,0)}},Ae:function(h,c,d,g,p,b,y,w,D,M,I,O){var j=z();try{X(h)(c,d,g,p,b,y,w,D,M,I,O)}catch(V){if(B(j),V!==V+0)throw V;G(1,0)}},Xb:function(h,c,d,g,p,b,y,w,D,M,I,O,j){var V=z();try{X(h)(c,d,g,p,b,y,w,D,M,I,O,j)}catch(Q){if(B(V),Q!==Q+0)throw Q;G(1,0)}},gb:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q){var ce=z();try{X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q)}catch(le){if(B(ce),le!==le+0)throw le;G(1,0)}},Ga:function(h,c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce){var le=z();try{X(h)(c,d,g,p,b,y,w,D,M,I,O,j,V,Q,ce)}catch(q){if(B(le),q!==q+0)throw q;G(1,0)}},td:function(h,c,d,g,p,b,y,w,D){var M=z();try{Ju(h,c,d,g,p,b,y,w,D)}catch(I){if(B(M),I!==I+0)throw I;G(1,0)}},Cd:function(h,c,d,g,p,b,y){var w=z();try{Uu(h,c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},Ac:function(h,c,d,g,p,b){var y=z();try{Nd(h,c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},zd:function(h,c,d,g,p,b,y){var w=z();try{Wu(h,c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},ad:function(h,c,d,g,p,b,y,w){var D=z();try{pd(h,c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},wd:function(h,c,d,g,p){var b=z();try{ju(h,c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},Dc:function(h,c,d,g,p,b){var y=z();try{Bu(h,c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Id:function(h,c,d,g,p,b,y){var w=z();try{Iu(h,c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},Td:function(h,c,d,g,p,b,y){var w=z();try{ud(h,c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},Kc:function(h,c,d,g,p,b,y,w){var D=z();try{Ad(h,c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},Wc:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{fd(h,c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},Ed:function(h,c,d,g){var p=z();try{Nu(h,c,d,g)}catch(b){if(B(p),b!==b+0)throw b;G(1,0)}},Bc:function(h,c,d,g,p){var b=z();try{Dd(h,c,d,g,p)}catch(y){if(B(b),y!==y+0)throw y;G(1,0)}},Pc:function(h,c,d,g,p,b){var y=z();try{Rd(h,c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},ed:function(h,c,d,g,p,b){var y=z();try{Pu(h,c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},Jc:function(h,c,d,g,p,b,y,w,D,M){var I=z();try{Fd(h,c,d,g,p,b,y,w,D,M)}catch(O){if(B(I),O!==O+0)throw O;G(1,0)}},Qc:function(h,c,d,g,p,b,y){var w=z();try{Td(h,c,d,g,p,b,y)}catch(D){if(B(w),D!==D+0)throw D;G(1,0)}},bd:function(h,c,d,g,p,b){var y=z();try{gd(h,c,d,g,p,b)}catch(w){if(B(y),w!==w+0)throw w;G(1,0)}},dd:function(h,c,d,g,p,b,y,w){var D=z();try{dd(h,c,d,g,p,b,y,w)}catch(M){if(B(D),M!==M+0)throw M;G(1,0)}},xd:function(h,c,d){var g=z();try{Ku(h,c,d)}catch(p){if(B(g),p!==p+0)throw p;G(1,0)}},w:function(h){return h},r:function(h){di(h)},qa:cu,kc:cu},bu=(function(){var h={a:$p};function c(y,b){var y=y.exports;v.asm=y,Kc((rl=v.asm.Re).buffer),zn=v.asm.Eg,y=v.asm.Se,Zc.unshift(y),xr()}function d(p){c(p.instance)}function g(p){return function(){if(!vr&&(Vc||Nn)){if(typeof fetch=="function"&&!Qc(fi))return fetch(fi,{credentials:"same-origin"}).then(function(b){if(b.ok)return b.arrayBuffer();throw"failed to load wasm binary file at '"+fi+"'"}).catch(function(){return eu(fi)});if(Ke)return new Promise(function(b,y){Ke(fi,function(w){b(new Uint8Array(w))},y)})}return Promise.resolve().then(function(){return eu(fi)})}().then(function(b){return WebAssembly.instantiate(b,h)}).then(function(b){return b}).then(p,function(b){Ci("failed to asynchronously prepare wasm: "+b),ii(b)})}if(Do(),v.instantiateWasm)try{v.instantiateWasm(h,c);return}catch(p){return Ci("Module.instantiateWasm callback failed with error: "+p)}(vr||typeof WebAssembly.instantiateStreaming!="function"||Jc(fi)||Qc(fi)||Es||typeof fetch!="function"?g(d):fetch(fi,{credentials:"same-origin"}).then(function(p){return WebAssembly.instantiateStreaming(p,h).then(d,function(b){return Ci("wasm streaming compile failed: "+b),Ci("falling back to ArrayBuffer instantiation"),g(d)})})).catch(F)}(),v.___wasm_call_ctors=function(){return(v.___wasm_call_ctors=v.asm.Se).apply(null,arguments)},v._CPLSetConfigOption=function(){return(v._CPLSetConfigOption=v.asm.Te).apply(null,arguments)},v._CPLSetThreadLocalConfigOption=function(){return(v._CPLSetThreadLocalConfigOption=v.asm.Ue).apply(null,arguments)},v._CPLError=function(){return(v._CPLError=v.asm.Ve).apply(null,arguments)},v._CPLErrorReset=function(){return(v._CPLErrorReset=v.asm.We).apply(null,arguments)},v._CPLGetLastErrorNo=function(){return(v._CPLGetLastErrorNo=v.asm.Xe).apply(null,arguments)},v._CPLGetLastErrorType=function(){return(v._CPLGetLastErrorType=v.asm.Ye).apply(null,arguments)},v._CPLGetLastErrorMsg=function(){return(v._CPLGetLastErrorMsg=v.asm.Ze).apply(null,arguments)},v._CPLQuietErrorHandler=function(){return(v._CPLQuietErrorHandler=v.asm._e).apply(null,arguments)},v._CPLSetErrorHandler=function(){return(v._CPLSetErrorHandler=v.asm.$e).apply(null,arguments)},v._CSLCount=function(){return(v._CSLCount=v.asm.af).apply(null,arguments)},v._GDALSuggestedWarpOutput=function(){return(v._GDALSuggestedWarpOutput=v.asm.bf).apply(null,arguments)},v._GDALGenImgProjTransform=function(){return(v._GDALGenImgProjTransform=v.asm.cf).apply(null,arguments)},v._GDALCreateGenImgProjTransformer=function(){return(v._GDALCreateGenImgProjTransformer=v.asm.df).apply(null,arguments)},v._GDALCreateGenImgProjTransformer2=function(){return(v._GDALCreateGenImgProjTransformer2=v.asm.ef).apply(null,arguments)},v._GDALDestroyGenImgProjTransformer=function(){return(v._GDALDestroyGenImgProjTransformer=v.asm.ff).apply(null,arguments)},v._GDALReprojectImage=function(){return(v._GDALReprojectImage=v.asm.gf).apply(null,arguments)},v._OSRNewSpatialReference=function(){return(v._OSRNewSpatialReference=v.asm.hf).apply(null,arguments)},v._OSRDestroySpatialReference=function(){return(v._OSRDestroySpatialReference=v.asm.jf).apply(null,arguments)},v._OSRSetFromUserInput=function(){return(v._OSRSetFromUserInput=v.asm.kf).apply(null,arguments)},v._OSRImportFromEPSG=function(){return(v._OSRImportFromEPSG=v.asm.lf).apply(null,arguments)},v._OCTDestroyCoordinateTransformation=function(){return(v._OCTDestroyCoordinateTransformation=v.asm.mf).apply(null,arguments)},v._OCTNewCoordinateTransformation=function(){return(v._OCTNewCoordinateTransformation=v.asm.nf).apply(null,arguments)},v._OCTTransform=function(){return(v._OCTTransform=v.asm.of).apply(null,arguments)},v._GDALAllRegister=function(){return(v._GDALAllRegister=v.asm.pf).apply(null,arguments)},v._OGRGetDriverCount=function(){return(v._OGRGetDriverCount=v.asm.qf).apply(null,arguments)},v._OGRGetDriver=function(){return(v._OGRGetDriver=v.asm.rf).apply(null,arguments)},v._OGR_L_GetFeatureCount=function(){return(v._OGR_L_GetFeatureCount=v.asm.sf).apply(null,arguments)},v._OGR_L_GetName=function(){return(v._OGR_L_GetName=v.asm.tf).apply(null,arguments)},v._OGR_DS_GetLayerCount=function(){return(v._OGR_DS_GetLayerCount=v.asm.uf).apply(null,arguments)},v._OGR_DS_GetLayer=function(){return(v._OGR_DS_GetLayer=v.asm.vf).apply(null,arguments)},v._OGR_DS_GetName=function(){return(v._OGR_DS_GetName=v.asm.wf).apply(null,arguments)},v._OGR_DS_GetDriver=function(){return(v._OGR_DS_GetDriver=v.asm.xf).apply(null,arguments)},v._OGR_Dr_GetName=function(){return(v._OGR_Dr_GetName=v.asm.yf).apply(null,arguments)},v._GDALCreate=function(){return(v._GDALCreate=v.asm.zf).apply(null,arguments)},v._GDALCreateCopy=function(){return(v._GDALCreateCopy=v.asm.Af).apply(null,arguments)},v._GDALGetDriverShortName=function(){return(v._GDALGetDriverShortName=v.asm.Bf).apply(null,arguments)},v._GDALGetDriverLongName=function(){return(v._GDALGetDriverLongName=v.asm.Cf).apply(null,arguments)},v._GDALGetDriverCount=function(){return(v._GDALGetDriverCount=v.asm.Df).apply(null,arguments)},v._GDALGetDriver=function(){return(v._GDALGetDriver=v.asm.Ef).apply(null,arguments)},v._GDALGetDriverByName=function(){return(v._GDALGetDriverByName=v.asm.Ff).apply(null,arguments)},v._GDALGetRasterXSize=function(){return(v._GDALGetRasterXSize=v.asm.Gf).apply(null,arguments)},v._GDALGetRasterYSize=function(){return(v._GDALGetRasterYSize=v.asm.Hf).apply(null,arguments)},v._GDALGetRasterBand=function(){return(v._GDALGetRasterBand=v.asm.If).apply(null,arguments)},v._GDALGetRasterCount=function(){return(v._GDALGetRasterCount=v.asm.Jf).apply(null,arguments)},v._GDALGetProjectionRef=function(){return(v._GDALGetProjectionRef=v.asm.Kf).apply(null,arguments)},v._GDALSetProjection=function(){return(v._GDALSetProjection=v.asm.Lf).apply(null,arguments)},v._GDALGetGeoTransform=function(){return(v._GDALGetGeoTransform=v.asm.Mf).apply(null,arguments)},v._GDALSetGeoTransform=function(){return(v._GDALSetGeoTransform=v.asm.Nf).apply(null,arguments)},v._GDALGetDatasetDriver=function(){return(v._GDALGetDatasetDriver=v.asm.Of).apply(null,arguments)},v._GDALGetFileList=function(){return(v._GDALGetFileList=v.asm.Pf).apply(null,arguments)},v._GDALOpen=function(){return(v._GDALOpen=v.asm.Qf).apply(null,arguments)},v._GDALOpenEx=function(){return(v._GDALOpenEx=v.asm.Rf).apply(null,arguments)},v._GDALClose=function(){return(v._GDALClose=v.asm.Sf).apply(null,arguments)},v._GDALDatasetGetLayerCount=function(){return(v._GDALDatasetGetLayerCount=v.asm.Tf).apply(null,arguments)},v._GDALDatasetGetLayer=function(){return(v._GDALDatasetGetLayer=v.asm.Uf).apply(null,arguments)},v._GDALGetRasterDataType=function(){return(v._GDALGetRasterDataType=v.asm.Vf).apply(null,arguments)},v._GDALGetRasterNoDataValue=function(){return(v._GDALGetRasterNoDataValue=v.asm.Wf).apply(null,arguments)},v._GDALGetRasterMaximum=function(){return(v._GDALGetRasterMaximum=v.asm.Xf).apply(null,arguments)},v._GDALGetRasterMinimum=function(){return(v._GDALGetRasterMinimum=v.asm.Yf).apply(null,arguments)},v._GDALGetRasterStatistics=function(){return(v._GDALGetRasterStatistics=v.asm.Zf).apply(null,arguments)},v._GDALSetCacheMax=function(){return(v._GDALSetCacheMax=v.asm._f).apply(null,arguments)},v._GDALGetDescription=function(){return(v._GDALGetDescription=v.asm.$f).apply(null,arguments)},v._GDALGetMetadataItem=function(){return(v._GDALGetMetadataItem=v.asm.ag).apply(null,arguments)},v._GDALBuildVRT=function(){return(v._GDALBuildVRT=v.asm.bg).apply(null,arguments)},v._GDALBuildVRTOptionsFree=function(){return(v._GDALBuildVRTOptionsFree=v.asm.cg).apply(null,arguments)},v._GDALBuildVRTOptionsNew=function(){return(v._GDALBuildVRTOptionsNew=v.asm.dg).apply(null,arguments)},v._GDALTranslate=function(){return(v._GDALTranslate=v.asm.eg).apply(null,arguments)},v._GDALTranslateOptionsNew=function(){return(v._GDALTranslateOptionsNew=v.asm.fg).apply(null,arguments)},v._GDALTranslateOptionsFree=function(){return(v._GDALTranslateOptionsFree=v.asm.gg).apply(null,arguments)},v._GDALRasterize=function(){return(v._GDALRasterize=v.asm.hg).apply(null,arguments)},v._GDALRasterizeOptionsNew=function(){return(v._GDALRasterizeOptionsNew=v.asm.ig).apply(null,arguments)},v._GDALRasterizeOptionsFree=function(){return(v._GDALRasterizeOptionsFree=v.asm.jg).apply(null,arguments)},v._GDALWarp=function(){return(v._GDALWarp=v.asm.kg).apply(null,arguments)},v._GDALWarpAppOptionsNew=function(){return(v._GDALWarpAppOptionsNew=v.asm.lg).apply(null,arguments)},v._GDALWarpAppOptionsFree=function(){return(v._GDALWarpAppOptionsFree=v.asm.mg).apply(null,arguments)},v._GDALWarpAppOptionsSetProgress=function(){return(v._GDALWarpAppOptionsSetProgress=v.asm.ng).apply(null,arguments)},v._GDALVectorTranslate=function(){return(v._GDALVectorTranslate=v.asm.og).apply(null,arguments)},v._GDALVectorTranslateOptionsFree=function(){return(v._GDALVectorTranslateOptionsFree=v.asm.pg).apply(null,arguments)},v._GDALVectorTranslateOptionsNew=function(){return(v._GDALVectorTranslateOptionsNew=v.asm.qg).apply(null,arguments)},v._GDALDEMProcessing=function(){return(v._GDALDEMProcessing=v.asm.rg).apply(null,arguments)},v._GDALDEMProcessingOptionsNew=function(){return(v._GDALDEMProcessingOptionsNew=v.asm.sg).apply(null,arguments)},v._GDALDEMProcessingOptionsFree=function(){return(v._GDALDEMProcessingOptionsFree=v.asm.tg).apply(null,arguments)},v.___errno_location=function(){return(bu=v.___errno_location=v.asm.ug).apply(null,arguments)}),fl=v._malloc=function(){return(fl=v._malloc=v.asm.vg).apply(null,arguments)},_u=v._free=function(){return(_u=v._free=v.asm.wg).apply(null,arguments)},yu=v._emscripten_builtin_memalign=function(){return(yu=v._emscripten_builtin_memalign=v.asm.xg).apply(null,arguments)},G=v._setThrew=function(){return(G=v._setThrew=v.asm.yg).apply(null,arguments)},z=v.stackSave=function(){return(z=v.stackSave=v.asm.zg).apply(null,arguments)},B=v.stackRestore=function(){return(B=v.stackRestore=v.asm.Ag).apply(null,arguments)},gl=v.stackAlloc=function(){return(gl=v.stackAlloc=v.asm.Bg).apply(null,arguments)},zo=v.___cxa_can_catch=function(){return(zo=v.___cxa_can_catch=v.asm.Cg).apply(null,arguments)},vu=v.___cxa_is_pointer_type=function(){return(vu=v.___cxa_is_pointer_type=v.asm.Dg).apply(null,arguments)},Eu=v.dynCall_jiiii=function(){return(Eu=v.dynCall_jiiii=v.asm.Fg).apply(null,arguments)},wu=v.dynCall_jii=function(){return(wu=v.dynCall_jii=v.asm.Gg).apply(null,arguments)},Cu=v.dynCall_iiji=function(){return(Cu=v.dynCall_iiji=v.asm.Hg).apply(null,arguments)},xu=v.dynCall_ji=function(){return(xu=v.dynCall_ji=v.asm.Ig).apply(null,arguments)},Tu=v.dynCall_iij=function(){return(Tu=v.dynCall_iij=v.asm.Jg).apply(null,arguments)},Ru=v.dynCall_iiiji=function(){return(Ru=v.dynCall_iiiji=v.asm.Kg).apply(null,arguments)},Su=v.dynCall_iiiijjjii=function(){return(Su=v.dynCall_iiiijjjii=v.asm.Lg).apply(null,arguments)},Lu=v.dynCall_iiij=function(){return(Lu=v.dynCall_iiij=v.asm.Mg).apply(null,arguments)},Du=v.dynCall_j=function(){return(Du=v.dynCall_j=v.asm.Ng).apply(null,arguments)},Au=v.dynCall_iiiiij=function(){return(Au=v.dynCall_iiiiij=v.asm.Og).apply(null,arguments)},Mu=v.dynCall_iiiiiijj=function(){return(Mu=v.dynCall_iiiiiijj=v.asm.Pg).apply(null,arguments)},Iu=v.dynCall_viijii=function(){return(Iu=v.dynCall_viijii=v.asm.Qg).apply(null,arguments)},Fu=v.dynCall_iiiij=function(){return(Fu=v.dynCall_iiiij=v.asm.Rg).apply(null,arguments)},Pu=v.dynCall_vijii=function(){return(Pu=v.dynCall_vijii=v.asm.Sg).apply(null,arguments)},Ou=v.dynCall_iijii=function(){return(Ou=v.dynCall_iijii=v.asm.Tg).apply(null,arguments)},ku=v.dynCall_iiiiiij=function(){return(ku=v.dynCall_iiiiiij=v.asm.Ug).apply(null,arguments)},Nu=v.dynCall_vij=function(){return(Nu=v.dynCall_vij=v.asm.Vg).apply(null,arguments)},Gu=v.dynCall_iiiiji=function(){return(Gu=v.dynCall_iiiiji=v.asm.Wg).apply(null,arguments)},zu=v.dynCall_ij=function(){return(zu=v.dynCall_ij=v.asm.Xg).apply(null,arguments)},Bu=v.dynCall_viiji=function(){return(Bu=v.dynCall_viiji=v.asm.Yg).apply(null,arguments)},ju=v.dynCall_viij=function(){return(ju=v.dynCall_viij=v.asm.Zg).apply(null,arguments)},Hu=v.dynCall_jiii=function(){return(Hu=v.dynCall_jiii=v.asm._g).apply(null,arguments)},Uu=v.dynCall_viiiij=function(){return(Uu=v.dynCall_viiiij=v.asm.$g).apply(null,arguments)},Vu=v.dynCall_iiiiiji=function(){return(Vu=v.dynCall_iiiiiji=v.asm.ah).apply(null,arguments)},Wu=v.dynCall_viiiji=function(){return(Wu=v.dynCall_viiiji=v.asm.bh).apply(null,arguments)},Xu=v.dynCall_iiijiiiiii=function(){return(Xu=v.dynCall_iiijiiiiii=v.asm.ch).apply(null,arguments)},Yu=v.dynCall_jij=function(){return(Yu=v.dynCall_jij=v.asm.dh).apply(null,arguments)},Ku=v.dynCall_vj=function(){return(Ku=v.dynCall_vj=v.asm.eh).apply(null,arguments)},$u=v.dynCall_iiiiiiiiiiiiijjji=function(){return($u=v.dynCall_iiiiiiiiiiiiijjji=v.asm.fh).apply(null,arguments)},Zu=v.dynCall_iiiiiiiiiiijji=function(){return(Zu=v.dynCall_iiiiiiiiiiijji=v.asm.gh).apply(null,arguments)},qu=v.dynCall_iiijiiiiiii=function(){return(qu=v.dynCall_iiijiiiiiii=v.asm.hh).apply(null,arguments)},Ju=v.dynCall_viiiiiji=function(){return(Ju=v.dynCall_viiiiiji=v.asm.ih).apply(null,arguments)},Qu=v.dynCall_iiiiiiijiii=function(){return(Qu=v.dynCall_iiiiiiijiii=v.asm.jh).apply(null,arguments)},ed=v.dynCall_iiiddddj=function(){return(ed=v.dynCall_iiiddddj=v.asm.kh).apply(null,arguments)},td=v.dynCall_iiiiiijii=function(){return(td=v.dynCall_iiiiiijii=v.asm.lh).apply(null,arguments)},id=v.dynCall_jiiiiiiiiiiiiiiiiiiiiiiiii=function(){return(id=v.dynCall_jiiiiiiiiiiiiiiiiiiiiiiiii=v.asm.mh).apply(null,arguments)},nd=v.dynCall_iiijiii=function(){return(nd=v.dynCall_iiijiii=v.asm.nh).apply(null,arguments)},sd=v.dynCall_iiijjiji=function(){return(sd=v.dynCall_iiijjiji=v.asm.oh).apply(null,arguments)},rd=v.dynCall_iiiiiiiiiiiiijjii=function(){return(rd=v.dynCall_iiiiiiiiiiiiijjii=v.asm.ph).apply(null,arguments)},od=v.dynCall_iiiiijiiiii=function(){return(od=v.dynCall_iiiiijiiiii=v.asm.qh).apply(null,arguments)},ad=v.dynCall_iji=function(){return(ad=v.dynCall_iji=v.asm.rh).apply(null,arguments)},ld=v.dynCall_iiiiiijjii=function(){return(ld=v.dynCall_iiiiiijjii=v.asm.sh).apply(null,arguments)},hd=v.dynCall_jiiji=function(){return(hd=v.dynCall_jiiji=v.asm.th).apply(null,arguments)},cd=v.dynCall_jiijji=function(){return(cd=v.dynCall_jiijji=v.asm.uh).apply(null,arguments)},ud=v.dynCall_viijj=function(){return(ud=v.dynCall_viijj=v.asm.vh).apply(null,arguments)},dd=v.dynCall_vijjj=function(){return(dd=v.dynCall_vijjj=v.asm.wh).apply(null,arguments)},fd=v.dynCall_viijjji=function(){return(fd=v.dynCall_viijjji=v.asm.xh).apply(null,arguments)},gd=v.dynCall_vijj=function(){return(gd=v.dynCall_vijj=v.asm.yh).apply(null,arguments)},md=v.dynCall_iiijj=function(){return(md=v.dynCall_iiijj=v.asm.zh).apply(null,arguments)},pd=v.dynCall_viiijj=function(){return(pd=v.dynCall_viiijj=v.asm.Ah).apply(null,arguments)},bd=v.dynCall_iiijiiii=function(){return(bd=v.dynCall_iiijiiii=v.asm.Bh).apply(null,arguments)},_d=v.dynCall_iiijiiiji=function(){return(_d=v.dynCall_iiijiiiji=v.asm.Ch).apply(null,arguments)},yd=v.dynCall_iiijiiiii=function(){return(yd=v.dynCall_iiijiiiii=v.asm.Dh).apply(null,arguments)},vd=v.dynCall_iiiiiiiijjji=function(){return(vd=v.dynCall_iiiiiiiijjji=v.asm.Eh).apply(null,arguments)},Ed=v.dynCall_iiiiiiiijiii=function(){return(Ed=v.dynCall_iiiiiiiijiii=v.asm.Fh).apply(null,arguments)},wd=v.dynCall_iiijjii=function(){return(wd=v.dynCall_iiijjii=v.asm.Gh).apply(null,arguments)},Cd=v.dynCall_iiiiijjii=function(){return(Cd=v.dynCall_iiiiijjii=v.asm.Hh).apply(null,arguments)},xd=v.dynCall_iiiiiiijji=function(){return(xd=v.dynCall_iiiiiiijji=v.asm.Ih).apply(null,arguments)},Td=v.dynCall_vijiii=function(){return(Td=v.dynCall_vijiii=v.asm.Jh).apply(null,arguments)},Rd=v.dynCall_vijid=function(){return(Rd=v.dynCall_vijid=v.asm.Kh).apply(null,arguments)},Sd=v.dynCall_iiiiiiiijii=function(){return(Sd=v.dynCall_iiiiiiiijii=v.asm.Lh).apply(null,arguments)},Ld=v.dynCall_iiiiijiiii=function(){return(Ld=v.dynCall_iiiiijiiii=v.asm.Mh).apply(null,arguments)},Dd=v.dynCall_viji=function(){return(Dd=v.dynCall_viji=v.asm.Nh).apply(null,arguments)},Ad=v.dynCall_viijji=function(){return(Ad=v.dynCall_viijji=v.asm.Oh).apply(null,arguments)},Md=v.dynCall_jijj=function(){return(Md=v.dynCall_jijj=v.asm.Ph).apply(null,arguments)},Id=v.dynCall_iijjjddi=function(){return(Id=v.dynCall_iijjjddi=v.asm.Qh).apply(null,arguments)},Fd=v.dynCall_vijiidddi=function(){return(Fd=v.dynCall_vijiidddi=v.asm.Rh).apply(null,arguments)},Pd=v.dynCall_jiiid=function(){return(Pd=v.dynCall_jiiid=v.asm.Sh).apply(null,arguments)},Od=v.dynCall_iiiiiiiiiijiiiii=function(){return(Od=v.dynCall_iiiiiiiiiijiiiii=v.asm.Th).apply(null,arguments)},kd=v.dynCall_jji=function(){return(kd=v.dynCall_jji=v.asm.Uh).apply(null,arguments)},Nd=v.dynCall_viiij=function(){return(Nd=v.dynCall_viiij=v.asm.Vh).apply(null,arguments)},Gd=v.dynCall_iiiijji=function(){return(Gd=v.dynCall_iiiijji=v.asm.Wh).apply(null,arguments)},zd=v.dynCall_iiiijiiiii=function(){return(zd=v.dynCall_iiiijiiiii=v.asm.Xh).apply(null,arguments)},Bd=v.dynCall_iiiiiiiiiiiiiijj=function(){return(Bd=v.dynCall_iiiiiiiiiiiiiijj=v.asm.Yh).apply(null,arguments)};function jd(){function h(){Go||(Go=!0,v.calledRun=!0,So||(v.noFSInit||T.init.initialized||T.init(),T.ignorePermissions=!1,_t.root=T.mount(_t,{},null),cl(Zc),E(v),v.onRuntimeInitialized&&v.onRuntimeInitialized(),Xp()))}0<jn||(Wp(),0<jn||(v.setStatus?(v.setStatus("Running..."),setTimeout(function(){setTimeout(function(){v.setStatus("")},1),h()},1)):h()))}if(v.stringToUTF8=wr,v.lengthBytesUTF8=xs,v.addRunDependency=Do,v.removeRunDependency=xr,v.FS_createPath=T.createPath,v.FS_createDataFile=T.createDataFile,v.FS_createPreloadedFile=T.createPreloadedFile,v.FS_createLazyFile=T.createLazyFile,v.FS_createDevice=T.createDevice,v.FS_unlink=T.unlink,v.ENV=Oo,v.ccall=mu,v.cwrap=function(h,c,d,g){var p=(d=d||[]).every(function(b){return b==="number"});return c!=="string"&&p&&!g?gu(h):function(){return mu(h,c,d,arguments)}},v.addFunction=function(h,c){if(!Un){Un=new WeakMap;var d=0,g=zn.length;if(Un)for(var p=d;p<d+g;p++){var b=X(p);b&&Un.set(b,p)}}if(Un.has(h))return Un.get(h);var y=function(){if(du.length)return du.pop();try{zn.grow(1)}catch(w){throw w instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":w}return zn.length-1}();try{fu(y,h)}catch(w){if(!(w instanceof TypeError))throw w;fu(y,Kp(h,c))}return Un.set(h,y),y},v.setValue=function(h,c){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"i8";switch(d=d.endsWith("*")?"*":d){case"i1":case"i8":vt[h>>0]=c;break;case"i16":Er[h>>1]=c;break;case"i32":re[h>>2]=c;break;case"i64":Dt=[c>>>0,($e=c,1<=+Math.abs($e)?0<$e?(0|Math.min(+Math.floor($e/4294967296),4294967295))>>>0:~~+Math.ceil(($e-(~~$e>>>0))/4294967296)>>>0:0)],re[h>>2]=Dt[0],re[h+4>>2]=Dt[1];break;case"float":al[h>>2]=c;break;case"double":ll[h>>3]=c;break;case"*":Et[h>>2]=c;break;default:ii("invalid type for setValue: "+d)}},v.getValue=function(h){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"i8";switch(c=c.endsWith("*")?"*":c){case"i1":case"i8":return vt[h>>0];case"i16":return Er[h>>1];case"i32":case"i64":return re[h>>2];case"float":return al[h>>2];case"double":return ll[h>>3];case"*":return Et[h>>2];default:ii("invalid type for getValue: "+c)}return null},v.FS=T,v.MEMFS=Pe,v.WORKERFS=Rt,v.NODEFS=Me,Cr=function h(){Go||jd(),Go||(Cr=h)},v.preInit)for(typeof v.preInit=="function"&&(v.preInit=[v.preInit]);0<v.preInit.length;)v.preInit.pop()();return jd(),x.ready}C=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0,typeof __filename<"u"&&(C=C||__filename),vs.exports=L;var A=ei.exports,S={Module:{}};function P(){var x=S.CPLGetLastErrorMsg(),E=S.CPLGetLastErrorNo();return S.CPLErrorReset(),{no:E,message:x}}function k(x){for(var E=[],F={},U=0;U<x.length;U+=1){var $=x[U];$==="--config"?(F[x[U+1]]=x[U+2],U+=2):E.push($)}var N=E.map(function(Y){return S.Module._malloc(S.Module.lengthBytesUTF8(Y)+1)}),se=(N.push(0),Uint32Array.from(N)),W=(E.forEach(function(Y,he){S.Module.stringToUTF8(Y,se[he],S.Module.lengthBytesUTF8(Y)+1)}),S.Module._malloc(se.length*se.BYTES_PER_ELEMENT));return S.Module.HEAPU32.set(se,W/se.BYTES_PER_ELEMENT),{ptr:W,ptrArray:N,config:F}}function H(x){S.Module._free(x.ptr),x.ptrArray.forEach(function(E){S.Module._free(E)})}var K="/input",ie="/output",te=ie,vs={},ee=t(Object.freeze({__proto__:null,default:{}})),ne=vs;ne.parser=function(x,E){return new oe(x,E)},ne.SAXParser=oe,ne.SAXStream=xe,ne.createStream=function(x,E){return new xe(x,E)},ne.MAX_BUFFER_LENGTH=65536;var ue,de=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function oe(x,E){if(!(this instanceof oe))return new oe(x,E);for(var F=this,U=F,$=0,N=de.length;$<N;$++)U[de[$]]="";F.q=F.c="",F.bufferCheckPosition=ne.MAX_BUFFER_LENGTH,F.opt=E||{},F.opt.lowercase=F.opt.lowercase||F.opt.lowercasetags,F.looseCase=F.opt.lowercase?"toLowerCase":"toUpperCase",F.tags=[],F.closed=F.closedRoot=F.sawRoot=!1,F.tag=F.error=null,F.strict=!!x,F.noscript=!(!x&&!F.opt.noscript),F.state=Z.BEGIN,F.strictEntities=F.opt.strictEntities,F.ENTITIES=F.strictEntities?Object.create(ne.XML_ENTITIES):Object.create(ne.ENTITIES),F.attribList=[],F.opt.xmlns&&(F.ns=Object.create(it)),F.trackPosition=F.opt.position!==!1,F.trackPosition&&(F.position=F.line=F.column=0),Ht(F,"onready")}ne.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(x){function E(){}return E.prototype=x,new E}),Object.keys||(Object.keys=function(x){var E,F=[];for(E in x)x.hasOwnProperty(E)&&F.push(E);return F}),oe.prototype={end:function(){wi(this)},write:function(x){var E=this;if(this.error)throw this.error;if(E.closed)return Di(E,"Cannot write after close. Assign an onready handler.");if(x===null)return wi(E);typeof x=="object"&&(x=x.toString());for(var F,U,$=0,N="";N=Vt(x,$++),!!(E.c=N);)switch(E.trackPosition&&(E.position++,N===`
`?(E.line++,E.column=0):E.column++),E.state){case Z.BEGIN:if(E.state=Z.BEGIN_WHITESPACE,N==="\uFEFF")continue;Ot(E,N);continue;case Z.BEGIN_WHITESPACE:Ot(E,N);continue;case Z.TEXT:if(E.sawRoot&&!E.closedRoot){for(var se=$-1;N&&N!=="<"&&N!=="&";)(N=Vt(x,$++))&&E.trackPosition&&(E.position++,N===`
`?(E.line++,E.column=0):E.column++);E.textNode+=x.substring(se,$-1)}N!=="<"||E.sawRoot&&E.closedRoot&&!E.strict?(De(N)||E.sawRoot&&!E.closedRoot||et(E,"Text data outside of root node."),N==="&"?E.state=Z.TEXT_ENTITY:E.textNode+=N):(E.state=Z.OPEN_WAKA,E.startTagPosition=E.position);continue;case Z.SCRIPT:N==="<"?E.state=Z.SCRIPT_ENDING:E.script+=N;continue;case Z.SCRIPT_ENDING:N==="/"?E.state=Z.CLOSE_TAG:(E.script+="<"+N,E.state=Z.SCRIPT);continue;case Z.OPEN_WAKA:N==="!"?(E.state=Z.SGML_DECL,E.sgmlDecl=""):De(N)||(ht(Ue,N)?(E.state=Z.OPEN_TAG,E.tagName=N):N==="/"?(E.state=Z.CLOSE_TAG,E.tagName=""):N==="?"?(E.state=Z.PROC_INST,E.procInstName=E.procInstBody=""):(et(E,"Unencoded <"),E.startTagPosition+1<E.position&&(se=E.position-E.startTagPosition,N=new Array(se).join(" ")+N),E.textNode+="<"+N,E.state=Z.TEXT));continue;case Z.SGML_DECL:(E.sgmlDecl+N).toUpperCase()===pe?(Qe(E,"onopencdata"),E.state=Z.CDATA,E.sgmlDecl="",E.cdata=""):E.sgmlDecl+N==="--"?(E.state=Z.COMMENT,E.comment="",E.sgmlDecl=""):(E.sgmlDecl+N).toUpperCase()===we?(E.state=Z.DOCTYPE,(E.doctype||E.sawRoot)&&et(E,"Inappropriately located doctype declaration"),E.doctype="",E.sgmlDecl=""):N===">"?(Qe(E,"onsgmldeclaration",E.sgmlDecl),E.sgmlDecl="",E.state=Z.TEXT):(Fe(N)&&(E.state=Z.SGML_DECL_QUOTED),E.sgmlDecl+=N);continue;case Z.SGML_DECL_QUOTED:N===E.q&&(E.state=Z.SGML_DECL,E.q=""),E.sgmlDecl+=N;continue;case Z.DOCTYPE:N===">"?(E.state=Z.TEXT,Qe(E,"ondoctype",E.doctype),E.doctype=!0):(E.doctype+=N,N==="["?E.state=Z.DOCTYPE_DTD:Fe(N)&&(E.state=Z.DOCTYPE_QUOTED,E.q=N));continue;case Z.DOCTYPE_QUOTED:E.doctype+=N,N===E.q&&(E.q="",E.state=Z.DOCTYPE);continue;case Z.DOCTYPE_DTD:E.doctype+=N,N==="]"?E.state=Z.DOCTYPE:Fe(N)&&(E.state=Z.DOCTYPE_DTD_QUOTED,E.q=N);continue;case Z.DOCTYPE_DTD_QUOTED:E.doctype+=N,N===E.q&&(E.state=Z.DOCTYPE_DTD,E.q="");continue;case Z.COMMENT:N==="-"?E.state=Z.COMMENT_ENDING:E.comment+=N;continue;case Z.COMMENT_ENDING:N==="-"?(E.state=Z.COMMENT_ENDED,E.comment=ui(E.opt,E.comment),E.comment&&Qe(E,"oncomment",E.comment),E.comment=""):(E.comment+="-"+N,E.state=Z.COMMENT);continue;case Z.COMMENT_ENDED:N!==">"?(et(E,"Malformed comment"),E.comment+="--"+N,E.state=Z.COMMENT):E.state=Z.TEXT;continue;case Z.CDATA:N==="]"?E.state=Z.CDATA_ENDING:E.cdata+=N;continue;case Z.CDATA_ENDING:N==="]"?E.state=Z.CDATA_ENDING_2:(E.cdata+="]"+N,E.state=Z.CDATA);continue;case Z.CDATA_ENDING_2:N===">"?(E.cdata&&Qe(E,"oncdata",E.cdata),Qe(E,"onclosecdata"),E.cdata="",E.state=Z.TEXT):N==="]"?E.cdata+="]":(E.cdata+="]]"+N,E.state=Z.CDATA);continue;case Z.PROC_INST:N==="?"?E.state=Z.PROC_INST_ENDING:De(N)?E.state=Z.PROC_INST_BODY:E.procInstName+=N;continue;case Z.PROC_INST_BODY:if(!E.procInstBody&&De(N))continue;N==="?"?E.state=Z.PROC_INST_ENDING:E.procInstBody+=N;continue;case Z.PROC_INST_ENDING:N===">"?(Qe(E,"onprocessinginstruction",{name:E.procInstName,body:E.procInstBody}),E.procInstName=E.procInstBody="",E.state=Z.TEXT):(E.procInstBody+="?"+N,E.state=Z.PROC_INST_BODY);continue;case Z.OPEN_TAG:ht(at,N)?E.tagName+=N:(function(W){W.strict||(W.tagName=W.tagName[W.looseCase]());var Y=W.tags[W.tags.length-1]||W,he=W.tag={name:W.tagName,attributes:{}};W.opt.xmlns&&(he.ns=Y.ns),W.attribList.length=0,Qe(W,"onopentagstart",he)}(E),N===">"?Jt(E):N==="/"?E.state=Z.OPEN_TAG_SLASH:(De(N)||et(E,"Invalid character in tag name"),E.state=Z.ATTRIB));continue;case Z.OPEN_TAG_SLASH:N===">"?(Jt(E,!0),An(E)):(et(E,"Forward-slash in opening tag not followed by >"),E.state=Z.ATTRIB);continue;case Z.ATTRIB:if(De(N))continue;N===">"?Jt(E):N==="/"?E.state=Z.OPEN_TAG_SLASH:ht(Ue,N)?(E.attribName=N,E.attribValue="",E.state=Z.ATTRIB_NAME):et(E,"Invalid attribute name");continue;case Z.ATTRIB_NAME:N==="="?E.state=Z.ATTRIB_VALUE:N===">"?(et(E,"Attribute without value"),E.attribValue=E.attribName,an(E),Jt(E)):De(N)?E.state=Z.ATTRIB_NAME_SAW_WHITE:ht(at,N)?E.attribName+=N:et(E,"Invalid attribute name");continue;case Z.ATTRIB_NAME_SAW_WHITE:if(N==="=")E.state=Z.ATTRIB_VALUE;else{if(De(N))continue;et(E,"Attribute without value"),E.tag.attributes[E.attribName]="",E.attribValue="",Qe(E,"onattribute",{name:E.attribName,value:""}),E.attribName="",N===">"?Jt(E):ht(Ue,N)?(E.attribName=N,E.state=Z.ATTRIB_NAME):(et(E,"Invalid attribute name"),E.state=Z.ATTRIB)}continue;case Z.ATTRIB_VALUE:if(De(N))continue;Fe(N)?(E.q=N,E.state=Z.ATTRIB_VALUE_QUOTED):(et(E,"Unquoted attribute value"),E.state=Z.ATTRIB_VALUE_UNQUOTED,E.attribValue=N);continue;case Z.ATTRIB_VALUE_QUOTED:if(N!==E.q){N==="&"?E.state=Z.ATTRIB_VALUE_ENTITY_Q:E.attribValue+=N;continue}an(E),E.q="",E.state=Z.ATTRIB_VALUE_CLOSED;continue;case Z.ATTRIB_VALUE_CLOSED:De(N)?E.state=Z.ATTRIB:N===">"?Jt(E):N==="/"?E.state=Z.OPEN_TAG_SLASH:ht(Ue,N)?(et(E,"No whitespace between attributes"),E.attribName=N,E.attribValue="",E.state=Z.ATTRIB_NAME):et(E,"Invalid attribute name");continue;case Z.ATTRIB_VALUE_UNQUOTED:if(!function(W){return W===">"||De(W)}(N)){N==="&"?E.state=Z.ATTRIB_VALUE_ENTITY_U:E.attribValue+=N;continue}an(E),N===">"?Jt(E):E.state=Z.ATTRIB;continue;case Z.CLOSE_TAG:if(E.tagName)N===">"?An(E):ht(at,N)?E.tagName+=N:E.script?(E.script+="</"+E.tagName,E.tagName="",E.state=Z.SCRIPT):(De(N)||et(E,"Invalid tagname in closing tag"),E.state=Z.CLOSE_TAG_SAW_WHITE);else{if(De(N))continue;(function(W,Y){return!ht(W,Y)})(Ue,N)?E.script?(E.script+="</"+N,E.state=Z.SCRIPT):et(E,"Invalid tagname in closing tag."):E.tagName=N}continue;case Z.CLOSE_TAG_SAW_WHITE:if(De(N))continue;N===">"?An(E):et(E,"Invalid characters in closing tag");continue;case Z.TEXT_ENTITY:case Z.ATTRIB_VALUE_ENTITY_Q:case Z.ATTRIB_VALUE_ENTITY_U:switch(E.state){case Z.TEXT_ENTITY:F=Z.TEXT,U="textNode";break;case Z.ATTRIB_VALUE_ENTITY_Q:F=Z.ATTRIB_VALUE_QUOTED,U="attribValue";break;case Z.ATTRIB_VALUE_ENTITY_U:F=Z.ATTRIB_VALUE_UNQUOTED,U="attribValue"}N===";"?(E[U]+=function(W){var Y,he=W.entity,Ee=he.toLowerCase(),v="";return W.ENTITIES[he]?W.ENTITIES[he]:W.ENTITIES[Ee]?W.ENTITIES[Ee]:((he=Ee).charAt(0)==="#"&&(v=he.charAt(1)==="x"?(he=he.slice(2),(Y=parseInt(he,16)).toString(16)):(he=he.slice(1),(Y=parseInt(he,10)).toString(10))),he=he.replace(/^0+/,""),isNaN(Y)||v.toLowerCase()!==he?(et(W,"Invalid character entity"),"&"+W.entity+";"):String.fromCodePoint(Y))}(E),E.entity="",E.state=F):ht(E.entity.length?pt:ae,N)?E.entity+=N:(et(E,"Invalid character in entity name"),E[U]+="&"+E.entity+N,E.entity="",E.state=F);continue;default:throw new Error(E,"Unknown state: "+E.state)}return E.position>=E.bufferCheckPosition&&function(W){for(var Y=Math.max(ne.MAX_BUFFER_LENGTH,10),he=0,Ee=0,v=de.length;Ee<v;Ee++){var be=W[de[Ee]].length;if(Y<be)switch(de[Ee]){case"textNode":Ut(W);break;case"cdata":Qe(W,"oncdata",W.cdata),W.cdata="";break;case"script":Qe(W,"onscript",W.script),W.script="";break;default:Di(W,"Max buffer length exceeded: "+de[Ee])}he=Math.max(he,be)}var je=ne.MAX_BUFFER_LENGTH-he;W.bufferCheckPosition=je+W.position}(E),E},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var x;Ut(x=this),x.cdata!==""&&(Qe(x,"oncdata",x.cdata),x.cdata=""),x.script!==""&&(Qe(x,"onscript",x.script),x.script="")}};try{ue=(void 0).Stream}catch{ue=function(){}}var ye=ne.EVENTS.filter(function(x){return x!=="error"&&x!=="end"});function xe(x,E){if(!(this instanceof xe))return new xe(x,E);ue.apply(this),this._parser=new oe(x,E),this.writable=!0,this.readable=!0;var F=this;this._parser.onend=function(){F.emit("end")},this._parser.onerror=function(U){F.emit("error",U),F._parser.error=null},this._decoder=null,ye.forEach(function(U){Object.defineProperty(F,"on"+U,{get:function(){return F._parser["on"+U]},set:function($){if(!$)return F.removeAllListeners(U),F._parser["on"+U]=$;F.on(U,$)},enumerable:!0,configurable:!1})})}(xe.prototype=Object.create(ue.prototype,{constructor:{value:xe}})).write=function(x){var E;return typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(x)&&(this._decoder||(E=ee.StringDecoder,this._decoder=new E("utf8")),x=this._decoder.write(x)),this._parser.write(x.toString()),this.emit("data",x),!0},xe.prototype.end=function(x){return x&&x.length&&this.write(x),this._parser.end(),!0},xe.prototype.on=function(x,E){var F=this;return F._parser["on"+x]||ye.indexOf(x)===-1||(F._parser["on"+x]=function(){var U=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);U.splice(0,0,x),F.emit.apply(F,U)}),ue.prototype.on.call(F,x,E)};var pe="[CDATA[",we="DOCTYPE",fe="http://www.w3.org/XML/1998/namespace",Se="http://www.w3.org/2000/xmlns/",it={xml:fe,xmlns:Se},Ue=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,at=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,ae=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,pt=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function De(x){return x===" "||x===`
`||x==="\r"||x==="	"}function Fe(x){return x==='"'||x==="'"}function ht(x,E){return x.test(E)}var Lt,ut,ct,Z=0;for(Lt in ne.STATE={BEGIN:Z++,BEGIN_WHITESPACE:Z++,TEXT:Z++,TEXT_ENTITY:Z++,OPEN_WAKA:Z++,SGML_DECL:Z++,SGML_DECL_QUOTED:Z++,DOCTYPE:Z++,DOCTYPE_QUOTED:Z++,DOCTYPE_DTD:Z++,DOCTYPE_DTD_QUOTED:Z++,COMMENT_STARTING:Z++,COMMENT:Z++,COMMENT_ENDING:Z++,COMMENT_ENDED:Z++,CDATA:Z++,CDATA_ENDING:Z++,CDATA_ENDING_2:Z++,PROC_INST:Z++,PROC_INST_BODY:Z++,PROC_INST_ENDING:Z++,OPEN_TAG:Z++,OPEN_TAG_SLASH:Z++,ATTRIB:Z++,ATTRIB_NAME:Z++,ATTRIB_NAME_SAW_WHITE:Z++,ATTRIB_VALUE:Z++,ATTRIB_VALUE_QUOTED:Z++,ATTRIB_VALUE_CLOSED:Z++,ATTRIB_VALUE_UNQUOTED:Z++,ATTRIB_VALUE_ENTITY_Q:Z++,ATTRIB_VALUE_ENTITY_U:Z++,CLOSE_TAG:Z++,CLOSE_TAG_SAW_WHITE:Z++,SCRIPT:Z++,SCRIPT_ENDING:Z++},ne.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},ne.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(ne.ENTITIES).forEach(function(x){var E=ne.ENTITIES[x],E=typeof E=="number"?String.fromCharCode(E):E;ne.ENTITIES[x]=E}),ne.STATE)ne.STATE[ne.STATE[Lt]]=Lt;function Ht(x,E,F){x[E]&&x[E](F)}function Qe(x,E,F){x.textNode&&Ut(x),Ht(x,E,F)}function Ut(x){x.textNode=ui(x.opt,x.textNode),x.textNode&&Ht(x,"ontext",x.textNode),x.textNode=""}function ui(x,E){return x.trim&&(E=E.trim()),E=x.normalize?E.replace(/\s+/g," "):E}function Di(x,E){return Ut(x),x.trackPosition&&(E+=`
Line: `+x.line+`
Column: `+x.column+`
Char: `+x.c),E=new Error(E),x.error=E,Ht(x,"onerror",E),x}function wi(x){return x.sawRoot&&!x.closedRoot&&et(x,"Unclosed root tag"),x.state!==Z.BEGIN&&x.state!==Z.BEGIN_WHITESPACE&&x.state!==Z.TEXT&&Di(x,"Unexpected end"),Ut(x),x.c="",x.closed=!0,Ht(x,"onend"),oe.call(x,x.strict,x.opt),x}function et(x,E){if(typeof x!="object"||!(x instanceof oe))throw new Error("bad call to strictFail");x.strict&&Di(x,E)}function on(x,E){var U=x.indexOf(":")<0?["",x]:x.split(":"),F=U[0],U=U[1];return E&&x==="xmlns"&&(F="xmlns",U=""),{prefix:F,local:U}}function an(x){var E,F,U;x.strict||(x.attribName=x.attribName[x.looseCase]()),x.attribList.indexOf(x.attribName)!==-1||x.tag.attributes.hasOwnProperty(x.attribName)||(x.opt.xmlns?(F=(E=on(x.attribName,!0)).prefix,E=E.local,F==="xmlns"&&(E==="xml"&&x.attribValue!==fe?et(x,"xml: prefix must be bound to "+fe+`
Actual: `+x.attribValue):E==="xmlns"&&x.attribValue!==Se?et(x,"xmlns: prefix must be bound to "+Se+`
Actual: `+x.attribValue):(F=x.tag,U=x.tags[x.tags.length-1]||x,F.ns===U.ns&&(F.ns=Object.create(U.ns)),F.ns[E]=x.attribValue)),x.attribList.push([x.attribName,x.attribValue])):(x.tag.attributes[x.attribName]=x.attribValue,Qe(x,"onattribute",{name:x.attribName,value:x.attribValue}))),x.attribName=x.attribValue=""}function Jt(x,E){if(x.opt.xmlns){var F=x.tag,U=on(x.tagName),U=(F.prefix=U.prefix,F.local=U.local,F.uri=F.ns[U.prefix]||"",F.prefix&&!F.uri&&(et(x,"Unbound namespace prefix: "+JSON.stringify(x.tagName)),F.uri=U.prefix),x.tags[x.tags.length-1]||x);F.ns&&U.ns!==F.ns&&Object.keys(F.ns).forEach(function(v){Qe(x,"onopennamespace",{prefix:v,uri:F.ns[v]})});for(var $=0,N=x.attribList.length;$<N;$++){var Ee=x.attribList[$],se=Ee[0],Ee=Ee[1],Y=on(se,!0),W=Y.prefix,Y=Y.local,he=W!==""&&F.ns[W]||"",Ee={name:se,value:Ee,prefix:W,local:Y,uri:he};W&&W!=="xmlns"&&!he&&(et(x,"Unbound namespace prefix: "+JSON.stringify(W)),Ee.uri=W),x.tag.attributes[se]=Ee,Qe(x,"onattribute",Ee)}x.attribList.length=0}x.tag.isSelfClosing=!!E,x.sawRoot=!0,x.tags.push(x.tag),Qe(x,"onopentag",x.tag),E||(x.noscript||x.tagName.toLowerCase()!=="script"?x.state=Z.TEXT:x.state=Z.SCRIPT,x.tag=null,x.tagName=""),x.attribName=x.attribValue="",x.attribList.length=0}function An(x){if(!x.tagName)return et(x,"Weird empty close tag."),x.textNode+="</>",void(x.state=Z.TEXT);if(x.script){if(x.tagName!=="script")return x.script+="</"+x.tagName+">",x.tagName="",void(x.state=Z.SCRIPT);Qe(x,"onscript",x.script),x.script=""}for(var E=x.tags.length,F=x.tagName,U=F=x.strict?F:F[x.looseCase]();E--&&x.tags[E].name!==U;)et(x,"Unexpected close tag");if(E<0)return et(x,"Unmatched closing tag: "+x.tagName),x.textNode+="</"+x.tagName+">",void(x.state=Z.TEXT);x.tagName=F;for(var $=x.tags.length;$-- >E;){var N,se=x.tag=x.tags.pop(),W=(x.tagName=x.tag.name,Qe(x,"onclosetag",x.tagName),{});for(N in se.ns)W[N]=se.ns[N];var Y=x.tags[x.tags.length-1]||x;x.opt.xmlns&&se.ns!==Y.ns&&Object.keys(se.ns).forEach(function(he){var Ee=se.ns[he];Qe(x,"onclosenamespace",{prefix:he,uri:Ee})})}E===0&&(x.closedRoot=!0),x.tagName=x.attribValue=x.attribName="",x.attribList.length=0,x.state=Z.TEXT}function Ot(x,E){E==="<"?(x.state=Z.OPEN_WAKA,x.startTagPosition=x.position):De(E)||(et(x,"Non-whitespace before first tag."),x.textNode=E,x.state=Z.TEXT)}function Vt(x,E){var F="";return F=E<x.length?x.charAt(E):F}function Qt(){var x=[],E=-1,F=arguments.length;if(!F)return"";for(var U="";++E<F;){var $=Number(arguments[E]);if(!isFinite($)||$<0||1114111<$||ct($)!==$)throw RangeError("Invalid code point: "+$);$<=65535?x.push($):($-=65536,x.push(55296+($>>10),$%1024+56320)),(E+1===F||16384<x.length)&&(U+=ut.apply(null,x),x.length=0)}return U}Z=ne.STATE,String.fromCodePoint||(ut=String.fromCharCode,ct=Math.floor,Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:Qt,configurable:!0,writable:!0}):String.fromCodePoint=Qt);var J,Re,ei=function(x){return Array.isArray?Array.isArray(x):Object.prototype.toString.call(x)==="[object Array]"},Ai=ei,yr={copyOptions:function(x){var E,F={};for(E in x)x.hasOwnProperty(E)&&(F[E]=x[E]);return F},ensureFlagExists:function(x,E){x in E&&typeof E[x]=="boolean"||(E[x]=!1)},ensureSpacesExists:function(x){"spaces"in x&&(typeof x.spaces=="number"||typeof x.spaces=="string")||(x.spaces=0)},ensureAlwaysArrayExists:function(x){"alwaysArray"in x&&(typeof x.alwaysArray=="boolean"||Ai(x.alwaysArray))||(x.alwaysArray=!1)},ensureKeyExists:function(x,E){x+"Key"in E&&typeof E[x+"Key"]=="string"||(E[x+"Key"]=E.compact?"_"+x:x)},checkFnExists:function(x,E){return x+"Fn"in E}},ln=vs,Je=yr,yt=ei;function ys(x){var E=Number(x);return isNaN(E)?(E=x.toLowerCase(),E==="true"||E!=="false"&&x):E}function Mn(x,E){var F,U;if(J.compact){if(!Re[J[x+"Key"]]&&(yt(J.alwaysArray)?J.alwaysArray.indexOf(J[x+"Key"])!==-1:J.alwaysArray)&&(Re[J[x+"Key"]]=[]),Re[J[x+"Key"]]&&!yt(Re[J[x+"Key"]])&&(Re[J[x+"Key"]]=[Re[J[x+"Key"]]]),x+"Fn"in J&&typeof E=="string"&&(E=J[x+"Fn"](E,Re)),x==="instruction"&&("instructionFn"in J||"instructionNameFn"in J))for(F in E)E.hasOwnProperty(F)&&("instructionFn"in J?E[F]=J.instructionFn(E[F],F,Re):(U=E[F],delete E[F],E[J.instructionNameFn(F,U,Re)]=U));yt(Re[J[x+"Key"]])?Re[J[x+"Key"]].push(E):Re[J[x+"Key"]]=E}else{Re[J.elementsKey]||(Re[J.elementsKey]=[]);var $={};if(($[J.typeKey]=x)==="instruction"){for(F in E)if(E.hasOwnProperty(F))break;$[J.nameKey]="instructionNameFn"in J?J.instructionNameFn(F,E,Re):F,J.instructionHasAttributes?($[J.attributesKey]=E[F][J.attributesKey],"instructionFn"in J&&($[J.attributesKey]=J.instructionFn($[J.attributesKey],F,Re))):("instructionFn"in J&&(E[F]=J.instructionFn(E[F],F,Re)),$[J.instructionKey]=E[F])}else x+"Fn"in J&&(E=J[x+"Fn"](E,Re)),$[J[x+"Key"]]=E;J.addParent&&($[J.parentKey]=Re),Re[J.elementsKey].push($)}}function vo(x){var E,F;if("attributesFn"in J&&x&&(x=J.attributesFn(x,Re)),(J.trim||"attributeValueFn"in J||"attributeNameFn"in J||J.nativeTypeAttributes)&&x)for(E in x)x.hasOwnProperty(E)&&(J.trim&&(x[E]=x[E].trim()),J.nativeTypeAttributes&&(x[E]=ys(x[E])),"attributeValueFn"in J&&(x[E]=J.attributeValueFn(x[E],E,Re)),"attributeNameFn"in J&&(F=x[E],delete x[E],x[J.attributeNameFn(E,x[E],Re)]=F));return x}function Eo(x){var E,F={};if(x.body&&(x.name.toLowerCase()==="xml"||J.instructionHasAttributes)){for(var U,$=/([\w:-]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|(\w+))\s*/g;(U=$.exec(x.body))!==null;)F[U[1]]=U[2]||U[3]||U[4];F=vo(F)}x.name.toLowerCase()==="xml"?J.ignoreDeclaration||(Re[J.declarationKey]={},Object.keys(F).length&&(Re[J.declarationKey][J.attributesKey]=F),J.addParent&&(Re[J.declarationKey][J.parentKey]=Re)):J.ignoreInstruction||(J.trim&&(x.body=x.body.trim()),E={},J.instructionHasAttributes&&Object.keys(F).length?(E[x.name]={},E[x.name][J.attributesKey]=F):E[x.name]=x.body,Mn("instruction",E))}function wo(x,E){if(typeof x=="object"&&(E=x.attributes,x=x.name),E=vo(E),"elementNameFn"in J&&(x=J.elementNameFn(x,Re)),J.compact){var F,U={};if(!J.ignoreAttributes&&E&&Object.keys(E).length)for(F in U[J.attributesKey]={},E)E.hasOwnProperty(F)&&(U[J.attributesKey][F]=E[F]);x in Re||(yt(J.alwaysArray)?J.alwaysArray.indexOf(x)===-1:!J.alwaysArray)||(Re[x]=[]),Re[x]&&!yt(Re[x])&&(Re[x]=[Re[x]]),yt(Re[x])?Re[x].push(U):Re[x]=U}else Re[J.elementsKey]||(Re[J.elementsKey]=[]),(U={})[J.typeKey]="element",U[J.nameKey]=x,!J.ignoreAttributes&&E&&Object.keys(E).length&&(U[J.attributesKey]=E),J.alwaysChildren&&(U[J.elementsKey]=[]),Re[J.elementsKey].push(U);U[J.parentKey]=Re,Re=U}function gr(x){J.ignoreText||(x.trim()||J.captureSpacesBetweenElements)&&(J.trim&&(x=x.trim()),J.nativeType&&(x=ys(x)),Mn("text",x=J.sanitize?x.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):x))}function Co(x){J.ignoreComment||Mn("comment",x=J.trim?x.trim():x)}function mr(x){var E=Re[J.parentKey];J.addParent||delete Re[J.parentKey],Re=E}function In(x){J.ignoreCdata||Mn("cdata",x=J.trim?x.trim():x)}function Fn(x){J.ignoreDoctype||(x=x.replace(/^ /,""),Mn("doctype",x=J.trim?x.trim():x))}function Pn(x){x.note=x}function pr(x,E){var F=ln.parser(!0,{}),U={};return Re=U,J=Je.copyOptions(E),Je.ensureFlagExists("ignoreDeclaration",J),Je.ensureFlagExists("ignoreInstruction",J),Je.ensureFlagExists("ignoreAttributes",J),Je.ensureFlagExists("ignoreText",J),Je.ensureFlagExists("ignoreComment",J),Je.ensureFlagExists("ignoreCdata",J),Je.ensureFlagExists("ignoreDoctype",J),Je.ensureFlagExists("compact",J),Je.ensureFlagExists("alwaysChildren",J),Je.ensureFlagExists("addParent",J),Je.ensureFlagExists("trim",J),Je.ensureFlagExists("nativeType",J),Je.ensureFlagExists("nativeTypeAttributes",J),Je.ensureFlagExists("sanitize",J),Je.ensureFlagExists("instructionHasAttributes",J),Je.ensureFlagExists("captureSpacesBetweenElements",J),Je.ensureAlwaysArrayExists(J),Je.ensureKeyExists("declaration",J),Je.ensureKeyExists("instruction",J),Je.ensureKeyExists("attributes",J),Je.ensureKeyExists("text",J),Je.ensureKeyExists("comment",J),Je.ensureKeyExists("cdata",J),Je.ensureKeyExists("doctype",J),Je.ensureKeyExists("type",J),Je.ensureKeyExists("name",J),Je.ensureKeyExists("elements",J),Je.ensureKeyExists("parent",J),F.opt={strictEntities:!0},F.onopentag=wo,F.ontext=gr,F.oncomment=Co,F.onclosetag=mr,F.onerror=Pn,F.oncdata=In,F.ondoctype=Fn,F.onprocessinginstruction=Eo,F.write(x).close(),U[J.elementsKey]&&(E=U[J.elementsKey],delete U[J.elementsKey],U[J.elementsKey]=E,delete U.text),U}var br=yr,Wt=pr,bt,rt,Ye=yr,Xt=ei;function Yt(x,E,F){return(!F&&x.spaces?`
`:"")+Array(E+1).join(x.spaces)}function Ui(x,E,F){if(E.ignoreAttributes)return"";var U,$,N,se,W=[];for(U in x="attributesFn"in E?E.attributesFn(x,rt,bt):x)x.hasOwnProperty(U)&&x[U]!==null&&x[U]!==void 0&&(se=E.noQuotesForNativeAttributes&&typeof x[U]!="string"?"":'"',$=($=""+x[U]).replace(/"/g,"&quot;"),N="attributeNameFn"in E?E.attributeNameFn(U,$,rt,bt):U,W.push(E.spaces&&E.indentAttributes?Yt(E,F+1,!1):" "),W.push(N+"="+se+("attributeValueFn"in E?E.attributeValueFn($,U,rt,bt):$)+se));return x&&Object.keys(x).length&&E.spaces&&E.indentAttributes&&W.push(Yt(E,F,!1)),W.join("")}function kt(x,E,F){return bt=x,rt="xml",E.ignoreDeclaration?"":"<?xml"+Ui(x[E.attributesKey],E,F)+"?>"}function Kt(x,E,F){if(E.ignoreInstruction)return"";for(var U in x)if(x.hasOwnProperty(U))break;var $="instructionNameFn"in E?E.instructionNameFn(U,x[U],rt,bt):U;return typeof x[U]=="object"?"<?"+(rt=$)+Ui((bt=x)[U][E.attributesKey],E,F)+"?>":(F=x[U]||"","<?"+$+((F="instructionFn"in E?E.instructionFn(F,U,rt,bt):F)?" "+F:"")+"?>")}function bi(x,E){return E.ignoreComment?"":"<!--"+("commentFn"in E?E.commentFn(x,rt,bt):x)+"-->"}function xo(x,E){return E.ignoreCdata?"":"<![CDATA["+("cdataFn"in E?E.cdataFn(x,rt,bt):x.replace("]]>","]]]]><![CDATA[>"))+"]]>"}function Nc(x,E){return E.ignoreDoctype?"":"<!DOCTYPE "+("doctypeFn"in E?E.doctypeFn(x,rt,bt):x)+">"}function Qa(x,E){return E.ignoreText?"":(x=(x=(x=""+x).replace(/&amp;/g,"&")).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"textFn"in E?E.textFn(x,rt,bt):x)}function zp(x,E,F){rt=(bt=x).name;var U=[],$="elementNameFn"in E?E.elementNameFn(x.name,x):x.name,N=(U.push("<"+$),x[E.attributesKey]&&U.push(Ui(x[E.attributesKey],E,F)),x[E.elementsKey]&&x[E.elementsKey].length||x[E.attributesKey]&&x[E.attributesKey]["xml:space"]==="preserve");return(N=N||("fullTagEmptyElementFn"in E?E.fullTagEmptyElementFn(x.name,x):E.fullTagEmptyElement))?(U.push(">"),x[E.elementsKey]&&x[E.elementsKey].length&&(U.push(Gc(x[E.elementsKey],E,F+1)),rt=(bt=x).name),U.push(E.spaces&&function(se,W){var Y;if(se.elements&&se.elements.length)for(Y=0;Y<se.elements.length;++Y)switch(se.elements[Y][W.typeKey]){case"text":if(W.indentText)return 1;break;case"cdata":if(W.indentCdata)return 1;break;case"instruction":if(W.indentInstruction)return 1;break;default:return 1}}(x,E)?`
`+Array(F+1).join(E.spaces):""),U.push("</"+$+">")):U.push("/>"),U.join("")}function Gc(x,E,F,U){return x.reduce(function($,N){var se=Yt(E,F,U&&!$);switch(N.type){case"element":return $+se+zp(N,E,F);case"comment":return $+se+bi(N[E.commentKey],E);case"doctype":return $+se+Nc(N[E.doctypeKey],E);case"cdata":return $+(E.indentCdata?se:"")+xo(N[E.cdataKey],E);case"text":return $+(E.indentText?se:"")+Qa(N[E.textKey],E);case"instruction":var W={};return W[N[E.nameKey]]=N[E.attributesKey]?N:N[E.instructionKey],$+(E.indentInstruction?se:"")+Kt(W,E,F)}},"")}function zc(x,E,F){for(var U in x)if(x.hasOwnProperty(U))switch(U){case E.parentKey:case E.attributesKey:break;case E.textKey:if(E.indentText||F)return!0;break;case E.cdataKey:if(E.indentCdata||F)return!0;break;case E.instructionKey:if(E.indentInstruction||F)return!0;break;case E.doctypeKey:case E.commentKey:default:return!0}return!1}function Bc(x,E,F,U){var $,N,se,W=[];for(N in x)if(x.hasOwnProperty(N))for(se=Xt(x[N])?x[N]:[x[N]],$=0;$<se.length;++$){switch(N){case E.declarationKey:W.push(kt(se[$],E,F));break;case E.instructionKey:W.push((E.indentInstruction?Yt(E,F,U):"")+Kt(se[$],E,F));break;case E.attributesKey:case E.parentKey:break;case E.textKey:W.push((E.indentText?Yt(E,F,U):"")+Qa(se[$],E));break;case E.cdataKey:W.push((E.indentCdata?Yt(E,F,U):"")+xo(se[$],E));break;case E.doctypeKey:W.push(Yt(E,F,U)+Nc(se[$],E));break;case E.commentKey:W.push(Yt(E,F,U)+bi(se[$],E));break;default:W.push(Yt(E,F,U)+function(Y,he,Ee,v,be){bt=Y,rt=he;var je="elementNameFn"in Ee?Ee.elementNameFn(he,Y):he;if(Y==null||Y==="")return"fullTagEmptyElementFn"in Ee&&Ee.fullTagEmptyElementFn(he,Y)||Ee.fullTagEmptyElement?"<"+je+"></"+je+">":"<"+je+"/>";var Ke=[];if(he){if(Ke.push("<"+je),typeof Y!="object")return Ke.push(">"+Qa(Y,Ee)+"</"+je+">"),Ke.join("");Y[Ee.attributesKey]&&Ke.push(Ui(Y[Ee.attributesKey],Ee,v));var gt=zc(Y,Ee,!0)||Y[Ee.attributesKey]&&Y[Ee.attributesKey]["xml:space"]==="preserve";if(!(gt=gt||("fullTagEmptyElementFn"in Ee?Ee.fullTagEmptyElementFn(he,Y):Ee.fullTagEmptyElement)))return Ke.push("/>"),Ke.join("");Ke.push(">")}return Ke.push(Bc(Y,Ee,v+1,!1)),bt=Y,(rt=he)&&Ke.push((be?Yt(Ee,v,!1):"")+"</"+je+">"),Ke.join("")}(se[$],N,E,F,zc(se[$],E)))}U=U&&!W.length}return W.join("")}function jc(x,E){F=E,F=Ye.copyOptions(F),Ye.ensureFlagExists("ignoreDeclaration",F),Ye.ensureFlagExists("ignoreInstruction",F),Ye.ensureFlagExists("ignoreAttributes",F),Ye.ensureFlagExists("ignoreText",F),Ye.ensureFlagExists("ignoreComment",F),Ye.ensureFlagExists("ignoreCdata",F),Ye.ensureFlagExists("ignoreDoctype",F),Ye.ensureFlagExists("compact",F),Ye.ensureFlagExists("indentText",F),Ye.ensureFlagExists("indentCdata",F),Ye.ensureFlagExists("indentAttributes",F),Ye.ensureFlagExists("indentInstruction",F),Ye.ensureFlagExists("fullTagEmptyElement",F),Ye.ensureFlagExists("noQuotesForNativeAttributes",F),Ye.ensureSpacesExists(F),typeof F.spaces=="number"&&(F.spaces=Array(F.spaces+1).join(" ")),Ye.ensureKeyExists("declaration",F),Ye.ensureKeyExists("instruction",F),Ye.ensureKeyExists("attributes",F),Ye.ensureKeyExists("text",F),Ye.ensureKeyExists("comment",F),Ye.ensureKeyExists("cdata",F),Ye.ensureKeyExists("doctype",F),Ye.ensureKeyExists("type",F),Ye.ensureKeyExists("name",F),Ye.ensureKeyExists("elements",F);var F,U=[];return bt=x,rt="_root_",(E=F).compact?U.push(Bc(x,E,0,!0)):(x[E.declarationKey]&&U.push(kt(x[E.declarationKey],E,0)),x[E.elementsKey]&&x[E.elementsKey].length&&U.push(Gc(x[E.elementsKey],E,0,!U.length))),U.join("")}var _r,Bp=jc,jp={xml2js:pr,xml2json:function(x,E){var F;return E=E,E=br.copyOptions(E),br.ensureSpacesExists(E),E=Wt(x,x=E),F="compact"in x&&x.compact?"_parent":"parent",("addParent"in x&&x.addParent?JSON.stringify(E,function(U,$){return U===F?"_":$},x.spaces):JSON.stringify(E,null,x.spaces)).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},js2xml:jc,json2xml:function(x,E){var F=null;if(typeof(x=x instanceof Buffer?x.toString():x)=="string")try{F=JSON.parse(x)}catch{throw new Error("The JSON structure is invalid")}else F=x;return Bp(F,E)}},On={raster:{},vector:{}};function el(x){return x&&(x=jp.xml2js(x),x.elements&&0<x.elements.length&&(x.elements.length!==1&&console.warn("invalid xml!"),x.elements[0]&&x.elements[0].elements))?x.elements[0].elements.map(function(E){var F=E.attributes;return E.elements&&0<E.elements.length&&(F.options=E.elements.map(function(U){return U.elements[0].text})),F}):null}function Hp(){for(var x,E,F,U=S.GDALGetDriverCount(),$=0;$<U;$+=1){var N=S.GDALGetDriver($),se=(N=N,F=E=se=x=void 0,x=S.GDALGetMetadataItem(N,"DMD_EXTENSIONS",null),(se=(se=S.GDALGetMetadataItem(N,"DMD_EXTENSION",null))===""&&x!==""?x.split(" ")[0]:se)!==""&&(se=se.replace(".","").replace("/","")),(E=S.GDALGetDescription(N))==="GeoJSON"&&(se="geojson"),F=S.GDALGetMetadataItem(N,"DMD_LONGNAME",null),{extension:se,extensions:x,shortName:E,longName:F,isReadable:S.GDALGetMetadataItem(N,"DCAP_OPEN",null)==="YES",isWritable:S.GDALGetMetadataItem(N,"DCAP_CREATE",null)==="YES"||S.GDALGetMetadataItem(N,"DCAP_CREATECOPY",null)==="YES",isRaster:S.GDALGetMetadataItem(N,"DCAP_RASTER",null)==="YES",isVector:S.GDALGetMetadataItem(N,"DCAP_VECTOR",null)==="YES",openOptionsList:el(S.GDALGetMetadataItem(N,"DMD_OPENOPTIONLIST",null)),creationOptionList:el(S.GDALGetMetadataItem(N,"DMD_CREATIONOPTIONLIST",null)),layerCreationOptionList:el(S.GDALGetMetadataItem(N,"DS_LAYER_CREATIONOPTIONLIST",null)),helpUrl:S.GDALGetMetadataItem(N,"DMD_HELPTOPIC",null)});se.isRaster&&(On.raster[se.shortName]=o(o({index:$},se),{},{type:"raster"})),se.isVector&&(On.vector[se.shortName]=o(o({index:$},se),{},{type:"vector"}))}}function Hc(){!n&&typeof importScripts!="function"||S.Module.FS.unmount(K)}var Up={ogr2ogr:function(x){var E=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[];return new Promise(function(F,U){var $=k(E),N=$.config,N=(Object.entries(N).forEach(function(be){var be=u(be,2),v=be[0],be=be[1];S.CPLSetConfigOption(v,be)}),S.GDALVectorTranslateOptionsNew($.ptr,null)),he=S.Module._malloc(4),W=(S.Module.setValue(he,x.pointer,"*"),E.indexOf("-f")+1),se="unknown",W=(W!==0&&(W=E[W],(Y=On.vector[W])&&(se=W==="MapInfo File"&&E.indexOf("FORMAT=MIF")!==-1?"mif":Y.extension)),x.path.split(".",1)[0]),Y="".concat(ie,"/").concat(W,".").concat(se),he=S.GDALVectorTranslate(Y,null,1,he,N,null);S.GDALVectorTranslateOptionsFree(N),H($),S.GDALClose(he),S.CPLGetLastErrorNo()!==0?U(P()):F({local:Y,real:"".concat(te,"/").concat(W,".").concat(se)})})},gdal_translate:function(x){var E=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[];return new Promise(function(F,U){var $=k(E),N=$.config,N=(Object.entries(N).forEach(function(be){var be=u(be,2),v=be[0],be=be[1];S.CPLSetConfigOption(v,be)}),S.GDALTranslateOptionsNew($.ptr,null)),W=E.indexOf("-of")+1,se="unknown",W=(W!==0&&(W=E[W],(W=On.raster[W])&&(se=W.extension)),x.path.split(".",1)[0]),Y="".concat(ie,"/").concat(W,".").concat(se),he=S.GDALTranslate(Y,x.pointer,N,null);S.GDALTranslateOptionsFree(N),H($),S.GDALClose(he),S.CPLGetLastErrorNo()!==0?U(P()):F({local:Y,real:"".concat(te,"/").concat(W,".").concat(se)})})},gdal_rasterize:function(x){var E=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[];return new Promise(function(F,U){var $=k(E),N=$.config,N=(Object.entries(N).forEach(function(be){var be=u(be,2),v=be[0],be=be[1];S.CPLSetConfigOption(v,be)}),S.GDALRasterizeOptionsNew($.ptr,null)),W=E.indexOf("-of")+1,se="tif",W=(W!==0&&(W=E[W],(W=On.raster[W])&&(se=W.extension)),x.path.split(".",1)[0]),Y="".concat(ie,"/").concat(W,".").concat(se),he=S.GDALRasterize(Y,null,x.pointer,N,null);S.GDALRasterizeOptionsFree(N),H($),S.GDALClose(he),S.CPLGetLastErrorNo()!==0?U(P()):F({local:Y,real:"".concat(te,"/").concat(W,".").concat(se)})})},gdalwarp:function(x){var E=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[];return new Promise(function(F,U){var $=k(E),N=$.config,N=(Object.entries(N).forEach(function(be){var be=u(be,2),v=be[0],be=be[1];S.CPLSetConfigOption(v,be)}),S.GDALWarpAppOptionsNew($.ptr,null)),he=S.Module._malloc(4),W=(S.Module.setValue(he,x.pointer,"*"),E.indexOf("-of")+1),se="unknown",W=(W!==0&&(W=E[W],(W=On.raster[W])&&(se=W.extension)),x.path.split(".",1)[0]),Y="".concat(ie,"/").concat(W,".").concat(se),he=S.GDALWarp(Y,null,1,he,N,null);S.GDALWarpAppOptionsFree(N),H($),S.GDALClose(he),S.CPLGetLastErrorNo()!==0?U(P()):F({local:Y,real:"".concat(te,"/").concat(W,".").concat(se)})})},gdaltransform:function(x,E){return new Promise(function(F){for(var U=new Float64Array(x.map(function(Mi){return Mi[0]})),$=new Float64Array(x.map(function(Mi){return Mi[1]})),N=new Float64Array(x.map(function(Mi){return Mi[2]||0})),se=S.Module._malloc(U.length*U.BYTES_PER_ELEMENT),W=S.Module._malloc($.length*$.BYTES_PER_ELEMENT),Y=S.Module._malloc(N.length*N.BYTES_PER_ELEMENT),he=(S.Module.HEAPF64.set(U,se/U.BYTES_PER_ELEMENT),S.Module.HEAPF64.set($,W/$.BYTES_PER_ELEMENT),S.Module.HEAPF64.set(N,Y/N.BYTES_PER_ELEMENT),!1),Ee=!1,v=[],be=0;be<E.length;be+=1)switch(E[be]){case"-s_srs":be+=1,v.push("SRC_SRS=".concat(E[be]));break;case"-t_srs":be+=1,v.push("DST_SRS=".concat(E[be]));break;case"-ct":be+=1,v.push("COORDINATE_OPERATION=".concat(E[be]));break;case"-order":be+=1,v.push("MAX_GCP_ORDER=".concat(E[be]));break;case"-tps":v.push("METHOD=GCP_TPS");break;case"-rpc":v.push("METHOD=RPC");break;case"-geoloc":v.push("METHOD=GEOLOC_ARRAY");break;case"-i":he=!0;break;case"-to":be+=1,v.push("".concat(E[be]));break;case"-output_xy":Ee=!0}for(var je=k(v),Ke=S.GDALCreateGenImgProjTransformer2(null,null,je.ptr),gt=(S.GDALGenImgProjTransform(Ke,he,x.length,se,W,Y,null),[Array.from(S.Module.HEAPF64.subarray(se/U.BYTES_PER_ELEMENT,se/U.BYTES_PER_ELEMENT+U.length)),Array.from(S.Module.HEAPF64.subarray(W/$.BYTES_PER_ELEMENT,W/$.BYTES_PER_ELEMENT+$.length)),Array.from(S.Module.HEAPF64.subarray(Y/N.BYTES_PER_ELEMENT,Y/N.BYTES_PER_ELEMENT+N.length))]),nt=[],Tt=0;Tt<gt[0].length;Tt+=1)Ee?nt.push([gt[0][Tt],gt[1][Tt]]):nt.push([gt[0][Tt],gt[1][Tt],gt[2][Tt]]);S.Module._free(se),S.Module._free(W),S.Module._free(Y),H(je),S.GDALDestroyGenImgProjTransformer(Ke),F(nt)})},open:function(x){var E=x,F=k(1<arguments.length&&arguments[1]!==void 0?arguments[1]:[]);return Array.isArray(E)||typeof FileList=="function"&&E instanceof FileList||(E=[E]),new Promise(function(U,$){var N,se=[],W=[];f(E).forEach(function(Y){!(typeof Y=="string"||Y instanceof String)||Y.substr(0,K.length+1)!=="".concat(K,"/")&&Y.substr(0,ie.length+1)!=="".concat(ie,"/")?W.push(Y):se.push({name:Y.substr(ie.length+1),internal:!0})}),N=W,new Promise(function(Y){var he,Ee;N.length===0?Y([]):n?(he=[],N.forEach(function(je){var je=je.split("/"),be=je.pop(),je=je.join("/")||".";_r!==je&&(_r&&Hc(),_r=je,S.Module.FS.mount(S.Module.NODEFS,{root:je},K)),he.push({name:be})}),Y(he)):typeof importScripts=="function"?(_r&&Hc(),S.Module.FS.mount(S.Module.WORKERFS,{files:N},K),_r=!0,Y(N)):(Ee=[],N.forEach(function(v){Ee.push(v.arrayBuffer())}),Promise.all(Ee).then(function(v){v.forEach(function(be,je){be=new Uint8Array(be),S.Module.FS.writeFile("".concat(K,"/").concat(N[je].name),be)}),Y(N)}))}).then(function(Y){for(var he=[].concat(f(Y),se),Ee=[],v=(S.CPLErrorReset(),{}),be=0;be<he.length;be+=1){var je,Ke=he[be].name,gt=Ke.split(".",1)[0];v[gt]||(v[gt]={}),v[gt].pointer||(v[gt].path=Ke,je="".concat(K,"/").concat(Ke),he[be].internal&&(je="".concat(ie,"/").concat(Ke)),Ke=S.GDALOpenEx(je,null,null,F.ptr,null),S.CPLGetLastErrorNo()!==0||Ke===0?(je=P(),Ee.push(je),delete v[gt]):(v[gt].pointer=Ke,je=S.GDALGetRasterCount(Ke),Ke=S.GDALDatasetGetLayerCount(Ke),v[gt].type=0<je&&Ke===0?"raster":"vector"))}H(F),Y=Object.values(v),0<Y.length||Ee.length===0?U({datasets:Y,errors:Ee}):$(Ee)})})},close:function(x){return new Promise(function(E){S.GDALClose(x.pointer),E()})},getInfo:function(x){return new Promise(function(E){var F=S.GDALGetRasterCount(x.pointer),U=S.GDALDatasetGetLayerCount(x.pointer);if(0<F&&U===0){var $=S.GDALGetRasterXSize(x.pointer),N=S.GDALGetRasterYSize(x.pointer),se=S.GDALGetProjectionRef(x.pointer),Y=S.Module._malloc(6*Float64Array.BYTES_PER_ELEMENT),W=(S.GDALGetGeoTransform(x.pointer,Y),S.Module.HEAPF64.subarray(Y/Float64Array.BYTES_PER_ELEMENT,Y/Float64Array.BYTES_PER_ELEMENT+6)),Y=[[0,0],[$,0],[$,N],[0,N]].map(function(Tt){var nt=Tt[0],Tt=Tt[1];return[W[0]+W[1]*nt+W[2]*Tt,W[3]+W[4]*nt+W[5]*Tt]}),he=S.GDALGetDatasetDriver(x.pointer),he=S.GDALGetDriverLongName(he),Ee=S.OGR_DS_GetName(x.pointer);E(JSON.parse(JSON.stringify({type:"raster",bandCount:F,width:$,height:N,projectionWkt:se,coordinateTransform:W,corners:Y,driverName:he,dsName:Ee})))}else{for(var v=[],be=0;be<U;be+=1){var Ke=S.OGR_DS_GetLayer(x.pointer,be),je=S.OGR_L_GetName(Ke),Ke=S.OGR_L_GetFeatureCount(Ke,1);v.push({name:je,featureCount:Ke})}F=v.reduce(function(gt,nt){return gt+nt.featureCount},0),$=S.OGR_DS_GetName(x.pointer),N=S.GDALGetDatasetDriver(x.pointer),E({type:"vector",layerCount:U,featureCount:F,layers:v,dsName:$,driverName:S.GDALGetDriverLongName(N)})}})},getOutputFiles:function(){return new Promise(function(x){x(function E(F){var U=0<arguments.length&&F!==void 0?F:ie.substr(1),$=U.split("/").reduce(function(se,W){return se.contents[W]},S.Module.FS.root).contents,N=[];return Object.keys($).forEach(function(se){var W=$[se];W.usedBytes?N.push({path:"/".concat(U,"/").concat(se),size:W.usedBytes}):W.contents&&N.push.apply(N,f(E("".concat(U,"/").concat(se))))}),N}())})},getFileBytes:function(x){return new Promise(function(E){var F;x?(F=x.local||x,E(S.Module.FS.readFile(F,{encoding:"binary"}))):E(new Uint8Array)})},drivers:On};function Vp(x){var E;onmessage=function(F){var U;return F.data&&F.data.func==="constructor"?(U={useWorker:!1},F.data.params&&F.data.params.config&&(U=o(o({},F.data.params.config),U)),(E=x(U)).then(function($){return $=$.drivers,postMessage({success:!0,id:"onload",data:$})}).catch(function($){return postMessage({success:!1,id:"onload",data:$})}),null):E.then(function($){var N=this;this.data&&this.data.func&&$[this.data.func]?$[this.data.func].apply($,f(this.data.params)).then(function(se){postMessage({success:!0,id:N.data.id,data:se})}).catch(function(se){postMessage({success:!1,id:N.data.id,data:{message:se.message}})}):console.error("undefined function",this.data)}.bind(F)).catch(function($){postMessage({success:!1,id:this.id,data:{no:-1,message:$.message}})}.bind(F))}}var Uc,tl={gdalWorkerWrapper:null,drivers:null},vs=function(){function x(U,$,N){var se=this;if(!(this instanceof x))throw new TypeError("Cannot call a class as a function");this.promises={onload:{resolve:N,reject:console.error}},this.gdalWorker=new Worker(U),this.gdalWorker.onmessage=function(W){W.data&&W.data.id&&se.promises[W.data.id]&&(W.data.success?se.promises[W.data.id].resolve(W.data.data):se.promises[W.data.id].reject(W.data.data))},this.gdalWorker.postMessage({func:"constructor",params:{config:$}})}var E,F;return E=x,(F=[{key:"call",value:function(U){var $=this;return new Promise(function(N,se){U.id=Math.floor(1e5*Math.random()),$.promises[U.id]={resolve:N,reject:se},$.gdalWorker.postMessage(U)})}},{key:"terminate",value:function(){this.gdalWorker.terminate(),delete this.gdalWorker,delete this.promises}}])&&l(E.prototype,F),Object.defineProperty(E,"prototype",{writable:!1}),x}(),yr=new Proxy({},{get:function(x,E){return E==="then"||E==="catch"?x:E==="drivers"?tl.drivers:function(){for(var F=arguments.length,U=new Array(F),$=0;$<F;$++)U[$]=arguments[$];return new Promise(function(N,se){tl.gdalWorkerWrapper.call({func:E,params:U}).then(function(W){N(W)}).catch(function(W){return se(W)})})}}}),To={variables:tl,WorkerWrapper:vs,gdalProxy:yr};function il(){var x,E,F=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return Uc=Uc||(n||F.useWorker===!1?new Promise(function(U,$){var N=S.Module,se=N.onAbort;N.onAbort=function(W){$(new Error(W)),se&&se(W)},N.print=function(W){console.debug("gdal stdout: ".concat(W))},N.printErr=function(W){console.error("gdal stderr: ".concat(W))},N.preRun=[function(W){W=W.ENV,W.PROJ_LIB="/usr/share/proj",W.GDAL_DATA="/usr/share/gdal",W.DXF_FEATURE_LIMIT_PER_BLOCK="-1",W.GDAL_NUM_THREADS="0",W.GDAL_ENABLE_DEPRECATED_DRIVER_GTM="YES",W.CPL_LOG_ERRORS="ON"}],N.onRuntimeInitialized=function(){var W,Y;S.GDALOpen||((Y=S.Module).ccall("GDALAllRegister",null,[],[]),S.GDALOpen=Y.cwrap("GDALOpen","number",["string"]),S.GDALOpenEx=Y.cwrap("GDALOpenEx","number",["string","number","number","number","number"]),S.GDALClose=Y.cwrap("GDALClose",null,["number"]),S.CPLErrorReset=Y.cwrap("CPLErrorReset",null,[]),S.CPLSetErrorHandler=Y.cwrap("CPLSetErrorHandler","number",["number"]),S.CPLQuietErrorHandler=Y.cwrap("CPLQuietErrorHandler",null,["number","number","string"]),S.CPLGetLastErrorNo=Y.cwrap("CPLGetLastErrorNo","number",[]),S.CPLGetLastErrorMsg=Y.cwrap("CPLGetLastErrorMsg","string",[]),S.CPLGetLastErrorType=Y.cwrap("CPLGetLastErrorType","number",[]),S.CPLSetConfigOption=Y.cwrap("CPLSetConfigOption",null,["string","string"]),S.CPLSetThreadLocalConfigOption=Y.cwrap("CPLSetThreadLocalConfigOption",null,["string","string"]),S.GDALGetRasterCount=Y.cwrap("GDALGetRasterCount","number",["number"]),S.GDALGetRasterXSize=Y.cwrap("GDALGetRasterXSize","number",["number"]),S.GDALGetRasterYSize=Y.cwrap("GDALGetRasterYSize","number",["number"]),S.GDALGetProjectionRef=Y.cwrap("GDALGetProjectionRef","string",["number"]),S.GDALGetGeoTransform=Y.cwrap("GDALGetGeoTransform","number",["number","number"]),S.GDALVectorTranslate=Y.cwrap("GDALVectorTranslate","number",["string","number","number","number","number","number"]),S.GDALVectorTranslateOptionsNew=Y.cwrap("GDALVectorTranslateOptionsNew","number",["number","number"]),S.GDALVectorTranslateOptionsFree=Y.cwrap("GDALVectorTranslateOptionsFree","number",["number"]),S.GDALDatasetGetLayerCount=Y.cwrap("GDALDatasetGetLayerCount","number",["number"]),S.GDALDatasetGetLayer=Y.cwrap("GDALDatasetGetLayer","number",["number","number"]),S.OGR_DS_GetLayerCount=Y.cwrap("OGR_DS_GetLayerCount","number",["number"]),S.OGR_DS_GetName=Y.cwrap("OGR_DS_GetName","string",["number"]),S.OGR_DS_GetLayer=Y.cwrap("OGR_DS_GetLayer","number",["number","number"]),S.OGR_L_GetName=Y.cwrap("OGR_L_GetName","string",["number"]),S.OGR_DS_GetDriver=Y.cwrap("OGR_DS_GetDriver","number",["number"]),S.OGR_Dr_GetName=Y.cwrap("OGR_Dr_GetName","string",["number"]),S.GDALGetDatasetDriver=Y.cwrap("GDALGetDatasetDriver","number",["number"]),S.GDALGetDriverLongName=Y.cwrap("GDALGetDriverLongName","string",["number"]),S.GDALGetDriverShortName=Y.cwrap("GDALGetDriverShortName","string",["number"]),S.GDALTranslate=Y.cwrap("GDALTranslate","number",["string","number","number","number"]),S.GDALTranslateOptionsNew=Y.cwrap("GDALTranslateOptionsNew","number",["number","number"]),S.GDALTranslateOptionsFree=Y.cwrap("GDALTranslateOptionsFree","number",["number"]),S.GDALRasterize=Y.cwrap("GDALRasterize","number",["string","number","number","number","number"]),S.GDALRasterizeOptionsNew=Y.cwrap("GDALRasterizeOptionsNew","number",["number","number"]),S.GDALRasterizeOptionsFree=Y.cwrap("GDALRasterizeOptionsFree","number",["number"]),S.GDALWarp=Y.cwrap("GDALWarp","number",["string","number","number","number","number","number"]),S.GDALWarpAppOptionsNew=Y.cwrap("GDALWarpAppOptionsNew","number",["number","number"]),S.GDALWarpAppOptionsSetProgress=Y.cwrap("GDALWarpAppOptionsSetProgress","number",["number","number","number"]),S.GDALWarpAppOptionsFree=Y.cwrap("GDALWarpAppOptionsFree","number",["number"]),S.OSRNewSpatialReference=Y.cwrap("OSRNewSpatialReference","number",["string"]),S.OSRDestroySpatialReference=Y.cwrap("OSRDestroySpatialReference","number",["number"]),S.OCTNewCoordinateTransformation=Y.cwrap("OCTNewCoordinateTransformation","number",["number","number"]),S.OCTDestroyCoordinateTransformation=Y.cwrap("OCTDestroyCoordinateTransformation","number",["number"]),S.OCTTransform=Y.cwrap("OCTTransform","number",["number","number","number","number","number"]),S.GDALGetDriverCount=Y.cwrap("GDALGetDriverCount","number",[]),S.OGRGetDriverCount=Y.cwrap("OGRGetDriverCount","number",[]),S.GDALGetDriver=Y.cwrap("GDALGetDriver","number",["number"]),S.OGRGetDriver=Y.cwrap("OGRGetDriver","number",["number"]),S.GDALGetMetadataItem=Y.cwrap("GDALGetMetadataItem","string",["number","string","string"]),S.GDALGetDescription=Y.cwrap("GDALGetDescription","string",["number"]),S.OGR_L_GetFeatureCount=Y.cwrap("OGR_L_GetFeatureCount","number",["number","number"]),S.GDALGenImgProjTransform=Y.cwrap("GDALGenImgProjTransform","number",["number","number","number","number","number","number","number"]),S.GDALCreateGenImgProjTransformer2=Y.cwrap("GDALCreateGenImgProjTransformer2","number",["number","number","number"]),S.GDALDestroyGenImgProjTransformer=Y.cwrap("GDALDestroyGenImgProjTransformer",null,["number"]),S.OSRSetFromUserInput=Y.cwrap("OSRSetFromUserInput","number",["number","string"])),N.FS.mkdir(K),N.FS.mkdir(ie),F.dest&&(Y=F.dest,te=Y,W=F.dest,n&&S.Module.FS.mount(S.Module.NODEFS,{root:W},ie)),Hp()},N.locateFile=function(he){var Y=he,he=(F.paths&&F.paths.wasm&&he.split(".").pop()==="wasm"?Y=F.paths.wasm:F.paths&&F.paths.data&&he.split(".").pop()==="data"&&(Y=F.paths.data),""),he=(F.path?(he=F.path).slice(-1)!=="/"&&(he+="/"):n&&(he="node_modules/gdal3.js/dist/package/"),he+Y);return he=n||he.substring(0,4)==="http"||he[0]==="/"?he:"/".concat(he)},n&&(N.getPreloadedPackage=function(W){return i.readFileSync("./".concat(W),{flag:"r"}).buffer}),A(S.Module).then(function(){U(Up)})}):(x=F.paths&&F.paths.js||"gdal3.js",E="",F.path&&(E=F.path).slice(-1)!=="/"&&(E+="/"),new Promise(function(U){To.variables.gdalWorkerWrapper=new To.WorkerWrapper("".concat(E).concat(x),F,function($){To.variables.drivers=$,U(To.gdalProxy)})})))}return n&&(ah.location={pathname:"./"}),typeof window<"u"&&(window.initGdalJs=il),typeof importScripts=="function"&&Vp(il),il})})(lp);const XC=iv(lp.exports);class YC{constructor(e){this.layer=e}static fromPath(e){return new Promise((t,i)=>{fetch(e).then(n=>n.blob()).then(n=>{t(this.fromBlob(n,e))})})}static fromBlob(e,t){return new this(new AE({title:t,source:new RC({sources:[{blob:e}]})}))}}class KC{constructor(e){this.Gdal=e}async transformGcps(e,t){const i=[...Array(e.length/5)].map((s,o)=>[e[o*5+3],e[o*5+4]].map(a=>+a));return(await this.Gdal.gdaltransform(i,["-s_srs",t,"-t_srs","EPSG:3857","-output_xy"])).map((s,o)=>[e.slice(o*5,o*5+3),s.map(String)]).flat(2)}byTable(e,t){return new Promise(async(i,n)=>{const s=(await this.Gdal.open(e.img.file)).datasets[0],o=t.concat(["-of","GTiff","-a_srs",e.crs]),a=(await this.Gdal.gdal_translate(s,o)).local,l=(await this.Gdal.gdalwarp((await this.Gdal.open(a)).datasets[0],["-tps","-of","COG"])).local,u=await this.Gdal.getFileBytes(l),f=new Blob([u]),m=e.img.file.name.split(".").at(-2)+".tif",_=YC.fromBlob(f,m);_.link=document.createElement("a"),_.link.href=URL.createObjectURL(f),_.link.download=m,_.link.textContent="Download raster",_.link.style.position="absolute",_.link.style.left="55px",_.link.style.top="30px",i(_)})}static init(){const e={wasm:WC,data:VC,js:UC};return new Promise((t,i)=>{XC({paths:e}).then(n=>t(new this(n)))})}}const Qo={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class ea extends Ei{constructor(e,t){super(e),this.feature=t}}function $C(r,e){const t=[];for(let i=0;i<e.length;++i){const s=e[i].getGeometry();hp(r,s,t)}return t}function ta(r,e){return tn(r[0],r[1],e[0],e[1])}function zs(r,e){const t=r.length;return e<0?r[e+t]:e>=t?r[e-t]:r[e]}function ia(r,e,t){let i,n;e<t?(i=e,n=t):(i=t,n=e);const s=Math.ceil(i),o=Math.floor(n);if(s>o){const l=Bs(r,i),u=Bs(r,n);return ta(l,u)}let a=0;if(i<s){const l=Bs(r,i),u=zs(r,s);a+=ta(l,u)}if(o<n){const l=zs(r,o),u=Bs(r,n);a+=ta(l,u)}for(let l=s;l<o-1;++l){const u=zs(r,l),f=zs(r,l+1);a+=ta(u,f)}return a}function hp(r,e,t){if(e instanceof Vs){na(r,e.getCoordinates(),!1,t);return}if(e instanceof Zg){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n)na(r,i[n],!1,t);return}if(e instanceof Bi){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n)na(r,i[n],!0,t);return}if(e instanceof nm){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let a=0,l=o.length;a<l;++a)na(r,o[a],!0,t)}return}if(e instanceof bv){const i=e.getGeometries();for(let n=0;n<i.length;++n)hp(r,i[n],t);return}}const Bl={index:-1,endIndex:NaN};function ZC(r,e,t,i){const n=r[0],s=r[1];let o=1/0,a=-1,l=NaN;for(let m=0;m<e.targets.length;++m){const _=e.targets[m],C=_.coordinates;let R=1/0,L;for(let A=0;A<C.length-1;++A){const S=C[A],P=C[A+1],k=cp(n,s,S,P);k.squaredDistance<R&&(R=k.squaredDistance,L=A+k.along)}R<o&&(o=R,_.ring&&e.targetIndex===m&&(_.endIndex>_.startIndex?L<_.startIndex&&(L+=C.length):_.endIndex<_.startIndex&&L>_.startIndex&&(L-=C.length)),l=L,a=m)}const u=e.targets[a];let f=u.ring;if(e.targetIndex===a&&f){const m=Bs(u.coordinates,l),_=t.getPixelFromCoordinate(m);da(_,e.startPx)>i&&(f=!1)}if(f){const m=u.coordinates,_=m.length,C=u.startIndex,R=l;if(C<R){const L=ia(m,C,R);ia(m,C,R-_)<L&&(l-=_)}else{const L=ia(m,C,R);ia(m,C,R+_)<L&&(l+=_)}}return Bl.index=a,Bl.endIndex=l,Bl}function na(r,e,t,i){const n=r[0],s=r[1];for(let o=0,a=e.length-1;o<a;++o){const l=e[o],u=e[o+1],f=cp(n,s,l,u);if(f.squaredDistance===0){const m=o+f.along;i.push({coordinates:e,ring:t,startIndex:m,endIndex:m});return}}}const jl={along:0,squaredDistance:0};function cp(r,e,t,i){const n=t[0],s=t[1],o=i[0],a=i[1],l=o-n,u=a-s;let f=0,m=n,_=s;return(l!==0||u!==0)&&(f=wt(((r-n)*l+(e-s)*u)/(l*l+u*u),0,1),m+=l*f,_+=u*f),jl.along=f,jl.squaredDistance=Sh(tn(r,e,m,_),10),jl}function Bs(r,e){const t=r.length;let i=Math.floor(e);const n=e-i;i>=t?i-=t:i<0&&(i+=t);let s=i+1;s>=t&&(s-=t);const o=r[i],a=o[0],l=o[1],u=r[s],f=u[0]-a,m=u[1]-l;return[a+f*n,l+m*n]}class qC extends Rn{constructor(e){const t=e;t.stopDown||(t.stopDown=gs),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=QC(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:rs,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const n=this.mode_;if(n==="Circle")i=function(s,o,a){const l=o||new pv([NaN,NaN]),u=ft(s[0]),f=nn(u,ft(s[s.length-1]));return l.setCenterAndRadius(u,Math.sqrt(f),this.geometryLayout_),l};else{let s;n==="Point"?s=ns:n==="LineString"?s=Vs:n==="Polygon"&&(s=Bi),i=function(o,a,l){return a?n==="Polygon"?o[0].length?a.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(o,this.geometryLayout_):a=new s(o,this.geometryLayout_),a}}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Jh({source:new ec({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:JC(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:bc,this.freehandCondition_,e.freehand?this.freehandCondition_=Aa:this.freehandCondition_=e.freehandCondition?e.freehandCondition:ym,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(uh.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=Aa:t=e:t=P0,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===Te.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===qe.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===qe.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===qe.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===qe.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===qe.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===qe.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===qe.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new Ki(qe.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),n=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),s=Bt([i,n]),o=this.traceSource_.getFeaturesInExtent(s);if(o.length===0)return;const a=$C(e.coordinate,o);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,n=e.startIndex<=t;i===n?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const n=Math.ceil(e);let s=Math.floor(t);s===t&&(s-=1),i=s-n+1}else{const n=Math.floor(e);let s=Math.ceil(t);s===t&&(s+=1),i=n-s+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const n=[];if(t<i){const s=Math.ceil(t);let o=Math.floor(i);o===i&&(o-=1);for(let a=s;a<=o;++a)n.push(zs(e.coordinates,a))}else{const s=Math.floor(t);let o=Math.ceil(i);o===i&&(o+=1);for(let a=s;a>=o;--a)n.push(zs(e.coordinates,a))}n.length&&this.appendCoordinates(n)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&da(t.startPx,e.pixel)<this.snapTolerance_)return;const i=ZC(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=t.targets[i.index];this.addTracedCoordinates_(a,a.startIndex,i.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,i.endIndex)}t.targetIndex=i.index;const n=t.targets[t.targetIndex];n.endIndex=i.endIndex;const s=Bs(n.coordinates,n.endIndex),o=this.getMap().getPixelFromCoordinate(s);e.coordinate=s,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const n=!this.finishCoordinate_;n&&this.startDrawing_(e.coordinate),!n&&this.freehand_?this.finishDrawing():!this.freehand_&&(!n||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,n=t[0]-i[0],s=t[1]-i[1],o=n*n+s*s;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let n=!1,s=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")i=!0;else if(o==="Circle")i=this.sketchCoords_.length===2;else if(o==="LineString")n=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const a=this.sketchCoords_;n=a[0].length>this.minPoints_,s=[a[0][0],a[0][a[0].length-2]],t?s=[a[0][0]]:s=[a[0][0],a[0][a[0].length-2]]}if(n){const a=this.getMap();for(let l=0,u=s.length;l<u;l++){const f=s[l],m=a.getPixelFromCoordinate(f),_=e[0]-m[0],C=e[1]-m[1],R=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(_*_+C*C)<=R,i){this.finishCoordinate_=f;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Is(new ns(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Is);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new Vs(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=ga(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Is(new Vs(this.sketchLineCoords_)));const n=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Is,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new ea(Qo.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),n=t.getView().getProjection(),s=ga(this.geometryLayout_);let o,a;for(;e.length<s;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],a=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,a=o[o.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,n),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let n,s;const o=this.mode_;o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():n=!0),s.push(e.slice()),this.geometryFunction_(s,t,i)):o==="Polygon"&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():n=!0),s.push(e.slice()),n&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),n&&this.finishDrawing()}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),n=this.mode_;for(let s=0;s<e;++s){let o;if(n==="LineString"||n==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const a=this.finishCoordinate_.slice();o[o.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(o,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(n==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const a=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,i)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const i=e.getGeometry(),n=this.getMap().getView().getProjection();this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,n)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,n),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new qg([t])):this.type_==="MultiLineString"?e.setGeometry(new Zg([t])):this.type_==="MultiPolygon"&&e.setGeometry(new nm([t])),this.dispatchEvent(new ea(Qo.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new ea(Qo.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let n;if(t==="LineString"||t==="Circle")n=this.sketchCoords_;else if(t==="Polygon")n=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&n.shift(),n.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const s=e[e.length-1];this.addToDrawing_(s),this.modifyDrawing_(s)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const n=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=n.slice(),this.sketchCoords_.push(n.slice()),this.sketchPoint_=new Is(new ns(n)),this.updateSketchFeatures_(),this.dispatchEvent(new ea(Qo.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function JC(){const r=Og();return function(e,t){return r[e.getGeometry().getType()]}}function QC(r){switch(r){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+r)}}const ex=qC,$f=0,jr=1,Zf=[0,0,0,0],$s=[],Hl={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Ul extends Ei{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class tx extends Rn{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Em,this.defaultDeleteCondition_=function(i){return M0(i)&&O0(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Aa,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Ea,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Jh({source:new ec({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:nx(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new mi(this.source_.getFeatures()),this.source_.addEventListener($t.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener($t.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Ft.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Ft.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const n=this.SEGMENT_WRITERS_[t.getType()];n&&n(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),e.addEventListener(Te.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new mi;const i=this.featuresBeingModified_.getArray();for(let n=0,s=t.length;n<s;++n){const o=t[n];for(let a=0,l=o.length;a<l;++a){const u=o[a].feature;u&&!i.includes(u)&&this.featuresBeingModified_.push(u)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Ul(Hl.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Te.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(n){e===n.feature&&i.push(n)});for(let n=i.length-1;n>=0;--n){const s=i[n];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===s&&this.dragSegments_.splice(o,1);t.remove(s)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),n={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),n)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n],a={feature:e,geometry:t,depth:[n],index:n,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length-1;n<s;++n){const o=i.slice(n,n+2),a={feature:e,geometry:t,index:n,segment:o};this.rBush_.insert(Bt(o),a)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let a=0,l=o.length-1;a<l;++a){const u=o.slice(a,a+2),f={feature:e,geometry:t,depth:[n],index:a,segment:u};this.rBush_.insert(Bt(u),f)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let a=0,l=o.length-1;a<l;++a){const u=o.slice(a,a+2),f={feature:e,geometry:t,depth:[n],index:a,segment:u};this.rBush_.insert(Bt(u),f)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let a=0,l=o.length;a<l;++a){const u=o[a];for(let f=0,m=u.length-1;f<m;++f){const _=u.slice(f,f+2),C={feature:e,geometry:t,depth:[a,n],index:f,segment:_};this.rBush_.insert(Bt(_),C)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),n={feature:e,geometry:t,index:$f,segment:[i,i]},s={feature:e,geometry:t,index:jr,segment:[i,i]},o=[n,s];n.featureSegments=o,s.featureSegments=o,this.rBush_.insert(ra(i),n);let a=t;this.rBush_.insert(a.getExtent(),s)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let n=0;n<i.length;++n){const s=i[n],o=this.SEGMENT_WRITERS_[s.getType()];o(e,s)}}createOrUpdateVertexFeature_(e,t,i){let n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(e):(n=new Is(new ns(e)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set("features",t),n.set("geometries",i),n}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==qe.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=qe.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==qe.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],n=[];for(let s=0,o=this.dragSegments_.length;s<o;++s){const a=this.dragSegments_[s],l=a[0],u=l.feature;i.includes(u)||i.push(u);const f=l.geometry;n.includes(f)||n.push(f);const m=l.depth;let _;const C=l.segment,R=a[1];for(;t.length<f.getStride();)t.push(C[R][t.length]);switch(f.getType()){case"Point":_=t,C[0]=t,C[1]=t;break;case"MultiPoint":_=f.getCoordinates(),_[l.index]=t,C[0]=t,C[1]=t;break;case"LineString":_=f.getCoordinates(),_[l.index+R]=t,C[R]=t;break;case"MultiLineString":_=f.getCoordinates(),_[m[0]][l.index+R]=t,C[R]=t;break;case"Polygon":_=f.getCoordinates(),_[m[0]][l.index+R]=t,C[R]=t;break;case"MultiPolygon":_=f.getCoordinates(),_[m[1]][m[0]][l.index+R]=t,C[R]=t;break;case"Circle":if(C[0]=t,C[1]=t,l.index===$f)this.changingFeature_=!0,f.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let L=da(ft(f.getCenter()),ft(t));f.setRadius(L),this.changingFeature_=!1}break}_&&this.setGeometryCoordinates_(f,_)}this.createOrUpdateVertexFeature_(t,i,n)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){e.map.getView().getProjection();const n=[],s=i.getGeometry().getCoordinates(),o=Bt([s]),a=this.rBush_.getInExtent(o),l={};a.sort(ix);for(let u=0,f=a.length;u<f;++u){const m=a[u],_=m.segment;let C=Ie(m.geometry);const R=m.depth;if(R&&(C+="-"+R.join("-")),l[C]||(l[C]=new Array(2)),m.geometry.getType()==="Circle"&&m.index===jr){const L=Jf(t,m);Ri(L,s)&&!l[C][0]&&(this.dragSegments_.push([m,0]),l[C][0]=m);continue}if(Ri(_[0],s)&&!l[C][0]){this.dragSegments_.push([m,0]),l[C][0]=m;continue}if(Ri(_[1],s)&&!l[C][1]){if(l[C][0]&&l[C][0].index===0){let L=m.geometry.getCoordinates();switch(m.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":L=L[R[1]];case"Polygon":if(m.index!==L[R[0]].length-2)continue;break}}this.dragSegments_.push([m,1]),l[C][1]=m;continue}Ie(_)in this.vertexSegments_&&!l[C][0]&&!l[C][1]&&this.insertVertexCondition_(e)&&n.push(m)}n.length&&this.willModifyFeatures_(e,[n]);for(let u=n.length-1;u>=0;--u)this.insertVertex_(n[u],s)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],n=i.geometry;if(n.getType()==="Circle"){const s=n.getCenter(),o=i.featureSegments[0],a=i.featureSegments[1];o.segment[0]=s,o.segment[1]=s,a.segment[0]=s,a.segment[1]=s,this.rBush_.update(ra(s),o);let l=n;this.rBush_.update(l.getExtent(),a)}else this.rBush_.update(Bt(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new Ul(Hl.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,i){const n=i||t.getCoordinateFromPixel(e);t.getView().getProjection();const s=function(l,u){return qf(n,l)-qf(n,u)};let o,a;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?u=>u===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(u,f,m)=>{if(m=m||u.getGeometry(),m.getType()==="Point"&&this.features_.getArray().includes(u)){a=m;const _=m.getFlatCoordinates().slice(0,2);o=[{feature:u,geometry:m,segment:[_,_]}]}return!0},{layerFilter:l})}if(!o){const l=yi(ra(n,Zf)),u=t.getView().getResolution()*this.pixelTolerance_,f=za(no(l,u,Zf));o=this.rBush_.getInExtent(f)}if(o&&o.length>0){const l=o.sort(s)[0],u=l.segment;let f=Jf(n,l);const m=t.getPixelFromCoordinate(f);let _=da(e,m);if(a||_<=this.pixelTolerance_){const C={};if(C[Ie(u)]=!0,this.snapToPointer_||(this.delta_[0]=f[0]-n[0],this.delta_[1]=f[1]-n[1]),l.geometry.getType()==="Circle"&&l.index===jr)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(f,[l.feature],[l.geometry]);else{const R=t.getPixelFromCoordinate(u[0]),L=t.getPixelFromCoordinate(u[1]),A=nn(m,R),S=nn(m,L);_=Math.sqrt(Math.min(A,S)),this.snappedToVertex_=_<=this.pixelTolerance_,this.snappedToVertex_&&(f=A>S?u[1]:u[0]),this.createOrUpdateVertexFeature_(f,[l.feature],[l.geometry]);const P={};P[Ie(l.geometry)]=!0;for(let k=1,H=o.length;k<H;++k){const K=o[k].segment;if(Ri(u[0],K[0])&&Ri(u[1],K[1])||Ri(u[0],K[1])&&Ri(u[1],K[0])){const ie=Ie(o[k].geometry);ie in P||(P[ie]=!0,C[Ie(K)]=!0)}else break}}this.vertexSegments_=C;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,n=e.feature,s=e.geometry,o=e.depth,a=e.index;let l;for(;t.length<s.getStride();)t.push(0);switch(s.getType()){case"MultiLineString":l=s.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"Polygon":l=s.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"MultiPolygon":l=s.getCoordinates(),l[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":l=s.getCoordinates(),l.splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(s,l);const u=this.rBush_;u.remove(e),this.updateSegmentIndices_(s,a,o,1);const f={segment:[i[0],t],feature:n,geometry:s,depth:o,index:a};u.insert(Bt(f.segment),f),this.dragSegments_.push([f,1]);const m={segment:[t,i[1]],feature:n,geometry:s,depth:o,index:a+1};u.insert(Bt(m.segment),m),this.dragSegments_.push([m,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=qe.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Ul(Hl.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,n,s,o,a,l,u,f,m,_,C,R;for(l=e.length-1;l>=0;--l)o=e[l],C=o[0],R=Ie(C.feature),C.depth&&(R+="-"+C.depth.join("-")),R in t||(t[R]={}),o[1]===0?(t[R].right=C,t[R].index=C.index):o[1]==1&&(t[R].left=C,t[R].index=C.index+1);for(R in t){switch(_=t[R].right,f=t[R].left,u=t[R].index,m=u-1,f!==void 0?C=f:C=_,m<0&&(m=0),a=C.geometry,s=a.getCoordinates(),n=s,i=!1,a.getType()){case"MultiLineString":s[C.depth[0]].length>2&&(s[C.depth[0]].splice(u,1),i=!0);break;case"LineString":s.length>2&&(s.splice(u,1),i=!0);break;case"MultiPolygon":n=n[C.depth[1]];case"Polygon":n=n[C.depth[0]],n.length>4&&(u==n.length-1&&(u=0),n.splice(u,1),i=!0,u===0&&(n.pop(),n.push(n[0]),m=n.length-1));break}if(i){this.setGeometryCoordinates_(a,s);const L=[];if(f!==void 0&&(this.rBush_.remove(f),L.push(f.segment[0])),_!==void 0&&(this.rBush_.remove(_),L.push(_.segment[1])),f!==void 0&&_!==void 0){const A={depth:C.depth,feature:C.feature,geometry:C.geometry,index:m,segment:L};this.rBush_.insert(Bt(A.segment),A)}this.updateSegmentIndices_(a,u,C.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,n){this.rBush_.forEachInExtent(e.getExtent(),function(s){s.geometry===e&&(i===void 0||s.depth===void 0||xn(s.depth,i))&&s.index>t&&(s.index+=n)})}}function ix(r,e){return r.index-e.index}function qf(r,e,t){const i=e.geometry;if(i.getType()==="Circle"){let s=i;if(e.index===jr){const o=nn(s.getCenter(),ft(r)),a=Math.sqrt(o)-s.getRadius();return a*a}}const n=ft(r);return $s[0]=ft(e.segment[0]),$s[1]=ft(e.segment[1]),Hb(n,$s)}function Jf(r,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===jr)return ls(i.getClosestPoint(ft(r)));const n=ft(r);return $s[0]=ft(e.segment[0]),$s[1]=ft(e.segment[1]),ls(Lh(n,$s))}function nx(){const r=Og();return function(e,t){return r.Point}}const sx=tx;function Qf(r){if(r.feature)return r.feature;if(r.element)return r.element}const Vl=[];class rx extends Rn{constructor(e){e=e||{};const t=e;t.handleDownEvent||(t.handleDownEvent=rs),t.stopDown||(t.stopDown=gs),super(t),this.source_=e.source?e.source:null,this.vertex_=e.vertex!==void 0?e.vertex:!0,this.edge_=e.edge!==void 0?e.edge:!0,this.features_=e.features?e.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.rBush_=new Ea,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(e,t){t=t!==void 0?t:!0;const i=Ie(e),n=e.getGeometry();if(n){const s=this.GEOMETRY_SEGMENTERS_[n.getType()];if(s){this.indexedFeaturesExtents_[i]=n.getExtent(pi());const o=[];if(s(o,n),o.length===1)this.rBush_.insert(Bt(o[0]),{feature:e,segment:o[0]});else if(o.length>1){const a=o.map(u=>Bt(u)),l=o.map(u=>({feature:e,segment:u}));this.rBush_.load(a,l)}}}t&&(this.featureChangeListenerKeys_[i]=ze(e,Te.CHANGE,this.handleFeatureChange_,this))}forEachFeatureAdd_(e){this.addFeature(e)}forEachFeatureRemove_(e){this.removeFeature(e)}getFeatures_(){let e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e}handleEvent(e){const t=this.snapTo(e.pixel,e.coordinate,e.map);return t&&(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel),super.handleEvent(e)}handleFeatureAdd_(e){const t=Qf(e);this.addFeature(t)}handleFeatureRemove_(e){const t=Qf(e);this.removeFeature(t)}handleFeatureChange_(e){const t=e.target;if(this.handlingDownUpSequence){const i=Ie(t);i in this.pendingFeatures_||(this.pendingFeatures_[i]=t)}else this.updateFeature_(t)}handleUpEvent(e){const t=Object.values(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(e,t){const i=t!==void 0?t:!0,n=Ie(e),s=this.indexedFeaturesExtents_[n];if(s){const o=this.rBush_,a=[];o.forEachInExtent(s,function(l){e===l.feature&&a.push(l)});for(let l=a.length-1;l>=0;--l)o.remove(a[l])}i&&(lt(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])}setMap(e){const t=this.getMap(),i=this.featuresListenerKeys_,n=this.getFeatures_();t&&(i.forEach(lt),i.length=0,n.forEach(this.forEachFeatureRemove_.bind(this))),super.setMap(e),e&&(this.features_?i.push(ze(this.features_,Ft.ADD,this.handleFeatureAdd_,this),ze(this.features_,Ft.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push(ze(this.source_,$t.ADDFEATURE,this.handleFeatureAdd_,this),ze(this.source_,$t.REMOVEFEATURE,this.handleFeatureRemove_,this)),n.forEach(this.forEachFeatureAdd_.bind(this)))}snapTo(e,t,i){const n=i.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),s=i.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),o=Bt([n,s]),a=this.rBush_.getInExtent(o),l=a.length;if(l===0)return null;i.getView().getProjection();const u=ft(t);let f,m=1/0;const _=this.pixelTolerance_*this.pixelTolerance_,C=()=>{if(f){const R=i.getPixelFromCoordinate(f);if(nn(e,R)<=_)return{vertex:f,vertexPixel:[Math.round(R[0]),Math.round(R[1])]}}return null};if(this.vertex_){for(let L=0;L<l;++L){const A=a[L];A.feature.getGeometry().getType()!=="Circle"&&A.segment.forEach(S=>{const P=ft(S),k=nn(u,P);k<m&&(f=S,m=k)})}const R=C();if(R)return R}if(this.edge_){for(let L=0;L<l;++L){let A=null;const S=a[L];if(S.feature.getGeometry().getType()==="Circle"){let P=S.feature.getGeometry();A=ls(Bb(u,P))}else{const[P,k]=S.segment;k&&(Vl[0]=ft(P),Vl[1]=ft(k),A=Lh(u,Vl))}if(A){const P=nn(u,A);P<m&&(f=A,m=P)}}const R=C();if(R)return R}return null}updateFeature_(e){this.removeFeature(e,!1),this.addFeature(e,!1)}segmentCircleGeometry_(e,t){this.getMap().getView().getProjection();const s=fv(t).getCoordinates()[0];for(let o=0,a=s.length-1;o<a;++o)e.push(s.slice(o,o+2))}segmentGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let n=0;n<i.length;++n){const s=this.GEOMETRY_SEGMENTERS_[i[n].getType()];s&&s(e,i[n])}}segmentLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length-1;n<s;++n)e.push(i.slice(n,n+2))}segmentMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let a=0,l=o.length-1;a<l;++a)e.push(o.slice(a,a+2))}}segmentMultiPointGeometry_(e,t){t.getCoordinates().forEach(i=>{e.push([i])})}segmentMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let a=0,l=o.length;a<l;++a){const u=o[a];for(let f=0,m=u.length-1;f<m;++f)e.push(u.slice(f,f+2))}}}segmentPointGeometry_(e,t){e.push([t.getCoordinates()])}segmentPolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,s=i.length;n<s;++n){const o=i[n];for(let a=0,l=o.length-1;a<l;++a)e.push(o.slice(a,a+2))}}}const ox=rx;class ci{constructor(e){this.table=e}reloadData(e,t,i){return this.table.dataLoader.load(e,void 0,void 0,void 0,t,i)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,t){return typeof t<"u"&&(this.table.options[e]=t),this.table.options[e]}deprecationCheck(e,t){return this.table.deprecationAdvisor.check(e,t)}deprecationCheckMsg(e,t){return this.table.deprecationAdvisor.checkMsg(e,t)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class mt{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}}static deepClone(e,t,i=[]){var n={}.__proto__,s=[].__proto__;t||(t=Object.assign(Array.isArray(e)?[]:{},e));for(var o in e){let a=e[o],l,u;a!=null&&typeof a=="object"&&(a.__proto__===n||a.__proto__===s)&&(l=i.findIndex(f=>f.subject===a),l>-1?t[o]=i[l].copy:(u=Object.assign(Array.isArray(a)?[]:{},a),i.unshift({subject:a,copy:u}),t[o]=this.deepClone(a,u,i)))}return t}}class Pc extends ci{constructor(e,t,i){super(e),this.element=t,this.container=this._lookupContainer(),this.parent=i,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed,this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,t=this.table.element){return e===t?!0:t.parentNode?this._checkContainerIsParent(e,t.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var t=!(e instanceof MouseEvent),i=t?e.touches[0].pageX:e.pageX,n=t?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let s=mt.elOffset(this.container);i-=s.left,n-=s.top}return{x:i,y:n}}elementPositionCoords(e,t="right"){var i=mt.elOffset(e),n,s,o;switch(this.container!==document.body&&(n=mt.elOffset(this.container),i.left-=n.left,i.top-=n.top),t){case"right":s=i.left+e.offsetWidth,o=i.top-1;break;case"bottom":s=i.left,o=i.top+e.offsetHeight;break;case"left":s=i.left,o=i.top-1;break;case"top":s=i.left,o=i.top;break;case"center":s=i.left+e.offsetWidth/2,o=i.top+e.offsetHeight/2;break}return{x:s,y:o,offset:i}}show(e,t){var i,n,s,o,a;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(s=e,a=this.elementPositionCoords(e,t),o=a.offset,i=a.x,n=a.y):typeof e=="number"?(o={top:0,left:0},i=e,n=t):(a=this.containerEventCoords(e),i=a.x,n=a.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=i+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(i,n,s,o,t),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,t,i,n,s){var o=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;if((e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",i?this.element.style.right=this.container.offsetWidth-n.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0),t+this.element.offsetHeight>Math.max(this.container.offsetHeight,o?this.container.scrollHeight:0))if(i)switch(s){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-i.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+i.offsetHeight+1+"px"}else this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new Pc(this.table,e,this),this.childPopup}}class He extends ci{constructor(e,t){super(e),this._handler=null}initialize(){}registerTableOption(e,t){this.table.optionsList.register(e,t)}registerColumnOption(e,t){this.table.columnManager.optionsList.register(e,t)}registerTableFunction(e,t){typeof this.table[e]>"u"?this.table[e]=(...i)=>(this.table.initGuard(e),t(...i)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,t,i){return this.table.componentFunctionBinder.bind(e,t,i)}registerDataHandler(e,t){this.table.rowManager.registerDataPipelineHandler(e,t),this._handler=e}registerDisplayHandler(e,t){this.table.rowManager.registerDisplayPipelineHandler(e,t),this._handler=e}displayRows(e){var t=this.table.rowManager.displayRows.length-1,i;if(this._handler&&(i=this.table.rowManager.displayPipeline.findIndex(n=>n.handler===this._handler),i>-1&&(t=i)),e&&(t=t+e),this._handler)return t>-1?this.table.rowManager.getDisplayRows(t):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,t){t||(t=this._handler),t&&this.table.rowManager.refreshActiveData(t,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,t){return new Pc(this.table,e,t)}alert(e,t){return this.table.alertManager.alert(e,t)}clearAlert(){return this.table.alertManager.clear()}}var ax={};class nr extends He{constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var t=!1,i={};this.allowedTypes.forEach(n=>{var s="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[s]&&(o=this.lookupAccessor(e.definition[s]),o&&(t=!0,i[s]={accessor:o,params:e.definition[s+"Params"]||{}}))}),t&&(e.modules.accessor=i)}lookupAccessor(e){var t=!1;switch(typeof e){case"string":nr.accessors[e]?t=nr.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":t=e;break}return t}transformRow(e,t){var i="accessor"+(t.charAt(0).toUpperCase()+t.slice(1)),n=e.getComponent(),s=mt.deepClone(e.data||{});return this.table.columnManager.traverse(function(o){var a,l,u,f;o.modules.accessor&&(l=o.modules.accessor[i]||o.modules.accessor.accessor||!1,l&&(a=o.getFieldValue(s),a!="undefined"&&(f=o.getComponent(),u=typeof l.params=="function"?l.params(a,s,t,f,n):l.params,o.setFieldValue(s,l.accessor(a,s,t,u,f,n)))))}),s}}nr.moduleName="accessor";nr.accessors=ax;var lx={method:"GET"};function bh(r,e){var t=[];if(e=e||"",Array.isArray(r))r.forEach((n,s)=>{t=t.concat(bh(n,e?e+"["+s+"]":s))});else if(typeof r=="object")for(var i in r)t=t.concat(bh(r[i],e?e+"["+i+"]":i));else t.push({key:e,value:r});return t}function hx(r){var e=bh(r),t=[];return e.forEach(function(i){t.push(encodeURIComponent(i.key)+"="+encodeURIComponent(i.value))}),t.join("&")}function up(r,e,t){return r&&t&&Object.keys(t).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",r+=(r.includes("?")?"&":"?")+hx(t)),r}function cx(r,e,t){var i;return new Promise((n,s)=>{if(r=this.urlGenerator.call(this.table,r,e,t),e.method.toUpperCase()!="GET")if(i=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],i){for(var o in i.headers)e.headers||(e.headers={}),typeof e.headers[o]>"u"&&(e.headers[o]=i.headers[o]);e.body=i.body.call(this,r,e,t)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);r?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(r,e).then(a=>{a.ok?a.json().then(l=>{n(l)}).catch(l=>{s(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+a.status,a.statusText),s(a))}).catch(a=>{console.error("Ajax Load Error - Connection Error: ",a),s(a)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})}function _h(r,e){var t=[];if(e=e||"",Array.isArray(r))r.forEach((n,s)=>{t=t.concat(_h(n,e?e+"["+s+"]":s))});else if(typeof r=="object")for(var i in r)t=t.concat(_h(r[i],e?e+"["+i+"]":i));else t.push({key:e,value:r});return t}var ux={json:{headers:{"Content-Type":"application/json"},body:function(r,e,t){return JSON.stringify(t)}},form:{headers:{},body:function(r,e,t){var i=_h(t),n=new FormData;return i.forEach(function(s){n.append(s.key,s.value)}),n}}};class Si extends He{constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=Si.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||Si.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Si.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,t,i,n){var s=this.table.options.ajaxParams;return s&&(typeof s=="function"&&(s=s.call(this.table)),n=Object.assign(n,s)),n}requestDataCheck(e,t,i,n){return!!(!e&&this.url||typeof e=="string")}requestData(e,t,i,n,s){var o;return!s&&this.requestDataCheck(e)?(e&&this.setUrl(e),o=this.generateConfig(i),this.sendRequest(this.url,t,o)):s}setDefaultConfig(e={}){this.config=Object.assign({},Si.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var t=Object.assign({},this.config);return typeof e=="string"?t.method=e:Object.assign(t,e),t}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,t,i){return this.table.options.ajaxRequesting.call(this.table,e,t)!==!1?this.loaderPromise(e,i,t).then(n=>(this.table.options.ajaxResponse&&(n=this.table.options.ajaxResponse.call(this.table,e,t,n)),n)):Promise.reject()}}Si.moduleName="ajax";Si.defaultConfig=lx;Si.defaultURLGenerator=up;Si.defaultLoaderPromise=cx;Si.contentTypeFormatters=ux;var dx={replace:function(r){return this.table.setData(r)},update:function(r){return this.table.updateOrAddData(r)},insert:function(r){return this.table.addData(r)}},fx={table:function(r){var e=[],t=!0,i=this.table.columnManager.columns,n=[],s=[];return r=r.split(`
`),r.forEach(function(o){e.push(o.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(o){var a=i.find(function(l){return o&&l.definition.title&&o.trim()&&l.definition.title.trim()===o.trim()});a?n.push(a):t=!1}),t||(t=!0,n=[],e[0].forEach(function(o){var a=i.find(function(l){return o&&l.field&&o.trim()&&l.field.trim()===o.trim()});a?n.push(a):t=!1}),t||(n=this.table.columnManager.columnsByIndex)),t&&e.shift(),e.forEach(function(o){var a={};o.forEach(function(l,u){n[u]&&(a[n[u].field]=l)}),s.push(a)}),s):!1}};class cs extends He{constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var t,i,n;this.blocked||(e.preventDefault(),this.customSelection?(t=this.customSelection,this.table.options.clipboardCopyFormatter&&(t=this.table.options.clipboardCopyFormatter("plain",t))):(n=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),i=this.table.modules.export.generateHTMLTable(n),t=i?this.generatePlainContent(n):"",this.table.options.clipboardCopyFormatter&&(t=this.table.options.clipboardCopyFormatter("plain",t),i=this.table.options.clipboardCopyFormatter("html",i))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",t):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",t),i&&e.clipboardData.setData("text/html",i)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",t),i&&e.originalEvent.clipboardData.setData("text/html",i)),this.dispatchExternal("clipboardCopied",t,i),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var t=[];return e.forEach(i=>{var n=[];i.columns.forEach(s=>{var o="";if(s)if(i.type==="group"&&(s.value=s.component.getKey()),s.value===null)o="";else switch(typeof s.value){case"object":o=JSON.stringify(s.value);break;case"undefined":o="";break;default:o=s.value}n.push(o)}),t.push(n.join("	"))}),t.join(`
`)}copy(e,t){var i,n;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),i=window.getSelection(),i.toString()&&t&&(this.customSelection=i.toString()),i.removeAllRanges(),i.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(n=document.body.createTextRange(),n.moveToElementText(this.table.element),n.select()),document.execCommand("copy"),i&&i.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=cs.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=cs.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var t,i,n;this.checkPaseOrigin(e)&&(t=this.getPasteData(e),i=this.pasteParser.call(this,t),i?(e.preventDefault(),this.table.modExists("mutator")&&(i=this.mutateData(i)),n=this.pasteAction.call(this,i),this.dispatchExternal("clipboardPasted",t,i,n)):this.dispatchExternal("clipboardPasteError",t))}mutateData(e){var t=[];return Array.isArray(e)?e.forEach(i=>{t.push(this.table.modules.mutator.transformRow(i,"clipboard"))}):t=e,t}checkPaseOrigin(e){var t=!0;return(e.target.tagName!="DIV"||this.table.modules.edit.currentCell)&&(t=!1),t}getPasteData(e){var t;return window.clipboardData&&window.clipboardData.getData?t=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?t=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(t=e.originalEvent.clipboardData.getData("text/plain")),t}}cs.moduleName="clipboard";cs.pasteActions=dx;cs.pasteParsers=fx;class gx{constructor(e){return this._row=e,new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._row.table.componentFunctionBinder.handle("row",t._row,i)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(t){e.push(t.getComponent())}),e}getCell(e){var t=this._row.getCell(e);return t?t.getComponent():!1}_getSelf(){return this._row}}class dp{constructor(e){return this._cell=e,new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._cell.table.componentFunctionBinder.handle("cell",t._cell,i)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(){return this._cell.row.getData()}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,t){typeof t>"u"&&(t=!0),this._cell.setValue(e,t)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class go extends ci{constructor(e,t){super(e.table),this.table=e.table,this.column=e,this.row=t,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell")}_configureCell(){var e=this.element,t=this.column.getField(),i={top:"flex-start",bottom:"flex-end",middle:"center"},n={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=i[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=n[this.column.hozAlign]||"")),t&&e.setAttribute("tabulator-field",t),this.column.definition.cssClass){var s=this.column.definition.cssClass.split(" ");s.forEach(o=>{e.classList.add(o)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,t,i){var n=this.setValueProcessData(e,t,i);n&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,t,i){var n=!1;return(this.value!==e||i)&&(n=!0,t&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),n&&this.dispatch("cell-value-changed",this),n}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new dp(this)),this.component}}class fp{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._column.table.componentFunctionBinder.handle("column",t._column,i)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(t){e.push(t.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(t){e.push(t.getComponent())}),e}getParentColumn(){return this._column.parent instanceof Gi?this._column.parent.getComponent():!1}_getSelf(){return this._column}scrollTo(){return this._column.table.columnManager.scrollToColumn(this._column)}getTable(){return this._column.table}move(e,t){var i=this._column.table.columnManager.findColumn(e);i?this._column.table.columnManager.moveColumn(this._column,i,t):console.warn("Move Error - No matching column found:",i)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var t;return e===!0?t=this._column.reinitializeWidth(!0):t=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),t}}var gp={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class Gi extends ci{constructor(e,t){super(t.table),this.definition=e,this.parent=t,this.type="column",this.columns=[],this.cells=[],this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.isGroup=!1,this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((i,n)=>{var s=new Gi(i,this);this.attachColumn(s)}),this.checkColumnVisibility()):t.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let t in e)typeof this.definition[t]>"u"&&(this.definition[t]=e[t]);this.definition=this.table.columnManager.optionsList.generate(Gi.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{Gi.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var t=e.cssClass.split(" ");t.forEach(i=>{this.element.classList.add(i)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,t=document.createElement("div");if(t.classList.add("tabulator-col-title"),e.headerWordWrap&&t.classList.add("tabulator-col-title-wrap"),e.editableTitle){var i=document.createElement("input");i.classList.add("tabulator-title-editor"),i.addEventListener("click",n=>{n.stopPropagation(),i.focus()}),i.addEventListener("change",()=>{e.title=i.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),t.appendChild(i),e.field?this.langBind("columns|"+e.field,n=>{i.value=n||e.title||"&nbsp;"}):i.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,n=>{this._formatColumnHeaderTitle(t,n||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(t,e.title||"&nbsp;");return t}_formatColumnHeaderTitle(e,t){var i=this.chain("column-format",[this,t,e],null,()=>t);switch(typeof i){case"object":i instanceof Node?e.appendChild(i):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",i));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=i}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(t=>{this.element.classList.add(t)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var t=e,i=this.fieldStructure,n=i.length,s;for(let o=0;o<n&&(t=t[i[o]],s=t,!!t);o++);return s}_setFlatData(e,t){this.field&&(e[this.field]=t)}_setNestedData(e,t){var i=e,n=this.fieldStructure,s=n.length;for(let o=0;o<s;o++)if(o==s-1)i[n[o]]=t;else{if(!i[n[o]])if(typeof t<"u")i[n[o]]={};else break;i=i[n[o]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,t){var i=this.parent.isGroup?this.parent.getGroupElement().clientHeight:t||this.parent.getHeadersElement().clientHeight;this.element.style.height=i+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=i-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(n){n.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var t=[];return e?this.columns.forEach(i=>{t.push(i),t=t.concat(i.getColumns(!0))}):t=this.columns,t}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var t=[];return this.isGroup&&e&&(this.columns.forEach(function(i){t.push(i.getDefinition(!0))}),this.definition.columns=t),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(t){t.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,t){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(i){i.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,t),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,t){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(i){i.hide()}),this.dispatch("column-hide",this,t),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(t){t.visible&&(e+=t.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var t=this.columns.indexOf(e);t>-1&&this.columns.splice(t,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(t){t.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this)}checkCellHeights(){var e=[];this.cells.forEach(function(t){t.row.heightInitialized&&(t.row.getElement().offsetParent!==null?(e.push(t.row),t.row.clearCellHeight()):t.row.heightInitialized=!1)}),e.forEach(function(t){t.calcHeight()}),e.forEach(function(t){t.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(t){t.visible&&(e+=t.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(t){t.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(t){t.setMaxWidth()})}delete(){return new Promise((e,t)=>{this.isGroup&&this.columns.forEach(function(n){n.delete()}),this.dispatch("column-delete",this);var i=this.cells.length;for(let n=0;n<i;n++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var t=new go(this,e);return this.cells.push(t),t}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var t=this.table.columnManager.getColumnByIndex(e);return!t||t.visible?t:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var t=this.table.columnManager.getColumnByIndex(e);return!t||t.visible?t:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(n=>{n.clearWidth()}));var t=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(n=>{var s=n.getWidth();s>t&&(t=s)}),t)){var i=t+1;this.maxInitialWidth&&!e&&(i=Math.min(i,this.maxInitialWidth)),this.setWidthActual(i)}}}updateDefinition(e){var t;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(t=Object.assign({},this.getDefinition()),t=Object.assign(t,e),this.table.columnManager.addColumn(t,!1,this).then(i=>(t.field==this.field&&(this.field=!1),this.delete().then(()=>i.getComponent()))))}deleteCell(e){var t=this.cells.indexOf(e);t>-1&&this.cells.splice(t,1)}getComponent(){return this.component||(this.component=new fp(this)),this.component}}Gi.defaultOptionList=gp;class $a{constructor(e){return this._row=e,new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._row.table.componentFunctionBinder.handle("row",t._row,i)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(t){e.push(t.getComponent())}),e}getCell(e){var t=this._row.getCell(e);return t?t.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(){return this._row.table.rowManager.scrollToRow(this._row)}move(e,t){this._row.moveToRow(e,t)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class Zt extends ci{constructor(e,t,i="row"){super(t.table),this.parent=t,this.data={},this.type=i,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this)}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var t=0,i;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(i=this.table.options.resizableRows?this.element.clientHeight:0,this.cells.forEach(function(n){var s=n.getHeight();s>t&&(t=s)}),e?this.height=Math.max(t,i):this.height=this.manualHeight?this.height:Math.max(t,i)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,t){(this.height!=e||t)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var t=this.cells.indexOf(e);t>-1&&this.cells.splice(t,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var t=this.element&&mt.elVisible(this.element),i={},n;return new Promise((s,o)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(i=Object.assign(i,this.data),i=Object.assign(i,e)),n=this.chain("row-data-changing",[this,i,e],null,e);for(let a in n)this.data[a]=n[a];this.dispatch("row-data-save-after",this);for(let a in e)this.table.columnManager.getColumnsByFieldRoot(a).forEach(u=>{let f=this.getCell(u.getField());if(f){let m=u.getFieldValue(n);f.getValue()!==m&&(f.setValueProcessData(m),t&&f.cellRendered())}});t?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,t,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),s()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var t=!1;return e=this.table.columnManager.findColumn(e),this.initialized||this.generateCells(),t=this.cells.find(function(i){return i.column===e}),t}getCellIndex(e){return this.cells.findIndex(function(t){return t===e})}findCell(e){return this.cells.find(t=>t.element===e)}getCells(){return this.initialized||this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,t){var i=this.table.rowManager.findRow(e);i?(this.table.rowManager.moveRowActual(this,i,!t),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let t=0;t<e;t++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(t=>{t(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new $a(this)),this.component}}var mx={avg:function(r,e,t){var i=0,n=typeof t.precision<"u"?t.precision:2;return r.length&&(i=r.reduce(function(s,o){return Number(s)+Number(o)}),i=i/r.length,i=n!==!1?i.toFixed(n):i),parseFloat(i).toString()},max:function(r,e,t){var i=null,n=typeof t.precision<"u"?t.precision:!1;return r.forEach(function(s){s=Number(s),(s>i||i===null)&&(i=s)}),i!==null?n!==!1?i.toFixed(n):i:""},min:function(r,e,t){var i=null,n=typeof t.precision<"u"?t.precision:!1;return r.forEach(function(s){s=Number(s),(s<i||i===null)&&(i=s)}),i!==null?n!==!1?i.toFixed(n):i:""},sum:function(r,e,t){var i=0,n=typeof t.precision<"u"?t.precision:!1;return r.length&&r.forEach(function(s){s=Number(s),i+=isNaN(s)?0:Number(s)}),n!==!1?i.toFixed(n):i},concat:function(r,e,t){var i=0;return r.length&&(i=r.reduce(function(n,s){return String(n)+String(s)})),i},count:function(r,e,t){var i=0;return r.length&&r.forEach(function(n){n&&i++}),i}};class vn extends He{constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new Gi({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this))}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,t){return this.topRow&&t.unshift(this.topRow),this.botRow&&t.push(this.botRow),t}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var t=e.definition,i={topCalcParams:t.topCalcParams||{},botCalcParams:t.bottomCalcParams||{}};if(t.topCalc){switch(typeof t.topCalc){case"string":vn.calculations[t.topCalc]?i.topCalc=vn.calculations[t.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",t.topCalc);break;case"function":i.topCalc=t.topCalc;break}i.topCalc&&(e.modules.columnCalcs=i,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(t.bottomCalc){switch(typeof t.bottomCalc){case"string":vn.calculations[t.bottomCalc]?i.botCalc=vn.calculations[t.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",t.bottomCalc);break;case"function":i.botCalc=t.bottomCalc;break}i.botCalc&&(e.modules.columnCalcs=i,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){this.topInitialized||(this.table.columnManager.getContentsElement().insertBefore(this.topElement,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var t,i;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(t=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),i=this.generateRow("top",t),this.topRow=i;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(i.getElement()),i.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),i=this.generateRow("bottom",t),this.botRow=i;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(i.getElement()),i.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(t=>{this.recalcGroup(t)})}}recalcGroup(e){var t,i;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(t=this.rowsToData(e.rows),i=this.generateRowData("bottom",t),e.calcs.bottom.updateData(i),e.calcs.bottom.reinitialize()),e.calcs.top&&(t=this.rowsToData(e.rows),i=this.generateRowData("top",t),e.calcs.top.updateData(i),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var t=[];return e.forEach(i=>{if(t.push(i.getData()),this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs&&i.modules.dataTree&&i.modules.dataTree.open){var n=this.rowsToData(this.table.modules.dataTree.getFilteredTreeChildren(i));t=t.concat(n)}}),t}generateRow(e,t){var i=this.generateRowData(e,t),n;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),n=new Zt(i,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),n.component=!1,n.getComponent=()=>(n.component||(n.component=new gx(n)),n.component),n.generateCells=()=>{var s=[];this.table.columnManager.columnsByIndex.forEach(o=>{this.genColumn.setField(o.getField()),this.genColumn.hozAlign=o.hozAlign,o.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter(o.definition[e+"CalcFormatter"]),params:o.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=o.definition.cssClass;var a=new go(this.genColumn,n);a.getElement(),a.column=o,a.setWidth(),o.cells.push(a),s.push(a),o.visible||a.hide()}),n.cells=s},n}generateRowData(e,t){var i={},n=e=="top"?this.topCalcs:this.botCalcs,s=e=="top"?"topCalc":"botCalc",o,a;return n.forEach(function(l){var u=[];l.modules.columnCalcs&&l.modules.columnCalcs[s]&&(t.forEach(function(f){u.push(l.getFieldValue(f))}),a=s+"Params",o=typeof l.modules.columnCalcs[a]=="function"?l.modules.columnCalcs[a](u,t):l.modules.columnCalcs[a],l.setFieldValue(i,l.modules.columnCalcs[s](u,t,o)))}),i}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},t;return this.table.options.groupBy&&this.table.modExists("groupRows")?(t=this.table.modules.groupRows.getGroups(!0),t.forEach(i=>{e[i.getKey()]=this.getGroupResults(i)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var t=e._getSelf(),i=e.getSubGroups(),n={},s={};return i.forEach(o=>{n[o.getKey()]=this.getGroupResults(o)}),s={top:t.calcs.top?t.calcs.top.getData():{},bottom:t.calcs.bottom?t.calcs.bottom.getData():{},groups:n},s}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}}vn.moduleName="columnCalcs";vn.calculations=mx;class mp extends He{constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,t=this.table.options;switch(this.field=t.dataTreeChildField,this.indent=t.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),t.dataTreeBranchElement&&(t.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof t.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=t.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=t.dataTreeBranchElement),t.dataTreeCollapseElement?typeof t.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=t.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=t.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),t.dataTreeExpandElement?typeof t.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=t.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=t.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof t.dataTreeStartExpanded){case"boolean":this.startOpen=function(i,n){return t.dataTreeStartExpanded};break;case"function":this.startOpen=t.dataTreeStartExpanded;break;default:this.startOpen=function(i,n){return t.dataTreeStartExpanded[n]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var t;e&&(t=this.table.rowManager.getRows(),t.forEach(i=>{this.reinitializeRowChildren(i)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(t=>{e=e.concat(this.getTreeChildren(t,!1,!0))}),e}rowDataChanged(e,t,i){this.redrawNeeded(i)&&(this.initializeRow(e),t&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var t=e.column.getField();t===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var t=e.getData()[this.field],i=Array.isArray(t),n=i||!i&&typeof t=="object"&&t!==null;!n&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!n&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:n?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&n?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&n?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:n}}reinitializeRowChildren(e){var t=this.getTreeChildren(e,!1,!0);t.forEach(function(i){i.reinitialize(!0)})}layoutRow(e){var t=this.elementField?e.getCell(this.elementField):e.getCells()[0],i=t.getElement(),n=e.modules.dataTree;n.branchEl&&(n.branchEl.parentNode&&n.branchEl.parentNode.removeChild(n.branchEl),n.branchEl=!1),n.controlEl&&(n.controlEl.parentNode&&n.controlEl.parentNode.removeChild(n.controlEl),n.controlEl=!1),this.generateControlElement(e,i),e.getElement().classList.add("tabulator-tree-level-"+n.index),n.index&&(this.branchEl?(n.branchEl=this.branchEl.cloneNode(!0),i.insertBefore(n.branchEl,i.firstChild),this.table.rtl?n.branchEl.style.marginRight=(n.branchEl.offsetWidth+n.branchEl.style.marginLeft)*(n.index-1)+n.index*this.indent+"px":n.branchEl.style.marginLeft=(n.branchEl.offsetWidth+n.branchEl.style.marginRight)*(n.index-1)+n.index*this.indent+"px"):this.table.rtl?i.style.paddingRight=parseInt(window.getComputedStyle(i,null).getPropertyValue("padding-right"))+n.index*this.indent+"px":i.style.paddingLeft=parseInt(window.getComputedStyle(i,null).getPropertyValue("padding-left"))+n.index*this.indent+"px")}generateControlElement(e,t){var i=e.modules.dataTree,n=i.controlEl;t=t||e.getCells()[0].getElement(),i.children!==!1&&(i.open?(i.controlEl=this.collapseEl.cloneNode(!0),i.controlEl.addEventListener("click",s=>{s.stopPropagation(),this.collapseRow(e)})):(i.controlEl=this.expandEl.cloneNode(!0),i.controlEl.addEventListener("click",s=>{s.stopPropagation(),this.expandRow(e)})),i.controlEl.addEventListener("mousedown",s=>{s.stopPropagation()}),n&&n.parentNode===t?n.parentNode.replaceChild(i.controlEl,n):t.insertBefore(i.controlEl,t.firstChild))}getRows(e){var t=[];return e.forEach((i,n)=>{var s,o;t.push(i),i instanceof Zt&&(i.create(),s=i.modules.dataTree.children,!s.index&&s.children!==!1&&(o=this.getChildren(i),o.forEach(a=>{a.create(),t.push(a)})))}),t}getChildren(e,t){var i=e.modules.dataTree,n=[],s=[];return i.children!==!1&&(i.open||t)&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(i.children):n=i.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(n),n.forEach(o=>{s.push(o);var a=this.getChildren(o);a.forEach(l=>{s.push(l)})})),s}generateChildren(e){var t=[],i=e.getData()[this.field];return Array.isArray(i)||(i=[i]),i.forEach(n=>{var s=new Zt(n||{},this.table.rowManager);s.create(),s.modules.dataTree.index=e.modules.dataTree.index+1,s.modules.dataTree.parent=e,s.modules.dataTree.children&&(s.modules.dataTree.open=this.startOpen(s.getComponent(),s.modules.dataTree.index)),t.push(s)}),t}expandRow(e,t){var i=e.modules.dataTree;i.children!==!1&&(i.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var t=e.modules.dataTree;t.children!==!1&&(t.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var t=e.modules.dataTree;t.children!==!1&&(t.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var t=e.modules.dataTree,i=[],n;return t.children&&(Array.isArray(t.children)||(t.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(t.children):n=t.children,n.forEach(s=>{s instanceof Zt&&i.push(s)})),i}rowDelete(e){var t=e.modules.dataTree.parent,i;t&&(i=this.findChildIndex(e,t),i!==!1&&t.data[this.field].splice(i,1),t.data[this.field].length||delete t.data[this.field],this.initializeRow(t),this.layoutRow(t)),this.refreshData(!0)}addTreeChildRow(e,t,i,n){var s=!1;typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof n<"u"&&(s=this.findChildIndex(n,e),s!==!1&&e.data[this.field].splice(i?s:s+1,0,t)),s===!1&&(i?e.data[this.field].unshift(t):e.data[this.field].push(t)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,t){var i=!1;return typeof e=="object"?e instanceof Zt?i=e.data:e instanceof $a?i=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?t.modules.dataTree&&(i=t.modules.dataTree.children.find(n=>n instanceof Zt?n.element===e:!1),i&&(i=i.data)):e===null&&(i=!1):typeof e>"u"?i=!1:i=t.data[this.field].find(n=>n.data[this.table.options.index]==e),i&&(Array.isArray(t.data[this.field])&&(i=t.data[this.field].indexOf(i)),i==-1&&(i=!1)),i}getTreeChildren(e,t,i){var n=e.modules.dataTree,s=[];return n.children&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),n.children.forEach(o=>{o instanceof Zt&&(s.push(t?o.getComponent():o),i&&(s=s.concat(this.getTreeChildren(o,t,i))))})),s}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}mp.moduleName="dataTree";function px(r,e={},t){var i=e.delimiter?e.delimiter:",",n=[],s=[];r.forEach(o=>{var a=[];switch(o.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":o.columns.forEach((l,u)=>{l&&l.depth===1&&(s[u]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":o.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}a.push('"'+String(l.value).split('"').join('""')+'"')}}),n.push(a.join(i));break}}),s.length&&n.unshift(s.join(i)),n=n.join(`
`),e.bom&&(n="\uFEFF"+n),t(n,"text/csv")}function bx(r,e,t){var i=[];r.forEach(n=>{var s={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(s[o.component.getTitleDownload()||o.component.getField()]=o.value)}),i.push(s);break}}),i=JSON.stringify(i,null,"	"),t(i,"application/json")}function _x(r,e={},t){var i=[],n=[],s={},o=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},a=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},u=e.title?e.title:"";l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),r.forEach(_=>{switch(_.type){case"header":i.push(f(_));break;case"group":n.push(f(_,o));break;case"calc":n.push(f(_,a));break;case"row":n.push(f(_));break}});function f(_,C){var R=[];return _.columns.forEach(L=>{var A;if(L){switch(typeof L.value){case"object":L.value=L.value!==null?JSON.stringify(L.value):"";break;case"undefined":L.value="";break}A={content:L.value,colSpan:L.width,rowSpan:L.height},C&&(A.styles=C),R.push(A)}}),R}var m=new jspdf.jsPDF(l);e.autoTable&&(typeof e.autoTable=="function"?s=e.autoTable(m)||{}:s=e.autoTable),u&&(s.didDrawPage=function(_){m.text(u,40,30)}),s.head=i,s.body=n,m.autoTable(s),e.documentProcessing&&e.documentProcessing(m),t(m.output("arraybuffer"),"application/pdf")}function yx(r,e,t){var i=this,n=e.sheetName||"Sheet1",s=XLSX.utils.book_new(),o=new ci(this),a="compress"in e?e.compress:!0,l;s.SheetNames=[],s.Sheets={};function u(){var _=[],C=[],R={},L={s:{c:0,r:0},e:{c:r[0]?r[0].columns.reduce((A,S)=>A+(S&&S.width?S.width:1),0):0,r:r.length}};return r.forEach((A,S)=>{var P=[];A.columns.forEach(function(k,H){k?(P.push(!(k.value instanceof Date)&&typeof k.value=="object"?JSON.stringify(k.value):k.value),(k.width>1||k.height>-1)&&(k.height>1||k.width>1)&&C.push({s:{r:S,c:H},e:{r:S+k.height-1,c:H+k.width-1}})):P.push("")}),_.push(P)}),XLSX.utils.sheet_add_aoa(R,_),R["!ref"]=XLSX.utils.encode_range(L),C.length&&(R["!merges"]=C),R}if(e.sheetOnly){t(u());return}if(e.sheets)for(var f in e.sheets)e.sheets[f]===!0?(s.SheetNames.push(f),s.Sheets[f]=u()):(s.SheetNames.push(f),o.commsSend(e.sheets[f],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:i.active,intercept:function(_){s.Sheets[f]=_}}));else s.SheetNames.push(n),s.Sheets[n]=u();e.documentProcessing&&(s=e.documentProcessing(s));function m(_){for(var C=new ArrayBuffer(_.length),R=new Uint8Array(C),L=0;L!=_.length;++L)R[L]=_.charCodeAt(L)&255;return C}l=XLSX.write(s,{bookType:"xlsx",bookSST:!0,type:"binary",compression:a}),t(m(l),"application/octet-stream")}function vx(r,e,t){this.modExists("export",!0)&&t(this.modules.export.generateHTMLTable(r),"text/html")}function Ex(r,e,t){const i=[];r.forEach(n=>{const s={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(s[o.component.getTitleDownload()||o.component.getField()]=o.value)}),i.push(JSON.stringify(s));break}}),t(i.join(`
`),"application/x-ndjson")}var wx={csv:px,json:bx,jsonLines:Ex,pdf:_x,xlsx:yx,html:vx};class sr extends He{constructor(e){super(e),this.registerTableOption("downloadEncoder",function(t,i){return new Blob([t],{type:i})}),this.registerTableOption("downloadReady",void 0),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){this.deprecationCheck("downloadReady","downloadEncoder")}downloadToTab(e,t,i,n){this.download(e,t,i,n,!0)}download(e,t,i,n,s){var o=!1;function a(u,f){s?s===!0?this.triggerDownload(u,f,e,t,!0):s(u):this.triggerDownload(u,f,e,t)}if(typeof e=="function"?o=e:sr.downloaders[e]?o=sr.downloaders[e]:console.warn("Download Error - No such download type found: ",e),o){var l=this.generateExportList(n);o.call(this.table,l,i||{},a.bind(this))}}generateExportList(e){var t=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),i=this.table.options.groupHeaderDownload;return i&&!Array.isArray(i)&&(i=[i]),t.forEach(n=>{var s;n.type==="group"&&(s=n.columns[0],i&&i[n.indent]&&(s.value=i[n.indent](s.value,n.component._group.getRowCount(),n.component._group.getData(),n.component)))}),t}triggerDownload(e,t,i,n,s){var o=document.createElement("a"),a=this.table.options.downloadEncoder(e,t);a&&(s?window.open(window.URL.createObjectURL(a)):(n=n||"Tabulator."+(typeof i=="function"?"txt":i),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(a,n):(o.setAttribute("href",window.URL.createObjectURL(a)),o.setAttribute("download",n),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o))),this.dispatchExternal("downloadComplete"))}commsReceived(e,t,i){switch(t){case"intercept":this.download(i.type,"",i.options,i.active,i.intercept);break}}}sr.moduleName="download";sr.downloaders=wx;function Za(r,e){var t=e.mask,i=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",n=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",s=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function o(a){var l=t[a];typeof l<"u"&&l!==s&&l!==i&&l!==n&&(r.value=r.value+""+l,o(a+1))}r.addEventListener("keydown",a=>{var l=r.value.length,u=a.key;if(a.keyCode>46){if(l>=t.length)return a.preventDefault(),a.stopPropagation(),!1;switch(t[l]){case i:if(u.toUpperCase()==u.toLowerCase())return a.preventDefault(),a.stopPropagation(),!1;break;case n:if(isNaN(u))return a.preventDefault(),a.stopPropagation(),!1;break;case s:break;default:if(u!==t[l])return a.preventDefault(),a.stopPropagation(),!1}}}),r.addEventListener("keyup",a=>{a.keyCode>46&&e.maskAutoFill&&o(r.value.length)}),r.placeholder||(r.placeholder=t),e.maskAutoFill&&o(r.value.length)}function Cx(r,e,t,i,n){var s=r.getValue(),o=document.createElement("input");if(o.setAttribute("type",n.search?"search":"text"),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+n.elementAttributes["+"+l])):o.setAttribute(l,n.elementAttributes[l]);o.value=typeof s<"u"?s:"",e(function(){o.focus({preventScroll:!0}),o.style.height="100%",n.selectContents&&o.select()});function a(l){(s===null||typeof s>"u")&&o.value!==""||o.value!==s?t(o.value)&&(s=o.value):i()}return o.addEventListener("change",a),o.addEventListener("blur",a),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:a();break;case 27:i();break;case 35:case 36:l.stopPropagation();break}}),n.mask&&Za(o,n),o}function xx(r,e,t,i,n){var s=r.getValue(),o=n.verticalNavigation||"hybrid",a=String(s!==null&&typeof s<"u"?s:""),l=document.createElement("textarea"),u=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),l.setAttribute(m,l.getAttribute(m)+n.elementAttributes["+"+m])):l.setAttribute(m,n.elementAttributes[m]);l.value=a,e(function(){l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",r.getRow().normalizeHeight(),n.selectContents&&l.select()});function f(m){(s===null||typeof s>"u")&&l.value!==""||l.value!==s?(t(l.value)&&(s=l.value),setTimeout(function(){r.getRow().normalizeHeight()},300)):i()}return l.addEventListener("change",f),l.addEventListener("blur",f),l.addEventListener("keyup",function(){l.style.height="";var m=l.scrollHeight;l.style.height=m+"px",m!=u&&(u=m,r.getRow().normalizeHeight())}),l.addEventListener("keydown",function(m){switch(m.keyCode){case 13:m.shiftKey&&n.shiftEnterSubmit&&f();break;case 27:i();break;case 38:(o=="editor"||o=="hybrid"&&l.selectionStart)&&(m.stopImmediatePropagation(),m.stopPropagation());break;case 40:(o=="editor"||o=="hybrid"&&l.selectionStart!==l.value.length)&&(m.stopImmediatePropagation(),m.stopPropagation());break;case 35:case 36:m.stopPropagation();break}}),n.mask&&Za(l,n),l}function Tx(r,e,t,i,n){var s=r.getValue(),o=n.verticalNavigation||"editor",a=document.createElement("input");if(a.setAttribute("type","number"),typeof n.max<"u"&&a.setAttribute("max",n.max),typeof n.min<"u"&&a.setAttribute("min",n.min),typeof n.step<"u"&&a.setAttribute("step",n.step),a.style.padding="4px",a.style.width="100%",a.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let f in n.elementAttributes)f.charAt(0)=="+"?(f=f.slice(1),a.setAttribute(f,a.getAttribute(f)+n.elementAttributes["+"+f])):a.setAttribute(f,n.elementAttributes[f]);a.value=s;var l=function(f){u()};e(function(){a.removeEventListener("blur",l),a.focus({preventScroll:!0}),a.style.height="100%",a.addEventListener("blur",l),n.selectContents&&a.select()});function u(){var f=a.value;!isNaN(f)&&f!==""&&(f=Number(f)),f!==s?t(f)&&(s=f):i()}return a.addEventListener("keydown",function(f){switch(f.keyCode){case 13:u();break;case 27:i();break;case 38:case 40:o=="editor"&&(f.stopImmediatePropagation(),f.stopPropagation());break;case 35:case 36:f.stopPropagation();break}}),n.mask&&Za(a,n),a}function Rx(r,e,t,i,n){var s=r.getValue(),o=document.createElement("input");if(o.setAttribute("type","range"),typeof n.max<"u"&&o.setAttribute("max",n.max),typeof n.min<"u"&&o.setAttribute("min",n.min),typeof n.step<"u"&&o.setAttribute("step",n.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+n.elementAttributes["+"+l])):o.setAttribute(l,n.elementAttributes[l]);o.value=s,e(function(){o.focus({preventScroll:!0}),o.style.height="100%"});function a(){var l=o.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=s?t(l)&&(s=l):i()}return o.addEventListener("blur",function(l){a()}),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:a();break;case 27:i();break}}),o}function Sx(r,e,t,i,n){var s=n.format,o=s?window.DateTime||luxon.DateTime:null,a=r.getValue(),l=document.createElement("input");function u(m){var _;return o.isDateTime(m)?_=m:s==="iso"?_=o.fromISO(String(m)):_=o.fromFormat(String(m),s),_.toFormat("yyyy-MM-dd")}if(l.type="date",l.style.padding="4px",l.style.width="100%",l.style.boxSizing="border-box",n.max&&l.setAttribute("max",s?u(n.max):n.max),n.min&&l.setAttribute("min",s?u(n.min):n.min),n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),l.setAttribute(m,l.getAttribute(m)+n.elementAttributes["+"+m])):l.setAttribute(m,n.elementAttributes[m]);a=typeof a<"u"?a:"",s&&(o?a=u(a):console.error("Editor Error - 'date' editor 'inputFormat' param is dependant on luxon.js")),l.value=a,e(function(){l.focus({preventScroll:!0}),l.style.height="100%",n.selectContents&&l.select()});function f(m){var _=l.value;(a===null||typeof a>"u")&&_!==""||_!==a?(_&&s&&(_=o.fromFormat(String(_),"yyyy-MM-dd").toFormat(s)),t(_)&&(a=l.value)):i()}return l.addEventListener("change",f),l.addEventListener("blur",f),l.addEventListener("keydown",function(m){switch(m.keyCode){case 13:f();break;case 27:i();break;case 35:case 36:m.stopPropagation();break}}),l}function Lx(r,e,t,i,n){var s=n.format,o=s?window.DateTime||luxon.DateTime:null,a,l=r.getValue(),u=document.createElement("input");if(u.type="time",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),u.setAttribute(m,u.getAttribute(m)+n.elementAttributes["+"+m])):u.setAttribute(m,n.elementAttributes[m]);l=typeof l<"u"?l:"",s&&(o?(o.isDateTime(l)?a=l:s==="iso"?a=o.fromISO(String(l)):a=o.fromFormat(String(l),s),l=a.toFormat("hh:mm")):console.error("Editor Error - 'date' editor 'inputFormat' param is dependant on luxon.js")),u.value=l,e(function(){u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select()});function f(m){var _=u.value;(l===null||typeof l>"u")&&_!==""||_!==l?(_&&s&&(_=o.fromFormat(String(_),"hh:mm").toFormat(s)),t(_)&&(l=u.value)):i()}return u.addEventListener("change",f),u.addEventListener("blur",f),u.addEventListener("keydown",function(m){switch(m.keyCode){case 13:f();break;case 27:i();break;case 35:case 36:m.stopPropagation();break}}),u}function Dx(r,e,t,i,n){var s=n.format,o=s?window.DateTime||luxon.DateTime:null,a,l=r.getValue(),u=document.createElement("input");if(u.type="datetime-local",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),u.setAttribute(m,u.getAttribute(m)+n.elementAttributes["+"+m])):u.setAttribute(m,n.elementAttributes[m]);l=typeof l<"u"?l:"",s&&(o?(o.isDateTime(l)?a=l:s==="iso"?a=o.fromISO(String(l)):a=o.fromFormat(String(l),s),l=a.toFormat("yyyy-MM-dd")+"T"+a.toFormat("hh:mm")):console.error("Editor Error - 'date' editor 'inputFormat' param is dependant on luxon.js")),u.value=l,e(function(){u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select()});function f(m){var _=u.value;(l===null||typeof l>"u")&&_!==""||_!==l?(_&&s&&(_=o.fromISO(String(_)).toFormat(s)),t(_)&&(l=u.value)):i()}return u.addEventListener("change",f),u.addEventListener("blur",f),u.addEventListener("keydown",function(m){switch(m.keyCode){case 13:f();break;case 27:i();break;case 35:case 36:m.stopPropagation();break}}),u}class Oc{constructor(e,t,i,n,s,o){this.edit=e,this.table=e.table,this.cell=t,this.params=this._initializeParams(o),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=!t._getSelf,this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:n,cancel:s},this._deprecatedOptionsCheck(),this._initializeValue(),i(this._onRendered.bind(this))}_deprecatedOptionsCheck(){this.params.listItemFormatter&&this.cell.getTable().deprecationAdvisor.msg("The listItemFormatter editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.sortValuesList&&this.cell.getTable().deprecationAdvisor.msg("The sortValuesList editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchFunc&&this.cell.getTable().deprecationAdvisor.msg("The searchFunc editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchingPlaceholder&&this.cell.getTable().deprecationAdvisor.msg("The searchingPlaceholder editor param has been deprecated, please see the latest editor documentation for updated options")}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function t(i){i.stopPropagation()}this.input.style.height="100%",this.input.focus({preventScroll:!0}),e.addEventListener("click",t),setTimeout(()=>{e.removeEventListener("click",t)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,t=document.createElement("input");if(t.setAttribute("type",this.params.clearable?"search":"text"),t.style.padding="4px",t.style.width="100%",t.style.boxSizing="border-box",this.params.autocomplete||(t.style.cursor="default",t.style.caretColor="transparent"),e&&typeof e=="object")for(let i in e)i.charAt(0)=="+"?(i=i.slice(1),t.setAttribute(i,t.getAttribute(i)+e["+"+i])):t.setAttribute(i,e[i]);return this.params.mask&&Za(t,this.params),this._bindInputEvents(t),t}_initializeParams(e){var t=["values","valuesURL","valuesLookup"],i;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",i=Object.keys(e).filter(n=>t.includes(n)).length,i?i>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyUp(e){var t=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&t)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),t>0&&this._focusItem(this.displayItems[t-1]))}_keyDown(e){var t=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&t<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),t<this.displayItems.length-1&&(t==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[t+1])))}_keySide(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var t=String.fromCharCode(e).toLowerCase();this.filterTerm+=t.toLowerCase();var i=this.displayItems.find(n=>typeof n.label<"u"&&n.label.toLowerCase().startsWith(this.filterTerm));i&&this._focusItem(i),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var t=[],i=++this.listIteration;return this.filtered=!1,this.params.values?t=this.params.values:this.params.valuesURL?t=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?t=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(t=this._uniqueColumnValues(this.params.valuesLookupField)),t instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),t.then().then(n=>this.listIteration===i?this._parseList(n):Promise.reject(i))):Promise.resolve(this._parseList(t))}_addPlaceholder(e){var t=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?t=e:(t.classList.add("tabulator-edit-list-placeholder"),t.innerHTML=e),this.listEl.appendChild(t),this._showList())}_ajaxRequest(e,t){var i=this.params.filterRemote?{term:t}:{};return e=up(e,{},i),fetch(e).then(n=>n.ok?n.json().catch(s=>(console.warn("List Ajax Load Error - Invalid JSON returned",s),Promise.reject(s))):(console.error("List Ajax Load Error - Connection Error: "+n.status,n.statusText),Promise.reject(n))).catch(n=>(console.error("List Ajax Load Error - Connection Error: ",n),Promise.reject(n)))}_uniqueColumnValues(e){var t={},i=this.table.getData(this.params.valuesLookup),n;return e?n=this.table.columnManager.getColumnByField(e):n=this.cell.getColumn()._getSelf(),n?i.forEach(s=>{var o=n.getFieldValue(s);o!==null&&typeof o<"u"&&o!==""&&(t[o]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),t=[]),Object.keys(t)}_parseList(e){var t=[];return Array.isArray(e)||(e=Object.entries(e).map(([i,n])=>({label:n,value:i}))),e.forEach(i=>{typeof i!="object"&&(i={label:i,value:i}),this._parseListItem(i,t,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=t,t}_parseListItem(e,t,i){var n={};e.options?n=this._parseListGroup(e,i+1):(n={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:i,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(n,!0)),t.push(n)}_parseListGroup(e,t){var i={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:t,options:[],original:e};return e.options.forEach(n=>{this._parseListItem(n,i.options,t)}),i}_sortOptions(e){var t;return this.params.sort&&(t=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(t,e)),e}_sortGroup(e,t){t.sort((i,n)=>e(i.label,n.label,i.value,n.value,i.original,n.original)),t.forEach(i=>{i.group&&this._sortGroup(e,i.options)})}_defaultSortFunction(e,t){var i,n,s,o,a=0,l,u=/(\d+)|(\D+)/g,f=/\d/,m=0;if(this.params.sort==="desc"&&([e,t]=[t,e]),!e&&e!==0)m=!t&&t!==0?0:-1;else if(!t&&t!==0)m=1;else{if(isFinite(e)&&isFinite(t))return e-t;if(i=String(e).toLowerCase(),n=String(t).toLowerCase(),i===n)return 0;if(!(f.test(i)&&f.test(n)))return i>n?1:-1;for(i=i.match(u),n=n.match(u),l=i.length>n.length?n.length:i.length;a<l;)if(s=i[a],o=n[a++],s!==o)return isFinite(s)&&isFinite(o)?(s.charAt(0)==="0"&&(s="."+s),o.charAt(0)==="0"&&(o="."+o),s-o):s>o?1:-1;return i.length>n.length}return m}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,t=this.input.value;return t?(this.filtered=!0,this.data.forEach(i=>{this._filterItem(e,t,i)})):this.filtered=!1,this.data}_filterItem(e,t,i){var n=!1;return i.group?(i.options.forEach(s=>{this._filterItem(e,t,s)&&(n=!0)}),i.visible=n):i.visible=e(t,i.label,i.value,i.original),i.visible}_defaultFilterFunc(e,t,i,n){return e=String(e).toLowerCase(),t!==null&&typeof t<"u"&&(String(t).toLowerCase().indexOf(e)>-1||String(i).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(t=>{this._buildItem(t)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var t=e.element,i;if(!this.filtered||e.visible){if(!t){if(t=document.createElement("div"),t.tabIndex=0,i=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,t):e.label,i instanceof HTMLElement?t.appendChild(i):t.innerHTML=i,e.group?t.classList.add("tabulator-edit-list-group"):t.classList.add("tabulator-edit-list-item"),t.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let n in e.elementAttributes)n.charAt(0)=="+"?(n=n.slice(1),t.setAttribute(n,this.input.getAttribute(n)+e.elementAttributes["+"+n])):t.setAttribute(n,e.elementAttributes[n]);e.group?t.addEventListener("click",this._groupClick.bind(this,e)):t.addEventListener("click",this._itemClick.bind(this,e)),t.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=t}this._styleItem(e),this.listEl.appendChild(t),e.group?e.options.forEach(n=>{this._buildItem(n)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,t){t.stopPropagation(),this._chooseItem(e)}_groupClick(e,t){t.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,t){var i;this.typing=!1,this.params.multiselect?(i=this.currentItems.indexOf(e),i>-1?(this.currentItems.splice(i,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(n=>n.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),t||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var t,i;if(this.popup&&this.popup.hide(!0),this.params.multiselect)t=this.currentItems.map(n=>n.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")t=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?t=this.currentItems[0].value:(i=this.initialValues[0],i===null||typeof i>"u"||i===""?t=i:t=this.params.emptyValue);t===""&&(t=this.params.emptyValue),this.actions.success(t),this.isFilter&&(this.initialValues=t&&!Array.isArray(t)?[t]:t,this.currentItems=[])}}function Ax(r,e,t,i,n){this.deprecationMsg("The select editor has been deprecated, please use the new list editor");var s=new Oc(this,r,e,t,i,n);return s.input}function Mx(r,e,t,i,n){var s=new Oc(this,r,e,t,i,n);return s.input}function Ix(r,e,t,i,n){this.deprecationMsg("The autocomplete editor has been deprecated, please use the new list editor with the 'autocomplete' editorParam"),n.autocomplete=!0;var s=new Oc(this,r,e,t,i,n);return s.input}function Fx(r,e,t,i,n){var s=this,o=r.getElement(),a=r.getValue(),l=o.getElementsByTagName("svg").length||5,u=o.getElementsByTagName("svg")[0]?o.getElementsByTagName("svg")[0].getAttribute("width"):14,f=[],m=document.createElement("div"),_=document.createElementNS("http://www.w3.org/2000/svg","svg");function C(S){f.forEach(function(P,k){k<S?(s.table.browser=="ie"?P.setAttribute("class","tabulator-star-active"):P.classList.replace("tabulator-star-inactive","tabulator-star-active"),P.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(s.table.browser=="ie"?P.setAttribute("class","tabulator-star-inactive"):P.classList.replace("tabulator-star-active","tabulator-star-inactive"),P.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function R(S){var P=document.createElement("span"),k=_.cloneNode(!0);f.push(k),P.addEventListener("mouseenter",function(H){H.stopPropagation(),H.stopImmediatePropagation(),C(S)}),P.addEventListener("mousemove",function(H){H.stopPropagation(),H.stopImmediatePropagation()}),P.addEventListener("click",function(H){H.stopPropagation(),H.stopImmediatePropagation(),t(S),o.blur()}),P.appendChild(k),m.appendChild(P)}function L(S){a=S,C(S)}if(o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",m.style.verticalAlign="middle",m.style.display="inline-block",m.style.padding="4px",_.setAttribute("width",u),_.setAttribute("height",u),_.setAttribute("viewBox","0 0 512 512"),_.setAttribute("xml:space","preserve"),_.style.padding="0 1px",n.elementAttributes&&typeof n.elementAttributes=="object")for(let S in n.elementAttributes)S.charAt(0)=="+"?(S=S.slice(1),m.setAttribute(S,m.getAttribute(S)+n.elementAttributes["+"+S])):m.setAttribute(S,n.elementAttributes[S]);for(var A=1;A<=l;A++)R(A);return a=Math.min(parseInt(a),l),C(a),m.addEventListener("mousemove",function(S){C(0)}),m.addEventListener("click",function(S){t(0)}),o.addEventListener("blur",function(S){i()}),o.addEventListener("keydown",function(S){switch(S.keyCode){case 39:L(a+1);break;case 37:L(a-1);break;case 13:t(a);break;case 27:i();break}}),m}function Px(r,e,t,i,n){var s=r.getElement(),o=typeof n.max>"u"?s.getElementsByTagName("div")[0]&&s.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,a=typeof n.min>"u"?s.getElementsByTagName("div")[0]&&s.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,l=(o-a)/100,u=r.getValue()||0,f=document.createElement("div"),m=document.createElement("div"),_,C;function R(){var L=window.getComputedStyle(s,null),A=l*Math.round(m.offsetWidth/((s.clientWidth-parseInt(L.getPropertyValue("padding-left"))-parseInt(L.getPropertyValue("padding-right")))/100))+a;t(A),s.setAttribute("aria-valuenow",A),s.setAttribute("aria-label",u)}if(f.style.position="absolute",f.style.right="0",f.style.top="0",f.style.bottom="0",f.style.width="5px",f.classList.add("tabulator-progress-handle"),m.style.display="inline-block",m.style.position="relative",m.style.height="100%",m.style.backgroundColor="#488CE9",m.style.maxWidth="100%",m.style.minWidth="0%",n.elementAttributes&&typeof n.elementAttributes=="object")for(let L in n.elementAttributes)L.charAt(0)=="+"?(L=L.slice(1),m.setAttribute(L,m.getAttribute(L)+n.elementAttributes["+"+L])):m.setAttribute(L,n.elementAttributes[L]);return s.style.padding="4px 4px",u=Math.min(parseFloat(u),o),u=Math.max(parseFloat(u),a),u=Math.round((u-a)/l),m.style.width=u+"%",s.setAttribute("aria-valuemin",a),s.setAttribute("aria-valuemax",o),m.appendChild(f),f.addEventListener("mousedown",function(L){_=L.screenX,C=m.offsetWidth}),f.addEventListener("mouseover",function(){f.style.cursor="ew-resize"}),s.addEventListener("mousemove",function(L){_&&(m.style.width=C+L.screenX-_+"px")}),s.addEventListener("mouseup",function(L){_&&(L.stopPropagation(),L.stopImmediatePropagation(),_=!1,C=!1,R())}),s.addEventListener("keydown",function(L){switch(L.keyCode){case 39:L.preventDefault(),m.style.width=m.clientWidth+s.clientWidth/100+"px";break;case 37:L.preventDefault(),m.style.width=m.clientWidth-s.clientWidth/100+"px";break;case 9:case 13:R();break;case 27:i();break}}),s.addEventListener("blur",function(){i()}),m}function Ox(r,e,t,i,n){var s=r.getValue(),o=document.createElement("input"),a=n.tristate,l=typeof n.indeterminateValue>"u"?null:n.indeterminateValue,u=!1,f=Object.keys(n).includes("trueValue"),m=Object.keys(n).includes("falseValue");if(o.setAttribute("type","checkbox"),o.style.marginTop="5px",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let C in n.elementAttributes)C.charAt(0)=="+"?(C=C.slice(1),o.setAttribute(C,o.getAttribute(C)+n.elementAttributes["+"+C])):o.setAttribute(C,n.elementAttributes[C]);o.value=s,a&&(typeof s>"u"||s===l||s==="")&&(u=!0,o.indeterminate=!0),this.table.browser!="firefox"&&e(function(){o.focus({preventScroll:!0})}),o.checked=f?s===n.trueValue:s===!0||s==="true"||s==="True"||s===1,e(function(){o.focus()});function _(C){var R=o.checked;return f&&R?R=n.trueValue:m&&!R&&(R=n.falseValue),a?C?u?l:R:o.checked&&!u?(o.checked=!1,o.indeterminate=!0,u=!0,l):(u=!1,R):R}return o.addEventListener("change",function(C){t(_())}),o.addEventListener("blur",function(C){t(_(!0))}),o.addEventListener("keydown",function(C){C.keyCode==13&&t(_()),C.keyCode==27&&i()}),o}var kx={input:Cx,textarea:xx,number:Tx,range:Rx,date:Sx,time:Lx,datetime:Dx,select:Ax,list:Mx,autocomplete:Ix,star:Fx,progress:Px,tickCross:Ox};class mo extends He{constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.editors=mo.editors,this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-left",this.navigateLeft.bind(this,void 0)),this.subscribe("keybinding-nav-right",this.navigateRight.bind(this,void 0)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0))}keybindingNavigateNext(e){var t=this.currentCell,i=this.options("tabEndNewRow");t&&(this.navigateNext(t,e)||i&&(t.getElement().firstChild.blur(),i===!0?i=this.table.addRow({}):typeof i=="function"?i=this.table.addRow(i(t.row.getComponent())):i=this.table.addRow(Object.assign({},i)),i.then(()=>{setTimeout(()=>{t.getComponent().navigateNext()})})))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(t=>{this.table.modules.edit.clearEdited(t._getSelf())})}navigatePrev(e=this.currentCell,t){var i,n;if(e){if(t&&t.preventDefault(),i=this.navigateLeft(),i)return!0;if(n=this.table.rowManager.prevDisplayRow(e.row,!0),n&&(i=this.findPrevEditableCell(n,n.cells.length),i))return i.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,t){var i,n;if(e){if(t&&t.preventDefault(),i=this.navigateRight(),i)return!0;if(n=this.table.rowManager.nextDisplayRow(e.row,!0),n&&(i=this.findNextEditableCell(n,-1),i))return i.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,t){var i,n;return e&&(t&&t.preventDefault(),i=e.getIndex(),n=this.findPrevEditableCell(e.row,i),n)?(n.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,t){var i,n;return e&&(t&&t.preventDefault(),i=e.getIndex(),n=this.findNextEditableCell(e.row,i),n)?(n.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,t){var i,n;return e&&(t&&t.preventDefault(),i=e.getIndex(),n=this.table.rowManager.prevDisplayRow(e.row,!0),n)?(n.cells[i].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,t){var i,n;return e&&(t&&t.preventDefault(),i=e.getIndex(),n=this.table.rowManager.nextDisplayRow(e.row,!0),n)?(n.cells[i].getComponent().edit(),!0):!1}findNextEditableCell(e,t){var i=!1;if(t<e.cells.length-1)for(var n=t+1;n<e.cells.length;n++){let s=e.cells[n];if(s.column.modules.edit&&mt.elVisible(s.getElement())&&this.allowEdit(s)){i=s;break}}return i}findPrevEditableCell(e,t){var i=!1;if(t>0)for(var n=t-1;n>=0;n--){let s=e.cells[n];if(s.column.modules.edit&&mt.elVisible(s.getElement())&&this.allowEdit(s)){i=s;break}}return i}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(t=>{t.column.modules.edit&&typeof t.column.modules.edit.check=="function"&&this.updateCellClass(t)})}initializeColumn(e){var t={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{}};switch(typeof e.definition.editor){case"string":this.editors[e.definition.editor]?t.editor=this.editors[e.definition.editor]:console.warn("Editor Error - No such editor found: ",e.definition.editor);break;case"function":t.editor=e.definition.editor;break;case"boolean":e.definition.editor===!0&&(typeof e.definition.formatter!="function"?this.editors[e.definition.formatter]?t.editor=this.editors[e.definition.formatter]:t.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",e.definition.formatter));break}t.editor&&(e.modules.edit=t)}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var t=this.currentCell,i;if(this.invalidEdit=!1,t){for(this.currentCell=!1,i=t.getElement(),this.dispatch("edit-editor-clear",t,e),i.classList.remove("tabulator-editing");i.firstChild;)i.removeChild(i.firstChild);t.row.getElement().classList.remove("tabulator-editing"),t.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,t=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,t),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",t)}}bindEditor(e){if(e.column.modules.edit){var t=this,i=e.getElement(!0);this.updateCellClass(e),i.setAttribute("tabindex",0),i.addEventListener("click",function(n){i.classList.contains("tabulator-editing")||i.focus({preventScroll:!0})}),i.addEventListener("mousedown",function(n){n.button===2?n.preventDefault():t.mouseClick=!0}),i.addEventListener("focus",function(n){t.recursionBlock||t.edit(e,n,!1)})}}focusCellNoEvent(e,t){this.recursionBlock=!0,t&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,t){this.focusCellNoEvent(e),this.edit(e,!1,t)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var t=this.table.rowManager.element.scrollTop,i=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,n=e.row.getElement();n.offsetTop<t?this.table.rowManager.element.scrollTop-=t-n.offsetTop:n.offsetTop+n.offsetHeight>i&&(this.table.rowManager.element.scrollTop+=n.offsetTop+n.offsetHeight-i);var s=this.table.rowManager.element.scrollLeft,o=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,a=e.getElement();this.table.modExists("frozenColumns")&&(s+=parseInt(this.table.modules.frozenColumns.leftMargin),o-=parseInt(this.table.modules.frozenColumns.rightMargin)),this.table.options.renderHorizontal==="virtual"&&(s-=parseInt(this.table.columnManager.renderer.vDomPadLeft),o-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),a.offsetLeft<s?this.table.rowManager.element.scrollLeft-=s-a.offsetLeft:a.offsetLeft+a.offsetWidth>o&&(this.table.rowManager.element.scrollLeft+=a.offsetLeft+a.offsetWidth-o)}}allowEdit(e){var t=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(t=e.column.modules.edit.check(e.getComponent()));break;case"string":t=!!e.row.data[e.column.modules.edit.check];break;case"boolean":t=e.column.modules.edit.check;break}return t}edit(e,t,i){var n=this,s=!0,o=function(){},a=e.getElement(),l,u,f;if(this.currentCell){this.invalidEdit||this.cancelEdit();return}function m(A){if(n.currentCell===e){var S=n.chain("edit-success",[e,A],!0,!0);return S===!0||n.table.options.validationMode==="highlight"?(n.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,n.editedCells.indexOf(e)==-1&&n.editedCells.push(e),e.setValue(A,!0),S===!0):(n.invalidEdit=!0,n.focusCellNoEvent(e,!0),o(),!1)}}function _(){n.currentCell===e&&n.cancelEdit()}function C(A){o=A}if(e.column.modules.edit.blocked)return this.mouseClick=!1,a.blur(),!1;if(t&&t.stopPropagation(),s=this.allowEdit(e),s||i){if(n.cancelEdit(),n.currentCell=e,this.focusScrollAdjust(e),u=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,t,u)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,u),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",u),f=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(u):e.column.modules.edit.params,l=e.column.modules.edit.editor.call(n,u,C,m,_,f),l!==!1)if(l instanceof Node){for(a.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");a.firstChild;)a.removeChild(a.firstChild);a.appendChild(l),o();for(var R=a.children,L=0;L<R.length;L++)R[L].addEventListener("click",function(A){A.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",l),a.blur(),!1;else return a.blur(),!1;return!0}else return this.mouseClick=!1,a.blur(),!1}getEditedCells(){var e=[];return this.editedCells.forEach(t=>{e.push(t.getComponent())}),e}clearEdited(e){var t;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),t=this.editedCells.indexOf(e),t>-1&&this.editedCells.splice(t,1)}}mo.moduleName="edit";mo.editors=kx;class eg{constructor(e,t,i,n){this.type=e,this.columns=t,this.component=i||!1,this.indent=n||0}}class Wl{constructor(e,t,i,n,s){this.value=e,this.component=t||!1,this.width=i,this.height=n,this.depth=s}}class pp extends He{constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,t,i,n){this.cloneTableStyle=t,this.config=e||{},this.colVisProp=n;var s=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders()):[],o=this.bodyToExportRows(this.rowLookup(i));return s.concat(o)}generateTable(e,t,i,n){var s=this.generateExportList(e,t,i,n);return this.generateTableElement(s)}rowLookup(e){var t=[];if(typeof e=="function")e.call(this.table).forEach(i=>{i=this.table.rowManager.findRow(i),i&&t.push(i)});else switch(e){case!0:case"visible":t=this.table.rowManager.getVisibleRows(!1,!0);break;case"all":t=this.table.rowManager.rows;break;case"selected":t=this.table.modules.selectRow.selectedRows;break;case"active":default:this.table.options.pagination?t=this.table.rowManager.getDisplayRows(this.table.rowManager.displayRows.length-2):t=this.table.rowManager.getDisplayRows()}return Object.assign([],t)}generateColumnGroupHeaders(){var e=[],t=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex;return t.forEach(i=>{var n=this.processColumnGroup(i);n&&e.push(n)}),e}processColumnGroup(e){var t=e.columns,i=0,n=e.definition["title"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))]||e.definition.title,s={title:n,column:e,depth:1};if(t.length){if(s.subGroups=[],s.width=0,t.forEach(o=>{var a=this.processColumnGroup(o);a&&(s.width+=a.width,s.subGroups.push(a),a.depth>i&&(i=a.depth))}),s.depth+=i,!s.width)return!1}else if(this.columnVisCheck(e))s.width=1;else return!1;return s}columnVisCheck(e){var t=e.definition[this.colVisProp];return typeof t=="function"&&(t=t.call(this.table,e.getComponent())),t!==!1&&(e.visible||!e.visible&&t)}headersToExportRows(e){var t=[],i=0,n=[];function s(o,a){var l=i-a;if(typeof t[a]>"u"&&(t[a]=[]),o.height=o.subGroups?1:l-o.depth+1,t[a].push(o),o.height>1)for(let u=1;u<o.height;u++)typeof t[a+u]>"u"&&(t[a+u]=[]),t[a+u].push(!1);if(o.width>1)for(let u=1;u<o.width;u++)t[a].push(!1);o.subGroups&&o.subGroups.forEach(function(u){s(u,a+1)})}return e.forEach(function(o){o.depth>i&&(i=o.depth)}),e.forEach(function(o){s(o,0)}),t.forEach(o=>{var a=[];o.forEach(l=>{if(l){let u=typeof l.title>"u"?"":l.title;a.push(new Wl(u,l.column.getComponent(),l.width,l.height,l.depth))}else a.push(null)}),n.push(new eg("header",a))}),n}bodyToExportRows(e){var t=[],i=[];return this.table.columnManager.columnsByIndex.forEach(n=>{this.columnVisCheck(n)&&t.push(n.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(n=>{switch(n.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&n.modules.dataTree.parent)}return!0}),e.forEach((n,s)=>{var o=n.getData(this.colVisProp),a=[],l=0;switch(n.type){case"group":l=n.level,a.push(new Wl(n.key,n.getComponent(),t.length,1));break;case"calc":case"row":t.forEach(u=>{a.push(new Wl(u._column.getFieldValue(o),u,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=n.modules.dataTree.index);break}i.push(new eg(n.type,a,n.getComponent(),l))}),i}generateTableElement(e){var t=document.createElement("table"),i=document.createElement("thead"),n=document.createElement("tbody"),s=this.lookupTableStyles(),o=this.table.options["rowFormatter"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],a={};return a.rowFormatter=o!==null?o:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(a.treeElementField=this.table.modules.dataTree.elementField),a.groupHeader=this.table.options["groupHeader"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],a.groupHeader&&!Array.isArray(a.groupHeader)&&(a.groupHeader=[a.groupHeader]),t.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),i,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,u)=>{let f;switch(l.type){case"header":i.appendChild(this.generateHeaderElement(l,a,s));break;case"group":n.appendChild(this.generateGroupElement(l,a,s));break;case"calc":n.appendChild(this.generateCalcElement(l,a,s));break;case"row":f=this.generateRowElement(l,a,s),this.mapElementStyles(u%2&&s.evenRow?s.evenRow:s.oddRow,f,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n.appendChild(f);break}}),i.innerHTML&&t.appendChild(i),t.appendChild(n),this.mapElementStyles(this.table.element,t,["border-top","border-left","border-right","border-bottom"]),t}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,t,i){var n=document.createElement("tr");return e.columns.forEach(s=>{if(s){var o=document.createElement("th"),a=s.component._column.definition.cssClass?s.component._column.definition.cssClass.split(" "):[];o.colSpan=s.width,o.rowSpan=s.height,o.innerHTML=s.value,this.cloneTableStyle&&(o.style.boxSizing="border-box"),a.forEach(function(l){o.classList.add(l)}),this.mapElementStyles(s.component.getElement(),o,["text-align","border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(s.component._column.contentElement,o,["padding-top","padding-left","padding-right","padding-bottom"]),s.component._column.visible?this.mapElementStyles(s.component.getElement(),o,["width"]):s.component._column.definition.width&&(o.style.width=s.component._column.definition.width+"px"),s.component._column.parent&&this.mapElementStyles(s.component._column.parent.groupElement,o,["border-top"]),n.appendChild(o)}}),n}generateGroupElement(e,t,i){var n=document.createElement("tr"),s=document.createElement("td"),o=e.columns[0];return n.classList.add("tabulator-print-table-row"),t.groupHeader&&t.groupHeader[e.indent]?o.value=t.groupHeader[e.indent](o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):t.groupHeader!==!1&&(o.value=e.component._group.generator(o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),s.colSpan=o.width,s.innerHTML=o.value,n.classList.add("tabulator-print-table-group"),n.classList.add("tabulator-group-level-"+e.indent),o.component.isVisible()&&n.classList.add("tabulator-group-visible"),this.mapElementStyles(i.firstGroup,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(i.firstGroup,s,["padding-top","padding-left","padding-right","padding-bottom"]),n.appendChild(s),n}generateCalcElement(e,t,i){var n=this.generateRowElement(e,t,i);return n.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(i.calcRow,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n}generateRowElement(e,t,i){var n=document.createElement("tr");return n.classList.add("tabulator-print-table-row"),e.columns.forEach((s,o)=>{if(s){var a=document.createElement("td"),l=s.component._column,u=this.table.columnManager.findColumnIndex(l),f=s.value,m,_={modules:{},getValue:function(){return f},getField:function(){return l.definition.field},getElement:function(){return a},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getComponent:function(){return _},column:l},C=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(C.forEach(function(R){a.classList.add(R)}),this.table.modExists("format")&&this.config.formatCells!==!1)f=this.table.modules.format.formatExportValue(_,this.colVisProp);else switch(typeof f){case"object":f=f!==null?JSON.stringify(f):"";break;case"undefined":f="";break}f instanceof Node?a.appendChild(f):a.innerHTML=f,m=i.styleCells&&i.styleCells[u]?i.styleCells[u]:i.firstCell,m&&(this.mapElementStyles(m,a,["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"]),l.definition.align&&(a.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(t.treeElementField&&t.treeElementField==l.field||!t.treeElementField&&o==0)&&(e.component._row.modules.dataTree.controlEl&&a.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),a.firstChild),e.component._row.modules.dataTree.branchEl&&a.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),a.firstChild)),n.appendChild(a),_.modules.format&&_.modules.format.renderedCallback&&_.modules.format.renderedCallback(),t.rowFormatter&&this.config.formatCells!==!1&&t.rowFormatter(e.component)}}),n}generateHTMLTable(e){var t=document.createElement("div");return t.appendChild(this.generateTableElement(e)),t.innerHTML}getHtml(e,t,i,n){var s=this.generateExportList(i||this.table.options.htmlOutputConfig,t,e,n||"htmlOutput");return this.generateHTMLTable(s)}mapElementStyles(e,t,i){if(this.cloneTableStyle&&e&&t){var n={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var s=window.getComputedStyle(e);i.forEach(function(o){t.style[n[o]]=s.getPropertyValue(o)})}}}}pp.moduleName="export";var Nx={"=":function(r,e,t,i){return e==r},"<":function(r,e,t,i){return e<r},"<=":function(r,e,t,i){return e<=r},">":function(r,e,t,i){return e>r},">=":function(r,e,t,i){return e>=r},"!=":function(r,e,t,i){return e!=r},regex:function(r,e,t,i){return typeof r=="string"&&(r=new RegExp(r)),r.test(e)},like:function(r,e,t,i){return r===null||typeof r>"u"?e===r:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(r.toLowerCase())>-1:!1},keywords:function(r,e,t,i){var n=r.toLowerCase().split(typeof i.separator>"u"?" ":i.separator),s=String(e===null||typeof e>"u"?"":e).toLowerCase(),o=[];return n.forEach(a=>{s.includes(a)&&o.push(!0)}),i.matchAll?o.length===n.length:!!o.length},starts:function(r,e,t,i){return r===null||typeof r>"u"?e===r:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(r.toLowerCase()):!1},ends:function(r,e,t,i){return r===null||typeof r>"u"?e===r:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(r.toLowerCase()):!1},in:function(r,e,t,i){return Array.isArray(r)?r.length?r.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",r),!1)}};class Qi extends He{constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var t=this.table.columnManager.findColumn(e.field);if(t)this.setHeaderFilterValue(t,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,t,i,n){return n.filter=this.getFilters(!0,!0),n}userSetFilter(e,t,i,n){this.setFilter(e,t,i,n),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,t,i,n){this.addFilter(e,t,i,n),this.refreshFilter()}userSetHeaderFilterFocus(e){var t=this.table.columnManager.findColumn(e);if(t)this.setHeaderFilterFocus(t);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var t=this.table.columnManager.findColumn(e);if(t)return this.getHeaderFilterValue(t);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,t){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterValue(i,t);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,t,i){this.removeFilter(e,t,i),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,t,i){return this.search("rows",e,t,i)}searchData(e,t,i){return this.search("data",e,t,i)}initializeColumnHeaderFilter(e){var t=e.definition;t.headerFilter&&(typeof t.headerFilterPlaceholder<"u"&&t.field&&this.module("localize").setHeaderFilterColumnPlaceholder(t.field,t.headerFilterPlaceholder),this.initializeColumn(e))}initializeColumn(e,t){var i=this,n=e.getField();function s(o){var a=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",u="",f;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==o){if(e.modules.filter.prevSuccess=o,e.modules.filter.emptyFunc(o))delete i.headerFilters[n];else{switch(e.modules.filter.value=o,typeof e.definition.headerFilterFunc){case"string":Qi.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,f=function(m){var _=e.definition.headerFilterFuncParams||{},C=e.getFieldValue(m);return _=typeof _=="function"?_(o,C,m):_,Qi.filters[e.definition.headerFilterFunc](o,C,m,_)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":f=function(m){var _=e.definition.headerFilterFuncParams||{},C=e.getFieldValue(m);return _=typeof _=="function"?_(o,C,m):_,e.definition.headerFilterFunc(o,C,m,_)},l=f;break}if(!f)switch(a){case"partial":f=function(m){var _=e.getFieldValue(m);return typeof _<"u"&&_!==null?String(_).toLowerCase().indexOf(String(o).toLowerCase())>-1:!1},l="like";break;default:f=function(m){return e.getFieldValue(m)==o},l="="}i.headerFilters[n]={value:o,func:f,type:l}}e.modules.filter.value=o,u=JSON.stringify(i.headerFilters),i.prevHeaderFilterChangeCheck!==u&&(i.prevHeaderFilterChangeCheck=u,i.trackChanges(),i.refreshFilter())}return!0}e.modules.filter={success:s,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,t,i){var n=this,s=e.modules.filter.success,o=e.getField(),a,l,u,f,m,_,C;e.modules.filter.value=t;function R(){}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),o){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(L){return!L&&L!==0},a=document.createElement("div"),a.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":n.table.modules.edit.editors[e.definition.headerFilter]?(l=n.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(L){return L!==!0&&L!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&n.table.modules.edit.editors[e.definition.formatter]?(l=n.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(L){return L!==!0&&L!==!1})):l=n.table.modules.edit.editors.input;break}if(l){if(f={getValue:function(){return typeof t<"u"?t:""},getField:function(){return e.definition.field},getElement:function(){return a},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getRow:function(){return{normalizeHeight:function(){}}}},C=e.definition.headerFilterParams||{},C=typeof C=="function"?C.call(n.table,f):C,u=l.call(this.table.modules.edit,f,function(){},s,R,C),!u){console.warn("Filter Error - Cannot add filter to "+o+" column, editor returned a value of false");return}if(!(u instanceof Node)){console.warn("Filter Error - Cannot add filter to "+o+" column, editor should return an instance of Node, the editor returned:",u);return}n.langBind("headerFilters|columns|"+e.definition.field,function(L){u.setAttribute("placeholder",typeof L<"u"&&L?L:n.langText("headerFilters|default"))}),u.addEventListener("click",function(L){L.stopPropagation(),u.focus()}),u.addEventListener("focus",L=>{var A=this.table.columnManager.contentsElement.scrollLeft,S=this.table.rowManager.element.scrollLeft;A!==S&&(this.table.rowManager.scrollHorizontal(A),this.table.columnManager.scrollHorizontal(A))}),m=!1,_=function(L){m&&clearTimeout(m),m=setTimeout(function(){s(u.value)},n.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=u,e.modules.filter.attrType=u.hasAttribute("type")?u.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=u.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(u.addEventListener("keyup",_),u.addEventListener("search",_),e.modules.filter.attrType=="number"&&u.addEventListener("change",function(L){s(u.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&u.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&u.addEventListener("mousedown",function(L){L.stopPropagation()})),a.appendChild(u),e.contentElement.appendChild(a),i||n.headerFilterColumns.push(e)}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,t){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,t,!0),e.modules.filter.success(t)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,t,i,n){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:t,value:i,params:n}]),this.addFilter(e)}addFilter(e,t,i,n){var s=!1;Array.isArray(e)||(e=[{field:e,type:t,value:i,params:n}]),e.forEach(o=>{o=this.findFilter(o),o&&(this.filterList.push(o),s=!0)}),s&&this.trackChanges()}findFilter(e){var t;if(Array.isArray(e))return this.findSubFilters(e);var i=!1;return typeof e.field=="function"?i=function(n){return e.field(n,e.type||{})}:Qi.filters[e.type]?(t=this.table.columnManager.getColumnByField(e.field),t?i=function(n){return Qi.filters[e.type](e.value,t.getFieldValue(n),n,e.params||{})}:i=function(n){return Qi.filters[e.type](e.value,n[e.field],n,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=i,e.func?e:!1}findSubFilters(e){var t=[];return e.forEach(i=>{i=this.findFilter(i),i&&t.push(i)}),t.length?t:!1}getFilters(e,t){var i=[];return e&&(i=this.getHeaderFilters()),t&&i.forEach(function(n){typeof n.type=="function"&&(n.type="function")}),i=i.concat(this.filtersToArray(this.filterList,t)),i}filtersToArray(e,t){var i=[];return e.forEach(n=>{var s;Array.isArray(n)?i.push(this.filtersToArray(n,t)):(s={field:n.field,type:n.type,value:n.value},t&&typeof s.type=="function"&&(s.type="function"),i.push(s))}),i}getHeaderFilters(){var e=[];for(var t in this.headerFilters)e.push({field:t,type:this.headerFilters[t].type,value:this.headerFilters[t].value});return e}removeFilter(e,t,i){Array.isArray(e)||(e=[{field:e,type:t,value:i}]),e.forEach(n=>{var s=-1;typeof n.field=="object"?s=this.filterList.findIndex(o=>n===o):s=this.filterList.findIndex(o=>n.field===o.field&&n.type===o.type&&n.value===o.value),s>-1?this.filterList.splice(s,1):console.warn("Filter Error - No matching filter type found, ignoring: ",n.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,t,i,n){var s=[],o=[];return Array.isArray(t)||(t=[{field:t,type:i,value:n}]),t.forEach(a=>{a=this.findFilter(a),a&&o.push(a)}),this.table.rowManager.rows.forEach(a=>{var l=!0;o.forEach(u=>{this.filterRecurse(u,a.getData())||(l=!1)}),l&&s.push(e==="data"?a.getData("data"):a.getComponent())}),s}filter(e,t){var i=[],n=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(s=>{this.filterRow(s)&&i.push(s)}):i=e.slice(0),this.subscribedExternal("dataFiltered")&&(i.forEach(s=>{n.push(s.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),n)),i}filterRow(e,t){var i=!0,n=e.getData();this.filterList.forEach(o=>{this.filterRecurse(o,n)||(i=!1)});for(var s in this.headerFilters)this.headerFilters[s].func(n)||(i=!1);return i}filterRecurse(e,t){var i=!1;return Array.isArray(e)?e.forEach(n=>{this.filterRecurse(n,t)&&(i=!0)}):i=e.func(t),i}}Qi.moduleName="filter";Qi.filters=Nx;function Gx(r,e,t){return this.emptyToSpace(this.sanitizeHTML(r.getValue()))}function zx(r,e,t){return r.getValue()}function Bx(r,e,t){return r.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(r.getValue()))}function jx(r,e,t){var i=parseFloat(r.getValue()),n="",s,o,a,l,u=e.decimal||".",f=e.thousand||",",m=e.negativeSign||"-",_=e.symbol||"",C=!!e.symbolAfter,R=typeof e.precision<"u"?e.precision:2;if(isNaN(i))return this.emptyToSpace(this.sanitizeHTML(r.getValue()));if(i<0&&(i=Math.abs(i),n=m),s=R!==!1?i.toFixed(R):i,s=String(s).split("."),o=s[0],a=s.length>1?u+s[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(o);)o=o.replace(l,"$1"+f+"$2");return C?n+o+a+_:n+_+o+a}function Hx(r,e,t){var i=r.getValue(),n=e.urlPrefix||"",s=e.download,o=i,a=document.createElement("a"),l;function u(f,m){var _=f.shift(),C=m[_];return f.length&&typeof C=="object"?u(f,C):C}if(e.labelField&&(l=r.getData(),o=u(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":o=e.label;break;case"function":o=e.label(r);break}if(o){if(e.urlField&&(l=r.getData(),i=l[e.urlField]),e.url)switch(typeof e.url){case"string":i=e.url;break;case"function":i=e.url(r);break}return a.setAttribute("href",n+i),e.target&&a.setAttribute("target",e.target),e.download&&(typeof s=="function"?s=s(r):s=s===!0?"":s,a.setAttribute("download",s)),a.innerHTML=this.emptyToSpace(this.sanitizeHTML(o)),a}else return"&nbsp;"}function Ux(r,e,t){var i=document.createElement("img"),n=r.getValue();switch(e.urlPrefix&&(n=e.urlPrefix+r.getValue()),e.urlSuffix&&(n=n+e.urlSuffix),i.setAttribute("src",n),typeof e.height){case"number":i.style.height=e.height+"px";break;case"string":i.style.height=e.height;break}switch(typeof e.width){case"number":i.style.width=e.width+"px";break;case"string":i.style.width=e.width;break}return i.addEventListener("load",function(){r.getRow().normalizeHeight()}),i}function Vx(r,e,t){var i=r.getValue(),n=r.getElement(),s=e.allowEmpty,o=e.allowTruthy,a=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',u=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return a&&i===e.trueValue||!a&&(o&&i||i===!0||i==="true"||i==="True"||i===1||i==="1")?(n.setAttribute("aria-checked",!0),l||""):s&&(i==="null"||i===""||i===null||typeof i>"u")?(n.setAttribute("aria-checked","mixed"),""):(n.setAttribute("aria-checked",!1),u||"")}function Wx(r,e,t){var i=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",s=e.outputFormat||"dd/MM/yyyy HH:mm:ss",o=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",a=r.getValue();if(typeof i<"u"){var l;return i.isDateTime(a)?l=a:n==="iso"?l=i.fromISO(String(a)):l=i.fromFormat(String(a),n),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(s)):o===!0||!a?a:typeof o=="function"?o(a):o}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function Xx(r,e,t){var i=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",s=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=typeof e.suffix<"u"?e.suffix:!1,a=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,u=typeof e.date<"u"?e.date:i.now(),f=r.getValue();if(typeof i<"u"){var m;return i.isDateTime(f)?m=f:n==="iso"?m=i.fromISO(String(f)):m=i.fromFormat(String(f),n),m.isValid?l?m.diff(u,a).toHuman()+(o?" "+o:""):parseInt(m.diff(u,a)[a])+(o?" "+o:""):s===!0?f:typeof s=="function"?s(f):s}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function Yx(r,e,t){var i=r.getValue();return typeof e[i]>"u"?(console.warn("Missing display value for "+i),i):e[i]}function Kx(r,e,t){var i=r.getValue(),n=r.getElement(),s=e&&e.stars?e.stars:5,o=document.createElement("span"),a=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',u='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';o.style.verticalAlign="middle",a.setAttribute("width","14"),a.setAttribute("height","14"),a.setAttribute("viewBox","0 0 512 512"),a.setAttribute("xml:space","preserve"),a.style.padding="0 1px",i=i&&!isNaN(i)?parseInt(i):0,i=Math.max(0,Math.min(i,s));for(var f=1;f<=s;f++){var m=a.cloneNode(!0);m.innerHTML=f<=i?l:u,o.appendChild(m)}return n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.textOverflow="ellipsis",n.setAttribute("aria-label",i),o}function $x(r,e,t){var i=this.sanitizeHTML(r.getValue())||0,n=document.createElement("span"),s=e&&e.max?e.max:100,o=e&&e.min?e.min:0,a=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",u,f;if(!(isNaN(i)||typeof r.getValue()>"u")){switch(n.classList.add("tabulator-traffic-light"),f=parseFloat(i)<=s?parseFloat(i):s,f=parseFloat(f)>=o?parseFloat(f):o,u=(s-o)/100,f=Math.round((f-o)/u),typeof a){case"string":l=a;break;case"function":l=a(i);break;case"object":if(Array.isArray(a)){var m=100/a.length,_=Math.floor(f/m);_=Math.min(_,a.length-1),_=Math.max(_,0),l=a[_];break}}return n.style.backgroundColor=l,n}}function Zx(r,e={},t){var i=this.sanitizeHTML(r.getValue())||0,n=r.getElement(),s=e.max?e.max:100,o=e.min?e.min:0,a=e.legendAlign?e.legendAlign:"center",l,u,f,m,_;switch(u=parseFloat(i)<=s?parseFloat(i):s,u=parseFloat(u)>=o?parseFloat(u):o,l=(s-o)/100,u=Math.round((u-o)/l),typeof e.color){case"string":f=e.color;break;case"function":f=e.color(i);break;case"object":if(Array.isArray(e.color)){let A=100/e.color.length,S=Math.floor(u/A);S=Math.min(S,e.color.length-1),S=Math.max(S,0),f=e.color[S];break}default:f="#2DC214"}switch(typeof e.legend){case"string":m=e.legend;break;case"function":m=e.legend(i);break;case"boolean":m=i;break;default:m=!1}switch(typeof e.legendColor){case"string":_=e.legendColor;break;case"function":_=e.legendColor(i);break;case"object":if(Array.isArray(e.legendColor)){let A=100/e.legendColor.length,S=Math.floor(u/A);S=Math.min(S,e.legendColor.length-1),S=Math.max(S,0),_=e.legendColor[S]}break;default:_="#000"}n.style.minWidth="30px",n.style.position="relative",n.setAttribute("aria-label",u);var C=document.createElement("div");C.style.display="inline-block",C.style.width=u+"%",C.style.backgroundColor=f,C.style.height="100%",C.setAttribute("data-max",s),C.setAttribute("data-min",o);var R=document.createElement("div");if(R.style.position="relative",R.style.width="100%",R.style.height="100%",m){var L=document.createElement("div");L.style.position="absolute",L.style.top=0,L.style.left=0,L.style.textAlign=a,L.style.width="100%",L.style.color=_,L.innerHTML=m}return t(function(){if(!(r instanceof dp)){var A=document.createElement("div");A.style.position="absolute",A.style.top="4px",A.style.bottom="4px",A.style.left="4px",A.style.right="4px",n.appendChild(A),n=A}n.appendChild(R),R.appendChild(C),m&&R.appendChild(L)}),""}function qx(r,e,t){return r.getElement().style.backgroundColor=this.sanitizeHTML(r.getValue()),""}function Jx(r,e,t){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function Qx(r,e,t){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function eT(r,e,t){var i=document.createElement("span"),n=r.getRow();return n.watchPosition(s=>{i.innerText=s}),i}function tT(r,e,t){return r.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}function iT(r,e,t){var i=document.createElement("div"),n=r.getRow()._row.modules.responsiveLayout;i.classList.add("tabulator-responsive-collapse-toggle"),i.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,r.getElement().classList.add("tabulator-row-handle");function s(o){var a=n.element;n.open=o,a&&(n.open?(i.classList.add("open"),a.style.display=""):(i.classList.remove("open"),a.style.display="none"))}return i.addEventListener("click",function(o){o.stopImmediatePropagation(),s(!n.open),r.getTable().rowManager.adjustTableSize()}),s(n.open),i}function nT(r,e,t){var i=document.createElement("input"),n=!1;if(i.type="checkbox",i.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(i.addEventListener("click",o=>{o.stopPropagation()}),typeof r.getRow=="function"){var s=r.getRow();s instanceof $a?(i.addEventListener("change",o=>{this.table.options.selectableRangeMode==="click"&&n?n=!1:s.toggleSelect()}),this.table.options.selectableRangeMode==="click"&&i.addEventListener("click",o=>{n=!0,this.table.modules.selectRow.handleComplexRowClick(s._row,o)}),i.checked=s.isSelected&&s.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(s,i)):i=""}else i.addEventListener("change",o=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(i);return i}var sT={plaintext:Gx,html:zx,textarea:Bx,money:jx,link:Hx,image:Ux,tickCross:Vx,datetime:Wx,datetimediff:Xx,lookup:Yx,star:Kx,traffic:$x,progress:Zx,color:qx,buttonTick:Jx,buttonCross:Qx,rownum:eT,handle:tT,responsiveCollapse:iT,rowSelection:nT};class _i extends He{constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupFormatter(e,"HtmlOutput"))}lookupFormatter(e,t){var i={params:e.definition["formatter"+t+"Params"]||{}},n=e.definition["formatter"+t];switch(typeof n){case"string":_i.formatters[n]?i.formatter=_i.formatters[n]:(console.warn("Formatter Error - No such formatter found: ",n),i.formatter=_i.formatters.plaintext);break;case"function":i.formatter=n;break;default:i.formatter=_i.formatters.plaintext;break}return i}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,t,i){var n,s,o,a;return e.definition.titleFormatter?(n=this.getFormatter(e.definition.titleFormatter),o=l=>{e.titleFormatterRendered=l},a={getValue:function(){return t},getElement:function(){return i},getColumn:function(){return e.getComponent()},getTable:()=>this.table},s=e.definition.titleFormatterParams||{},s=typeof s=="function"?s():s,n.call(this,a,s,o)):t}formatValue(e){var t=e.getComponent(),i=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(t):e.column.modules.format.params;function n(s){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=s,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,t,i,n)}formatExportValue(e,t){var i=e.column.modules.format[t],n;if(i){let s=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};return n=typeof i.params=="function"?i.params(e.getComponent()):i.params,i.formatter.call(this,e.getComponent(),n,s)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(i){return t[i]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}getFormatter(e){switch(typeof e){case"string":_i.formatters[e]?e=_i.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),e=_i.formatters.plaintext);break;case"function":break;default:e=_i.formatters.plaintext;break}return e}}_i.moduleName="format";_i.formatters=sT;class bp extends He{constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-delete",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)})}initializeColumn(e){var t={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(t.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=t):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(t=>{t.calcs.top&&this.layoutRow(t.calcs.top),t.calcs.bottom&&this.layoutRow(t.calcs.bottom),t.groupList&&t.groupList.length&&this.layoutGroupCalcs(t.groupList)})}layoutColumnPosition(e){var t=[],i=0,n=0;this.leftColumns.forEach((s,o)=>{if(s.modules.frozen.marginValue=i,s.modules.frozen.margin=s.modules.frozen.marginValue+"px",s.visible&&(i+=s.getWidth()),o==this.leftColumns.length-1?s.modules.frozen.edge=!0:s.modules.frozen.edge=!1,s.parent.isGroup){var a=this.getColGroupParentElement(s);t.includes(a)||(this.layoutElement(a,s),t.push(a)),s.modules.frozen.edge&&a.classList.add("tabulator-frozen-"+s.modules.frozen.position)}else this.layoutElement(s.getElement(),s);e&&s.cells.forEach(l=>{this.layoutElement(l.getElement(!0),s)})}),this.rightColumns.forEach((s,o)=>{s.modules.frozen.marginValue=n,s.modules.frozen.margin=s.modules.frozen.marginValue+"px",s.visible&&(n+=s.getWidth()),o==this.rightColumns.length-1?s.modules.frozen.edge=!0:s.modules.frozen.edge=!1,s.parent.isGroup?this.layoutElement(this.getColGroupParentElement(s),s):this.layoutElement(s.getElement(),s),e&&s.cells.forEach(a=>{this.layoutElement(a.getElement(!0),s)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),t=this.table.rowManager.getRows().filter(i=>!e.includes(i));t.forEach(i=>{i.deinitialize()}),e.forEach(i=>{i.type==="row"&&this.layoutRow(i)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(t=>{var i=e.getCell(t);i&&this.layoutElement(i.getElement(!0),t)}),this.rightColumns.forEach(t=>{var i=e.getCell(t);i&&this.layoutElement(i.getElement(!0),t)})}layoutElement(e,t){var i;t.modules.frozen&&(e.style.position="sticky",this.table.rtl?i=t.modules.frozen.position==="left"?"right":"left":i=t.modules.frozen.position,e.style[i]=t.modules.frozen.margin,e.classList.add("tabulator-frozen"),t.modules.frozen.edge&&e.classList.add("tabulator-frozen-"+t.modules.frozen.position))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}_calcSpace(e,t){var i=0;for(let n=0;n<t;n++)e[n].visible&&(i+=e[n].getWidth());return i}}bp.moduleName="frozenColumns";class _p extends He{constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),this.table.columnManager.getContentsElement().insertBefore(this.topElement,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)))}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var t=this.table.options.frozenRows,i=typeof t;i==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=t&&this.freezeRow(e):i==="function"?t.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(t)&&t.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var t=this.rows.indexOf(e);return t>-1}isFrozen(){return!!this.rows.length}visibleRows(e,t){return this.rows.forEach(i=>{t.push(i)}),t}getRows(e){var t=e.slice(0);return this.rows.forEach(function(i){var n=t.indexOf(i);n>-1&&t.splice(n,1)}),t}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var t=this.rows.indexOf(e);if(t>-1){var i=e.getElement();i.parentNode&&i.parentNode.removeChild(i),this.rows.splice(t,1)}}styleRows(e){this.rows.forEach((t,i)=>{this.table.rowManager.styleRow(t,i)})}}_p.moduleName="frozenRows";class rT{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._group.groupManager.table.componentFunctionBinder.handle("row",t._group,i)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class js{constructor(e,t,i,n,s,o,a){this.groupManager=e,this.parent=t,this.key=n,this.level=i,this.field=s,this.hasSubGroups=i<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=a,this.rows=[],this.groups=[],this.groupList=[],this.generator=o,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=a?a.visible:typeof e.startOpen[i]<"u"?e.startOpen[i]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(t){t.wipe()}):this.rows.forEach(t=>{t.modules&&delete t.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(t=>{this._createGroup(t,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",t=>{t.stopPropagation(),t.stopImmediatePropagation(),this.toggleVisibility()}))}_createGroup(e,t){var i=t+"_"+e,n=new js(this.groupManager,this,t,e,this.groupManager.groupIDLookups[t].field,this.groupManager.headerGenerator[t]||this.groupManager.headerGenerator[0],this.old?this.old.groups[i]:!1);this.groups[i]=n,this.groupList.push(n)}_addRowToGroup(e){var t=this.level+1;if(this.hasSubGroups){var i=this.groupManager.groupIDLookups[t].func(e.getData()),n=t+"_"+i;this.groupManager.allowedValues&&this.groupManager.allowedValues[t]?this.groups[n]&&this.groups[n].addRow(e):(this.groups[n]||this._createGroup(i,t),this.groups[n].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,t,i){var n=this.conformRowData({});e.updateData(n);var s=this.rows.indexOf(t);s>-1?i?this.rows.splice(s+1,0,e):this.rows.splice(s,0,e):i?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(t){t.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var t=this.rows.indexOf(e),i=e.getElement();t>-1&&this.rows.splice(t,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(i.parentNode&&i.parentNode.removeChild(i),this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this))}removeGroup(e){var t=e.level+"_"+e.key,i;this.groups[t]&&(delete this.groups[t],i=this.groupList.indexOf(e),i>-1&&this.groupList.splice(i,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(t){e=e.concat(t.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,t){var i=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(n=>{i.push(n.getData(t||"data"))}),i}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(t=>{e+=t.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var t=e.getHeadersAndRows();t.forEach(i=>{i.detachElement()})}):this.rows.forEach(e=>{var t=e.getElement();t.parentNode.removeChild(t)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(t=>{var i=t.getHeadersAndRows();i.forEach(n=>{var s=n.getElement();e.parentNode.insertBefore(s,e.nextSibling),n.initialize(),e=s})}):this.rows.forEach(t=>{var i=t.getElement();e.parentNode.insertBefore(i,e.nextSibling),t.initialize(),e=i}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(t){e.push(t.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var t=!1;return this.groupList.length?this.groupList.forEach(function(i){var n=i.getRowGroup(e);n&&(t=n)}):this.rows.find(function(i){return i===e})&&(t=this),t}getSubGroups(e){var t=[];return this.groupList.forEach(function(i){t.push(e?i.getComponent():i)}),t}getRows(e){var t=[];return this.rows.forEach(function(i){t.push(e?i.getComponent():i)}),t}generateGroupHeaderContents(){var e=[];for(this.rows.forEach(function(t){e.push(t.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,mt.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}getComponent(){return this.component||(this.component=new rT(this)),this.component}}class yp extends He{constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,t=this.table.options.groupStartOpen,i=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(i)&&e.length>i.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(s,o)=>{this.headerGenerator[0]=(a,l,u)=>(typeof a>"u"?"":a)+"<span>("+l+" "+(l===1?s:o.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var n=this.table.columnManager.getRealColumns();n.forEach(s=>{s.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),s.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((s,o)=>{var a,l;typeof s=="function"?a=s:(l=this.table.columnManager.getColumnByField(s),l?a=function(u){return l.getFieldValue(u)}:a=function(u){return u[s]}),this.groupIDLookups.push({field:typeof s=="function"?!1:s,func:a,values:this.allowedValues?this.allowedValues[o]:!1})}),t&&(Array.isArray(t)||(t=[t]),t.forEach(s=>{}),this.startOpen=t),i&&(this.headerGenerator=Array.isArray(i)?i:[i])}else this.groupList=[],this.groups={}}rowSample(e,t){if(this.table.options.groupBy){var i=this.getGroups(!1)[0];t.push(i.getRows(!1)[0])}return t}virtualRenderFill(){var e=this.table.rowManager.tableElement,t=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)t=t.filter(i=>i.type!=="group"),e.style.minWidth=t.length?"":this.table.columnManager.getWidth()+"px";else return t}rowAddingIndex(e,t,i){if(this.table.options.groupBy){this.assignRowToGroup(e);var n=e.modules.group.rows;return n.length>1&&(!t||t&&n.indexOf(t)==-1?i?n[0]!==e&&(t=n[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,t,!i)):n[n.length-1]!==e&&(t=n[n.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,t,!i)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,t,!i)),t}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,t,i){if(this.table.options.groupBy){!i&&t instanceof js&&(t=this.table.rowManager.prevDisplayRow(e)||t);var n=t instanceof js?t:t.modules.group,s=e instanceof js?e:e.modules.group;n===s?this.table.rowManager.moveRowInArray(n.rows,e,t,i):(s&&s.removeRow(e),n.insertRow(e,t,i))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var t=[];return this.groupList.forEach(function(i){t.push(e?i.getComponent():i)}),t}getChildGroups(e){var t=[];return e||(e=this),e.groupList.forEach(i=>{i.groupList.length?t=t.concat(this.getChildGroups(i)):t.push(i)}),t}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var t=[];return e.forEach(i=>{var n={};n.level=0,n.rowCount=0,n.headerContent="";var s=[];i.hasSubGroups?(s=this.pullGroupListData(i.groupList),n.level=i.level,n.rowCount=s.length-i.groupList.length,n.headerContent=i.generator(i.key,n.rowCount,i.rows,i),t.push(n),t=t.concat(s)):(n.level=i.level,n.headerContent=i.generator(i.key,i.rows.length,i.rows,i),n.rowCount=i.getRows().length,t.push(n),i.getRows().forEach(o=>{t.push(o.getData("data"))}))}),t}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var t=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(i=>{var n=i.getRowGroup(e);n&&(t=n)}),t}countGroups(){return this.groupList.length}generateGroups(e){var t=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(i=>{this.createGroup(i,0,t)}),e.forEach(i=>{this.assignRowToExistingGroup(i,t)})):e.forEach(i=>{this.assignRowToGroup(i,t)}),Object.values(t).forEach(i=>{i.wipe(!0)})}createGroup(e,t,i){var n=t+"_"+e,s;i=i||[],s=new js(this,!1,t,e,this.groupIDLookups[0].field,this.headerGenerator[0],i[n]),this.groups[n]=s,this.groupList.push(s)}assignRowToExistingGroup(e,t){var i=this.groupIDLookups[0].func(e.getData()),n="0_"+i;this.groups[n]&&this.groups[n].addRow(e)}assignRowToGroup(e,t){var i=this.groupIDLookups[0].func(e.getData()),n=!this.groups["0_"+i];return n&&this.createGroup(i,0,t),this.groups["0_"+i].addRow(e),!n}reassignRowToGroup(e){if(e.type==="row"){var t=e.modules.group,i=t.getPath(),n=this.getExpectedPath(e),s;s=i.length==n.length&&i.every((o,a)=>o===n[a]),s||(t.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var t=[],i=e.getData();return this.groupIDLookups.forEach(n=>{t.push(n.func(i))}),t}updateGroupRows(e){var t=[];return this.groupList.forEach(i=>{t=t.concat(i.getHeadersAndRows())}),e&&this.refreshData(!0,this.displayHandler),t}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(t=>{t.scrollHeader(e)}))}removeGroup(e){var t=e.level+"_"+e.key,i;this.groups[t]&&(delete this.groups[t],i=this.groupList.indexOf(e),i>-1&&this.groupList.splice(i,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,t=!0;this.table.rowManager.getDisplayRows().forEach((i,n)=>{this.table.rowManager.styleRow(i,n),e.appendChild(i.getElement()),i.initialize(!0),i.type!=="group"&&(t=!1)}),t?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}yp.moduleName="groupRows";var oT={cellEdit:function(r){r.component.setValueProcessData(r.data.oldValue),r.component.cellRendered()},rowAdd:function(r){r.component.deleteActual()},rowDelete:function(r){var e=this.table.rowManager.addRowActual(r.data.data,r.data.pos,r.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(r.component,e)},rowMove:function(r){this.table.rowManager.moveRowActual(r.component,this.table.rowManager.rows[r.data.posFrom],!r.data.after),this.table.rowManager.redraw()}},aT={cellEdit:function(r){r.component.setValueProcessData(r.data.newValue),r.component.cellRendered()},rowAdd:function(r){var e=this.table.rowManager.addRowActual(r.data.data,r.data.pos,r.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(r.component,e)},rowDelete:function(r){r.component.deleteActual()},rowMove:function(r){this.table.rowManager.moveRowActual(r.component,this.table.rowManager.rows[r.data.posTo],r.data.after),this.table.rowManager.redraw()}};class us extends He{constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,t,i){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:t.getPosition(),to:t,after:i})}rowAdded(e,t,i,n){this.action("rowAdd",e,{data:t,pos:i,index:n})}rowDeleted(e){var t,i;this.table.options.groupBy?(i=e.getComponent().getGroup()._getSelf().rows,t=i.indexOf(e),t&&(t=i[t-1])):(t=e.table.rowManager.getRowIndex(e),t&&(t=e.table.rowManager.rows[t-1])),this.action("rowDelete",e,{data:e.getData(),pos:!t,index:t})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,t,i){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:t,data:i}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var t=this.history.findIndex(function(i){return i.component===e});t>-1&&(this.history.splice(t,1),t<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return us.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn("History Undo Error - No more history to undo"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return us.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn("History Redo Error - No more history to redo"),!1}_rebindRow(e,t){this.history.forEach(function(i){if(i.component instanceof Zt)i.component===e&&(i.component=t);else if(i.component instanceof go&&i.component.row===e){var n=i.component.column.getField();n&&(i.component=t.getCell(n))}})}}us.moduleName="history";us.undoers=oT;us.redoers=aT;class vp extends He{constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,t=this.table.options,i=e.getElementsByTagName("th"),n=e.getElementsByTagName("tbody")[0],s=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),n=n?n.getElementsByTagName("tr"):[],this._extractOptions(e,t),i.length?this._extractHeaders(i,n):this._generateBlankHeaders(i,n);for(var o=0;o<n.length;o++){var a=n[o],l=a.getElementsByTagName("td"),u={};this.hasIndex||(u[t.index]=o);for(var f=0;f<l.length;f++){var m=l[f];typeof this.fieldIndex[f]<"u"&&(u[this.fieldIndex[f]]=m.innerHTML)}s.push(u)}t.data=s,this.dispatchExternal("htmlImported")}_extractOptions(e,t,i){var n=e.attributes,s=Object.keys(i||t),o={};s.forEach(f=>{o[f.toLowerCase()]=f});for(var a in n){var l=n[a],u;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(u=l.name.replace("tabulator-",""),typeof o[u]<"u"&&(t[o[u]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var t=this.table.options.columns.find(i=>i.title===e);return t||!1}_extractHeaders(e,t){for(var i=0;i<e.length;i++){var n=e[i],s=!1,o=this._findCol(n.textContent),a;o?s=!0:o={title:n.textContent.trim()},o.field||(o.field=n.textContent.trim().toLowerCase().replace(" ","_")),a=n.getAttribute("width"),a&&!o.width&&(o.width=a),this._extractOptions(n,o,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[i]=o.field,o.field==this.table.options.index&&(this.hasIndex=!0),s||this.table.options.columns.push(o)}}_generateBlankHeaders(e,t){for(var i=0;i<e.length;i++){var n=e[i],s={title:"",field:"col"+i};this.fieldIndex[i]=s.field;var o=n.getAttribute("width");o&&(s.width=o),this.table.options.columns.push(s)}}}vp.moduleName="htmlTableImport";function lT(r){var e=[],t=0,i=0,n=!1;for(let s=0;s<r.length;s++){let o=r[s],a=r[s+1];if(e[t]||(e[t]=[]),e[t][i]||(e[t][i]=""),o=='"'&&n&&a=='"'){e[t][i]+=o,s++;continue}if(o=='"'){n=!n;continue}if(o==","&&!n){i++;continue}if(o=="\r"&&a==`
`&&!n){i=0,t++,s++;continue}if((o=="\r"||o==`
`)&&!n){i=0,t++;continue}e[t][i]+=o}return e}function hT(r){try{return JSON.parse(r)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function cT(r){return r}var uT={csv:lT,json:hT,array:cT};class po extends He{constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,t,i,n,s){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(o=>(console.error("Import Error:",o||"Unable to import data"),Promise.reject(o)))}lookupImporter(e){var t;return e||(e=this.table.options.importFormat),typeof e=="string"?t=po.importers[e]:t=e,t||console.error("Import Error - Importer not found:",e),t}importFromFile(e,t){var i=this.lookupImporter(e);if(i)return this.pickFile(t).then(this.importData.bind(this,i)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch(n=>(console.error("Import Error:",n||"Unable to import file"),Promise.reject(n)))}pickFile(e){return new Promise((t,i)=>{var n=document.createElement("input");n.type="file",n.accept=e,n.addEventListener("change",s=>{var o=n.files[0],a=new FileReader;switch(this.table.options.importReader){case"buffer":a.readAsArrayBuffer(o);break;case"binary":a.readAsBinaryString(o);break;case"url":a.readAsDataURL(o);break;case"text":default:a.readAsText(o)}a.onload=l=>{t(a.result)},a.onerror=l=>{console.warn("File Load Error - Unable to read file"),i()}}),n.click()})}importData(e,t){var i=e.call(this.table,t);return i instanceof Promise?i:i?Promise.resolve(i):Promise.reject()}structureData(e){var t=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?t=this.structureArrayToObject(e):t=this.structureArrayToColumns(e),t):e}structureArrayToObject(e){var t=e.shift(),i=e.map(n=>{var s={};return t.forEach((o,a)=>{s[o]=n[a]}),s});return i}structureArrayToColumns(e){var t=[],i=this.table.getColumns();return i[0]&&e[0][0]&&i[0].getDefinition().title===e[0][0]&&e.shift(),e.forEach(n=>{var s={};n.forEach((o,a)=>{var l=i[a];l&&(s[l.getField()]=o)}),t.push(s)}),t}setData(e){return this.table.setData(e)}}po.moduleName="import";po.importers=uT;class Ep extends He{constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this))}cellContentsSelectionFixer(e,t){var i;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===t)){e.preventDefault();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(t.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(t.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,t){t?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var t=this.eventMap[e];this.touchSubscribers[t+"-touchstart"]||(this.touchSubscribers[t+"-touchstart"]=this.handleTouch.bind(this,t,"start"),this.touchSubscribers[t+"-touchend"]=this.handleTouch.bind(this,t,"end"),this.subscribe(t+"-touchstart",this.touchSubscribers[t+"-touchstart"]),this.subscribe(t+"-touchend",this.touchSubscribers[t+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var t=!0,i=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let n in this.eventMap)this.eventMap[n]===i&&this.subscribers[n]&&(t=!1);t&&(this.unsubscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.unsubscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"]),delete this.touchSubscribers[i+"-touchstart"],delete this.touchSubscribers[i+"-touchend"])}}initializeColumn(e){var t=e.definition;for(let i in this.eventMap)t[i]&&(this.subscriptionChanged(i,!0),this.columnSubscribers[i]||(this.columnSubscribers[i]=[]),this.columnSubscribers[i].push(e))}handle(e,t,i){this.dispatchEvent(e,t,i)}handleTouch(e,t,i,n){var s=this.touchWatchers[e];switch(e==="column"&&(e="header"),t){case"start":s.tap=!0,clearTimeout(s.tapHold),s.tapHold=setTimeout(()=>{clearTimeout(s.tapHold),s.tapHold=null,s.tap=null,clearTimeout(s.tapDbl),s.tapDbl=null,this.dispatchEvent(e+"TapHold",i,n)},1e3);break;case"end":s.tap&&(s.tap=null,this.dispatchEvent(e+"Tap",i,n)),s.tapDbl?(clearTimeout(s.tapDbl),s.tapDbl=null,this.dispatchEvent(e+"DblTap",i,n)):s.tapDbl=setTimeout(()=>{clearTimeout(s.tapDbl),s.tapDbl=null},300),clearTimeout(s.tapHold),s.tapHold=null;break}}dispatchEvent(e,t,i){var n=i.getComponent(),s;this.columnSubscribers[e]&&(i instanceof go?s=i.column.definition[e]:i instanceof Gi&&(s=i.definition[e]),s&&s(t,n)),this.dispatchExternal(e,t,n)}}Ep.moduleName="interaction";var dT={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35,undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"],copyToClipboard:["ctrl + 67","meta + 89"]},fT={keyBlock:function(r){r.stopPropagation(),r.preventDefault()},scrollPageUp:function(r){var e=this.table.rowManager,t=e.scrollTop-e.element.clientHeight;r.preventDefault(),e.displayRowsCount&&(t>=0?e.element.scrollTop=t:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(r){var e=this.table.rowManager,t=e.scrollTop+e.element.clientHeight,i=e.element.scrollHeight;r.preventDefault(),e.displayRowsCount&&(t<=i?e.element.scrollTop=t:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(r){var e=this.table.rowManager;r.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(r){var e=this.table.rowManager;r.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(r){this.dispatch("keybinding-nav-prev",r)},navNext:function(r){this.dispatch("keybinding-nav-next",r)},navLeft:function(r){this.dispatch("keybinding-nav-left",r)},navRight:function(r){this.dispatch("keybinding-nav-right",r)},navUp:function(r){this.dispatch("keybinding-nav-up",r)},navDown:function(r){this.dispatch("keybinding-nav-down",r)},undo:function(r){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(r.preventDefault(),this.table.modules.history.undo()))},redo:function(r){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(r.preventDefault(),this.table.modules.history.redo()))},copyToClipboard:function(r){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}};class En extends He{constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,t={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(t,En.bindings),Object.assign(t,e),this.mapBindings(t),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let t in e)En.actions[t]?e[t]&&(typeof e[t]!="object"&&(e[t]=[e[t]]),e[t].forEach(i=>{var n=Array.isArray(i)?i:[i];n.forEach(s=>{this.mapBinding(t,s)})})):console.warn("Key Binding Error - no such action:",t)}mapBinding(e,t){var i={action:En.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},n=t.toString().toLowerCase().split(" ").join("").split("+");n.forEach(s=>{switch(s){case"ctrl":i.ctrl=!0;break;case"shift":i.shift=!0;break;case"meta":i.meta=!0;break;default:s=isNaN(s)?s.toUpperCase().charCodeAt(0):parseInt(s),i.keys.push(s),this.watchKeys[s]||(this.watchKeys[s]=[]),this.watchKeys[s].push(i)}})}bindEvents(){var e=this;this.keyupBinding=function(t){var i=t.keyCode,n=e.watchKeys[i];n&&(e.pressedKeys.push(i),n.forEach(function(s){e.checkBinding(t,s)}))},this.keydownBinding=function(t){var i=t.keyCode,n=e.watchKeys[i];if(n){var s=e.pressedKeys.indexOf(i);s>-1&&e.pressedKeys.splice(s,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,t){var i=!0;return e.ctrlKey==t.ctrl&&e.shiftKey==t.shift&&e.metaKey==t.meta?(t.keys.forEach(n=>{var s=this.pressedKeys.indexOf(n);s==-1&&(i=!1)}),i&&t.action.call(this,e),!0):!1}}En.moduleName="keybindings";En.bindings=dT;En.actions=fT;class wp extends He{constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("menuContainer",void 0),this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){this.deprecationCheck("menuContainer","popupContainer")||(this.table.options.popupContainer=this.table.options.menuContainer)}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var t=e.definition;t.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),t.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),t.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),t.headerMenu&&this.initializeColumnHeaderMenu(e),t.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),t.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),t.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var t=e.definition.headerMenuIcon,i;i=document.createElement("span"),i.classList.add("tabulator-header-popup-button"),t?(typeof t=="function"&&(t=t(e.getComponent())),t instanceof HTMLElement?i.appendChild(t):i.innerHTML=t):i.innerHTML="&vellip;",i.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,n,e)}),e.titleElement.insertBefore(i,e.titleElement.firstChild)}loadMenuTableCellEvent(e,t,i){i._cell&&(i=i._cell),i.column.definition[e]&&this.loadMenuEvent(i.column.definition[e],t,i)}loadMenuTableColumnEvent(e,t,i){i._column&&(i=i._column),i.definition[e]&&this.loadMenuEvent(i.definition[e],t,i)}loadMenuEvent(e,t,i){i._group?i=i._group:i._row&&(i=i._row),e=typeof e=="function"?e.call(this.table,t,i.getComponent()):e,this.loadMenu(t,i,e)}loadMenu(e,t,i,n,s){var o=!(e instanceof MouseEvent),a=document.createElement("div"),l;if(a.classList.add("tabulator-menu"),o||e.preventDefault(),!(!i||!i.length)){if(n)l=s.child(a);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(a)}i.forEach(u=>{var f=document.createElement("div"),m=u.label,_=u.disabled;u.separator?f.classList.add("tabulator-menu-separator"):(f.classList.add("tabulator-menu-item"),typeof m=="function"&&(m=m.call(this.table,t.getComponent())),m instanceof Node?f.appendChild(m):f.innerHTML=m,typeof _=="function"&&(_=_.call(this.table,t.getComponent())),_?(f.classList.add("tabulator-menu-item-disabled"),f.addEventListener("click",C=>{C.stopPropagation()})):u.menu&&u.menu.length?f.addEventListener("click",C=>{C.stopPropagation(),this.loadMenu(C,t,u.menu,f,l)}):u.action&&f.addEventListener("click",C=>{u.action(C,t.getComponent())}),u.menu&&u.menu.length&&f.classList.add("tabulator-menu-item-submenu")),a.appendChild(f)}),a.addEventListener("click",u=>{this.rootPopup&&this.rootPopup.hide()}),l.show(n||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=t,this.dispatchExternal("menuOpened",t.getComponent()))}}}wp.moduleName="menu";class Cp extends He{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){var t=this,i={},n;!e.modules.frozen&&!e.isGroup&&(n=e.getElement(),i.mousemove=function(s){e.parent===t.moving.parent&&((t.touchMove?s.touches[0].pageX:s.pageX)-mt.elOffset(n).left+t.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(t.toCol!==e||!t.toColAfter)&&(n.parentNode.insertBefore(t.placeholderElement,n.nextSibling),t.moveColumn(e,!0)):(t.toCol!==e||t.toColAfter)&&(n.parentNode.insertBefore(t.placeholderElement,n),t.moveColumn(e,!1)))}.bind(t),n.addEventListener("mousedown",function(s){t.touchMove=!1,s.which===1&&(t.checkTimeout=setTimeout(function(){t.startMove(s,e)},t.checkPeriod))}),n.addEventListener("mouseup",function(s){s.which===1&&t.checkTimeout&&clearTimeout(t.checkTimeout)}),t.bindTouchEvents(e)),e.modules.moveColumn=i}bindTouchEvents(e){var t=e.getElement(),i=!1,n,s,o,a,l,u;t.addEventListener("touchstart",f=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextColumn(),o=n?n.getWidth()/2:0,s=e.prevColumn(),a=s?s.getWidth()/2:0,l=0,u=0,i=!1,this.startMove(f,e)},this.checkPeriod)},{passive:!0}),t.addEventListener("touchmove",f=>{var m,_;this.moving&&(this.moveHover(f),i||(i=f.touches[0].pageX),m=f.touches[0].pageX-i,m>0?n&&m-l>o&&(_=n,_!==e&&(i=f.touches[0].pageX,_.getElement().parentNode.insertBefore(this.placeholderElement,_.getElement().nextSibling),this.moveColumn(_,!0))):s&&-m-u>a&&(_=s,_!==e&&(i=f.touches[0].pageX,_.getElement().parentNode.insertBefore(this.placeholderElement,_.getElement()),this.moveColumn(_,!1))),_&&(n=_.nextColumn(),l=o,o=n?n.getWidth()/2:0,s=_.prevColumn(),u=a,a=s?s.getWidth()/2:0))},{passive:!0}),t.addEventListener("touchend",f=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(f)})}startMove(e,t){var i=t.getElement(),n=this.table.columnManager.getContentsElement(),s=this.table.columnManager.getHeadersElement();this.moving=t,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-mt.elOffset(i).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=t.getWidth()+"px",this.placeholderElement.style.height=t.getHeight()+"px",i.parentNode.insertBefore(this.placeholderElement,i),i.parentNode.removeChild(i),this.hoverElement=i.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),n.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=n.clientHeight-s.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e)}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,t){var i=this.moving.getCells();this.toCol=e,this.toColAfter=t,t?e.getCells().forEach(function(n,s){var o=n.getElement(!0);o.parentNode&&i[s]&&o.parentNode.insertBefore(i[s].getElement(),o.nextSibling)}):e.getCells().forEach(function(n,s){var o=n.getElement(!0);o.parentNode&&i[s]&&o.parentNode.insertBefore(i[s].getElement(),o)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var t=this.table.columnManager.getContentsElement(),i=t.scrollLeft,n=(this.touchMove?e.touches[0].pageX:e.pageX)-mt.elOffset(t).left+i,s;this.hoverElement.style.left=n-this.startX+"px",n-i<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{s=Math.max(0,i-5),this.table.rowManager.getElement().scrollLeft=s,this.autoScrollTimeout=!1},1))),i+t.clientWidth-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{s=Math.min(t.clientWidth,i+5),this.table.rowManager.getElement().scrollLeft=s,this.autoScrollTimeout=!1},1)))}}Cp.moduleName="moveColumn";class qa extends He{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var t=this,i={};i.mouseup=function(n){t.tableRowDrop(n,e)}.bind(t),i.mousemove=function(n){var s;n.pageY-mt.elOffset(e.element).top+t.table.rowManager.element.scrollTop>e.getHeight()/2?(t.toRow!==e||!t.toRowAfter)&&(s=e.getElement(),s.parentNode.insertBefore(t.placeholderElement,s.nextSibling),t.moveRow(e,!0)):(t.toRow!==e||t.toRowAfter)&&(s=e.getElement(),s.previousSibling&&(s.parentNode.insertBefore(t.placeholderElement,s),t.moveRow(e,!1)))}.bind(t),e.modules.moveRow=i}initializeRow(e){var t=this,i={},n;i.mouseup=function(s){t.tableRowDrop(s,e)}.bind(t),i.mousemove=function(s){var o=e.getElement();s.pageY-mt.elOffset(o).top+t.table.rowManager.element.scrollTop>e.getHeight()/2?(t.toRow!==e||!t.toRowAfter)&&(o.parentNode.insertBefore(t.placeholderElement,o.nextSibling),t.moveRow(e,!0)):(t.toRow!==e||t.toRowAfter)&&(o.parentNode.insertBefore(t.placeholderElement,o),t.moveRow(e,!1))}.bind(t),this.hasHandle||(n=e.getElement(),n.addEventListener("mousedown",function(s){s.which===1&&(t.checkTimeout=setTimeout(function(){t.startMove(s,e)},t.checkPeriod))}),n.addEventListener("mouseup",function(s){s.which===1&&t.checkTimeout&&clearTimeout(t.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=i}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var t=this,i=e.getElement(!0);i.addEventListener("mousedown",function(n){n.which===1&&(t.checkTimeout=setTimeout(function(){t.startMove(n,e.row)},t.checkPeriod))}),i.addEventListener("mouseup",function(n){n.which===1&&t.checkTimeout&&clearTimeout(t.checkTimeout)}),this.bindTouchEvents(e.row,i)}}bindTouchEvents(e,t){var i=!1,n,s,o,a,l,u;t.addEventListener("touchstart",f=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextRow(),o=n?n.getHeight()/2:0,s=e.prevRow(),a=s?s.getHeight()/2:0,l=0,u=0,i=!1,this.startMove(f,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,t.addEventListener("touchmove",f=>{var m,_;this.moving&&(f.preventDefault(),this.moveHover(f),i||(i=f.touches[0].pageY),m=f.touches[0].pageY-i,m>0?n&&m-l>o&&(_=n,_!==e&&(i=f.touches[0].pageY,_.getElement().parentNode.insertBefore(this.placeholderElement,_.getElement().nextSibling),this.moveRow(_,!0))):s&&-m-u>a&&(_=s,_!==e&&(i=f.touches[0].pageY,_.getElement().parentNode.insertBefore(this.placeholderElement,_.getElement()),this.moveRow(_,!1))),_&&(n=_.nextRow(),l=o,o=n?n.getHeight()/2:0,s=_.prevRow(),u=a,a=s?s.getHeight()/2:0))}),t.addEventListener("touchend",f=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(f),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,t){var i=t.getElement();this.setStartPosition(e,t),this.moving=t,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=t.getWidth()+"px",this.placeholderElement.style.height=t.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(t)):(i.parentNode.insertBefore(this.placeholderElement,i),i.parentNode.removeChild(i)),this.hoverElement=i.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",t.getComponent()),this.moveHover(e)}setStartPosition(e,t){var i=this.touchMove?e.touches[0].pageX:e.pageX,n=this.touchMove?e.touches[0].pageY:e.pageY,s,o;s=t.getElement(),this.connection?(o=s.getBoundingClientRect(),this.startX=o.left-i+window.pageXOffset,this.startY=o.top-n+window.pageYOffset):this.startY=n-s.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,t){this.toRow=e,this.toRowAfter=t}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var t=this.table.rowManager.getElement(),i=t.scrollTop,n=(this.touchMove?e.touches[0].pageY:e.pageY)-t.getBoundingClientRect().top+i;this.hoverElement.style.top=Math.min(n-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,t,i){this.dispatchExternal("movableRowsElementDrop",e,t,i?i.getComponent():!1)}connectToTables(e){var t;this.connectionSelectorsTables&&(t=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",t),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(i=>{typeof i=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(i))):this.connectionElements.push(i)}),this.connectionElements.forEach(i=>{var n=s=>{this.elementRowDrop(s,i,this.moving)};i.addEventListener("mouseup",n),i.tabulatorElementDropEvent=n,i.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(t=>{t.classList.remove("tabulator-movingrow-receiving"),t.removeEventListener("mouseup",t.tabulatorElementDropEvent),delete t.tabulatorElementDropEvent})}connect(e,t){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=t,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().addEventListener("mouseup",i.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",t,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(t=>{t.type==="row"&&t.modules.moveRow&&t.modules.moveRow.mouseup&&t.getElement().removeEventListener("mouseup",t.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,t,i){var n=!1;if(i){switch(typeof this.table.options.movableRowsSender){case"string":n=this.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender;break}n?n.call(this,this.moving?this.moving.getComponent():void 0,t?t.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),t?t.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),t?t.getComponent():void 0,e);this.endMove()}tableRowDrop(e,t){var i=!1,n=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":i=this.receivers[this.table.options.movableRowsReceiver];break;case"function":i=this.table.options.movableRowsReceiver;break}i?n=i.call(this,this.connectedRow.getComponent(),t?t.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),t?t.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),t?t.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:t,success:n})}commsReceived(e,t,i){switch(t){case"connect":return this.connect(e,i.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,i.row,i.success)}}}qa.prototype.receivers={insert:function(r,e,t){return this.table.addRow(r.getData(),void 0,e),!0},add:function(r,e,t){return this.table.addRow(r.getData()),!0},update:function(r,e,t){return e?(e.update(r.getData()),!0):!1},replace:function(r,e,t){return e?(this.table.addRow(r.getData(),void 0,e),e.delete(),!0):!1}};qa.prototype.senders={delete:function(r,e,t){r.delete()}};qa.moduleName="moveRow";var gT={};class rr extends He{constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,t,i){return this.transformRow(t,"data",i)}initializeColumn(e){var t=!1,i={};this.allowedTypes.forEach(n=>{var s="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[s]&&(o=this.lookupMutator(e.definition[s]),o&&(t=!0,i[s]={mutator:o,params:e.definition[s+"Params"]||{}}))}),t&&(e.modules.mutate=i)}lookupMutator(e){var t=!1;switch(typeof e){case"string":rr.mutators[e]?t=rr.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":t=e;break}return t}transformRow(e,t,i){var n="mutator"+(t.charAt(0).toUpperCase()+t.slice(1)),s;return this.enabled&&this.table.columnManager.traverse(o=>{var a,l,u;o.modules.mutate&&(a=o.modules.mutate[n]||o.modules.mutate.mutator||!1,a&&(s=o.getFieldValue(typeof i<"u"?i:e),(t=="data"||typeof s<"u")&&(u=o.getComponent(),l=typeof a.params=="function"?a.params(s,e,t,u):a.params,o.setFieldValue(e,a.mutator(s,e,t,l,u)))))}),e}transformCell(e,t){if(e.column.modules.mutate){var i=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,n={};if(i)return n=Object.assign(n,e.row.getData()),e.column.setFieldValue(n,t),i.mutator(t,n,"edit",i.params,e.getComponent())}return t}mutateLink(e){var t=e.column.definition.mutateLink;t&&(Array.isArray(t)||(t=[t]),t.forEach(i=>{var n=e.row.getCell(i);n&&n.setValue(n.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}}rr.moduleName="mutator";rr.mutators=gT;function mT(r,e,t,i,n){var s=document.createElement("span"),o=document.createElement("span"),a=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),f=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",m=>{o.innerHTML=m}),this.table.modules.localize.langBind("pagination|counter|of",m=>{l.innerHTML=m}),this.table.modules.localize.langBind("pagination|counter|rows",m=>{f.innerHTML=m}),i?(a.innerHTML=" "+e+"-"+Math.min(e+r-1,i)+" ",u.innerHTML=" "+i+" ",s.appendChild(o),s.appendChild(a),s.appendChild(l),s.appendChild(u),s.appendChild(f)):(a.innerHTML=" 0 ",s.appendChild(o),s.appendChild(a),s.appendChild(f)),s}function pT(r,e,t,i,n){var s=document.createElement("span"),o=document.createElement("span"),a=document.createElement("span"),l=document.createElement("span"),u=document.createElement("span"),f=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",m=>{o.innerHTML=m}),a.innerHTML=" "+t+" ",this.table.modules.localize.langBind("pagination|counter|of",m=>{l.innerHTML=m}),u.innerHTML=" "+n+" ",this.table.modules.localize.langBind("pagination|counter|pages",m=>{f.innerHTML=m}),s.appendChild(o),s.appendChild(a),s.appendChild(l),s.appendChild(u),s.appendChild(f),s}var bT={rows:mT,pages:pT};class bo extends He{constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,t){var i=this.table.rowManager,n=i.getDisplayRows(),s;return t?n.length?s=n[0]:i.activeRows.length&&(s=i.activeRows[i.activeRows.length-1],t=!1):n.length&&(s=n[n.length-1],t=!(n.length<this.size)),{index:s,top:t}}calculatePageSizes(){var e,t;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",t=document.createElement("div"),t.classList.add("tabulator-cell"),t.innerHTML="Page Row Test",e.appendChild(t),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,t,i,n){return this.initialLoad||(this.progressiveLoad&&!i||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),n.page=this.page,this.size&&(n.size=this.size),n}userSetPageToRow(e){return this.table.options.pagination&&(e=this.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,t){var i,n,s;!t&&!this.table.dataLoader.loading&&(i=this.table.rowManager.getElement(),n=i.scrollHeight-i.clientHeight-e,s=this.table.options.progressiveLoadScrollMargin||i.clientHeight*2,n<s&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,t){return t||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let t=1;t<5;t++)e.push(this.size*t);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(t=>{var i=document.createElement("option");i.value=t,t===!0?this.langBind("pagination|all",function(n){i.innerHTML=n}):i.innerHTML=t,this.pageSizeSelect.appendChild(i)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,t=null;e&&(typeof e=="function"?t=e:t=bo.pageCounters[e],t?(this.pageCounter=t,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var t,i;e||(this.langBind("pagination|first",n=>{this.firstBut.innerHTML=n}),this.langBind("pagination|first_title",n=>{this.firstBut.setAttribute("aria-label",n),this.firstBut.setAttribute("title",n)}),this.langBind("pagination|prev",n=>{this.prevBut.innerHTML=n}),this.langBind("pagination|prev_title",n=>{this.prevBut.setAttribute("aria-label",n),this.prevBut.setAttribute("title",n)}),this.langBind("pagination|next",n=>{this.nextBut.innerHTML=n}),this.langBind("pagination|next_title",n=>{this.nextBut.setAttribute("aria-label",n),this.nextBut.setAttribute("title",n)}),this.langBind("pagination|last",n=>{this.lastBut.innerHTML=n}),this.langBind("pagination|last_title",n=>{this.lastBut.setAttribute("aria-label",n),this.lastBut.setAttribute("title",n)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(t=document.createElement("label"),this.langBind("pagination|page_size",n=>{this.pageSizeSelect.setAttribute("aria-label",n),this.pageSizeSelect.setAttribute("title",n),t.innerHTML=n}),this.element.appendChild(t),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",n=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(i=document.querySelector(this.table.options.paginationCounterElement),i?i.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var t=this.displayRows(-1),i=t.indexOf(e);if(i>-1){var n=this.size===!0?1:Math.ceil((i+1)/this.size);return this.setPage(n)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,t,i){var n;if(this.pageCounter)switch(this.mode==="remote"&&(t=this.size,i=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),n=this.pageCounter.call(this,t,i,this.page,e,this.max),typeof n){case"object":if(n instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(n)}else this.pageCounterElement.innerHTML="",n!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",n);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=n}}_setPageButtons(){let e=Math.floor((this.count-1)/2),t=Math.ceil((this.count-1)/2),i=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),n=this.page<=t?Math.min(this.count,this.max):Math.min(this.page+t,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let s=i;s<=n;s++)s>0&&s<=this.max&&this.pagesElement.appendChild(this._generatePageButton(s));this.footerRedraw()}_generatePageButton(e){var t=document.createElement("button");return t.classList.add("tabulator-page"),e==this.page&&t.classList.add("active"),t.setAttribute("type","button"),t.setAttribute("role","button"),this.langBind("pagination|page_title",i=>{t.setAttribute("aria-label",i+" "+e),t.setAttribute("title",i+" "+e)}),t.setAttribute("data-page",e),t.textContent=e,t.addEventListener("click",i=>{this.setPage(e)}),t}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var t=0,i,n,s,o,a=e.filter(l=>l.type==="row");if(this.mode=="local"){i=[],this.setMaxRows(e.length),this.size===!0?(n=0,s=e.length):(n=this.size*(this.page-1),s=n+parseInt(this.size)),this._setPageButtons();for(let l=n;l<s;l++){let u=e[l];u&&(i.push(u),u.type==="row"&&(o||(o=u),t++))}return this._setPageCounter(a.length,t,o?a.indexOf(o)+1:0),i}else return this._setPageButtons(),this._setPageCounter(a.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var t;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),t=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+t&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else this.dispatchExternal("pageLoaded",this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}}bo.moduleName="page";bo.pageCounters=bT;var _T={local:function(r,e){var t=localStorage.getItem(r+"-"+e);return t?JSON.parse(t):!1},cookie:function(r,e){var t=document.cookie,i=r+"-"+e,n=t.indexOf(i+"="),s,o;return n>-1&&(t=t.slice(n),s=t.indexOf(";"),s>-1&&(t=t.slice(0,s)),o=t.replace(i+"=","")),o?JSON.parse(o):!1}},yT={local:function(r,e,t){localStorage.setItem(r+"-"+e,JSON.stringify(t))},cookie:function(r,e,t){var i=new Date;i.setDate(i.getDate()+1e4),document.cookie=r+"-"+e+"="+JSON.stringify(t)+"; expires="+i.toUTCString()}};class ri extends He{constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,t=this.table.options.persistenceID,i;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:ri.readers[this.table.options.persistenceReaderFunc]?this.readFunc=ri.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):ri.readers[this.mode]?this.readFunc=ri.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:ri.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=ri.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):ri.writers[this.mode]?this.writeFunc=ri.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(t||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(i=this.retrieveData("page"),i&&(typeof i.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=i.paginationSize),typeof i.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=i.paginationInitialPage))),this.config.group&&(i=this.retrieveData("group"),i&&(typeof i.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=i.groupBy),typeof i.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=i.groupStartOpen),typeof i.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=i.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,t;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(t=this.load("filter"),t&&(this.table.options.initialFilter=t))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e)),!0}initializeColumn(e){var t,i;this.config.columns&&(this.defWatcherBlock=!0,t=e.getDefinition(),i=this.config.columns===!0?Object.keys(t):this.config.columns,i.forEach(n=>{var s=Object.getOwnPropertyDescriptor(t,n),o=t[n];s&&Object.defineProperty(t,n,{set:a=>{o=a,this.defWatcherBlock||this.save("columns"),s.set&&s.set(a)},get:()=>(s.get&&s.get(),o)})}),this.defWatcherBlock=!1)}load(e,t){var i=this.retrieveData(e);return t&&(i=i?this.mergeDefinition(t,i):t),i}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,t){var i=[];return t=t||[],t.forEach((n,s)=>{var o=this._findColumn(e,n),a;o&&(this.config.columns===!0||this.config.columns==null?(a=Object.keys(o),a.push("width")):a=this.config.columns,a.forEach(l=>{l!=="columns"&&typeof n[l]<"u"&&(o[l]=n[l])}),o.columns&&(o.columns=this.mergeDefinition(o.columns,n.columns)),i.push(o))}),e.forEach((n,s)=>{var o=this._findColumn(t,n);o||(i.length>s?i.splice(s,0,n):i.push(n))}),i}_findColumn(e,t){var i=t.columns?"group":t.field?"field":"object";return e.find(function(n){switch(i){case"group":return n.title===t.title&&n.columns.length===t.columns.length;case"field":return n.field===t.field;case"object":return n===t}})}save(e){var t={};switch(e){case"columns":t=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":t=this.table.modules.filter.getFilters();break;case"sort":t=this.validateSorters(this.table.modules.sort.getSort());break;case"group":t=this.getGroupConfig();break;case"page":t=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,t)}validateSorters(e){return e.forEach(function(t){t.column=t.field,delete t.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var t=[],i=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(n=>{var s={},o=n.getDefinition(),a;n.isGroup?(s.title=o.title,s.columns=this.parseColumns(n.getColumns())):(s.field=n.getField(),this.config.columns===!0||this.config.columns==null?(a=Object.keys(o),a.push("width"),a.push("visible")):a=this.config.columns,a.forEach(l=>{switch(l){case"width":s.width=n.getWidth();break;case"visible":s.visible=n.visible;break;default:typeof o[l]!="function"&&i.indexOf(l)===-1&&(s[l]=o[l])}})),t.push(s)}),t}}ri.moduleName="persistence";ri.moduleInitOrder=-10;ri.readers=_T;ri.writers=yT;class xp extends He{constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,t,i){this.loadPopupEvent(t,null,e,i)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var t=e.definition;t.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),t.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),t.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),t.headerPopup&&this.initializeColumnHeaderPopup(e),t.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),t.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),t.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var t=e.definition.headerPopupIcon,i;i=document.createElement("span"),i.classList.add("tabulator-header-popup-button"),t?(typeof t=="function"&&(t=t(e.getComponent())),t instanceof HTMLElement?i.appendChild(t):i.innerHTML=t):i.innerHTML="&vellip;",i.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,n,e)}),e.titleElement.insertBefore(i,e.titleElement.firstChild)}loadPopupTableCellEvent(e,t,i){i._cell&&(i=i._cell),i.column.definition[e]&&this.loadPopupEvent(i.column.definition[e],t,i)}loadPopupTableColumnEvent(e,t,i){i._column&&(i=i._column),i.definition[e]&&this.loadPopupEvent(i.definition[e],t,i)}loadPopupEvent(e,t,i,n){var s;function o(a){s=a}i._group?i=i._group:i._row&&(i=i._row),e=typeof e=="function"?e.call(this.table,t,i.getComponent(),o):e,this.loadPopup(t,i,e,s,n)}loadPopup(e,t,i,n,s){var o=!(e instanceof MouseEvent),a,l;i instanceof HTMLElement?a=i:(a=document.createElement("div"),a.innerHTML=i),a.classList.add("tabulator-popup"),a.addEventListener("click",u=>{u.stopPropagation()}),o||e.preventDefault(),l=this.popup(a),typeof n=="function"&&l.renderCallback(n),e?l.show(e):l.show(t.getElement(),s||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",t.getComponent())}),this.dispatchExternal("popupOpened",t.getComponent())}}xp.moduleName="popup";class Tp extends He{constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(window.addEventListener("beforeprint",this.replaceTable.bind(this)),window.addEventListener("afterprint",this.cleanup.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,t,i){var n=window.scrollX,s=window.scrollY,o=document.createElement("div"),a=document.createElement("div"),l=this.table.modules.export.generateTable(typeof i<"u"?i:this.table.options.printConfig,typeof t<"u"?t:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),u,f;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(o.classList.add("tabulator-print-header"),u=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof u=="string"?o.innerHTML=u:o.appendChild(u),this.element.appendChild(o)),this.element.appendChild(l),this.table.options.printFooter&&(a.classList.add("tabulator-print-footer"),f=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof f=="string"?a.innerHTML=f:a.appendChild(f),this.element.appendChild(a)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(n,s),this.manualBlock=!1}}Tp.moduleName="print";class Rp extends He{constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var t=this,i;this.currentVersion++,i=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),s;return!t.blocked&&i===t.currentVersion&&(t.block("data-push"),n.forEach(o=>{t.table.rowManager.addRowActual(o,!1)}),s=t.origFuncs.push.apply(e,arguments),t.unblock("data-push")),s}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),s;return!t.blocked&&i===t.currentVersion&&(t.block("data-unshift"),n.forEach(o=>{t.table.rowManager.addRowActual(o,!0)}),s=t.origFuncs.unshift.apply(e,arguments),t.unblock("data-unshift")),s}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var n,s;return!t.blocked&&i===t.currentVersion&&(t.block("data-shift"),t.data.length&&(n=t.table.rowManager.getRowFromDataObject(t.data[0]),n&&n.deleteActual()),s=t.origFuncs.shift.call(e),t.unblock("data-shift")),s}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var n,s;return!t.blocked&&i===t.currentVersion&&(t.block("data-pop"),t.data.length&&(n=t.table.rowManager.getRowFromDataObject(t.data[t.data.length-1]),n&&n.deleteActual()),s=t.origFuncs.pop.call(e),t.unblock("data-pop")),s}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),s=n[0]<0?e.length+n[0]:n[0],o=n[1],a=n[2]?n.slice(2):!1,l,u;if(!t.blocked&&i===t.currentVersion){if(t.block("data-splice"),a&&(l=e[s]?t.table.rowManager.getRowFromDataObject(e[s]):!1,l?a.forEach(m=>{t.table.rowManager.addRowActual(m,!0,l,!0)}):(a=a.slice().reverse(),a.forEach(m=>{t.table.rowManager.addRowActual(m,!0,!1,!0)}))),o!==0){var f=e.slice(s,typeof n[1]>"u"?n[1]:s+o);f.forEach((m,_)=>{var C=t.table.rowManager.getRowFromDataObject(m);C&&C.deleteActual(_!==f.length-1)})}(a||o!==0)&&t.table.rowManager.reRenderInPosition(),u=t.origFuncs.splice.apply(e,arguments),t.unblock("data-splice")}return u}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var t=e.getData();for(var i in t)this.watchKey(e,t,i);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var t=this,i=e.getData()[this.table.options.dataTreeChildField],n={};i&&(n.push=i.push,Object.defineProperty(i,"push",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-push");var s=n.push.apply(i,arguments);this.rebuildTree(e),t.unblock("tree-push")}return s}}),n.unshift=i.unshift,Object.defineProperty(i,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-unshift");var s=n.unshift.apply(i,arguments);this.rebuildTree(e),t.unblock("tree-unshift")}return s}}),n.shift=i.shift,Object.defineProperty(i,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-shift");var s=n.shift.call(i);this.rebuildTree(e),t.unblock("tree-shift")}return s}}),n.pop=i.pop,Object.defineProperty(i,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-pop");var s=n.pop.call(i);this.rebuildTree(e),t.unblock("tree-pop")}return s}}),n.splice=i.splice,Object.defineProperty(i,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-splice");var s=n.splice.apply(i,arguments);this.rebuildTree(e),t.unblock("tree-splice")}return s}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,t,i){var n=this,s=Object.getOwnPropertyDescriptor(t,i),o=t[i],a=this.currentVersion;Object.defineProperty(t,i,{set:l=>{if(o=l,!n.blocked&&a===n.currentVersion){n.block("key");var u={};u[i]=l,e.updateData(u),n.unblock("key")}s.set&&s.set(l)},get:()=>(s.get&&s.get(),o)})}unwatchRow(e){var t=e.getData();for(var i in t)Object.defineProperty(t,i,{value:t[i]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}Rp.moduleName="reactiveData";class Sp extends He{constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var t=e.prevColumn();this.reinitializeColumn(e),t&&this.reinitializeColumn(t)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(t=>{this.reinitializeColumn(t)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(t=>{this.reinitializeColumn(t)}))}frozenColumnOffset(e){var t=!1;return e.modules.frozen&&(t=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?t+=e.getWidth()-3:t&&(t-=3)),t!==!1?t+"px":!1}reinitializeColumn(e){var t=this.frozenColumnOffset(e);e.cells.forEach(i=>{i.modules.resize&&i.modules.resize.handleEl&&(t&&(i.modules.resize.handleEl.style[e.modules.frozen.position]=t),i.element.after(i.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(t&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=t),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,t,i,n){var s=this,o=!1,a=i.definition.resizable,l={},u=i.getLastColumn();if(e==="header"&&(o=i.definition.formatter=="textarea"||i.definition.variableHeight,l={variableHeight:o}),(a===!0||a==e)&&this._checkResizability(u)){var f=document.createElement("span");f.className="tabulator-col-resize-handle",f.addEventListener("click",function(_){_.stopPropagation()});var m=function(_){s.startColumn=i,s.initialNextColumn=s.nextColumn=u.nextColumn(),s._mouseDown(_,u,f)};f.addEventListener("mousedown",m),f.addEventListener("touchstart",m,{passive:!0}),f.addEventListener("dblclick",_=>{var C=u.getWidth();_.stopPropagation(),u.reinitializeWidth(!0),C!==u.getWidth()&&(s.dispatch("column-resized",u),s.table.externalEvents.dispatch("columnResized",u.getComponent()))}),i.modules.frozen&&(f.style.position="sticky",f.style[i.modules.frozen.position]=this.frozenColumnOffset(i)),l.handleEl=f,n.parentNode&&i.visible&&n.after(f)}t.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(t=>{this.deInitializeComponent(t)})}deInitializeComponent(e){var t;e.modules.resize&&(t=e.modules.resize.handleEl,t&&t.parentElement&&t.parentElement.removeChild(t))}resizeHandle(e,t){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=t)}_checkResizability(e){return e.definition.resizable}_mouseDown(e,t,i){var n=this;n.table.element.classList.add("tabulator-block-select");function s(a){var l=typeof a.screenX>"u"?a.touches[0].screenX:a.screenX,u=l-n.startX,f=l-n.latestX,m,_;if(n.latestX=l,n.table.rtl&&(u=-u,f=-f),m=t.width==t.minWidth||t.width==t.maxWidth,t.setWidth(n.startWidth+u),_=t.width==t.minWidth||t.width==t.maxWidth,f<0&&(n.nextColumn=n.initialNextColumn),n.table.options.resizableColumnFit&&n.nextColumn&&!(m&&_)){let C=n.nextColumn.getWidth();f>0&&C<=n.nextColumn.minWidth&&(n.nextColumn=n.nextColumn.nextColumn()),n.nextColumn&&n.nextColumn.setWidth(n.nextColumn.getWidth()-f)}n.table.columnManager.rerenderColumns(!0),!n.table.browserSlow&&t.modules.resize&&t.modules.resize.variableHeight&&t.checkCellHeights()}function o(a){n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!1),n.table.browserSlow&&t.modules.resize&&t.modules.resize.variableHeight&&t.checkCellHeights(),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",s),i.removeEventListener("touchmove",s),i.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.startWidth!==t.getWidth()&&(n.table.columnManager.verticalAlignHeaders(),n.dispatch("column-resized",t),n.table.externalEvents.dispatch("columnResized",t.getComponent()))}e.stopPropagation(),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!0),n.startX=typeof e.screenX>"u"?e.touches[0].screenX:e.screenX,n.latestX=n.startX,n.startWidth=t.getWidth(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),i.addEventListener("touchmove",s,{passive:!0}),i.addEventListener("touchend",o)}}Sp.moduleName="resizeColumns";class Lp extends He{constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var t=this,i=e.getElement(),n=document.createElement("div");n.className="tabulator-row-resize-handle";var s=document.createElement("div");s.className="tabulator-row-resize-handle prev",n.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){t.startRow=e,t._mouseDown(l,e,n)};n.addEventListener("mousedown",o),n.addEventListener("touchstart",o,{passive:!0}),s.addEventListener("click",function(l){l.stopPropagation()});var a=function(l){var u=t.table.rowManager.prevDisplayRow(e);u&&(t.startRow=u,t._mouseDown(l,u,s))};s.addEventListener("mousedown",a),s.addEventListener("touchstart",a,{passive:!0}),i.appendChild(n),i.appendChild(s)}_mouseDown(e,t,i){var n=this;n.table.element.classList.add("tabulator-block-select");function s(a){t.setHeight(n.startHeight+((typeof a.screenY>"u"?a.touches[0].screenY:a.screenY)-n.startY))}function o(a){document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",s),i.removeEventListener("touchmove",s),i.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.dispatchExternal("rowResized",t.getComponent())}e.stopPropagation(),n.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,n.startHeight=t.getHeight(),document.body.addEventListener("mousemove",s),document.body.addEventListener("mouseup",o),i.addEventListener("touchmove",s,{passive:!0}),i.addEventListener("touchend",o)}}Lp.moduleName="resizeRows";class Dp extends He{constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,t;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(i=>{if(!e.browserMobile||e.browserMobile&&!e.modules.edit.currentCell){var n=Math.floor(i[0].contentRect.height),s=Math.floor(i[0].contentRect.width);(this.tableHeight!=n||this.tableWidth!=s)&&(this.tableHeight=n,this.tableWidth=s,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),t=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(t.getPropertyValue("max-height")||t.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(i=>{if(!e.browserMobile||e.browserMobile&&!e.modules.edit.currentCell){var n=Math.floor(i[0].contentRect.height),s=Math.floor(i[0].contentRect.width);(this.containerHeight!=n||this.containerWidth!=s)&&(this.containerHeight=n,this.containerWidth=s,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&!e.modules.edit.currentCell)&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}Dp.moduleName="resizeTable";class Ap extends He{constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.table.columnManager.columnsByIndex.forEach((t,i)=>{t.modules.responsive&&t.modules.responsive.order&&t.modules.responsive.visible&&(t.modules.responsive.index=i,e.push(t),!t.visible&&this.mode==="collapse"&&this.hiddenColumns.push(t))}),e=e.reverse(),e=e.sort((t,i)=>{var n=i.modules.responsive.order-t.modules.responsive.order;return n||i.modules.responsive.index-t.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let t of this.table.columnManager.columnsByIndex)if(t.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=t;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var t=e.getDefinition();e.modules.responsive={order:typeof t.responsive>"u"?1:t.responsive,visible:t.visible!==!1}}initializeRow(e){var t;e.type!=="calc"&&(t=document.createElement("div"),t.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:t,open:this.collapseStartOpen},this.collapseStartOpen||(t.style.display="none"))}layoutRow(e){var t=e.getElement();e.modules.responsiveLayout&&(t.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,t){!t&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var t=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!t&&this.collapseHandleColumn.show())}showColumn(e){var t;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(t=this.hiddenColumns.indexOf(e),t>-1&&this.hiddenColumns.splice(t,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let t=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),i=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-t;if(i<0){let n=this.columns[this.index];n?(this.hideColumn(n),this.index++):e=!1}else{let n=this.columns[this.index-1];n&&i>0&&i>=n.getWidth()?(this.showColumn(n),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(t=>{this.generateCollapsedRowContent(t)})}generateCollapsedRowContent(e){var t,i;if(e.modules.responsiveLayout){for(t=e.modules.responsiveLayout.element;t.firstChild;)t.removeChild(t.firstChild);i=this.collapseFormatter(this.generateCollapsedRowData(e)),i&&t.appendChild(i)}}generateCollapsedRowData(e){var t=e.getData(),i=[],n;return this.hiddenColumns.forEach(s=>{var o=s.getFieldValue(t);if(s.definition.title&&s.field)if(s.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let a=function(l){l()};n={value:!1,data:{},getValue:function(){return o},getData:function(){return t},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return s.getComponent()},getTable:()=>this.table},i.push({field:s.field,title:s.definition.title,value:s.modules.format.formatter.call(this.table.modules.format,n,s.modules.format.params,a)})}else i.push({field:s.field,title:s.definition.title,value:o})}),i}formatCollapsedData(e){var t=document.createElement("table");return e.forEach(function(i){var n=document.createElement("tr"),s=document.createElement("td"),o=document.createElement("td"),a,l=document.createElement("strong");s.appendChild(l),this.langBind("columns|"+i.field,function(u){l.innerHTML=u||i.title}),i.value instanceof Node?(a=document.createElement("div"),a.appendChild(i.value),o.appendChild(a)):o.innerHTML=i.value,n.appendChild(s),n.appendChild(o),t.appendChild(n)},this),Object.keys(e).length?t:""}}Ap.moduleName="responsiveLayout";class Mp extends He{constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectable","highlight"),this.registerTableOption("selectableRangeMode","drag"),this.registerTableOption("selectableRollingSelection",!0),this.registerTableOption("selectablePersistence",!0),this.registerTableOption("selectableCheck",function(t,i){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.table.options.selectable!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectable&&!this.table.options.selectablePersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}rowRetrieve(e,t){return e==="selected"?this.selectedRows:t}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],e!==!0&&this._rowSelectionChanged()}initializeRow(e){var t=this,i=e.getElement(),n=function(){setTimeout(function(){t.selecting=!1},50),document.body.removeEventListener("mouseup",n)};e.modules.select={selected:!1},t.table.options.selectableCheck.call(this.table,e.getComponent())?(i.classList.add("tabulator-selectable"),i.classList.remove("tabulator-unselectable"),t.table.options.selectable&&t.table.options.selectable!="highlight"&&(t.table.options.selectableRangeMode==="click"?i.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(i.addEventListener("click",function(s){(!t.table.modExists("edit")||!t.table.modules.edit.getCurrentCell())&&t.table._clearSelection(),t.selecting||t.toggleRow(e)}),i.addEventListener("mousedown",function(s){if(s.shiftKey)return t.table._clearSelection(),t.selecting=!0,t.selectPrev=[],document.body.addEventListener("mouseup",n),document.body.addEventListener("keyup",n),t.toggleRow(e),!1}),i.addEventListener("mouseenter",function(s){t.selecting&&(t.table._clearSelection(),t.toggleRow(e),t.selectPrev[1]==e&&t.toggleRow(t.selectPrev[0]))}),i.addEventListener("mouseout",function(s){t.selecting&&(t.table._clearSelection(),t.selectPrev.unshift(e))})))):(i.classList.add("tabulator-unselectable"),i.classList.remove("tabulator-selectable"))}handleComplexRowClick(e,t){if(t.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var i=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),n=this.table.rowManager.getDisplayRowIndex(e),s=i<=n?i:n,o=i>=n?i:n,a=this.table.rowManager.getDisplayRows().slice(0),l=a.splice(s,o-s+1);t.ctrlKey||t.metaKey?(l.forEach(u=>{u!==this.lastClickedRow&&(this.table.options.selectable!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectable&&this.toggleRow(u):this.toggleRow(u))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectable!==!0&&l.length>this.table.options.selectable&&(l=l.slice(0,this.table.options.selectable)),this.selectRows(l)),this.table._clearSelection()}else t.ctrlKey||t.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}toggleRow(e){this.table.options.selectableCheck.call(this.table,e.getComponent())&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var t;switch(typeof e){case"undefined":this.table.rowManager.rows.forEach(i=>{this._selectRow(i,!0,!0)}),this._rowSelectionChanged();break;case"string":t=this.table.rowManager.findRow(e),t?(this._selectRow(t,!0,!0),this._rowSelectionChanged()):(t=this.table.rowManager.getRows(e),t.forEach(i=>{this._selectRow(i,!0,!0)}),t.length&&this._rowSelectionChanged());break;default:Array.isArray(e)?(e.forEach(i=>{this._selectRow(i,!0,!0)}),this._rowSelectionChanged()):this._selectRow(e,!1,!0);break}}_selectRow(e,t,i){if(!isNaN(this.table.options.selectable)&&this.table.options.selectable!==!0&&!i&&this.selectedRows.length>=this.table.options.selectable)if(this.table.options.selectableRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var n=this.table.rowManager.findRow(e);n?this.selectedRows.indexOf(n)==-1&&(n.getElement().classList.add("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!0,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!0),this.selectedRows.push(n),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!0),this.dispatchExternal("rowSelected",n.getComponent()),this._rowSelectionChanged(t)):t||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,t){var i=this,n;if(typeof e>"u"){n=i.selectedRows.length;for(let s=0;s<n;s++)i._deselectRow(i.selectedRows[0],!0);n&&i._rowSelectionChanged(t)}else Array.isArray(e)?(e.forEach(function(s){i._deselectRow(s,!0)}),i._rowSelectionChanged(t)):i._deselectRow(e,t)}_deselectRow(e,t){var i=this,n=i.table.rowManager.findRow(e),s;n?(s=i.selectedRows.findIndex(function(o){return o==n}),s>-1&&(n.getElement().classList.remove("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!1,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!1),i.selectedRows.splice(s,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!1),this.dispatchExternal("rowDeselected",n.getComponent()),i._rowSelectionChanged(t))):t||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(t){e.push(t.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(t){e.push(t.getComponent())}),e}_rowSelectionChanged(e){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows())}registerRowSelectCheckbox(e,t){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=t}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,t){var i=this.table.modules.dataTree.getChildren(e,!0);if(t)for(let n of i)this._selectRow(n,!0);else for(let n of i)this._deselectRow(n,!0)}}Mp.moduleName="selectRow";function vT(r,e,t,i,n,s,o){var a=o.alignEmptyValues,l=o.decimalSeparator,u=o.thousandSeparator,f=0;if(r=String(r),e=String(e),u&&(r=r.split(u).join(""),e=e.split(u).join("")),l&&(r=r.split(l).join("."),e=e.split(l).join(".")),r=parseFloat(r),e=parseFloat(e),isNaN(r))f=isNaN(e)?0:-1;else if(isNaN(e))f=1;else return r-e;return(a==="top"&&s==="desc"||a==="bottom"&&s==="asc")&&(f*=-1),f}function ET(r,e,t,i,n,s,o){var a=o.alignEmptyValues,l=0,u;if(!r)l=e?-1:0;else if(!e)l=1;else{switch(typeof o.locale){case"boolean":o.locale&&(u=this.langLocale());break;case"string":u=o.locale;break}return String(r).toLowerCase().localeCompare(String(e).toLowerCase(),u)}return(a==="top"&&s==="desc"||a==="bottom"&&s==="asc")&&(l*=-1),l}function kc(r,e,t,i,n,s,o){var a=window.DateTime||luxon.DateTime,l=o.format||"dd/MM/yyyy HH:mm:ss",u=o.alignEmptyValues,f=0;if(typeof a<"u"){if(a.isDateTime(r)||(l==="iso"?r=a.fromISO(String(r)):r=a.fromFormat(String(r),l)),a.isDateTime(e)||(l==="iso"?e=a.fromISO(String(e)):e=a.fromFormat(String(e),l)),!r.isValid)f=e.isValid?-1:0;else if(!e.isValid)f=1;else return r-e;return(u==="top"&&s==="desc"||u==="bottom"&&s==="asc")&&(f*=-1),f}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function wT(r,e,t,i,n,s,o){return o.format||(o.format="dd/MM/yyyy"),kc.call(this,r,e,t,i,n,s,o)}function CT(r,e,t,i,n,s,o){return o.format||(o.format="HH:mm"),kc.call(this,r,e,t,i,n,s,o)}function xT(r,e,t,i,n,s,o){var a=r===!0||r==="true"||r==="True"||r===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return a-l}function TT(r,e,t,i,n,s,o){var a=o.type||"length",l=o.alignEmptyValues,u=0;function f(m){var _;switch(a){case"length":_=m.length;break;case"sum":_=m.reduce(function(C,R){return C+R});break;case"max":_=Math.max.apply(null,m);break;case"min":_=Math.min.apply(null,m);break;case"avg":_=m.reduce(function(C,R){return C+R})/m.length;break}return _}if(!Array.isArray(r))u=Array.isArray(e)?-1:0;else if(!Array.isArray(e))u=1;else return f(e)-f(r);return(l==="top"&&s==="desc"||l==="bottom"&&s==="asc")&&(u*=-1),u}function RT(r,e,t,i,n,s,o){var a=typeof r>"u"?0:1,l=typeof e>"u"?0:1;return a-l}function ST(r,e,t,i,n,s,o){var a,l,u,f,m=0,_,C=/(\d+)|(\D+)/g,R=/\d/,L=o.alignEmptyValues,A=0;if(!r&&r!==0)A=!e&&e!==0?0:-1;else if(!e&&e!==0)A=1;else{if(isFinite(r)&&isFinite(e))return r-e;if(a=String(r).toLowerCase(),l=String(e).toLowerCase(),a===l)return 0;if(!(R.test(a)&&R.test(l)))return a>l?1:-1;for(a=a.match(C),l=l.match(C),_=a.length>l.length?l.length:a.length;m<_;)if(u=a[m],f=l[m++],u!==f)return isFinite(u)&&isFinite(f)?(u.charAt(0)==="0"&&(u="."+u),f.charAt(0)==="0"&&(f="."+f),u-f):u>f?1:-1;return a.length>l.length}return(L==="top"&&s==="desc"||L==="bottom"&&s==="asc")&&(A*=-1),A}var LT={number:vT,string:ET,date:wT,time:CT,datetime:kc,boolean:xT,array:TT,exists:RT,alphanum:ST};class ss extends He{constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,t,i,n){var s=this.getSort();return s.forEach(o=>{delete o.column}),n.sort=s,n}userSetSort(e,t){this.setSort(e,t),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var t=!1,i,n;switch(typeof e.definition.sorter){case"string":ss.sorters[e.definition.sorter]?t=ss.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":t=e.definition.sorter;break}if(e.modules.sort={sorter:t,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(i=e.getElement(),i.classList.add("tabulator-sortable"),n=document.createElement("div"),n.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":n.classList.add("tabulator-col-sorter-element");break;case"header":i.classList.add("tabulator-col-sorter-element");break;default:i.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":n.appendChild(this.table.options.headerSortElement);break;default:n.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(n),e.modules.sort.element=n,this.setColumnHeaderSortIcon(e,"none"),(this.table.options.headerSortClickElement==="icon"?n:i).addEventListener("click",s=>{var o="",a=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?o=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?o=e.modules.sort.dir=="asc"?"desc":"asc":o="none";else switch(e.modules.sort.dir){case"asc":o="desc";break;case"desc":o="asc";break;default:o=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(s.shiftKey||s.ctrlKey)?(a=this.getSort(),l=a.findIndex(u=>u.field===e.getField()),l>-1?(a[l].dir=o,l=a.splice(l,1)[0],o!="none"&&a.push(l)):o!="none"&&a.push({column:e,dir:o}),this.setSort(a)):o=="none"?this.clear():this.setSort(e,o),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,t=[];return e.sortList.forEach(function(i){i.column&&t.push({column:i.column.getComponent(),field:i.column.getField(),dir:i.dir})}),t}setSort(e,t){var i=this,n=[];Array.isArray(e)||(e=[{column:e,dir:t}]),e.forEach(function(s){var o;o=i.table.columnManager.findColumn(s.column),o?(s.column=o,n.push(s),i.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",s.column)}),i.sortList=n,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var t=this.table.rowManager.activeRows[0],i="string",n,s;if(t&&(t=t.getData(),n=e.getField(),n))switch(s=e.getFieldValue(t),typeof s){case"undefined":i="string";break;case"boolean":i="boolean";break;default:!isNaN(s)&&s!==""?i="number":s.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(i="alphanum");break}return ss.sorters[i]}sort(e){var t=this,i=this.table.options.sortOrderReverse?t.sortList.slice().reverse():t.sortList,n=[],s=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",t.getSort()),t.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(i.forEach(function(o,a){var l;o.column&&(l=o.column.modules.sort,l&&(l.sorter||(l.sorter=t.findSorter(o.column)),o.params=typeof l.params=="function"?l.params(o.column.getComponent(),o.dir):l.params,n.push(o)),t.setColumnHeader(o.column,o.dir))}),n.length&&t._sortItems(e,n)):i.forEach(function(o,a){t.setColumnHeader(o.column,o.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(o=>{s.push(o.getComponent())}),this.dispatchExternal("dataSorted",t.getSort(),s)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,t){e.modules.sort.dir=t,e.getElement().setAttribute("aria-sort",t==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,t)}setColumnHeaderSortIcon(e,t){var i=e.modules.sort.element,n;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;i.firstChild;)i.removeChild(i.firstChild);n=this.table.options.headerSortElement.call(this.table,e.getComponent(),t),typeof n=="object"?i.appendChild(n):i.innerHTML=n}}_sortItems(e,t){var i=t.length-1;e.sort((n,s)=>{for(var o,a=i;a>=0;a--){let l=t[a];if(o=this._sortRow(n,s,l.column,l.dir,l.params),o!==0)break}return o})}_sortRow(e,t,i,n,s){var o,a,l=n=="asc"?e:t,u=n=="asc"?t:e;return e=i.getFieldValue(l.getData()),t=i.getFieldValue(u.getData()),e=typeof e<"u"?e:"",t=typeof t<"u"?t:"",o=l.getComponent(),a=u.getComponent(),i.modules.sort.sorter.call(this,e,t,o,a,i.getComponent(),n,s)}}ss.moduleName="sort";ss.sorters=LT;class Ip extends He{constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipGenerationMode",void 0),this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){this.deprecationCheckMsg("tooltipGenerationMode","This option is no longer needed as tooltips are always generated on hover now")}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,t,i){var n=e==="tooltip"?i.column.definition.tooltip:i.definition.headerTooltip;n&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,t,i,n),this.table.options.tooltipDelay))}mouseoutCheck(e,t,i){this.popupInstance||this.clearPopup()}clearPopup(e,t,i){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,t,i){var n,s,o;function a(l){s=l}typeof i=="function"&&(i=i(e,t.getComponent(),a)),i instanceof HTMLElement?n=i:(n=document.createElement("div"),i===!0&&(t instanceof go?i=t.value:t.definition.field?this.langBind("columns|"+t.definition.field,l=>{n.innerHTML=i=l||t.definition.title}):i=t.definition.title),n.innerHTML=i),(i||i===0||i===!1)&&(n.classList.add("tabulator-tooltip"),n.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(n),typeof s=="function"&&this.popupInstance.renderCallback(s),o=this.popupInstance.containerEventCoords(e),this.popupInstance.show(o.x+15,o.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",t.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",t.getComponent()))}}Ip.moduleName="tooltip";var DT={integer:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},max:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=t},min:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=t},starts:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(t).toLowerCase())},ends:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(t).toLowerCase())},minLength:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:String(e).length>=t},maxLength:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:String(e).length<=t},in:function(r,e,t){return e===""||e===null||typeof e>"u"?!0:(typeof t=="string"&&(t=t.split("|")),t.indexOf(e)>-1)},regex:function(r,e,t){if(e===""||e===null||typeof e>"u")return!0;var i=new RegExp(t);return i.test(e)},unique:function(r,e,t){if(e===""||e===null||typeof e>"u")return!0;var i=!0,n=r.getData(),s=r.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(o){var a=o.getData();a!==n&&e==s.getFieldValue(a)&&(i=!1)}),i},required:function(r,e,t){return e!==""&&e!==null&&typeof e<"u"}};class _o extends He{constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,t,i){var n=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,t):!0;return n!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),t,n)}),n}editorClear(e,t){t&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var t=[];return e.cells.forEach(i=>{this.cellValidate(i)!==!0&&t.push(i.getComponent())}),t.length?t:!0}rowValidate(e){var t=[];return e.cells.forEach(i=>{this.cellValidate(i)!==!0&&t.push(i.getComponent())}),t.length?t:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(t=>{this.clearValidation(t._getSelf())})}userValidate(e){var t=[];return this.table.rowManager.rows.forEach(i=>{i=i.getComponent();var n=i.validate();n!==!0&&(t=t.concat(n))}),t.length?t:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var t=this,i=[],n;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(s=>{n=t._extractValidator(s),n&&i.push(n)}):(n=this._extractValidator(e.definition.validator),n&&i.push(n)),e.modules.validate=i.length?i:!1)}_extractValidator(e){var t,i,n;switch(typeof e){case"string":return n=e.indexOf(":"),n>-1?(t=e.substring(0,n),i=e.substring(n+1)):t=e,this._buildValidator(t,i);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,t){var i=typeof e=="function"?e:_o.validators[e];return i?{type:typeof e=="function"?"function":e,func:i,params:t}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,t,i){var n=this,s=[],o=this.invalidCells.indexOf(t);return e&&e.forEach(a=>{a.func.call(n,t.getComponent(),i,a.params)||s.push({type:a.type,parameters:a.params})}),t.modules.validate||(t.modules.validate={}),s.length?(t.modules.validate.invalid=s,this.table.options.validationMode!=="manual"&&t.getElement().classList.add("tabulator-validation-fail"),o==-1&&this.invalidCells.push(t)):(t.modules.validate.invalid=!1,t.getElement().classList.remove("tabulator-validation-fail"),o>-1&&this.invalidCells.splice(o,1)),s.length?s:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(t=>{e.push(t.getComponent())}),e}clearValidation(e){var t;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,t=this.invalidCells.indexOf(e),t>-1&&this.invalidCells.splice(t,1))}}_o.moduleName="validate";_o.validators=DT;var AT=Object.freeze({__proto__:null,AccessorModule:nr,AjaxModule:Si,ClipboardModule:cs,ColumnCalcsModule:vn,DataTreeModule:mp,DownloadModule:sr,EditModule:mo,ExportModule:pp,FilterModule:Qi,FormatModule:_i,FrozenColumnsModule:bp,FrozenRowsModule:_p,GroupRowsModule:yp,HistoryModule:us,HtmlTableImportModule:vp,ImportModule:po,InteractionModule:Ep,KeybindingsModule:En,MenuModule:wp,MoveColumnsModule:Cp,MoveRowsModule:qa,MutatorModule:rr,PageModule:bo,PersistenceModule:ri,PopupModule:xp,PrintModule:Tp,ReactiveDataModule:Rp,ResizeColumnsModule:Sp,ResizeRowsModule:Lp,ResizeTableModule:Dp,ResponsiveLayoutModule:Ap,SelectRowModule:Mp,SortModule:ss,TooltipModule:Ip,ValidateModule:_o}),MT={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}};class Fp{constructor(e,t,i={}){this.table=e,this.msgType=t,this.registeredDefaults=Object.assign({},i)}register(e,t){this.registeredDefaults[e]=t}generate(e,t={}){var i=Object.assign({},this.registeredDefaults);if(Object.assign(i,e),t.debugInvalidOptions!==!1||this.table.options.debugInvalidOptions)for(let n in t)i.hasOwnProperty(n)||console.warn("Invalid "+this.msgType+" option:",n);for(let n in i)n in t?i[n]=t[n]:Array.isArray(i[n])?i[n]=Object.assign([],i[n]):typeof i[n]=="object"&&i[n]!==null?i[n]=Object.assign({},i[n]):typeof i[n]>"u"&&delete i[n];return i}}class Ja extends ci{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,t){}renderRowCells(e){}rerenderRowCells(e,t){}scrollColumns(e,t){}scrollRows(e,t){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,t){var i=e.getElement();t%2?(i.classList.add("tabulator-row-even"),i.classList.remove("tabulator-row-odd")):(i.classList.add("tabulator-row-odd"),i.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,t,i){var n=this.rows().indexOf(e),s=e.getElement(),o=0;return new Promise((a,l)=>{if(n>-1){if(typeof i>"u"&&(i=this.table.options.scrollToRowIfVisible),!i&&mt.elVisible(s)&&(o=mt.elOffset(s).top-mt.elOffset(this.elementVertical).top,o>0&&o<this.elementVertical.clientHeight-s.offsetHeight))return a(),!1;switch(typeof t>"u"&&(t=this.table.options.scrollToRowPosition),t==="nearest"&&(t=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),t){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(s.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-s.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-s.offsetTop)+s.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+s.offsetHeight;break;case"top":this.elementVertical.scrollTop=s.offsetTop;break}a()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class IT extends Ja{constructor(e){super(e)}renderRowCells(e){e.cells.forEach(t=>{e.element.appendChild(t.getElement()),t.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(t){t.reinitializeWidth()})}}class FT extends Ja{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,t){this.dataChange()}scrollColumns(e,t){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(t=>{if(t.visible){var i=t.getWidth();i>e&&(e=i)}}),this.windowBuffer=e*2}rerenderColumns(e,t){var i={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(s=>{var o={},a;s.visible&&(s.modules.frozen||(a=s.getWidth(),o.leftPos=n,o.rightPos=n+a,o.width=a,this.isFitData&&(o.fitDataCheck=s.modules.vdomHoz?s.modules.vdomHoz.fitDataCheck:!0),n+a>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=a),this.columns.push(s),s.modules.vdomHoz=o,n+=a))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,t||(!e||this.reinitChanged(i))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){this.initialized?this.initializeRow(e):e.cells.forEach(t=>{e.element.appendChild(t.getElement()),t.cellRendered()})}rerenderRowCells(e,t){this.reinitializeRow(e,t)}reinitializeColumnWidths(e){for(let t=this.leftCol;t<=this.rightCol;t++)this.columns[t].reinitializeWidth()}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,t,i;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(n=>{!n.definition.width&&n.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,t=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],t)){i=t.getElement(),t.generateCells(),this.tableElement.appendChild(i);for(let n=0;n<t.cells.length;n++){let s=t.cells[n];i.appendChild(s.getElement()),s.column.reinitializeWidth()}i.parentNode.removeChild(i),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var t=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((i,n)=>{i!==this.columns[n]&&(t=!1)}),!t)}reinitializeRows(){var e=this.getVisibleRows(),t=this.table.rowManager.getRows().filter(i=>!e.includes(i));e.forEach(i=>{this.reinitializeRow(i,!0)}),t.forEach(i=>{i.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,t,i){for(let n=e;n<t;n++){let s=this.columns[n];s.modules.vdomHoz.leftPos+=i,s.modules.vdomHoz.rightPos+=i}}addColRight(){for(var e=!1,t=!0;t;){let i=this.columns[this.rightCol+1];i&&i.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var s=n.getCell(i);n.getElement().insertBefore(s.getElement(),n.getCell(this.columns[this.rightCol]).getElement().nextSibling),s.cellRendered()}}),this.fitDataColActualWidthCheck(i),this.rightCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=i.getWidth()):t=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,t=!0;t;){let i=this.columns[this.leftCol-1];if(i)if(i.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(s=>{if(s.type!=="group"){var o=s.getCell(i);s.getElement().insertBefore(o.getElement(),s.getCell(this.columns[this.leftCol]).getElement()),o.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(s=>{s.type!=="group"&&(s.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=i.getWidth();let n=this.fitDataColActualWidthCheck(i);n&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+n,this.vDomPadRight-=n)}else t=!1;else t=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,t=!0;t;){let i=this.columns[this.rightCol];i&&i.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var s=n.getCell(i);try{n.getElement().removeChild(s.getElement())}catch(o){console.warn("Could not removeColRight",o.message)}}}),this.vDomPadRight+=i.getWidth(),this.rightCol--,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)})):t=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,t=!0;t;){let i=this.columns[this.leftCol];i&&i.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var s=n.getCell(i);try{n.getElement().removeChild(s.getElement())}catch(o){console.warn("Could not removeColLeft",o.message)}}}),this.vDomPadLeft+=i.getWidth(),this.leftCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.leftCol=this.leftCol)})):t=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var t,i;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),t=e.getWidth(),i=t-e.modules.vdomHoz.width,i&&(e.modules.vdomHoz.rightPos+=i,e.modules.vdomHoz.width=t,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,i)),e.modules.vdomHoz.fitDataCheck=!1),i}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(t=>{this.appendCell(e,t)});for(let t=this.leftCol;t<=this.rightCol;t++)this.appendCell(e,this.columns[t]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(t=>{this.appendCell(e,t)})}}appendCell(e,t){if(t&&t.visible){let i=e.getCell(t);e.getElement().appendChild(i.getElement()),i.cellRendered()}}reinitializeRow(e,t){if(e.type!=="group"&&(t||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var i=e.getElement();i.firstChild;)i.removeChild(i.firstChild);this.initializeRow(e)}}}class PT extends ci{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new Fp(this.table,"column definition",gp),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,t={virtual:FT,basic:IT};typeof this.table.options.renderHorizontal=="string"?e=t[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}generateColumnsFromRowData(e){var t=[],i=this.table.options.autoColumnsDefinitions,n,s;if(e&&e.length){n=e[0];for(var o in n){let a={field:o,title:o},l=n[o];switch(typeof l){case"undefined":s="string";break;case"boolean":s="boolean";break;case"object":Array.isArray(l)?s="array":s="string";break;default:!isNaN(l)&&l!==""?s="number":l.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?s="alphanum":s="string";break}a.sorter=s,t.push(a)}if(i)switch(typeof i){case"function":this.table.options.columns=i.call(this.table,t);break;case"object":Array.isArray(i)?t.forEach(a=>{var l=i.find(u=>u.field===a.field);l&&Object.assign(a,l)}):t.forEach(a=>{i[a.field]&&Object.assign(a,i[a.field])}),this.table.options.columns=t;break}else this.table.options.columns=t;this.setColumns(this.table.options.columns)}}setColumns(e,t){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),e.forEach((i,n)=>{this._addColumn(i)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,t,i){var n=new Gi(e,this),s=n.getElement(),o=i&&this.findColumnIndex(i);if(i&&o>-1){var a=i.getTopColumn(),l=this.columns.indexOf(a),u=a.getElement();t?(this.columns.splice(l,0,n),u.parentNode.insertBefore(s,u)):(this.columns.splice(l+1,0,n),u.parentNode.insertBefore(s,u.nextSibling))}else t?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(t=>{t.clearVerticalAlign()}),this.columns.forEach(t=>{var i=t.getHeight();i>e&&(e=i)}),this.headersElement.style.height=e+"px",this.columns.forEach(t=>{t.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var t;if(typeof e=="object"){if(e instanceof Gi)return e;if(e instanceof fp)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return t=[],this.columns.forEach(n=>{t.push(n),t=t.concat(n.getColumns(!0))}),t.find(n=>n.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var t=[];return Object.keys(this.columnsByField).forEach(i=>{var n=i.split(".")[0];n===e&&t.push(this.columnsByField[i])}),t}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(t=>t.visible);return e>-1?this.columnsByIndex[e]:!1}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(t=>e===t)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((t,i)=>{e(t,i)})}getDefinitions(e){var t=[];return this.columnsByIndex.forEach(i=>{(!e||e&&i.visible)&&t.push(i.getDefinition())}),t}getDefinitionTree(){var e=[];return this.columns.forEach(t=>{e.push(t.getDefinition(!0))}),e}getComponents(e){var t=[],i=e?this.columns:this.columnsByIndex;return i.forEach(n=>{t.push(n.getComponent())}),t}getWidth(){var e=0;return this.columnsByIndex.forEach(t=>{t.visible&&(e+=t.getWidth())}),e}moveColumn(e,t,i){t.element.parentNode.insertBefore(e.element,t.element),i&&t.element.parentNode.insertBefore(t.element,e.element),this.moveColumnActual(e,t,i),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,t,i){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,t,i):this._moveColumnInArray(this.columns,e,t,i),this._moveColumnInArray(this.columnsByIndex,e,t,i,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,t,i),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,t,i,n,s){var o=e.indexOf(t),a,l=[];o>-1&&(e.splice(o,1),a=e.indexOf(i),a>-1?n&&(a=a+1):a=o,e.splice(a,0,t),s&&(l=this.chain("column-moving-rows",[t,i,n],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(u){if(u.cells.length){var f=u.cells.splice(o,1)[0];u.cells.splice(a,0,f)}})))}scrollToColumn(e,t,i){var n=0,s=e.getLeftOffset(),o=0,a=e.getElement();return new Promise((l,u)=>{if(typeof t>"u"&&(t=this.table.options.scrollToColumnPosition),typeof i>"u"&&(i=this.table.options.scrollToColumnIfVisible),e.visible){switch(t){case"middle":case"center":o=-this.element.clientWidth/2;break;case"right":o=a.clientWidth-this.headersElement.clientWidth;break}if(!i&&s>0&&s+a.offsetWidth<this.element.clientWidth)return!1;n=s+o,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),l()}else console.warn("Scroll Error - Column not visible"),u("Scroll Error - Column not visible")})}generateCells(e){var t=[];return this.columnsByIndex.forEach(i=>{t.push(i.generateCell(e))}),t}getFlexBaseWidth(){var e=this.table.element.clientWidth,t=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(i){var n,s,o;i.visible&&(n=i.definition.width||0,s=parseInt(i.minWidth),typeof n=="string"?n.indexOf("%")>-1?o=e/100*parseInt(n):o=parseInt(n):o=n,t+=o>s?o:s)}),t}addColumn(e,t,i){return new Promise((n,s)=>{var o=this._addColumn(e,t,i);this._reIndexColumns(),this.dispatch("column-add",e,t,i),this.layoutMode()!="fitColumns"&&o.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(o)})}deregisterColumn(e){var t=e.getField(),i;t&&delete this.columnsByField[t],i=this.columnsByIndex.indexOf(e),i>-1&&this.columnsByIndex.splice(i,1),i=this.columns.indexOf(e),i>-1&&this.columns.splice(i,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,t){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,t)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){mt.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class OT extends Ja{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,t=!0;this.rows().forEach((i,n)=>{this.styleRow(i,n),e.appendChild(i.getElement()),i.initialize(!0),i.type!=="group"&&(t=!1)}),t?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),this.renderRows(),e&&e()}scrollToRowNearestTop(e){var t=mt.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-t)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-t))}scrollToRow(e){var t=e.getElement();this.elementVertical.scrollTop=mt.elOffset(t).top-mt.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class kT extends Ja{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var t=this.elementVertical.scrollTop,i=!1,n=!1,s=this.table.rowManager.scrollLeft,o=this.rows(),a=this.vDomTop;a<=this.vDomBottom;a++)if(o[a]){var l=t-o[a].getElement().offsetTop;if(n===!1||Math.abs(l)<n)n=l,i=a;else break}o.forEach(u=>{u.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(i===!1?this.rows.length-1:i,!0,n||0):(this.clear(),this.table.rowManager._showPlaceholder()),this.scrollColumns(s)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,t){var i=e-this.vDomScrollPosTop,n=e-this.vDomScrollPosBottom,s=this.vDomWindowBuffer*2,o=this.rows();if(this.scrollTop=e,-i>s||n>s){var a=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*o.length)),this.scrollColumns(a)}else t?(i<0&&this._addTopRow(o,-i),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(o,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(o,n),i>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(o,i):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var t=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-t)>Math.abs(this.vDomBottom-t))}scrollToRow(e){var t=this.rows().indexOf(e);t>-1&&this._virtualRenderFill(t,!0)}visibleRows(e){var t=this.elementVertical.scrollTop,i=this.elementVertical.clientHeight+t,n=!1,s=0,o=0,a=this.rows();if(e)s=this.vDomTop,o=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(a[l])if(n)if(i-a[l].getElement().offsetTop>=0)o=l;else break;else if(t-a[l].getElement().offsetTop>=0)s=l;else if(n=!0,i-a[l].getElement().offsetTop>=0)o=l;else break;return a.slice(s,o+1)}_virtualRenderFill(e,t,i){var n=this.tableElement,s=this.elementVertical,o=0,a=0,l=0,u=0,f=0,m=this.rows(),_=m.length,C=this.elementVertical.clientHeight;if(e=e||0,i=i||0,!e)this.clear();else{for(;n.firstChild;)n.removeChild(n.firstChild);l=(_-e+1)*this.vDomRowHeight,l<C&&(e-=Math.ceil((C-l)/this.vDomRowHeight),e<0&&(e=0)),o=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=o}if(_&&mt.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1;(a<=C+this.vDomWindowBuffer||f<this.vDomWindowMinTotalRows)&&this.vDomBottom<_-1;){var R=this.vDomBottom+1,L=m[R],A=0;this.styleRow(L,R),n.appendChild(L.getElement()),L.initialize(),L.heightInitialized||L.normalizeHeight(!0),A=L.getHeight(),f<o?u+=A:a+=A,A>this.vDomWindowBuffer&&(this.vDomWindowBuffer=A*2),this.vDomBottom++,f++}e?(this.vDomTopPad=t?this.vDomRowHeight*this.vDomTop+i:this.scrollTop-u,this.vDomBottomPad=this.vDomBottom==_-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-a-u,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((a+u)/f),this.vDomBottomPad=this.vDomRowHeight*(_-this.vDomBottom-1),this.vDomScrollHeight=u+a+this.vDomBottomPad-C),n.style.paddingTop=this.vDomTopPad+"px",n.style.paddingBottom=this.vDomBottomPad+"px",t&&(this.scrollTop=this.vDomTopPad+u+i-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-C:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-C),this.elementVertical.scrollWidth>this.elementVertical.offsetWidth&&t&&(this.scrollTop+=this.elementVertical.offsetHeight-C),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,s.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,t){for(var i=this.tableElement,n=[],s=0,o=this.vDomTop-1,a=0,l=!0;l;)if(this.vDomTop){let u=e[o],f,m;u&&a<this.vDomMaxRenderChain?(f=u.getHeight()||this.vDomRowHeight,m=u.initialized,t>=f?(this.styleRow(u,o),i.insertBefore(u.getElement(),i.firstChild),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),m||(f=u.getElement().offsetHeight,f>this.vDomWindowBuffer&&(this.vDomWindowBuffer=f*2)),t-=f,s+=f,this.vDomTop--,o--,a++):l=!1):l=!1}else l=!1;for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),s&&(this.vDomTopPad-=s,this.vDomTopPad<0&&(this.vDomTopPad=o*this.vDomRowHeight),o<1&&(this.vDomTopPad=0),i.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=s)}_removeTopRow(e,t){for(var i=[],n=0,s=0,o=!0;o;){let a=e[this.vDomTop],l;a&&s<this.vDomMaxRenderChain?(l=a.getHeight()||this.vDomRowHeight,t>=l?(this.vDomTop++,t-=l,n+=l,i.push(a),s++):o=!1):o=!1}for(let a of i){let l=a.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(e,t){for(var i=this.tableElement,n=[],s=0,o=this.vDomBottom+1,a=0,l=!0;l;){let u=e[o],f,m;u&&a<this.vDomMaxRenderChain?(f=u.getHeight()||this.vDomRowHeight,m=u.initialized,t>=f?(this.styleRow(u,o),i.appendChild(u.getElement()),(!u.initialized||!u.heightInitialized)&&n.push(u),u.initialize(),m||(f=u.getElement().offsetHeight,f>this.vDomWindowBuffer&&(this.vDomWindowBuffer=f*2)),t-=f,s+=f,this.vDomBottom++,o++,a++):l=!1):l=!1}for(let u of n)u.clearCellHeight();this._quickNormalizeRowHeight(n),s&&(this.vDomBottomPad-=s,(this.vDomBottomPad<0||o==e.length-1)&&(this.vDomBottomPad=0),i.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=s)}_removeBottomRow(e,t){for(var i=[],n=0,s=0,o=!0;o;){let a=e[this.vDomBottom],l;a&&s<this.vDomMaxRenderChain?(l=a.getHeight()||this.vDomRowHeight,t>=l?(this.vDomBottom--,t-=l,n+=l,i.push(a),s++):o=!1):o=!1}for(let a of i){let l=a.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(e){for(let t of e)t.calcHeight();for(let t of e)t.setCellHeight()}}class NT extends ci{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){if(typeof this.table.options.placeholder=="string"){let e=document.createElement("div");e.classList.add("tabulator-placeholder");let t=document.createElement("div");t.classList.add("tabulator-placeholder-contents"),t.innerHTML=this.table.options.placeholder,e.appendChild(t),this.placeholderContents=t,this.placeholder=e}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,t=this.scrollLeft>e,i=this.element.scrollTop,n=this.scrollTop>i;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,t),this.dispatchExternal("scrollHorizontal",e,t),this._positionPlaceholder()),this.scrollTop!=i&&(this.scrollTop=i,this.renderer.scrollRows(i,n),this.dispatch("scroll-vertical",i,n),this.dispatchExternal("scrollVertical",i,n))})}findRow(e){if(typeof e=="object"){if(e instanceof Zt)return e;if(e instanceof $a)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(i=>i.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(i=>i.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var t=this.rows.find(i=>i.data===e);return t||!1}getRowFromPosition(e){return this.getDisplayRows().find(t=>t.getPosition()===e&&t.isDisplayed())}scrollToRow(e,t,i){return this.renderer.scrollToRowPosition(e,t,i)}setData(e,t,i){return new Promise((n,s)=>{t&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&i&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),n()})}_setDataActual(e,t){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((i,n)=>{if(i&&typeof i=="object"){var s=new Zt(i,this);this.rows.push(s)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",i)}),this.refreshActiveData(!1,!1,t),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.adjustTableSize()}deleteRow(e,t){var i=this.rows.indexOf(e),n=this.activeRows.indexOf(e);n>-1&&this.activeRows.splice(n,1),i>-1&&this.rows.splice(i,1),this.setActiveRows(this.activeRows),this.displayRowIterator(s=>{var o=s.indexOf(e);o>-1&&s.splice(o,1)}),t||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this._showPlaceholder(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,t,i,n){var s=this.addRowActual(e,t,i,n);return s}addRows(e,t,i){var n=[];return new Promise((s,o)=>{t=this.findAddRowPos(t),Array.isArray(e)||(e=[e]),(typeof i>"u"&&t||typeof i<"u"&&!t)&&e.reverse(),e.forEach((a,l)=>{var u=this.addRow(a,t,i,!0);n.push(u),this.dispatch("row-added",u,e,t,i)}),this.refreshActiveData(!1,!1,!0),this.regenerateRowPositions(),n.length&&this._clearPlaceholder(),s(n)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,t,i,n){var s=e instanceof Zt?e:new Zt(e||{},this),o=this.findAddRowPos(t),a=-1,l,u;return i||(u=this.chain("row-adding-position",[s,o],null,{index:i,top:o}),i=u.index,o=u.top),typeof i<"u"&&(i=this.findRow(i)),i=this.chain("row-adding-index",[s,i,o],null,i),i&&(a=this.rows.indexOf(i)),i&&a>-1?(l=this.activeRows.indexOf(i),this.displayRowIterator(function(f){var m=f.indexOf(i);m>-1&&f.splice(o?m:m+1,0,s)}),l>-1&&this.activeRows.splice(o?l:l+1,0,s),this.rows.splice(o?a:a+1,0,s)):o?(this.displayRowIterator(function(f){f.unshift(s)}),this.activeRows.unshift(s),this.rows.unshift(s)):(this.displayRowIterator(function(f){f.push(s)}),this.activeRows.push(s),this.rows.push(s)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",s.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),s}moveRow(e,t,i){this.dispatch("row-move",e,t,i),this.moveRowActual(e,t,i),this.regenerateRowPositions(),this.dispatch("row-moved",e,t,i),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,t,i){this.moveRowInArray(this.rows,e,t,i),this.moveRowInArray(this.activeRows,e,t,i),this.displayRowIterator(n=>{this.moveRowInArray(n,e,t,i)}),this.dispatch("row-moving",e,t,i)}moveRowInArray(e,t,i,n){var s,o,a,l;if(t!==i&&(s=e.indexOf(t),s>-1&&(e.splice(s,1),o=e.indexOf(i),o>-1?n?e.splice(o+1,0,t):e.splice(o,0,t):e.splice(s,0,t)),e===this.getDisplayRows())){a=s<o?s:o,l=o>s?o:s+1;for(let u=a;u<=l;u++)e[u]&&this.styleRow(e[u],u)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var t=this.getDisplayRows().indexOf(e);return t>-1?t:!1}nextDisplayRow(e,t){var i=this.getDisplayRowIndex(e),n=!1;return i!==!1&&i<this.displayRowsCount-1&&(n=this.getDisplayRows()[i+1]),n&&(!(n instanceof Zt)||n.type!="row")?this.nextDisplayRow(n,t):n}prevDisplayRow(e,t){var i=this.getDisplayRowIndex(e),n=!1;return i&&(n=this.getDisplayRows()[i-1]),t&&n&&(!(n instanceof Zt)||n.type!="row")?this.prevDisplayRow(n,t):n}findRowIndex(e,t){var i;return e=this.findRow(e),e&&(i=t.indexOf(e),i>-1)?i:!1}getData(e,t){var i=[],n=this.getRows(e);return n.forEach(function(s){s.type=="row"&&i.push(s.getData(t||"data"))}),i}getComponents(e){var t=[],i=this.getRows(e);return i.forEach(function(n){t.push(n.getComponent())}),t}getDataCount(e){var t=this.getRows(e);return t.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,t){typeof t<"u"?(this.dataPipeline.push({handler:e,priority:t}),this.dataPipeline.sort((i,n)=>i.priority-n.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,t){typeof t<"u"?(this.displayPipeline.push({handler:e,priority:t}),this.displayPipeline.sort((i,n)=>i.priority-n.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,t,i){var n=this.table,s="",o=0,a=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(o=this.dataPipeline.findIndex(l=>l.handler===e),o>-1)s="dataPipeline",t&&(o==this.dataPipeline.length-1?s="display":o++);else if(o=this.displayPipeline.findIndex(l=>l.handler===e),o>-1)s="displayPipeline",t&&(o==this.displayPipeline.length-1?s="end":o++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else s=e||"all",o=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===s&&o<this.redrawBlockRestoreConfig.index||a.indexOf(s)<a.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:t,renderInPosition:i,stage:s,index:o});return}else mt.elVisible(this.element)?i?this.reRenderInPosition(this.refreshPipelines.bind(this,e,s,o,i)):(this.refreshPipelines(e,s,o,i),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,s,o,i),this.dispatch("data-refreshed")}}refreshPipelines(e,t,i,n){switch(this.dispatch("data-refreshing"),e||(this.activeRowsPipeline[0]=this.rows.slice(0)),t){case"all":case"dataPipeline":for(let s=i;s<this.dataPipeline.length;s++){let o=this.dataPipeline[s].handler(this.activeRowsPipeline[s].slice(0));this.activeRowsPipeline[s+1]=o||this.activeRowsPipeline[s].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":i=0,this.resetDisplayRows();case"displayPipeline":for(let s=i;s<this.displayPipeline.length;s++){let o=this.displayPipeline[s].handler((s?this.getDisplayRows(s-1):this.activeRows).slice(0),n);this.setDisplayRows(o||this.getDisplayRows(s-1).slice(0),s)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),t=1;e.forEach(i=>{i.type==="row"&&(i.setPosition(t),t++)})}setActiveRows(e){this.activeRows=e,this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,t){this.displayRows[t]=e,t==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,t){var i=Object.assign([],this.renderer.visibleRows(!t));return e&&(i=this.chain("rows-visible",[t],i,i)),i}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var t=[];if(!e||e===!0)t=this.chain("rows-retrieve",e,null,this.rows)||this.rows;else switch(e){case"active":t=this.activeRows;break;case"display":t=this.table.rowManager.getDisplayRows();break;case"visible":t=this.getVisibleRows(!1,!0);break}return t}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,t={virtual:kT,basic:OT};typeof this.table.options.renderVertical=="string"?e=t[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),this.table.element.clientHeight||this.table.options.height?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}_showPlaceholder(){this.placeholder&&(this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,t){var i=e.getElement();t%2?(i.classList.add("tabulator-row-even"),i.classList.remove("tabulator-row-odd")):(i.classList.add("tabulator-row-odd"),i.classList.remove("tabulator-row-even"))}normalizeHeight(){this.activeRows.forEach(function(e){e.normalizeHeight()})}adjustTableSize(){var e=this.element.clientHeight,t;if(this.renderer.verticalFillMode==="fill"){let i=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));this.fixedHeight?(t=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px",this.element.style.minHeight=t||"calc(100% - "+i+"px)",this.element.style.height="calc(100% - "+i+"px)",this.element.style.maxHeight="calc(100% - "+i+"px)"):(this.element.style.height="",this.element.style.height=this.table.element.clientHeight-i+"px",this.element.scrollTop=this.scrollTop),this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}this._positionPlaceholder()}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){var t=this.scrollLeft;this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(t))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class GT extends ci{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class zT extends ci{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(t=>{e[t]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,t,i){this.pseudoTrackers[e].target!==i&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",t,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,t),this.pseudoTrackers[e].target=i,this.dispatch(e+"-mouseenter",t,i))}pseudoMouseLeave(e,t){var i=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};i=i.filter(s=>{var o=n[e];return s!==e&&(!o||o&&!o.includes(s))}),i.forEach(s=>{var o=this.pseudoTrackers[s].target;this.pseudoTrackers[s].target&&(this.dispatch(s+"-mouseleave",t,o),this.pseudoTrackers[s].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),t=Object.values(this.componentMap);for(let i of t)for(let n of e){let s=i+"-"+n;this.subscriptionChange(s,this.subscriptionChanged.bind(this,i,n))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,t,i){var n=this.listeners[t].components,s=n.indexOf(e),o=!1;i?s===-1&&(n.push(e),o=!0):this.subscribed(e+"-"+t)||s>-1&&(n.splice(s,1),o=!0),(t==="mouseenter"||t==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),o&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let t=this.listeners[e];t.components.length?t.handler||(t.handler=this.track.bind(this,e),this.el.addEventListener(e,t.handler)):t.handler&&(this.el.removeEventListener(e,t.handler),t.handler=null)}}track(e,t){var i=t.composedPath&&t.composedPath()||t.path,n=this.findTargets(i);n=this.bindComponents(e,n),this.triggerEvents(e,t,n),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(n).length&&this.pseudoMouseLeave("none",t)}findTargets(e){var t={};let i=Object.keys(this.componentMap);for(let n of e){let s=n.classList?[...n.classList]:[];if(s.filter(l=>this.abortClasses.includes(l)).length)break;let a=s.filter(l=>i.includes(l));for(let l of a)t[this.componentMap[l]]||(t[this.componentMap[l]]=n)}return t.group&&t.group===t.row&&delete t.row,t}bindComponents(e,t){var i=Object.keys(t).reverse(),n=this.listeners[e],s={},o={};for(let a of i){let l,u=t[a],f=this.previousTargets[a];if(f&&f.target===u)l=f.component;else switch(a){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(l=this.table.rowManager.getVisibleRows(!0).find(_=>_.getElement()===u),t.row&&t.row.parentNode&&t.row.parentNode.closest(".tabulator-row")&&(t[a]=!1));break;case"column":n.components.includes("column")&&(l=this.table.columnManager.findColumn(u));break;case"cell":n.components.includes("cell")&&(s.row instanceof Zt?l=s.row.findCell(u):t.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}l&&(s[a]=l,o[a]={target:u,component:l})}return this.previousTargets=o,s}triggerEvents(e,t,i){var n=this.listeners[e];for(let s in i)i[s]&&n.components.includes(s)&&this.dispatch(s+"-"+e,t,i[s])}clearWatchers(){for(let e in this.listeners){let t=this.listeners[e];t.handler&&(this.el.removeEventListener(e,t.handler),t.handler=null)}}}class BT{constructor(e){this.table=e,this.bindings={}}bind(e,t,i){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][t]?console.warn("Unable to bind component handler, a matching function name is already bound",e,t,i):this.bindings[e][t]=i}handle(e,t,i){if(this.bindings[e]&&this.bindings[e][i]&&typeof this.bindings[e][i].bind=="function")return this.bindings[e][i].bind(null,t);i!=="then"&&typeof i=="string"&&!i.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+i+" function, have you checked that you have the correct Tabulator module installed?")}}class jT extends ci{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,t,i,n,s,o){var a=++this.requestOrder;if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,t,i,s])){this.loading=!0,s||this.alertLoader(),t=this.chain("data-params",[e,i,s],t||{},t||{}),t=this.mapParams(t,this.table.options.dataSendParams);var l=this.chain("data-load",[e,t,i,s],!1,Promise.resolve([]));return l.then(u=>{!Array.isArray(u)&&typeof u=="object"&&(u=this.mapParams(u,this.objectInvert(this.table.options.dataReceiveParams)));var f=this.chain("data-loaded",u,null,u);a==this.requestOrder?(this.clearAlert(),f!==!1&&(this.dispatchExternal("dataLoaded",f),this.table.rowManager.setData(f,n,typeof o>"u"?!n:o))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}).catch(u=>{console.error("Data Load Error: ",u),this.dispatchExternal("dataLoadError",u),s||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,n,typeof o>"u"?!n:o),Promise.resolve()}mapParams(e,t){var i={};for(let n in e)i[t.hasOwnProperty(n)?t[n]:n]=e[n];return i}objectInvert(e){var t={};for(let i in e)t[e[i]]=i;return t}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class HT{constructor(e,t,i){this.table=e,this.events={},this.optionsList=t||{},this.subscriptionNotifiers={},this.dispatch=i?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=i}subscriptionChange(e,t){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(t),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t),this._notifySubscriptionChange(e,!0)}unsubscribe(e,t){var i;if(this.events[e])if(t)if(i=this.events[e].findIndex(n=>n===t),i>-1)this.events[e].splice(i,1);else{console.warn("Cannot remove event, no matching event found:",e,t);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,t){var i=this.subscriptionNotifiers[e];i&&i.forEach(n=>{n(t)})}_dispatch(){var e=Array.from(arguments),t=e.shift(),i;return this.events[t]&&this.events[t].forEach((n,s)=>{let o=n.apply(this.table,e);s||(i=o)}),i}_debugDispatch(){var e=Array.from(arguments),t=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(t))&&console.log(...e),this._dispatch(...arguments)}}class UT{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,t){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(t),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,t,i=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:t,priority:i}),this.events[e].sort((n,s)=>n.priority-s.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,t){var i;if(this.events[e]){if(t)if(i=this.events[e].findIndex(n=>n.callback===t),i>-1)this.events[e].splice(i,1);else{console.warn("Cannot remove event, no matching event found:",e,t);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,t,i,n){var s=i;return Array.isArray(t)||(t=[t]),this.subscribed(e)?(this.events[e].forEach((o,a)=>{s=o.callback.apply(this,t.concat([s]))}),s):typeof n=="function"?n():n}_confirm(e,t){var i=!1;return Array.isArray(t)||(t=[t]),this.subscribed(e)&&this.events[e].forEach((n,s)=>{n.callback.apply(this,t)&&(i=!0)}),i}_notifySubscriptionChange(e,t){var i=this.subscriptionNotifiers[e];i&&i.forEach(n=>{n(t)})}_dispatch(){var e=Array.from(arguments),t=e.shift();this.events[t]&&this.events[t].forEach(i=>{i.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),t=e[0];return e[0]="InternalEvent:"+t,(this.debug===!0||this.debug.includes(t))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),t=e[0];return e[0]="InternalEvent:"+t,(this.debug===!0||this.debug.includes(t))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),t=e[0];return e[0]="InternalEvent:"+t,(this.debug===!0||this.debug.includes(t))&&console.log(...e),this._confirm(...arguments)}}class VT extends ci{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,t){var i="";return typeof this.options(e)<"u"?(i="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",t?(i=i+", Please use the %c"+t+"%c option instead",this._warnUser(i,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;")):this._warnUser(i,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,t){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+t,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}class gi{static register(e){gi.tables.push(e)}static deregister(e){var t=gi.tables.indexOf(e);t>-1&&gi.tables.splice(t,1)}static lookupTable(e,t){var i=[],n,s;if(typeof e=="string"){if(n=document.querySelectorAll(e),n.length)for(var o=0;o<n.length;o++)s=gi.matchElement(n[o]),s&&i.push(s)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof ds?(s=gi.matchElement(e),s&&i.push(s)):Array.isArray(e)?e.forEach(function(a){i=i.concat(gi.lookupTable(a))}):t||console.warn("Table Connection Error - Invalid Selector",e);return i}static matchElement(e){return gi.tables.find(function(t){return e instanceof ds?t===e:t.element===e})}}gi.tables=[];function WT(r,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(r),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function tg(r,e){r.forEach(function(t){t.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function XT(r,e){var t=0,i=this.table.rowManager.element.clientWidth,n=0,s=!1;r.forEach((o,a)=>{o.widthFixed||o.reinitializeWidth(),(this.table.options.responsiveLayout?o.modules.responsive.visible:o.visible)&&(s=o),o.visible&&(t+=o.getWidth())}),s?(n=i-t+s.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(s.setWidth(0),this.table.modules.responsiveLayout.update()),n>0?s.setWidth(n):s.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function YT(r,e){var t=this.table.rowManager.element.getBoundingClientRect().width,i=0,n=0,s=0,o=0,a=[],l=[],u=0,f=0,m=0;function _(R){var L;return typeof R=="string"?R.indexOf("%")>-1?L=t/100*parseInt(R):L=parseInt(R):L=R,L}function C(R,L,A,S){var P=[],k=0,H=0,K=0,ie=s,te=0,ee=0,ne=[];function ue(oe){return A*(oe.column.definition.widthGrow||1)}function de(oe){return _(oe.width)-A*(oe.column.definition.widthShrink||0)}return R.forEach(function(oe,ye){var xe=S?de(oe):ue(oe);oe.column.minWidth>=xe?P.push(oe):oe.column.maxWidth&&oe.column.maxWidth<xe?(oe.width=oe.column.maxWidth,L-=oe.column.maxWidth,ie-=S?oe.column.definition.widthShrink||1:oe.column.definition.widthGrow||1,ie&&(A=Math.floor(L/ie))):(ne.push(oe),ee+=S?oe.column.definition.widthShrink||1:oe.column.definition.widthGrow||1)}),P.length?(P.forEach(function(oe){k+=S?oe.width-oe.column.minWidth:oe.column.minWidth,oe.width=oe.column.minWidth}),H=L-k,K=ee?Math.floor(H/ee):H,te=C(ne,H,K,S)):(te=ee?L-Math.floor(L/ee)*ee:L,ne.forEach(function(oe){oe.width=S?de(oe):ue(oe)})),te}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(t-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),r.forEach(function(R){var L,A,S;R.visible&&(L=R.definition.width,A=parseInt(R.minWidth),L?(S=_(L),i+=S>A?S:A,R.definition.widthShrink&&(l.push({column:R,width:S>A?S:A}),u+=R.definition.widthShrink)):(a.push({column:R,width:0}),s+=R.definition.widthGrow||1))}),n=t-i,o=Math.floor(n/s),m=C(a,n,o,!1),a.length&&m>0&&(a[a.length-1].width+=m),a.forEach(function(R){n-=R.width}),f=Math.abs(m)+n,f>0&&u&&(m=C(l,f,Math.floor(f/u),!0)),m&&l.length&&(l[l.length-1].width-=m),a.forEach(function(R){R.column.setWidth(R.width)}),l.forEach(function(R){R.column.setWidth(R.width)})}var KT={fitData:WT,fitDataFill:tg,fitDataTable:tg,fitDataStretch:XT,fitColumns:YT};class or extends He{constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;or.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode)}getMode(){return this.mode}layout(e){this.dispatch("layout-refreshing"),or.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),this.dispatch("layout-refreshed")}}or.moduleName="layout";or.modes=KT;var $T={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class yo extends He{constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=mt.deepClone(yo.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}setHeaderFilterColumnPlaceholder(e,t){this.langList.default.headerFilters.columns[e]=t,this.lang&&!this.lang.headerFilters.columns[e]&&(this.lang.headerFilters.columns[e]=t)}installLang(e,t){this.langList[e]?this._setLangProp(this.langList[e],t):this.langList[e]=t}_setLangProp(e,t){for(let i in t)e[i]&&typeof e[i]=="object"?this._setLangProp(e[i],t[i]):e[i]=t[i]}setLocale(e){e=e||"default";function t(i,n){for(var s in i)typeof i[s]=="object"?(n[s]||(n[s]={}),t(i[s],n[s])):n[s]=i[s]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let i=e.split("-")[0];this.langList[i]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,i),e=i):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=mt.deepClone(this.langList.default||{}),e!="default"&&t(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,t){var i=t?e+"|"+t:e,n=i.split("|"),s=this._getLangElement(n,this.locale);return s||""}_getLangElement(e,t){var i=this.lang;return e.forEach(function(n){var s;i&&(s=i[n],typeof s<"u"?i=s:i=!1)}),i}bind(e,t){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(t),t(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(t=>{t(this.getText(e),this.lang)})}}yo.moduleName="localize";yo.langs=$T;class Pp extends He{constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var t=[],i;return i=gi.lookupTable(e),i.forEach(n=>{this.table!==n&&t.push(n)}),t}send(e,t,i,n){var s=this.getConnections(e);s.forEach(o=>{o.tableComms(this.table.element,t,i,n)}),!s.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,t,i,n){if(this.table.modExists(t))return this.table.modules[t].commsReceived(e,i,n);console.warn("Inter-table Comms Error - no such module:",t)}}Pp.moduleName="comms";var ZT=Object.freeze({__proto__:null,LayoutModule:or,LocalizeModule:yo,CommsModule:Pp});class Op{constructor(e,t){this.bindStaticFunctionality(e),this.bindModules(e,ZT,!0),t&&this.bindModules(e,t)}bindStaticFunctionality(e){e.moduleBindings={},e.extendModule=function(t,i,n){if(e.moduleBindings[t]){var s=e.moduleBindings[t][i];if(s)if(typeof n=="object")for(let o in n)s[o]=n[o];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",t)},e.registerModule=function(t){Array.isArray(t)||(t=[t]),t.forEach(i=>{e.registerModuleBinding(i)})},e.registerModuleBinding=function(t){e.moduleBindings[t.moduleName]=t},e.findTable=function(t){var i=gi.lookupTable(t,!0);return Array.isArray(i)&&!i.length?!1:i},e.prototype.bindModules=function(){var t=[],i=[],n=[];this.modules={};for(var s in e.moduleBindings){let o=e.moduleBindings[s],a=new o(this);this.modules[s]=a,o.prototype.moduleCore?this.modulesCore.push(a):o.moduleInitOrder?o.moduleInitOrder<0?t.push(a):i.push(a):n.push(a)}t.sort((o,a)=>o.moduleInitOrder>a.moduleInitOrder?1:-1),i.sort((o,a)=>o.moduleInitOrder>a.moduleInitOrder?1:-1),this.modulesRegular=t.concat(n.concat(i))}}bindModules(e,t,i){var n=Object.values(t);i&&n.forEach(s=>{s.prototype.moduleCore=!0}),e.registerModule(n)}}class qT extends ci{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,t="msg"){if(e){for(this.clear(),this.type=t;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class ds{constructor(e,t){this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new BT(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new VT(this),this.optionsList=new Fp(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(t),setTimeout(()=>{this._create()})),gi.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new PT(this),this.rowManager=new NT(this),this.footerManager=new GT(this),this.dataLoader=new jT(this),this.alertManager=new qT(this),this.bindModules(),this.options=this.optionsList.generate(ds.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new HT(this,this.options,this.options.debugEventsExternal),this.eventBus=new UT(this.options.debugEventsInternal),this.interactionMonitor=new zT(this),this.dataLoader.initialize(),this.footerManager.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this._loadInitialData(),this.initialized=!0,this.externalEvents.dispatch("tableBuilt")}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,t=this.options,i;if(e.tagName==="TABLE"){this.originalElement=this.element,i=document.createElement("div");var n=e.attributes;for(var s in n)typeof n[s]=="object"&&i.setAttribute(n[s].name,n[s].value);e.parentNode.replaceChild(i,e),this.element=e=i}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);t.height&&(t.height=isNaN(t.height)?t.height:t.height+"px",e.style.height=t.height),t.minHeight!==!1&&(t.minHeight=isNaN(t.minHeight)?t.minHeight:t.minHeight+"px",e.style.minHeight=t.minHeight),t.maxHeight!==!1&&(t.maxHeight=isNaN(t.maxHeight)?t.maxHeight:t.maxHeight+"px",e.style.maxHeight=t.maxHeight)}_initializeTable(){var e=this.element,t=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(i=>{i.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),t.footerElement&&this.footerManager.activate(),t.autoColumns&&t.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(i=>{i.initialize()}),this.columnManager.setColumns(t.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){this.dataLoader.load(this.options.data)}destroy(){var e=this.element;for(this.destroyed=!0,gi.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.rows.forEach(function(t){t.wipe()}),this.rowManager.rows=[],this.rowManager.activeRows=[],this.rowManager.displayRows=[];e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,t){var i,n;return this.options.debugInitialization&&!this.initialized&&(e||(i=new Error().stack.split(`
`),n=i[0]=="Error"?i[2]:i[1],n[0]==" "?e=n.trim().split(" ")[1].split(".")[1]:e=n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(t?" "+t:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,t,i){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,t,i,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,t,i){return this.initGuard(),this.dataLoader.load(e,t,i,!0,!0)}updateData(e){var t=0;return this.initGuard(),new Promise((i,n)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(s=>{var o=this.rowManager.findRow(s[this.options.index]);o&&(t++,o.updateData(s).then(()=>{t--,t||i()}))}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(e,t,i){return this.initGuard(),new Promise((n,s)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,t,i).then(o=>{var a=[];o.forEach(function(l){a.push(l.getComponent())}),n(a)}):(console.warn("Update Error - No data provided"),s("Update Error - No data provided"))})}updateOrAddData(e){var t=[],i=0;return this.initGuard(),new Promise((n,s)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(o=>{var a=this.rowManager.findRow(o[this.options.index]);i++,a?a.updateData(o).then(()=>{i--,t.push(a.getComponent()),i||n(t)}):this.rowManager.addRows(o).then(l=>{i--,t.push(l[0].getComponent()),i||n(t)})}):(console.warn("Update Error - No data provided"),s("Update Error - No data provided"))})}getRow(e){var t=this.rowManager.findRow(e);return t?t.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var t=this.rowManager.getRowFromPosition(e);return t?t.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var t=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let i of e){let n=this.rowManager.findRow(i,!0);if(n)t.push(n);else return console.error("Delete Error - No matching row found:",i),Promise.reject("Delete Error - No matching row found")}return t.sort((i,n)=>this.rowManager.rows.indexOf(i)>this.rowManager.rows.indexOf(n)?1:-1),t.forEach(i=>{i.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,t,i){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,t,i).then(n=>n[0].getComponent())}updateOrAddRow(e,t){var i=this.rowManager.findRow(e);return this.initGuard(),typeof t=="string"&&(t=JSON.parse(t)),i?i.updateData(t).then(()=>i.getComponent()):this.rowManager.addRows(t).then(n=>n[0].getComponent())}updateRow(e,t){var i=this.rowManager.findRow(e);return this.initGuard(),typeof t=="string"&&(t=JSON.parse(t)),i?i.updateData(t).then(()=>Promise.resolve(i.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,t,i){var n=this.rowManager.findRow(e);return n?this.rowManager.scrollToRow(n,t,i):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,t,i){var n=this.rowManager.findRow(e);this.initGuard(),n?n.moveToRow(t,i):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var t=this.rowManager.findRow(e);return t?t.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var t=this.columnManager.findColumn(e);return t?t.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var t=this.columnManager.findColumn(e);if(this.initGuard(),t)t.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var t=this.columnManager.findColumn(e);if(this.initGuard(),t)t.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var t=this.columnManager.findColumn(e);if(this.initGuard(),t)t.visible?t.hide():t.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,t,i){var n=this.columnManager.findColumn(i);return this.initGuard(),this.columnManager.addColumn(e,t,n).then(s=>s.getComponent())}deleteColumn(e){var t=this.columnManager.findColumn(e);return this.initGuard(),t?t.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,t){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.updateDefinition(t):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,t,i){var n=this.columnManager.findColumn(e),s=this.columnManager.findColumn(t);this.initGuard(),n?s?this.columnManager.moveColumn(n,s,i):console.warn("Move Error - No matching column found:",s):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,t,i){return new Promise((n,s)=>{var o=this.columnManager.findColumn(e);return o?this.columnManager.scrollToColumn(o,t,i):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw()}on(e,t){this.externalEvents.subscribe(e,t)}off(e,t){this.externalEvents.unsubscribe(e,t)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,t){this.initGuard(),this.alertManager.alert(e,t)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,t){return this.modules[e]?!0:(t&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var t=this.modules[e];return t||console.error("Tabulator module not installed: "+e),t}}ds.defaultOptions=MT;new Op(ds);class kp extends ds{}new Op(kp,AT);class JT extends kp{constructor(e){super("#gcp-table",{layout:"fitDataTable",reactiveData:!0,data:e.gcpFeatures.getArray(),columns:[{formatter:"rowSelection",titleFormatter:"rowSelection",hozAlign:"center",headerSort:!1,cellClick:(t,i)=>i.getRow().toggleSelect()},{title:"mapX",field:"mapX",editor:!0},{title:"mapY",field:"mapY",editor:!0}],rowDblClickMenu:[{label:"Delete point",action:(t,i)=>i.delete()},{label:"Delete selected",action:(t,i)=>i.getTable().getSelectedRows().forEach(n=>n.delete())}]}),e.addControl(new _s({element:this.element})),this.on("rowDeleted",t=>e.gcpSource.removeFeature(t.getData())),["rowSelected","rowDeselected"].forEach(t=>this.on(t,i=>e.toggleGcpSelection(i.getData())))}get gcps(){return this.getData().map(e=>["-gcp",...e.values_.geometry.flatCoordinates.map(Math.abs).map(String),e.mapX,e.mapY]).flat()}}function QT(r){r.gcpFeatures=new mi,r.gcpSource=new ec({features:r.gcpFeatures}),r.gcpStyle={"circle-stroke-color":"#13678A","circle-stroke-width":1.25,"circle-radius":5,"circle-fill-color":"transparent"},r.gcpDrawStyle={"circle-stroke-color":"#484848","circle-stroke-width":1.25,"circle-radius":5,"circle-fill-color":"transparent"},r.gcpSelectStyle=new ya({image:new Ua({fill:new qs({color:"rgb(30, 144, 255)"}),stroke:new Ws({color:"white",width:1.25}),radius:5})}),r.gcpLayer=new Jh({title:"GCPs",source:r.gcpSource,style:r.gcpStyle}),r.gcpDraw=new ex({source:r.gcpSource,type:"Point",style:r.gcpDrawStyle,condition:e=>e.originalEvent.buttons===1}),r.gcpSnap=new ox({source:r.gcpSource}),r.gcpModify=new sx({source:r.gcpSource}),r.addLayer(r.gcpLayer),r.addInteraction(r.gcpDraw),r.addInteraction(r.gcpModify),r.addInteraction(r.gcpSnap),r.on("dblclick",e=>{r.forEachFeatureAtPixel(e.pixel,(t,i)=>{i===r.gcpLayer&&r.gcpSource.removeFeature(t)},{hitTolerance:5})}),r.toggleGcpSelection=function(e){e.selected?(e.selected=!1,e.setStyle(null)):(e.selected=!0,e.setStyle(r.gcpSelectStyle))},r.gcpTable=new JT(r),r.on("click",e=>{r.forEachFeatureAtPixel(e.pixel,(t,i)=>{i===r.gcpLayer&&r.gcpTable.getRows().find(n=>n.getData()===t).toggleSelect()},{hitTolerance:5})})}class e1{constructor(e,t,i){this.switchCbx=e.querySelector(".switch__checkbox"),this.switchSld=e.querySelector(".switch__slider"),this.map1=t.getTargetElement(),this.map2=i.getTargetElement(),this.map2.hidden=!0,this.switchCbx.addEventListener("change",()=>this.toggle())}toggle(){this.switchCbx.checked?(this.map1.hidden=!0,this.map2.hidden=!1):(this.map1.hidden=!1,this.map2.hidden=!0)}init(){this.switchCbx.disabled=!1,this.switchCbx.click(),this.switchSld.classList.remove("switch__slider_disabled")}}function t1(r){fetch("./epsg_api_coordrefsys.json").then(e=>e.json()).then(e=>{r.disabled=!1,e.Results.forEach(t=>r.list.appendChild(new Option(t.Name,`EPSG:${t.Code}`))),r.addEventListener("input",()=>r.epsgCode=r.value)})}const fs=new ap("gcp-map"),Hr=new ap("world-map");Hr.addLayer(new fE({title:"OSM",source:new NC}));const Xl=document.querySelector(".upload-btn > input"),i1=document.querySelector(".upload-btn > .btn-spinner"),Hs=document.querySelector(".georef-btn"),Yl=Hs.querySelector(".btn-spinner");fs.addControl(new _s({element:Hs}));const Np=document.querySelector(".gcp-crs"),Gp=Np.querySelector("input");fs.addControl(new _s({element:Np}));t1(Gp);const n1=new e1(document.querySelector(".switch"),fs,Hr);Xl.addEventListener("input",function(){console.time("image"),console.timeLog("image","image loading..."),i1.classList.toggle("fa-spinner"),Xl.parentElement.classList.add("btn_disabled");const r=new Image;r.file=this.files[0];const e=new FileReader;e.readAsDataURL(r.file),e.onload=t=>{r.src=t.target.result,r.onload=async()=>{console.timeLog("image","image loaded"),console.timeEnd("image"),Xl.parentElement.style.opacity=0;const i=new HC(r);fs.addSlfgrRaster(i),QT(fs)}},this.disabled=!0});KC.init().then(async r=>{Yl.classList.toggle("fa-spinner"),Hs.classList.toggle("btn_disabled"),Hs.addEventListener("click",async()=>{console.time("georef"),console.timeLog("georef","georef started"),Yl.classList.toggle("fa-spinner"),Hs.classList.toggle("btn_disabled");const e=fs.gcpTable.gcps,t=await r.transformGcps(e,Gp.epsgCode);console.log(e,t),r.byTable(fs.raster,t).then(async i=>{console.timeLog("georef","georaster ready"),Hr.addLayer(i.layer),console.timeLog("georef","georaster rendered");const n=await i.layer.getSource().getView(),s=new ki;s.fit(n.extent,{size:Hr.getSize(),padding:[75,75,75,75]}),Hr.setView(s),document.body.appendChild(i.link),n1.init(),Yl.classList.toggle("fa-spinner"),Hs.classList.toggle("btn_disabled"),console.timeLog("georef","georef finished"),console.timeEnd("georef")})})});export{g1 as L,m1 as a};
//# sourceMappingURL=index.72babcd1.js.map
